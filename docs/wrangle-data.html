<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 Wrangling Data in the Tidyverse | Tidyverse Skills for Data Science</title>
  <meta name="description" content="This book demonstrates how to use the Tidyverse collection of packages for doing data science." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 Wrangling Data in the Tidyverse | Tidyverse Skills for Data Science" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This book demonstrates how to use the Tidyverse collection of packages for doing data science." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Wrangling Data in the Tidyverse | Tidyverse Skills for Data Science" />
  
  <meta name="twitter:description" content="This book demonstrates how to use the Tidyverse collection of packages for doing data science." />
  

<meta name="author" content="Carrie Wright, Shannon E. Ellis, Stephanie C. Hicks and Roger D. Peng" />


<meta name="date" content="2020-12-09" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="get-data.html"/>
<link rel="next" href="dataviz.html"/>
<script src="libs/header-attrs-2.5/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.2/htmlwidgets.js"></script>
<link href="libs/str_view-0.1.0/str_view.css" rel="stylesheet" />
<script src="libs/str_view-binding-1.4.0/str_view.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Tidyverse Skills for Data Science</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Introduction to the Tidyverse</a>
<ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#about-this-course"><i class="fa fa-check"></i><b>1.1</b> About This Course</a></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#tidy-data"><i class="fa fa-check"></i><b>1.2</b> Tidy Data</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="intro.html"><a href="intro.html#data-terminology"><i class="fa fa-check"></i><b>1.2.1</b> Data Terminology</a></li>
<li class="chapter" data-level="1.2.2" data-path="intro.html"><a href="intro.html#principles-of-tidy-data"><i class="fa fa-check"></i><b>1.2.2</b> Principles of Tidy Data</a></li>
<li class="chapter" data-level="1.2.3" data-path="intro.html"><a href="intro.html#tidy-data-are-rectangular"><i class="fa fa-check"></i><b>1.2.3</b> Tidy Data Are Rectangular</a></li>
<li class="chapter" data-level="1.2.4" data-path="intro.html"><a href="intro.html#tidy-data-benefits"><i class="fa fa-check"></i><b>1.2.4</b> Tidy Data Benefits</a></li>
<li class="chapter" data-level="1.2.5" data-path="intro.html"><a href="intro.html#rules-for-storing-tidy-data"><i class="fa fa-check"></i><b>1.2.5</b> Rules for Storing Tidy Data</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="intro.html"><a href="intro.html#from-non-tidy-tidy"><i class="fa fa-check"></i><b>1.3</b> From Non-Tidy –&gt; Tidy</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="intro.html"><a href="intro.html#common-problems-with-messy-datasets"><i class="fa fa-check"></i><b>1.3.1</b> Common problems with messy datasets</a></li>
<li class="chapter" data-level="1.3.2" data-path="intro.html"><a href="intro.html#examples-of-untidy-data"><i class="fa fa-check"></i><b>1.3.2</b> Examples of untidy data</a></li>
<li class="chapter" data-level="1.3.3" data-path="intro.html"><a href="intro.html#tidying-untidy-data"><i class="fa fa-check"></i><b>1.3.3</b> Tidying untidy data</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="intro.html"><a href="intro.html#the-data-science-life-cycle"><i class="fa fa-check"></i><b>1.4</b> The Data Science Life Cycle</a></li>
<li class="chapter" data-level="1.5" data-path="intro.html"><a href="intro.html#the-tidyverse-ecosystem"><i class="fa fa-check"></i><b>1.5</b> The Tidyverse Ecosystem</a>
<ul>
<li class="chapter" data-level="1.5.1" data-path="intro.html"><a href="intro.html#reading-data-into-r"><i class="fa fa-check"></i><b>1.5.1</b> Reading Data into R</a></li>
<li class="chapter" data-level="1.5.2" data-path="intro.html"><a href="intro.html#data-tidying"><i class="fa fa-check"></i><b>1.5.2</b> Data Tidying</a></li>
<li class="chapter" data-level="1.5.3" data-path="intro.html"><a href="intro.html#data-visualization"><i class="fa fa-check"></i><b>1.5.3</b> Data Visualization</a></li>
<li class="chapter" data-level="1.5.4" data-path="intro.html"><a href="intro.html#data-modeling"><i class="fa fa-check"></i><b>1.5.4</b> Data Modeling</a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path="intro.html"><a href="intro.html#data-science-project-organization"><i class="fa fa-check"></i><b>1.6</b> Data Science Project Organization</a>
<ul>
<li class="chapter" data-level="1.6.1" data-path="intro.html"><a href="intro.html#rstudio-projects"><i class="fa fa-check"></i><b>1.6.1</b> RStudio Projects</a></li>
<li class="chapter" data-level="1.6.2" data-path="intro.html"><a href="intro.html#file-paths"><i class="fa fa-check"></i><b>1.6.2</b> File Paths</a></li>
<li class="chapter" data-level="1.6.3" data-path="intro.html"><a href="intro.html#the-here-package"><i class="fa fa-check"></i><b>1.6.3</b> The <code>here</code> package</a></li>
<li class="chapter" data-level="1.6.4" data-path="intro.html"><a href="intro.html#file-naming"><i class="fa fa-check"></i><b>1.6.4</b> File Naming</a></li>
<li class="chapter" data-level="1.6.5" data-path="intro.html"><a href="intro.html#project-template-everything-in-its-place"><i class="fa fa-check"></i><b>1.6.5</b> Project Template: Everything In Its Place</a></li>
</ul></li>
<li class="chapter" data-level="1.7" data-path="intro.html"><a href="intro.html#data-science-workflows"><i class="fa fa-check"></i><b>1.7</b> Data Science Workflows</a></li>
<li class="chapter" data-level="1.8" data-path="intro.html"><a href="intro.html#case-studies"><i class="fa fa-check"></i><b>1.8</b> Case Studies</a>
<ul>
<li class="chapter" data-level="1.8.1" data-path="intro.html"><a href="intro.html#case-study-1-health-expenditures"><i class="fa fa-check"></i><b>1.8.1</b> Case Study #1: Health Expenditures</a></li>
<li class="chapter" data-level="1.8.2" data-path="intro.html"><a href="intro.html#case-study-2-firearms"><i class="fa fa-check"></i><b>1.8.2</b> Case Study #2: Firearms</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="get-data.html"><a href="get-data.html"><i class="fa fa-check"></i><b>2</b> Importing Data in the Tidyverse</a>
<ul>
<li class="chapter" data-level="2.1" data-path="get-data.html"><a href="get-data.html#about-this-course-1"><i class="fa fa-check"></i><b>2.1</b> About This Course</a></li>
<li class="chapter" data-level="2.2" data-path="get-data.html"><a href="get-data.html#tibbles"><i class="fa fa-check"></i><b>2.2</b> Tibbles</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="get-data.html"><a href="get-data.html#how-tibbles-differ-from-data.frame"><i class="fa fa-check"></i><b>2.2.1</b> How tibbles differ from data.frame</a></li>
<li class="chapter" data-level="2.2.2" data-path="get-data.html"><a href="get-data.html#creating-a-tibble"><i class="fa fa-check"></i><b>2.2.2</b> Creating a tibble</a></li>
<li class="chapter" data-level="2.2.3" data-path="get-data.html"><a href="get-data.html#subsetting"><i class="fa fa-check"></i><b>2.2.3</b> Subsetting</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="get-data.html"><a href="get-data.html#spreadsheets"><i class="fa fa-check"></i><b>2.3</b> Spreadsheets</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="get-data.html"><a href="get-data.html#excel-files"><i class="fa fa-check"></i><b>2.3.1</b> Excel files</a></li>
<li class="chapter" data-level="2.3.2" data-path="get-data.html"><a href="get-data.html#google-sheets"><i class="fa fa-check"></i><b>2.3.2</b> Google Sheets</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="get-data.html"><a href="get-data.html#csvs"><i class="fa fa-check"></i><b>2.4</b> CSVs</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="get-data.html"><a href="get-data.html#downloading-csv-files"><i class="fa fa-check"></i><b>2.4.1</b> Downloading CSV files</a></li>
<li class="chapter" data-level="2.4.2" data-path="get-data.html"><a href="get-data.html#reading-csvs-into-r"><i class="fa fa-check"></i><b>2.4.2</b> Reading CSVs into R</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="get-data.html"><a href="get-data.html#tsvs"><i class="fa fa-check"></i><b>2.5</b> TSVs</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="get-data.html"><a href="get-data.html#reading-tsvs-into-r"><i class="fa fa-check"></i><b>2.5.1</b> Reading TSVs into R</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="get-data.html"><a href="get-data.html#delimited-files"><i class="fa fa-check"></i><b>2.6</b> Delimited Files</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="get-data.html"><a href="get-data.html#reading-delimited-files-into-r"><i class="fa fa-check"></i><b>2.6.1</b> Reading Delimited Files into R</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="get-data.html"><a href="get-data.html#exporting-data-from-r"><i class="fa fa-check"></i><b>2.7</b> Exporting Data from R</a></li>
<li class="chapter" data-level="2.8" data-path="get-data.html"><a href="get-data.html#json"><i class="fa fa-check"></i><b>2.8</b> JSON</a></li>
<li class="chapter" data-level="2.9" data-path="get-data.html"><a href="get-data.html#xml"><i class="fa fa-check"></i><b>2.9</b> XML</a></li>
<li class="chapter" data-level="2.10" data-path="get-data.html"><a href="get-data.html#databases"><i class="fa fa-check"></i><b>2.10</b> Databases</a>
<ul>
<li class="chapter" data-level="2.10.1" data-path="get-data.html"><a href="get-data.html#relational-data"><i class="fa fa-check"></i><b>2.10.1</b> Relational Data</a></li>
<li class="chapter" data-level="2.10.2" data-path="get-data.html"><a href="get-data.html#relational-databases-sql"><i class="fa fa-check"></i><b>2.10.2</b> Relational Databases: <code>SQL</code></a></li>
<li class="chapter" data-level="2.10.3" data-path="get-data.html"><a href="get-data.html#connecting-to-databases-rsqlite"><i class="fa fa-check"></i><b>2.10.3</b> Connecting to Databases: <code>RSQLite</code></a></li>
<li class="chapter" data-level="2.10.4" data-path="get-data.html"><a href="get-data.html#working-with-relational-data-dplyr-dbplyr"><i class="fa fa-check"></i><b>2.10.4</b> Working with Relational Data: <code>dplyr</code> &amp; <code>dbplyr</code></a></li>
<li class="chapter" data-level="2.10.5" data-path="get-data.html"><a href="get-data.html#mutating-joins"><i class="fa fa-check"></i><b>2.10.5</b> Mutating Joins</a></li>
<li class="chapter" data-level="2.10.6" data-path="get-data.html"><a href="get-data.html#filtering-joins"><i class="fa fa-check"></i><b>2.10.6</b> Filtering Joins</a></li>
<li class="chapter" data-level="2.10.7" data-path="get-data.html"><a href="get-data.html#how-to-connect-to-a-database-online"><i class="fa fa-check"></i><b>2.10.7</b> How to Connect to a Database Online</a></li>
</ul></li>
<li class="chapter" data-level="2.11" data-path="get-data.html"><a href="get-data.html#web-scraping"><i class="fa fa-check"></i><b>2.11</b> Web Scraping</a>
<ul>
<li class="chapter" data-level="2.11.1" data-path="get-data.html"><a href="get-data.html#rvest-basics"><i class="fa fa-check"></i><b>2.11.1</b> <code>rvest</code> Basics</a></li>
<li class="chapter" data-level="2.11.2" data-path="get-data.html"><a href="get-data.html#selectorgadget"><i class="fa fa-check"></i><b>2.11.2</b> SelectorGadget</a></li>
<li class="chapter" data-level="2.11.3" data-path="get-data.html"><a href="get-data.html#web-scraping-example"><i class="fa fa-check"></i><b>2.11.3</b> Web Scraping Example</a></li>
<li class="chapter" data-level="2.11.4" data-path="get-data.html"><a href="get-data.html#a-final-note-selectorgadget"><i class="fa fa-check"></i><b>2.11.4</b> A final note: SelectorGadget</a></li>
</ul></li>
<li class="chapter" data-level="2.12" data-path="get-data.html"><a href="get-data.html#apis"><i class="fa fa-check"></i><b>2.12</b> APIs</a>
<ul>
<li class="chapter" data-level="2.12.1" data-path="get-data.html"><a href="get-data.html#getting-data-httr"><i class="fa fa-check"></i><b>2.12.1</b> Getting Data: <code>httr</code></a></li>
<li class="chapter" data-level="2.12.2" data-path="get-data.html"><a href="get-data.html#example-1-githubs-api"><i class="fa fa-check"></i><b>2.12.2</b> Example 1: GitHub’s API</a></li>
<li class="chapter" data-level="2.12.3" data-path="get-data.html"><a href="get-data.html#example-2-obtaining-a-csv"><i class="fa fa-check"></i><b>2.12.3</b> Example 2: Obtaining a CSV</a></li>
<li class="chapter" data-level="2.12.4" data-path="get-data.html"><a href="get-data.html#read_csv-from-a-url"><i class="fa fa-check"></i><b>2.12.4</b> <code>read_csv()</code> from a URL</a></li>
<li class="chapter" data-level="2.12.5" data-path="get-data.html"><a href="get-data.html#api-keys"><i class="fa fa-check"></i><b>2.12.5</b> API keys</a></li>
</ul></li>
<li class="chapter" data-level="2.13" data-path="get-data.html"><a href="get-data.html#foreign-formats"><i class="fa fa-check"></i><b>2.13</b> Foreign Formats</a>
<ul>
<li class="chapter" data-level="2.13.1" data-path="get-data.html"><a href="get-data.html#haven-1"><i class="fa fa-check"></i><b>2.13.1</b> <code>haven</code></a></li>
</ul></li>
<li class="chapter" data-level="2.14" data-path="get-data.html"><a href="get-data.html#images"><i class="fa fa-check"></i><b>2.14</b> Images</a></li>
<li class="chapter" data-level="2.15" data-path="get-data.html"><a href="get-data.html#googledrive-1"><i class="fa fa-check"></i><b>2.15</b> <code>googledrive</code></a></li>
<li class="chapter" data-level="2.16" data-path="get-data.html"><a href="get-data.html#case-studies-1"><i class="fa fa-check"></i><b>2.16</b> Case Studies</a>
<ul>
<li class="chapter" data-level="2.16.1" data-path="get-data.html"><a href="get-data.html#case-study-1-health-expenditures-1"><i class="fa fa-check"></i><b>2.16.1</b> Case Study #1: Health Expenditures</a></li>
<li class="chapter" data-level="2.16.2" data-path="get-data.html"><a href="get-data.html#case-study-2-firearms-1"><i class="fa fa-check"></i><b>2.16.2</b> Case Study #2: Firearms</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="wrangle-data.html"><a href="wrangle-data.html"><i class="fa fa-check"></i><b>3</b> Wrangling Data in the Tidyverse</a>
<ul>
<li class="chapter" data-level="3.1" data-path="wrangle-data.html"><a href="wrangle-data.html#about-this-course-2"><i class="fa fa-check"></i><b>3.1</b> About This Course</a></li>
<li class="chapter" data-level="3.2" data-path="wrangle-data.html"><a href="wrangle-data.html#tidy-data-review"><i class="fa fa-check"></i><b>3.2</b> Tidy Data Review</a></li>
<li class="chapter" data-level="3.3" data-path="wrangle-data.html"><a href="wrangle-data.html#reshaping-data"><i class="fa fa-check"></i><b>3.3</b> Reshaping Data</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="wrangle-data.html"><a href="wrangle-data.html#wide-data"><i class="fa fa-check"></i><b>3.3.1</b> Wide Data</a></li>
<li class="chapter" data-level="3.3.2" data-path="wrangle-data.html"><a href="wrangle-data.html#long-data"><i class="fa fa-check"></i><b>3.3.2</b> Long Data</a></li>
<li class="chapter" data-level="3.3.3" data-path="wrangle-data.html"><a href="wrangle-data.html#reshaping-the-data"><i class="fa fa-check"></i><b>3.3.3</b> Reshaping the Data</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="wrangle-data.html"><a href="wrangle-data.html#data-wrangling"><i class="fa fa-check"></i><b>3.4</b> Data Wrangling</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="wrangle-data.html"><a href="wrangle-data.html#r-packages"><i class="fa fa-check"></i><b>3.4.1</b> R Packages</a></li>
<li class="chapter" data-level="3.4.2" data-path="wrangle-data.html"><a href="wrangle-data.html#the-pipe-operator"><i class="fa fa-check"></i><b>3.4.2</b> The Pipe Operator</a></li>
<li class="chapter" data-level="3.4.3" data-path="wrangle-data.html"><a href="wrangle-data.html#filtering-data"><i class="fa fa-check"></i><b>3.4.3</b> Filtering Data</a></li>
<li class="chapter" data-level="3.4.4" data-path="wrangle-data.html"><a href="wrangle-data.html#reordering"><i class="fa fa-check"></i><b>3.4.4</b> Reordering</a></li>
<li class="chapter" data-level="3.4.5" data-path="wrangle-data.html"><a href="wrangle-data.html#creating-new-columns"><i class="fa fa-check"></i><b>3.4.5</b> Creating New Columns</a></li>
<li class="chapter" data-level="3.4.6" data-path="wrangle-data.html"><a href="wrangle-data.html#separating-columns"><i class="fa fa-check"></i><b>3.4.6</b> Separating Columns</a></li>
<li class="chapter" data-level="3.4.7" data-path="wrangle-data.html"><a href="wrangle-data.html#merging-columns"><i class="fa fa-check"></i><b>3.4.7</b> Merging Columns</a></li>
<li class="chapter" data-level="3.4.8" data-path="wrangle-data.html"><a href="wrangle-data.html#cleaning-column-names"><i class="fa fa-check"></i><b>3.4.8</b> Cleaning Column Names</a></li>
<li class="chapter" data-level="3.4.9" data-path="wrangle-data.html"><a href="wrangle-data.html#combining-data-across-data-frames"><i class="fa fa-check"></i><b>3.4.9</b> Combining Data Across Data Frames</a></li>
<li class="chapter" data-level="3.4.10" data-path="wrangle-data.html"><a href="wrangle-data.html#grouping-data"><i class="fa fa-check"></i><b>3.4.10</b> Grouping Data</a></li>
<li class="chapter" data-level="3.4.11" data-path="wrangle-data.html"><a href="wrangle-data.html#summarizing-data"><i class="fa fa-check"></i><b>3.4.11</b> Summarizing Data</a></li>
<li class="chapter" data-level="3.4.12" data-path="wrangle-data.html"><a href="wrangle-data.html#operations-across-columns"><i class="fa fa-check"></i><b>3.4.12</b> Operations Across Columns</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="wrangle-data.html"><a href="wrangle-data.html#working-with-factors"><i class="fa fa-check"></i><b>3.5</b> Working With Factors</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="wrangle-data.html"><a href="wrangle-data.html#factor-review"><i class="fa fa-check"></i><b>3.5.1</b> Factor Review</a></li>
<li class="chapter" data-level="3.5.2" data-path="wrangle-data.html"><a href="wrangle-data.html#manually-changing-the-labels-of-factor-levels-fct_relevel"><i class="fa fa-check"></i><b>3.5.2</b> Manually Changing the Labels of Factor Levels: <code>fct_relevel()</code></a></li>
<li class="chapter" data-level="3.5.3" data-path="wrangle-data.html"><a href="wrangle-data.html#keeping-the-order-of-the-factor-levels-fct_inorder"><i class="fa fa-check"></i><b>3.5.3</b> Keeping the Order of the Factor Levels: <code>fct_inorder()</code></a></li>
<li class="chapter" data-level="3.5.4" data-path="wrangle-data.html"><a href="wrangle-data.html#advanced-factoring"><i class="fa fa-check"></i><b>3.5.4</b> Advanced Factoring</a></li>
<li class="chapter" data-level="3.5.5" data-path="wrangle-data.html"><a href="wrangle-data.html#re-ordering-factor-levels-by-frequency-fct_infreq"><i class="fa fa-check"></i><b>3.5.5</b> Re-ordering Factor Levels by Frequency: <code>fct_infreq()</code></a></li>
<li class="chapter" data-level="3.5.6" data-path="wrangle-data.html"><a href="wrangle-data.html#reversing-order-levels-fct_rev"><i class="fa fa-check"></i><b>3.5.6</b> Reversing Order Levels: <code>fct_rev()</code></a></li>
<li class="chapter" data-level="3.5.7" data-path="wrangle-data.html"><a href="wrangle-data.html#re-ordering-factor-levels-by-another-variable-fct_reorder"><i class="fa fa-check"></i><b>3.5.7</b> Re-ordering Factor Levels by Another Variable: <code>fct_reorder()</code></a></li>
<li class="chapter" data-level="3.5.8" data-path="wrangle-data.html"><a href="wrangle-data.html#combining-several-levels-into-one-fct_recode"><i class="fa fa-check"></i><b>3.5.8</b> Combining Several Levels into One: <code>fct_recode()</code></a></li>
<li class="chapter" data-level="3.5.9" data-path="wrangle-data.html"><a href="wrangle-data.html#converting-numeric-levels-to-factors-ifelse-factor"><i class="fa fa-check"></i><b>3.5.9</b> Converting Numeric Levels to Factors: <code>ifelse()</code> + <code>factor()</code></a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="wrangle-data.html"><a href="wrangle-data.html#working-with-dates-and-times"><i class="fa fa-check"></i><b>3.6</b> Working With Dates and Times</a>
<ul>
<li class="chapter" data-level="3.6.1" data-path="wrangle-data.html"><a href="wrangle-data.html#dates-and-times-basics"><i class="fa fa-check"></i><b>3.6.1</b> Dates and Times Basics</a></li>
<li class="chapter" data-level="3.6.2" data-path="wrangle-data.html"><a href="wrangle-data.html#creating-dates-and-date-time-objects"><i class="fa fa-check"></i><b>3.6.2</b> Creating Dates and Date-Time Objects</a></li>
<li class="chapter" data-level="3.6.3" data-path="wrangle-data.html"><a href="wrangle-data.html#working-with-dates"><i class="fa fa-check"></i><b>3.6.3</b> Working with Dates</a></li>
<li class="chapter" data-level="3.6.4" data-path="wrangle-data.html"><a href="wrangle-data.html#time-spans"><i class="fa fa-check"></i><b>3.6.4</b> Time Spans</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="wrangle-data.html"><a href="wrangle-data.html#working-with-strings"><i class="fa fa-check"></i><b>3.7</b> Working With Strings</a>
<ul>
<li class="chapter" data-level="3.7.1" data-path="wrangle-data.html"><a href="wrangle-data.html#stringr-1"><i class="fa fa-check"></i><b>3.7.1</b> <code>stringr</code></a></li>
<li class="chapter" data-level="3.7.2" data-path="wrangle-data.html"><a href="wrangle-data.html#string-basics"><i class="fa fa-check"></i><b>3.7.2</b> String Basics</a></li>
<li class="chapter" data-level="3.7.3" data-path="wrangle-data.html"><a href="wrangle-data.html#regular-expressions"><i class="fa fa-check"></i><b>3.7.3</b> Regular Expressions</a></li>
<li class="chapter" data-level="3.7.4" data-path="wrangle-data.html"><a href="wrangle-data.html#glue-1"><i class="fa fa-check"></i><b>3.7.4</b> <code>glue</code></a></li>
</ul></li>
<li class="chapter" data-level="3.8" data-path="wrangle-data.html"><a href="wrangle-data.html#working-with-text"><i class="fa fa-check"></i><b>3.8</b> Working With Text</a>
<ul>
<li class="chapter" data-level="3.8.1" data-path="wrangle-data.html"><a href="wrangle-data.html#tidy-text-format"><i class="fa fa-check"></i><b>3.8.1</b> Tidy Text Format</a></li>
<li class="chapter" data-level="3.8.2" data-path="wrangle-data.html"><a href="wrangle-data.html#sentiment-analysis"><i class="fa fa-check"></i><b>3.8.2</b> Sentiment Analysis</a></li>
<li class="chapter" data-level="3.8.3" data-path="wrangle-data.html"><a href="wrangle-data.html#word-and-document-frequency"><i class="fa fa-check"></i><b>3.8.3</b> Word and Document Frequency</a></li>
</ul></li>
<li class="chapter" data-level="3.9" data-path="wrangle-data.html"><a href="wrangle-data.html#functional-programming"><i class="fa fa-check"></i><b>3.9</b> Functional Programming</a>
<ul>
<li class="chapter" data-level="3.9.1" data-path="wrangle-data.html"><a href="wrangle-data.html#for-loops-vs.-functionals"><i class="fa fa-check"></i><b>3.9.1</b> For Loops vs. Functionals</a></li>
<li class="chapter" data-level="3.9.2" data-path="wrangle-data.html"><a href="wrangle-data.html#map-functions"><i class="fa fa-check"></i><b>3.9.2</b> <code>map</code> Functions</a></li>
<li class="chapter" data-level="3.9.3" data-path="wrangle-data.html"><a href="wrangle-data.html#multiple-vectors"><i class="fa fa-check"></i><b>3.9.3</b> Multiple Vectors</a></li>
<li class="chapter" data-level="3.9.4" data-path="wrangle-data.html"><a href="wrangle-data.html#anonymous-functions"><i class="fa fa-check"></i><b>3.9.4</b> Anonymous Functions</a></li>
</ul></li>
<li class="chapter" data-level="3.10" data-path="wrangle-data.html"><a href="wrangle-data.html#exploratory-data-analysis"><i class="fa fa-check"></i><b>3.10</b> Exploratory Data Analysis</a>
<ul>
<li class="chapter" data-level="3.10.1" data-path="wrangle-data.html"><a href="wrangle-data.html#general-principles-of-eda"><i class="fa fa-check"></i><b>3.10.1</b> General Principles of EDA</a></li>
<li class="chapter" data-level="3.10.2" data-path="wrangle-data.html"><a href="wrangle-data.html#analyzing-json-in-r"><i class="fa fa-check"></i><b>3.10.2</b> Analyzing JSON in R</a></li>
<li class="chapter" data-level="3.10.3" data-path="wrangle-data.html"><a href="wrangle-data.html#analyzing-xml-in-r"><i class="fa fa-check"></i><b>3.10.3</b> Analyzing XML in R</a></li>
</ul></li>
<li class="chapter" data-level="3.11" data-path="wrangle-data.html"><a href="wrangle-data.html#case-studies-2"><i class="fa fa-check"></i><b>3.11</b> Case Studies</a>
<ul>
<li class="chapter" data-level="3.11.1" data-path="wrangle-data.html"><a href="wrangle-data.html#case-study-1-health-expenditures-2"><i class="fa fa-check"></i><b>3.11.1</b> Case Study #1: Health Expenditures</a></li>
<li class="chapter" data-level="3.11.2" data-path="wrangle-data.html"><a href="wrangle-data.html#case-study-2-firearms-2"><i class="fa fa-check"></i><b>3.11.2</b> Case Study #2: Firearms</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="dataviz.html"><a href="dataviz.html"><i class="fa fa-check"></i><b>4</b> Visualizing Data in the Tidyverse</a>
<ul>
<li class="chapter" data-level="4.1" data-path="dataviz.html"><a href="dataviz.html#about-this-course-3"><i class="fa fa-check"></i><b>4.1</b> About This Course</a></li>
<li class="chapter" data-level="4.2" data-path="dataviz.html"><a href="dataviz.html#data-visualization-background"><i class="fa fa-check"></i><b>4.2</b> Data Visualization Background</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="dataviz.html"><a href="dataviz.html#general-features-of-plots"><i class="fa fa-check"></i><b>4.2.1</b> General Features of Plots</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="dataviz.html"><a href="dataviz.html#plot-types"><i class="fa fa-check"></i><b>4.3</b> Plot Types</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="dataviz.html"><a href="dataviz.html#histogram"><i class="fa fa-check"></i><b>4.3.1</b> Histogram</a></li>
<li class="chapter" data-level="4.3.2" data-path="dataviz.html"><a href="dataviz.html#densityplot"><i class="fa fa-check"></i><b>4.3.2</b> Densityplot</a></li>
<li class="chapter" data-level="4.3.3" data-path="dataviz.html"><a href="dataviz.html#scatterplot"><i class="fa fa-check"></i><b>4.3.3</b> Scatterplot</a></li>
<li class="chapter" data-level="4.3.4" data-path="dataviz.html"><a href="dataviz.html#barplot"><i class="fa fa-check"></i><b>4.3.4</b> Barplot</a></li>
<li class="chapter" data-level="4.3.5" data-path="dataviz.html"><a href="dataviz.html#boxplot"><i class="fa fa-check"></i><b>4.3.5</b> Boxplot</a></li>
<li class="chapter" data-level="4.3.6" data-path="dataviz.html"><a href="dataviz.html#line-plots"><i class="fa fa-check"></i><b>4.3.6</b> Line Plots</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="dataviz.html"><a href="dataviz.html#making-good-plots"><i class="fa fa-check"></i><b>4.4</b> Making Good Plots</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="dataviz.html"><a href="dataviz.html#choose-the-right-type-of-plot"><i class="fa fa-check"></i><b>4.4.1</b> Choose the Right Type of Plot</a></li>
<li class="chapter" data-level="4.4.2" data-path="dataviz.html"><a href="dataviz.html#be-mindful-when-choosing-colors"><i class="fa fa-check"></i><b>4.4.2</b> Be Mindful When Choosing Colors</a></li>
<li class="chapter" data-level="4.4.3" data-path="dataviz.html"><a href="dataviz.html#label-the-axes"><i class="fa fa-check"></i><b>4.4.3</b> Label the Axes</a></li>
<li class="chapter" data-level="4.4.4" data-path="dataviz.html"><a href="dataviz.html#make-sure-the-text-is-readable"><i class="fa fa-check"></i><b>4.4.4</b> Make Sure the Text is Readable</a></li>
<li class="chapter" data-level="4.4.5" data-path="dataviz.html"><a href="dataviz.html#make-sure-the-numbers-add-up"><i class="fa fa-check"></i><b>4.4.5</b> Make Sure the Numbers Add Up</a></li>
<li class="chapter" data-level="4.4.6" data-path="dataviz.html"><a href="dataviz.html#make-sure-the-numbers-and-plots-make-sense-together"><i class="fa fa-check"></i><b>4.4.6</b> Make Sure the Numbers and Plots Make Sense Together</a></li>
<li class="chapter" data-level="4.4.7" data-path="dataviz.html"><a href="dataviz.html#make-comparisons-easy-on-viewers"><i class="fa fa-check"></i><b>4.4.7</b> Make Comparisons Easy on Viewers</a></li>
<li class="chapter" data-level="4.4.8" data-path="dataviz.html"><a href="dataviz.html#use-y-axes-that-start-at-zero"><i class="fa fa-check"></i><b>4.4.8</b> Use y-axes That Start at Zero</a></li>
<li class="chapter" data-level="4.4.9" data-path="dataviz.html"><a href="dataviz.html#keep-it-simple"><i class="fa fa-check"></i><b>4.4.9</b> Keep It Simple</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="dataviz.html"><a href="dataviz.html#plot-generation-process"><i class="fa fa-check"></i><b>4.5</b> Plot Generation Process</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="dataviz.html"><a href="dataviz.html#whats-your-point"><i class="fa fa-check"></i><b>4.5.1</b> What’s your point?</a></li>
<li class="chapter" data-level="4.5.2" data-path="dataviz.html"><a href="dataviz.html#how-can-you-emphasize-your-point-in-your-chart"><i class="fa fa-check"></i><b>4.5.2</b> How can you emphasize your point in your chart?</a></li>
<li class="chapter" data-level="4.5.3" data-path="dataviz.html"><a href="dataviz.html#what-does-your-final-chart-show"><i class="fa fa-check"></i><b>4.5.3</b> What Does Your Final Chart Show?</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="dataviz.html"><a href="dataviz.html#ggplot2-basics"><i class="fa fa-check"></i><b>4.6</b> <code>ggplot2</code>: Basics</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="dataviz.html"><a href="dataviz.html#ggplot2-background"><i class="fa fa-check"></i><b>4.6.1</b> <code>ggplot2</code> Background</a></li>
<li class="chapter" data-level="4.6.2" data-path="dataviz.html"><a href="dataviz.html#example-dataset-diamonds"><i class="fa fa-check"></i><b>4.6.2</b> Example Dataset: <code>diamonds</code></a></li>
<li class="chapter" data-level="4.6.3" data-path="dataviz.html"><a href="dataviz.html#scatterplots-geom_point"><i class="fa fa-check"></i><b>4.6.3</b> Scatterplots: <code>geom_point()</code></a></li>
<li class="chapter" data-level="4.6.4" data-path="dataviz.html"><a href="dataviz.html#aesthetics"><i class="fa fa-check"></i><b>4.6.4</b> Aesthetics</a></li>
<li class="chapter" data-level="4.6.5" data-path="dataviz.html"><a href="dataviz.html#facets"><i class="fa fa-check"></i><b>4.6.5</b> Facets</a></li>
<li class="chapter" data-level="4.6.6" data-path="dataviz.html"><a href="dataviz.html#geoms"><i class="fa fa-check"></i><b>4.6.6</b> Geoms</a></li>
<li class="chapter" data-level="4.6.7" data-path="dataviz.html"><a href="dataviz.html#eda-plots"><i class="fa fa-check"></i><b>4.6.7</b> EDA Plots</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="dataviz.html"><a href="dataviz.html#ggplot2-customization"><i class="fa fa-check"></i><b>4.7</b> <code>ggplot2</code>: Customization</a>
<ul>
<li class="chapter" data-level="4.7.1" data-path="dataviz.html"><a href="dataviz.html#colors"><i class="fa fa-check"></i><b>4.7.1</b> Colors</a></li>
<li class="chapter" data-level="4.7.2" data-path="dataviz.html"><a href="dataviz.html#labels"><i class="fa fa-check"></i><b>4.7.2</b> Labels</a></li>
<li class="chapter" data-level="4.7.3" data-path="dataviz.html"><a href="dataviz.html#themes"><i class="fa fa-check"></i><b>4.7.3</b> Themes</a></li>
<li class="chapter" data-level="4.7.4" data-path="dataviz.html"><a href="dataviz.html#custom-theme"><i class="fa fa-check"></i><b>4.7.4</b> Custom Theme</a></li>
<li class="chapter" data-level="4.7.5" data-path="dataviz.html"><a href="dataviz.html#legends"><i class="fa fa-check"></i><b>4.7.5</b> Legends</a></li>
<li class="chapter" data-level="4.7.6" data-path="dataviz.html"><a href="dataviz.html#scales"><i class="fa fa-check"></i><b>4.7.6</b> Scales</a></li>
<li class="chapter" data-level="4.7.7" data-path="dataviz.html"><a href="dataviz.html#coordinate-adjustment"><i class="fa fa-check"></i><b>4.7.7</b> Coordinate Adjustment</a></li>
<li class="chapter" data-level="4.7.8" data-path="dataviz.html"><a href="dataviz.html#annotation"><i class="fa fa-check"></i><b>4.7.8</b> Annotation</a></li>
<li class="chapter" data-level="4.7.9" data-path="dataviz.html"><a href="dataviz.html#vertical-and-horizontal-lines"><i class="fa fa-check"></i><b>4.7.9</b> Vertical and Horizontal Lines</a></li>
</ul></li>
<li class="chapter" data-level="4.8" data-path="dataviz.html"><a href="dataviz.html#tables"><i class="fa fa-check"></i><b>4.8</b> Tables</a>
<ul>
<li class="chapter" data-level="4.8.1" data-path="dataviz.html"><a href="dataviz.html#tables-in-r"><i class="fa fa-check"></i><b>4.8.1</b> Tables in R</a></li>
<li class="chapter" data-level="4.8.2" data-path="dataviz.html"><a href="dataviz.html#getting-the-data-in-order"><i class="fa fa-check"></i><b>4.8.2</b> Getting the Data in Order</a></li>
<li class="chapter" data-level="4.8.3" data-path="dataviz.html"><a href="dataviz.html#an-exploratory-table"><i class="fa fa-check"></i><b>4.8.3</b> An Exploratory Table</a></li>
<li class="chapter" data-level="4.8.4" data-path="dataviz.html"><a href="dataviz.html#improving-the-table-output"><i class="fa fa-check"></i><b>4.8.4</b> Improving the Table Output</a></li>
<li class="chapter" data-level="4.8.5" data-path="dataviz.html"><a href="dataviz.html#annotating-your-table"><i class="fa fa-check"></i><b>4.8.5</b> Annotating Your Table</a></li>
</ul></li>
<li class="chapter" data-level="4.9" data-path="dataviz.html"><a href="dataviz.html#ggplot2-extensions"><i class="fa fa-check"></i><b>4.9</b> <code>ggplot2</code>: Extensions</a>
<ul>
<li class="chapter" data-level="4.9.1" data-path="dataviz.html"><a href="dataviz.html#ggrepel-1"><i class="fa fa-check"></i><b>4.9.1</b> <code>ggrepel</code></a></li>
<li class="chapter" data-level="4.9.2" data-path="dataviz.html"><a href="dataviz.html#directlabels"><i class="fa fa-check"></i><b>4.9.2</b> <code>directlabels</code></a></li>
<li class="chapter" data-level="4.9.3" data-path="dataviz.html"><a href="dataviz.html#cowplot-1"><i class="fa fa-check"></i><b>4.9.3</b> <code>cowplot</code></a></li>
<li class="chapter" data-level="4.9.4" data-path="dataviz.html"><a href="dataviz.html#patchwork-1"><i class="fa fa-check"></i><b>4.9.4</b> <code>patchwork</code></a></li>
<li class="chapter" data-level="4.9.5" data-path="dataviz.html"><a href="dataviz.html#gganimate-1"><i class="fa fa-check"></i><b>4.9.5</b> <code>gganimate</code></a></li>
</ul></li>
<li class="chapter" data-level="4.10" data-path="dataviz.html"><a href="dataviz.html#case-studies-3"><i class="fa fa-check"></i><b>4.10</b> Case Studies</a>
<ul>
<li class="chapter" data-level="4.10.1" data-path="dataviz.html"><a href="dataviz.html#case-study-1-health-expenditures-3"><i class="fa fa-check"></i><b>4.10.1</b> Case Study #1: Health Expenditures</a></li>
<li class="chapter" data-level="4.10.2" data-path="dataviz.html"><a href="dataviz.html#case-study-2-firearms-3"><i class="fa fa-check"></i><b>4.10.2</b> Case Study #2: Firearms</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="model.html"><a href="model.html"><i class="fa fa-check"></i><b>5</b> Modeling Data in the Tidyverse</a>
<ul>
<li class="chapter" data-level="5.1" data-path="model.html"><a href="model.html#about-this-course-4"><i class="fa fa-check"></i><b>5.1</b> About This Course</a></li>
<li class="chapter" data-level="5.2" data-path="model.html"><a href="model.html#the-purpose-of-data-science"><i class="fa fa-check"></i><b>5.2</b> The Purpose of Data Science</a></li>
<li class="chapter" data-level="5.3" data-path="model.html"><a href="model.html#types-of-data-science-questions"><i class="fa fa-check"></i><b>5.3</b> Types of Data Science Questions</a></li>
<li class="chapter" data-level="5.4" data-path="model.html"><a href="model.html#data-needs"><i class="fa fa-check"></i><b>5.4</b> Data Needs</a></li>
<li class="chapter" data-level="5.5" data-path="model.html"><a href="model.html#descriptive-and-exploratory-analysis"><i class="fa fa-check"></i><b>5.5</b> Descriptive and Exploratory Analysis</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="model.html"><a href="model.html#missing-values"><i class="fa fa-check"></i><b>5.5.1</b> Missing Values</a></li>
<li class="chapter" data-level="5.5.2" data-path="model.html"><a href="model.html#shape"><i class="fa fa-check"></i><b>5.5.2</b> Shape</a></li>
<li class="chapter" data-level="5.5.3" data-path="model.html"><a href="model.html#identifying-outliers"><i class="fa fa-check"></i><b>5.5.3</b> Identifying Outliers</a></li>
<li class="chapter" data-level="5.5.4" data-path="model.html"><a href="model.html#evaluating-variables"><i class="fa fa-check"></i><b>5.5.4</b> Evaluating Variables</a></li>
<li class="chapter" data-level="5.5.5" data-path="model.html"><a href="model.html#evaluating-relationships"><i class="fa fa-check"></i><b>5.5.5</b> Evaluating Relationships</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="model.html"><a href="model.html#inference"><i class="fa fa-check"></i><b>5.6</b> Inference</a>
<ul>
<li class="chapter" data-level="5.6.1" data-path="model.html"><a href="model.html#uncertainty"><i class="fa fa-check"></i><b>5.6.1</b> Uncertainty</a></li>
<li class="chapter" data-level="5.6.2" data-path="model.html"><a href="model.html#random-sampling"><i class="fa fa-check"></i><b>5.6.2</b> Random Sampling</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="model.html"><a href="model.html#linear-modeling"><i class="fa fa-check"></i><b>5.7</b> Linear Modeling</a>
<ul>
<li class="chapter" data-level="5.7.1" data-path="model.html"><a href="model.html#linear-regression"><i class="fa fa-check"></i><b>5.7.1</b> Linear Regression</a></li>
<li class="chapter" data-level="5.7.2" data-path="model.html"><a href="model.html#assumptions"><i class="fa fa-check"></i><b>5.7.2</b> Assumptions</a></li>
<li class="chapter" data-level="5.7.3" data-path="model.html"><a href="model.html#association"><i class="fa fa-check"></i><b>5.7.3</b> Association</a></li>
<li class="chapter" data-level="5.7.4" data-path="model.html"><a href="model.html#association-testing-in-r"><i class="fa fa-check"></i><b>5.7.4</b> Association Testing in R</a></li>
<li class="chapter" data-level="5.7.5" data-path="model.html"><a href="model.html#fitting-the-model"><i class="fa fa-check"></i><b>5.7.5</b> Fitting the Model</a></li>
<li class="chapter" data-level="5.7.6" data-path="model.html"><a href="model.html#model-diagnostics"><i class="fa fa-check"></i><b>5.7.6</b> Model Diagnostics</a></li>
<li class="chapter" data-level="5.7.7" data-path="model.html"><a href="model.html#tree-girth-and-height-example"><i class="fa fa-check"></i><b>5.7.7</b> Tree Girth and Height Example</a></li>
<li class="chapter" data-level="5.7.8" data-path="model.html"><a href="model.html#interpreting-the-model"><i class="fa fa-check"></i><b>5.7.8</b> Interpreting the Model</a></li>
<li class="chapter" data-level="5.7.9" data-path="model.html"><a href="model.html#variance-explained"><i class="fa fa-check"></i><b>5.7.9</b> Variance Explained</a></li>
<li class="chapter" data-level="5.7.10" data-path="model.html"><a href="model.html#using-broom"><i class="fa fa-check"></i><b>5.7.10</b> Using <code>broom</code></a></li>
<li class="chapter" data-level="5.7.11" data-path="model.html"><a href="model.html#correlation-is-not-causation"><i class="fa fa-check"></i><b>5.7.11</b> Correlation Is Not Causation</a></li>
<li class="chapter" data-level="5.7.12" data-path="model.html"><a href="model.html#confounding"><i class="fa fa-check"></i><b>5.7.12</b> Confounding</a></li>
</ul></li>
<li class="chapter" data-level="5.8" data-path="model.html"><a href="model.html#multiple-linear-regression"><i class="fa fa-check"></i><b>5.8</b> Multiple Linear Regression</a></li>
<li class="chapter" data-level="5.9" data-path="model.html"><a href="model.html#beyond-linear-regression"><i class="fa fa-check"></i><b>5.9</b> Beyond Linear Regression</a>
<ul>
<li class="chapter" data-level="5.9.1" data-path="model.html"><a href="model.html#mean-different-from-expectation"><i class="fa fa-check"></i><b>5.9.1</b> Mean Different From Expectation?</a></li>
<li class="chapter" data-level="5.9.2" data-path="model.html"><a href="model.html#testing-mean-difference-from-expectation-in-r"><i class="fa fa-check"></i><b>5.9.2</b> Testing Mean Difference From Expectation in R</a></li>
</ul></li>
<li class="chapter" data-level="5.10" data-path="model.html"><a href="model.html#more-statistical-tests"><i class="fa fa-check"></i><b>5.10</b> More Statistical Tests</a></li>
<li class="chapter" data-level="5.11" data-path="model.html"><a href="model.html#hypothesis-testing"><i class="fa fa-check"></i><b>5.11</b> Hypothesis Testing</a>
<ul>
<li class="chapter" data-level="5.11.1" data-path="model.html"><a href="model.html#theinfer-package"><i class="fa fa-check"></i><b>5.11.1</b> The<code>Infer</code> Package</a></li>
</ul></li>
<li class="chapter" data-level="5.12" data-path="model.html"><a href="model.html#prediction-modeling"><i class="fa fa-check"></i><b>5.12</b> Prediction Modeling</a>
<ul>
<li class="chapter" data-level="5.12.1" data-path="model.html"><a href="model.html#what-is-machine-learning"><i class="fa fa-check"></i><b>5.12.1</b> What is Machine Learning?</a></li>
<li class="chapter" data-level="5.12.2" data-path="model.html"><a href="model.html#machine-learning-steps"><i class="fa fa-check"></i><b>5.12.2</b> Machine Learning Steps</a></li>
<li class="chapter" data-level="5.12.3" data-path="model.html"><a href="model.html#data-splitting"><i class="fa fa-check"></i><b>5.12.3</b> Data Splitting</a></li>
<li class="chapter" data-level="5.12.4" data-path="model.html"><a href="model.html#train-test-validate"><i class="fa fa-check"></i><b>5.12.4</b> Train, Test, Validate</a></li>
<li class="chapter" data-level="5.12.5" data-path="model.html"><a href="model.html#train"><i class="fa fa-check"></i><b>5.12.5</b> Train</a></li>
<li class="chapter" data-level="5.12.6" data-path="model.html"><a href="model.html#test"><i class="fa fa-check"></i><b>5.12.6</b> Test</a></li>
<li class="chapter" data-level="5.12.7" data-path="model.html"><a href="model.html#validate"><i class="fa fa-check"></i><b>5.12.7</b> Validate</a></li>
<li class="chapter" data-level="5.12.8" data-path="model.html"><a href="model.html#variable-selection"><i class="fa fa-check"></i><b>5.12.8</b> Variable Selection</a></li>
<li class="chapter" data-level="5.12.9" data-path="model.html"><a href="model.html#model-selection"><i class="fa fa-check"></i><b>5.12.9</b> Model Selection</a></li>
<li class="chapter" data-level="5.12.10" data-path="model.html"><a href="model.html#regression-vs.-classification"><i class="fa fa-check"></i><b>5.12.10</b> Regression vs. Classification</a></li>
<li class="chapter" data-level="5.12.11" data-path="model.html"><a href="model.html#model-accuracy"><i class="fa fa-check"></i><b>5.12.11</b> Model Accuracy</a></li>
</ul></li>
<li class="chapter" data-level="5.13" data-path="model.html"><a href="model.html#the-tidymodels-ecosystem-1"><i class="fa fa-check"></i><b>5.13</b> The <code>tidymodels</code> Ecosystem</a>
<ul>
<li class="chapter" data-level="5.13.1" data-path="model.html"><a href="model.html#benefits-of-tidymodels"><i class="fa fa-check"></i><b>5.13.1</b> Benefits of <code>tidymodels</code></a></li>
<li class="chapter" data-level="5.13.2" data-path="model.html"><a href="model.html#packages-of-tidymodels"><i class="fa fa-check"></i><b>5.13.2</b> Packages of <code>tidymodels</code></a></li>
<li class="chapter" data-level="5.13.3" data-path="model.html"><a href="model.html#example-of-continuous-variable-prediction"><i class="fa fa-check"></i><b>5.13.3</b> Example of Continuous Variable Prediction</a></li>
<li class="chapter" data-level="5.13.4" data-path="model.html"><a href="model.html#example-of-categorical-variable-prediction"><i class="fa fa-check"></i><b>5.13.4</b> Example of Categorical Variable Prediction</a></li>
</ul></li>
<li class="chapter" data-level="5.14" data-path="model.html"><a href="model.html#case-studies-4"><i class="fa fa-check"></i><b>5.14</b> Case Studies</a>
<ul>
<li class="chapter" data-level="5.14.1" data-path="model.html"><a href="model.html#case-study-1-predicting-annual-air-pollution"><i class="fa fa-check"></i><b>5.14.1</b> Case Study #1: Predicting Annual Air Pollution</a></li>
</ul></li>
<li class="chapter" data-level="5.15" data-path="model.html"><a href="model.html#summary-of-tidymodels"><i class="fa fa-check"></i><b>5.15</b> Summary of <code>tidymodels</code></a></li>
</ul></li>
<li class="chapter" data-level="" data-path="about-the-authors.html"><a href="about-the-authors.html"><i class="fa fa-check"></i>About the Authors</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Tidyverse Skills for Data Science</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="wrangle-data" class="section level1" number="3">
<h1><span class="header-section-number">Chapter 3</span> Wrangling Data in the Tidyverse</h1>
<p>In the last course we spent a ton of time talking about all the most common ways data are stored and reviewed how to get them into a tibble (or data.frame) in R.</p>
<p>So far we’ve discussed what tidy and untidy data are. We’ve (hopefully) convinced you that tidy data are the right type of data to work with. What we may not have made perfectly clear yet is that data are <em>not</em> always the tidiest when they come to you at the start of a project. An incredibly important skill of a data scientist is to be able to take data from an untidy format and get it into a tidy format. This process is often referred to as <strong>data wrangling</strong>. Generally, data wranglings skills are those that allow you to wrangle data from the format they’re currently in into the tidy format you actually want them in.</p>
<p>Beyond data wrangling, it’s also important to make sure the data you have are accurate and what you need to answer your question of interest. After wrangling the data into a tidy format, there is often further work that has to be done to <strong>clean</strong> the data.</p>
<div id="about-this-course-2" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> About This Course</h2>
<p>Data never arrive in the condition that you need them in order to do effective data analysis. Data need to be re-shaped, re-arranged, and re-formatted, so that they can be visualized or be inputted into a machine learning algorithm. This course addresses the problem of wrangling your data so that you can bring them under control and analyze them effectively. The key goal in data wrangling is transforming non-tidy data into tidy data.</p>
<p>This course covers many of the critical details about handling tidy and non-tidy data in R such as converting from wide to long formats, manipulating tables with the <code>dplyr</code> package, understanding different R data types, processing text data with regular expressions, and conducting basic exploratory data analyses. Investing the time to learn these data wrangling techniques will make your analyses more efficient, more reproducible, and more understandable to your data science team.</p>
<p>In this specialization we assume familiarity with the R programming language. If you are not yet familiar with R, we suggest you first complete <a href="https://www.coursera.org/learn/r-programming">R Programming</a> before returning to complete this course.</p>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1Z1pukaF-HrZHEwSfr3SV8N2Slo2rMEJxpgl1qJv-QL4/export/png?id=1Z1pukaF-HrZHEwSfr3SV8N2Slo2rMEJxpgl1qJv-QL4&amp;pageid=g38bb68a535_0_1" alt="" />
<p class="caption">Data wrangling example</p>
</div>
</div>
<div id="tidy-data-review" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> Tidy Data Review</h2>
<p>Before we move any further, let’s review the requirements for a tidy dataset:</p>
<ol style="list-style-type: decimal">
<li>Each variable is stored in a column</li>
<li>Each observation is stored in a row</li>
<li>Each cell stores a single value</li>
</ol>
<p>We had four tidy data principles in an earlier lesson, where the fourth was that each table should store a single <em>type</em> of information. That’s less critical here, as we’ll be working at first with single datasets, so let’s just keep those three tidy data principles at the front of our minds.</p>
</div>
<div id="reshaping-data" class="section level2" number="3.3">
<h2><span class="header-section-number">3.3</span> Reshaping Data</h2>
<p>Tidy data generally exist in two forms: wide data and long data. Both types of data are used and needed in data analysis, and fortunately, there are tools that can take you from wide-to-long format and from long-to-wide format. This makes it easy to work with any tidy dataset. We’ll discuss the basics of what wide and long data are and how to go back and forth between the two in R. Getting data into the right format will be crucial later when summarizing data and visualizing it.</p>
<div id="wide-data" class="section level3" number="3.3.1">
<h3><span class="header-section-number">3.3.1</span> Wide Data</h3>
<p>Wide data has a column for each variable and a row for each observation. Data are often entered and stored in this manner. This is because wide data are often easy to understand at a glance. For example, this is a wide dataset:</p>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1zcn01MIeABs90ZABS2Oh--HDPZCfUHP5Utdex4TvbZs/export/png?id=1zcn01MIeABs90ZABS2Oh--HDPZCfUHP5Utdex4TvbZs&amp;pageid=g2bfdb07292_0_151" alt="" />
<p class="caption">Wide dataset</p>
</div>
<p>Up until this point, we would have described this dataset as a rectangular, tidy dataset. With the additional information just introduced, we can also state that it is a <em>wide</em> dataset. Here, you can clearly see what measurements were taken for each individual and can get a sense of how many individuals are contained in the dataset.</p>
<p>Specifically, each individual is in a different row with each variable in a different column. At a glance we can quickly see that we have information about four different people and that each person was measured in four different ways.</p>
</div>
<div id="long-data" class="section level3" number="3.3.2">
<h3><span class="header-section-number">3.3.2</span> Long Data</h3>
<p>Long data, on the other hand, has one column indicating the type of variable contained in that row and then a separate row for the value for that variable. Each row contains a single observation for a single variable. It’s <em>still</em> a tidy datasets, but the information is stored in a long format:</p>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1zcn01MIeABs90ZABS2Oh--HDPZCfUHP5Utdex4TvbZs/export/png?id=1zcn01MIeABs90ZABS2Oh--HDPZCfUHP5Utdex4TvbZs&amp;pageid=g38bb68a532_0_0" alt="" />
<p class="caption">Long dataset</p>
</div>
<p>This long dataset includes the exact same information as the previous wide dataset; it is just stored differently. It’s harder to see visually how many different measurements were taken and on how many different people, but the same information is there.</p>
<p>While long data formats are less readable than wide data at a glance, they are often a lot easier to work with during analysis. Most of the tools we’ll be working with use long data. Thus, to go from how data are often stored (wide) to working with the data during analysis (long), we’ll need to understand what tools are needed to do this and how to work with them.</p>
</div>
<div id="reshaping-the-data" class="section level3" number="3.3.3">
<h3><span class="header-section-number">3.3.3</span> Reshaping the Data</h3>
<p>Converting your data from wide-to-long or from long-to-wide data formats is referred to as <strong>reshaping</strong> your data.</p>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1zcn01MIeABs90ZABS2Oh--HDPZCfUHP5Utdex4TvbZs/export/png?id=1zcn01MIeABs90ZABS2Oh--HDPZCfUHP5Utdex4TvbZs&amp;pageid=g38bb68a532_0_13" alt="" />
<p class="caption">Reshaping data</p>
</div>
<p>Within the tidyverse, <a href="https://tidyr.tidyverse.org/">tidyr</a> is the go-to package for accomplishing this task. Within the <code>tidyr</code> package, you’ll have to become familiar with a number of functions. The two most pertinent to reshaping data are: <code>pivot_wider()</code> and <code>pivot_longer()</code>.</p>
<p>For these examples, we’ll work with the <code>airquality</code> dataset available in R. The data in this dataset includes “Daily air quality measurements in New York, May to September 1973.” This is a wide dataset because each day is in a separate row and there are multiple columns with each including information about a different variable (ozone, solar.r, wind, temp, month, and day).</p>
<p>We’ll load in the tidyverse, so that we can convert this data.frame to a tibble <em>and</em> see the first few lines of this dataset using the following code:</p>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="wrangle-data.html#cb157-1"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb157-2"><a href="wrangle-data.html#cb157-2"></a></span>
<span id="cb157-3"><a href="wrangle-data.html#cb157-3"></a>airquality &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(airquality)</span>
<span id="cb157-4"><a href="wrangle-data.html#cb157-4"></a>airquality</span></code></pre></div>
<pre><code>## # A tibble: 153 x 6
##    Ozone Solar.R  Wind  Temp Month   Day
##    &lt;int&gt;   &lt;int&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
##  1    41     190   7.4    67     5     1
##  2    36     118   8      72     5     2
##  3    12     149  12.6    74     5     3
##  4    18     313  11.5    62     5     4
##  5    NA      NA  14.3    56     5     5
##  6    28      NA  14.9    66     5     6
##  7    23     299   8.6    65     5     7
##  8    19      99  13.8    59     5     8
##  9     8      19  20.1    61     5     9
## 10    NA     194   8.6    69     5    10
## # … with 143 more rows</code></pre>
<p>Again, wide data are easy to decipher at a glance. We can see that we have six different variables for each day, with each one of these variables (measurements) being stored in a separate column.</p>
<div id="tidyr-1" class="section level4" number="3.3.3.1">
<h4><span class="header-section-number">3.3.3.1</span> <code>tidyr</code></h4>
<p>The <code>tidyr</code> package is part of the tidyverse, so its functionality is available to you since you’ve loaded in the tidyverse. The two main functions we mentioned above will help you reshape your data in the following ways:</p>
<ul>
<li><code>pivot_longer()</code>: go from wide data to long data</li>
<li><code>pivot_wider()</code>: go from long data to wide data</li>
</ul>
<p>To get started, you’ll need to be sure that the <code>tidyr</code> package is installed and loaded into your RStudio session.</p>
<div id="pivot_longer" class="section level5" number="3.3.3.1.1">
<h5><span class="header-section-number">3.3.3.1.1</span> <code>pivot_longer()</code></h5>
<p>As data are often stored in wide formats, you’ll likely use <code>pivot_longer()</code> a lot more frequently than you’ll use <code>pivot_wider()</code>. This will allow you to get the data into a long format that will be easy to use for analysis.</p>
<p>In <code>tidyr</code>, <code>pivot_longer()</code> will take the <code>airquality</code> dataset from wide to long, putting each column name into the first column and each corresponding value into the second column. Here, the first column will be called <code>name</code>. The second column will still be <code>value</code>.</p>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="wrangle-data.html#cb159-1"></a><span class="co">## use pivot_longer() to reshape from wide to long</span></span>
<span id="cb159-2"><a href="wrangle-data.html#cb159-2"></a>gathered &lt;-<span class="st"> </span>airquality <span class="op">%&gt;%</span></span>
<span id="cb159-3"><a href="wrangle-data.html#cb159-3"></a><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="kw">everything</span>())</span>
<span id="cb159-4"><a href="wrangle-data.html#cb159-4"></a></span>
<span id="cb159-5"><a href="wrangle-data.html#cb159-5"></a><span class="co">## take a look at first few rows of long data</span></span>
<span id="cb159-6"><a href="wrangle-data.html#cb159-6"></a>gathered</span></code></pre></div>
<pre><code>## # A tibble: 918 x 2
##    name    value
##    &lt;chr&gt;   &lt;dbl&gt;
##  1 Ozone    41  
##  2 Solar.R 190  
##  3 Wind      7.4
##  4 Temp     67  
##  5 Month     5  
##  6 Day       1  
##  7 Ozone    36  
##  8 Solar.R 118  
##  9 Wind      8  
## 10 Temp     72  
## # … with 908 more rows</code></pre>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1zcn01MIeABs90ZABS2Oh--HDPZCfUHP5Utdex4TvbZs/export/png?id=1zcn01MIeABs90ZABS2Oh--HDPZCfUHP5Utdex4TvbZs&amp;pageid=g38bb68a532_0_205" alt="" />
<p class="caption">Longer dataset</p>
</div>
<p>However, it’s very easy to change the names of these columns within <code>pivot_longer()</code>. To do so you specify what the <code>names_to</code> and <code>values_to</code> columns names should be within <code>pivot_longer()</code>:</p>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb161-1"><a href="wrangle-data.html#cb161-1"></a><span class="co">## to rename the column names that gather provides,</span></span>
<span id="cb161-2"><a href="wrangle-data.html#cb161-2"></a><span class="co">## change key and value to what you want those column names to be</span></span>
<span id="cb161-3"><a href="wrangle-data.html#cb161-3"></a>gathered &lt;-<span class="st"> </span>airquality <span class="op">%&gt;%</span></span>
<span id="cb161-4"><a href="wrangle-data.html#cb161-4"></a><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="kw">everything</span>(), <span class="dt">names_to =</span> <span class="st">&quot;variable&quot;</span>, <span class="dt">values_to =</span> <span class="st">&quot;value&quot;</span>)</span>
<span id="cb161-5"><a href="wrangle-data.html#cb161-5"></a></span>
<span id="cb161-6"><a href="wrangle-data.html#cb161-6"></a><span class="co">## take a look at first few rows of long data</span></span>
<span id="cb161-7"><a href="wrangle-data.html#cb161-7"></a>gathered </span></code></pre></div>
<pre><code>## # A tibble: 918 x 2
##    variable value
##    &lt;chr&gt;    &lt;dbl&gt;
##  1 Ozone     41  
##  2 Solar.R  190  
##  3 Wind       7.4
##  4 Temp      67  
##  5 Month      5  
##  6 Day        1  
##  7 Ozone     36  
##  8 Solar.R  118  
##  9 Wind       8  
## 10 Temp      72  
## # … with 908 more rows</code></pre>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1zcn01MIeABs90ZABS2Oh--HDPZCfUHP5Utdex4TvbZs/export/png?id=1zcn01MIeABs90ZABS2Oh--HDPZCfUHP5Utdex4TvbZs&amp;pageid=g38bb68a532_0_213" alt="" />
<p class="caption">gather column names changed</p>
</div>
<p>However, you’re likely not interested in your day and month variable being separated out into their own variables within the <code>variable</code> column. In fact, knowing the day and month associated with a particular data point helps identify that particular data point. To account for this, you can exclude <code>day</code> and <code>month</code> from the variables being included in the <code>variable</code> column by specifying all the variables that you <em>do</em> want included in the <code>variable</code> column. Here, that means specifying <code>Ozone</code>, <code>Solar.R</code>, <code>Wind</code>, and <code>Temp</code>. This will keep <code>Day</code> and <code>Month</code> in their own columns, allowing each row to be identified by the specific day and month being discussed.</p>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb163-1"><a href="wrangle-data.html#cb163-1"></a><span class="co">## in pivot_longer(), you can specify which variables </span></span>
<span id="cb163-2"><a href="wrangle-data.html#cb163-2"></a><span class="co">## you want included in the long format</span></span>
<span id="cb163-3"><a href="wrangle-data.html#cb163-3"></a><span class="co">## it will leave the other variables as is</span></span>
<span id="cb163-4"><a href="wrangle-data.html#cb163-4"></a>gathered &lt;-<span class="st"> </span>airquality <span class="op">%&gt;%</span></span>
<span id="cb163-5"><a href="wrangle-data.html#cb163-5"></a><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="kw">c</span>(Ozone, Solar.R, Wind, Temp), </span>
<span id="cb163-6"><a href="wrangle-data.html#cb163-6"></a>               <span class="dt">names_to =</span> <span class="st">&quot;variable&quot;</span>, </span>
<span id="cb163-7"><a href="wrangle-data.html#cb163-7"></a>               <span class="dt">values_to =</span> <span class="st">&quot;value&quot;</span>)</span>
<span id="cb163-8"><a href="wrangle-data.html#cb163-8"></a></span>
<span id="cb163-9"><a href="wrangle-data.html#cb163-9"></a><span class="co">## take a look at first few rows of long data</span></span>
<span id="cb163-10"><a href="wrangle-data.html#cb163-10"></a>gathered</span></code></pre></div>
<pre><code>## # A tibble: 612 x 4
##    Month   Day variable value
##    &lt;int&gt; &lt;int&gt; &lt;chr&gt;    &lt;dbl&gt;
##  1     5     1 Ozone     41  
##  2     5     1 Solar.R  190  
##  3     5     1 Wind       7.4
##  4     5     1 Temp      67  
##  5     5     2 Ozone     36  
##  6     5     2 Solar.R  118  
##  7     5     2 Wind       8  
##  8     5     2 Temp      72  
##  9     5     3 Ozone     12  
## 10     5     3 Solar.R  149  
## # … with 602 more rows</code></pre>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1zcn01MIeABs90ZABS2Oh--HDPZCfUHP5Utdex4TvbZs/export/png?id=1zcn01MIeABs90ZABS2Oh--HDPZCfUHP5Utdex4TvbZs&amp;pageid=g38bb68a532_0_222" alt="" />
<p class="caption">gather specifying which variables to include in long format</p>
</div>
<p>Now, when you look at the top of this object, you’ll see that <code>Month</code> and <code>Day</code> remain in the data frame and that variable combines information from the other columns in <code>airquality</code> (<code>Ozone</code>, <code>Solar.R</code>, <code>Wind</code>, <code>Temp</code>). This is still a long format dataset; however, it has used <code>Month</code> and <code>Day</code> as IDs when reshaping the data frame.</p>
</div>
<div id="pivot_wider" class="section level5" number="3.3.3.1.2">
<h5><span class="header-section-number">3.3.3.1.2</span> <code>pivot_wider()</code></h5>
<p>To return your long data back to its original form, you can use <code>pivot_wider()</code>. Here you specify two columns: the column that contains the names of what your wide data columns should be (<code>names_from</code>) and the column that contains the values that should go in these columns (<code>values_from</code>). The data frame resulting from <code>pivot_wider()</code> will have the original information back in the wide format (again, the columns will be in a different order). But, we’ll discuss how to rearrange data in the next lesson!</p>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb165-1"><a href="wrangle-data.html#cb165-1"></a><span class="co">## use pivot_wider() to reshape from long to wide</span></span>
<span id="cb165-2"><a href="wrangle-data.html#cb165-2"></a>spread_data &lt;-<span class="st"> </span>gathered <span class="op">%&gt;%</span></span>
<span id="cb165-3"><a href="wrangle-data.html#cb165-3"></a><span class="st">  </span><span class="kw">pivot_wider</span>(<span class="dt">names_from =</span> <span class="st">&quot;variable&quot;</span>, </span>
<span id="cb165-4"><a href="wrangle-data.html#cb165-4"></a>              <span class="dt">values_from =</span> <span class="st">&quot;value&quot;</span>)</span>
<span id="cb165-5"><a href="wrangle-data.html#cb165-5"></a></span>
<span id="cb165-6"><a href="wrangle-data.html#cb165-6"></a><span class="co">## take a look at the wide data</span></span>
<span id="cb165-7"><a href="wrangle-data.html#cb165-7"></a>spread_data</span></code></pre></div>
<pre><code>## # A tibble: 153 x 6
##    Month   Day Ozone Solar.R  Wind  Temp
##    &lt;int&gt; &lt;int&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1     5     1    41     190   7.4    67
##  2     5     2    36     118   8      72
##  3     5     3    12     149  12.6    74
##  4     5     4    18     313  11.5    62
##  5     5     5    NA      NA  14.3    56
##  6     5     6    28      NA  14.9    66
##  7     5     7    23     299   8.6    65
##  8     5     8    19      99  13.8    59
##  9     5     9     8      19  20.1    61
## 10     5    10    NA     194   8.6    69
## # … with 143 more rows</code></pre>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb167-1"><a href="wrangle-data.html#cb167-1"></a><span class="co">## compare that back to the original</span></span>
<span id="cb167-2"><a href="wrangle-data.html#cb167-2"></a>airquality</span></code></pre></div>
<pre><code>## # A tibble: 153 x 6
##    Ozone Solar.R  Wind  Temp Month   Day
##    &lt;int&gt;   &lt;int&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
##  1    41     190   7.4    67     5     1
##  2    36     118   8      72     5     2
##  3    12     149  12.6    74     5     3
##  4    18     313  11.5    62     5     4
##  5    NA      NA  14.3    56     5     5
##  6    28      NA  14.9    66     5     6
##  7    23     299   8.6    65     5     7
##  8    19      99  13.8    59     5     8
##  9     8      19  20.1    61     5     9
## 10    NA     194   8.6    69     5    10
## # … with 143 more rows</code></pre>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1zcn01MIeABs90ZABS2Oh--HDPZCfUHP5Utdex4TvbZs/export/png?id=1zcn01MIeABs90ZABS2Oh--HDPZCfUHP5Utdex4TvbZs&amp;pageid=g38bb68a532_0_236" alt="" />
<p class="caption">spread data</p>
</div>
<p>While reshaping data may not <em>read</em> like the most exciting topic, having this skill will be indispensable as you start working with data. It’s best to get these skills down pat early!</p>
</div>
</div>
</div>
</div>
<div id="data-wrangling" class="section level2" number="3.4">
<h2><span class="header-section-number">3.4</span> Data Wrangling</h2>
<p>Once you’ve read your data into R and have it in the appropriately wide- or long-format, it’s time to wrangle the data, so that it is in the appropriate format and includes the information you need.</p>
<div id="r-packages" class="section level3" number="3.4.1">
<h3><span class="header-section-number">3.4.1</span> R Packages</h3>
<p>While there are <em>tons</em> of R packages out there to help you work with data, we’re going to cover the packages and functions within those packages that you’ll absolutely want and need to work with when working with data.</p>
<div id="dplyr-1" class="section level4" number="3.4.1.1">
<h4><span class="header-section-number">3.4.1.1</span> <code>dplyr</code></h4>
<p>There is a package specifically designed for helping you wrangle your data. This package is called <a href="https://dplyr.tidyverse.org/"><code>dplyr</code></a> and will allow you to easily accomplish many of the data wrangling tasks necessary. Like <code>tidyr</code>, this package is a core package within the tidyverse, and thus it was loaded in for you when you ran <code>library(tidyverse)</code> earlier. We will cover a number of functions that will help you wrangle data using <code>dplyr</code>:</p>
<ul>
<li><code>%&gt;%</code> - pipe operator for chaining a sequence of operations</li>
<li><code>glimpse()</code> - get an overview of what’s included in dataset</li>
<li><code>filter()</code> - filter rows</li>
<li><code>select()</code> - select, rename, and reorder columns</li>
<li><code>rename()</code> - rename columns</li>
<li><code>arrange()</code> - reorder rows</li>
<li><code>mutate()</code> - create a new column</li>
<li><code>group_by()</code> - group variables</li>
<li><code>summarize()</code> - summarize information within a dataset</li>
<li><code>left_join()</code> - combine data across data frame</li>
<li><code>tally()</code> - get overall sum of values of specified column(s) or the number of rows of tibble</li>
<li><code>count()</code> - get counts of unique values of specified column(s) (shortcut of <code>group_by()</code> and <code>tally()</code>)</li>
<li><code>add_count()</code> - add values of <code>count()</code> as a new column</li>
<li><code>add_tally()</code> - add value(s) of <code>tally()</code> as a new column</li>
</ul>
</div>
<div id="tidyr-2" class="section level4" number="3.4.1.2">
<h4><span class="header-section-number">3.4.1.2</span> <code>tidyr</code></h4>
<p>We will also return to the <code>tidyr</code> package. The same package that we used to reshape our data will be helpful when wrangling data. The main functions we’ll cover from <code>tidyr</code> are:</p>
<ul>
<li><code>unite()</code> - combine contents of two or more columns into a single column</li>
<li><code>separate()</code> - separate contents of a column into two or more columns</li>
</ul>
</div>
<div id="janitor-1" class="section level4" number="3.4.1.3">
<h4><span class="header-section-number">3.4.1.3</span> <code>janitor</code></h4>
<p>The third package we’ll include here is the <code>janitor</code> package. While not a core tidyverse package, this tidyverse-adjacent package provides tools for cleaning messy data. The main functions we’ll cover from janitor are:</p>
<ul>
<li><code>clean_names()</code> - clean names of a data frame</li>
<li><code>tabyl()</code> - get a helpful summary of a variable</li>
<li><code>get_dupes()</code> - identify duplicate observations</li>
</ul>
<p>If you have not already, you’ll want to be sure this package is installed and loaded:</p>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb169-1"><a href="wrangle-data.html#cb169-1"></a><span class="co">#install.packages(&#39;janitor&#39;)</span></span>
<span id="cb169-2"><a href="wrangle-data.html#cb169-2"></a><span class="kw">library</span>(janitor)</span></code></pre></div>
</div>
<div id="skimr-1" class="section level4" number="3.4.1.4">
<h4><span class="header-section-number">3.4.1.4</span> <code>skimr</code></h4>
<p>The final package we’ll discuss here is the <code>skimr</code> package. This package provides a quick way to summarize a data.frame or tibble within the tidy data framework. We’ll discuss its most useful function here:</p>
<ul>
<li><code>skim()</code> - summarize a data frame</li>
</ul>
<p>If you have not already, you’ll want to be sure this package is installed and loaded:</p>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb170-1"><a href="wrangle-data.html#cb170-1"></a><span class="co">#install.packages(&#39;skimr&#39;)</span></span>
<span id="cb170-2"><a href="wrangle-data.html#cb170-2"></a><span class="kw">library</span>(skimr)</span></code></pre></div>
</div>
</div>
<div id="the-pipe-operator" class="section level3" number="3.4.2">
<h3><span class="header-section-number">3.4.2</span> The Pipe Operator</h3>
<p>Before we get into the important functions within <code>dplyr</code>, it will be very useful to discuss what is known as the <strong>pipe operator</strong>. The pipe operator looks like this in R: <code>%&gt;%</code>. Whenever you see the pipe <code>%&gt;%</code>, think of the word “then”, so if you saw the sentence “I went to the the store and %&gt;% I went back to my house,” you would read this as I went to the store and <em>then</em> I went back to my house. The pipe tells you to do one thing and <em>then</em> do another.</p>
<p>Generally, the pipe operator allows you to string a number of different functions together in a particular order. If you wanted to take data frame A and carry out function B on it in R, you could depict this with an arrow pointing from A to B:</p>
<p>A –&gt; B</p>
<p>Here you are saying, “Take A and <em>then</em> feed it into function B.”</p>
<p>In base R syntax, what is depicted by the arrow above would be carried out by calling the function B on the data frame object A:</p>
<pre><code>B(A)</code></pre>
<p>Alternatively, you could use the pipe operator (<code>%&gt;%</code>):</p>
<pre><code>A %&gt;% B</code></pre>
<p>However, often you are not performing just one action on a data frame, but rather you are looking to carry out multiple functions. We can again depict this with an arrow diagram.</p>
<p>A –&gt; B –&gt; C –&gt; D</p>
<p>Here you are saying that you want to take data frame A and carry out function B, <em>then</em> you want to take the output from that and <em>then</em> carry out function C. Subsequently you want to take the output of that and <em>then</em> carry out function D. In R syntax, we would first apply function B to data frame A, then apply function C to this output, then apply function D to this output. This results in the following syntax that is hard to read because multiple calls to functions are nested within each other:</p>
<pre><code>D(C(B(A)))</code></pre>
<p>Alternatively, you could use the pipe operator. Each time you want take the output of one function and carry out something new on that output, you will use the pipe operator:</p>
<pre><code>A %&gt;% B %&gt;% C %&gt;% D</code></pre>
<p>And, even more readable is when each of these steps is separated out onto its own individual line of code:</p>
<pre><code>A %&gt;% 
  B %&gt;% 
    C %&gt;%
      D</code></pre>
<p>While both of the previous two code examples would provide the same output, the one below is more readable, which is a large part of why pipes are used. It makes your code more understandable to you and others.</p>
<p>Below we’ll use this pipe operator a lot. Remember, it takes output from the left hand side and feeds it into the function that comes after the pipe. You’ll get a better understanding of how it works as you run the code below. But, when in doubt remember that the pipe operator should be read as <em>then</em>.</p>
</div>
<div id="filtering-data" class="section level3" number="3.4.3">
<h3><span class="header-section-number">3.4.3</span> Filtering Data</h3>
<p>When working with a large dataset, you’re often interested in only working with a portion of the data at any one time. For example, if you had data on people from ages 0 to 100 years old, but you wanted to ask a question that only pertained to children, you would likely want to only work with data from those individuals who were less than 18 years old. To do this, you would want to <strong>filter</strong> your dataset to only include data from these select individuals. Filtering can be done by row or by column. We’ll discuss the syntax in R for doing both. Please note that the examples in this lesson and the organization for this lesson were adapted from <a href="https://suzan.rbind.io/">Suzan Baert’s</a> wonderful <code>dplyr</code> tutorials. Links to the all four tutorials can be found in the “Additional Resources” section at the bottom of this lesson.</p>
<p>For the examples below, we’ll be using a dataset from the <code>ggplot2</code> package called <code>msleep</code>. (You’ll learn more about this package in a later course on data visualization. For now, it’s a core tidyverse package so it’s loaded in along with the other tidyverse packages using <code>library(tidyverse)</code>.) This dataset includes sleep times and weights from a number of different mammals. It has 83 rows, with each row including information about a different type of animal, and 11 variables. As each row is a different animal and each column includes information about that animal, this is a <strong>wide</strong> dataset.</p>
<p>To get an idea of what variables are included in this data frame, you can use <code>glimpse()</code>. This function summarizes how many rows there are (<code>Observations</code>) and how many columns there are (<code>Variables</code>). Additionally, it gives you a glimpse into the type of data contained in each column. Specifically, in this dataset, we know that the first column is <code>name</code> and that it contains a character vector (<code>chr</code>) and that the first three entries are “Cheetah”, “Owl monkey”, and “Mountain beaver.” It works similarly to the <code>summary()</code> function covered in an earlier course.</p>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="wrangle-data.html#cb176-1"></a><span class="co">## take a look at the data</span></span>
<span id="cb176-2"><a href="wrangle-data.html#cb176-2"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb176-3"><a href="wrangle-data.html#cb176-3"></a><span class="kw">glimpse</span>(msleep)</span></code></pre></div>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1Z1pukaF-HrZHEwSfr3SV8N2Slo2rMEJxpgl1qJv-QL4/export/png?id=1Z1pukaF-HrZHEwSfr3SV8N2Slo2rMEJxpgl1qJv-QL4&amp;pageid=g38bb68a535_0_133" alt="" />
<p class="caption">Glimpse of msleep dataset</p>
</div>
<div id="filtering-rows" class="section level4" number="3.4.3.1">
<h4><span class="header-section-number">3.4.3.1</span> Filtering Rows</h4>
<p>If you were only interested in learning more about the sleep times of “Primates,” we could filter this dataset to include only data about those mammals that are also Primates. As we can see from <code>glimpse()</code>, this information is contained within the <code>order</code> variable. So to do this within R, we use the following syntax:</p>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb177-1"><a href="wrangle-data.html#cb177-1"></a><span class="co"># filter to only include primates</span></span>
<span id="cb177-2"><a href="wrangle-data.html#cb177-2"></a>msleep <span class="op">%&gt;%</span></span>
<span id="cb177-3"><a href="wrangle-data.html#cb177-3"></a><span class="st">  </span><span class="kw">filter</span>(order <span class="op">==</span><span class="st"> &quot;Primates&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 12 x 11
##    name  genus vore  order conservation sleep_total sleep_rem sleep_cycle awake
##    &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;              &lt;dbl&gt;     &lt;dbl&gt;       &lt;dbl&gt; &lt;dbl&gt;
##  1 Owl … Aotus omni  Prim… &lt;NA&gt;                17         1.8      NA       7  
##  2 Griv… Cerc… omni  Prim… lc                  10         0.7      NA      14  
##  3 Pata… Eryt… omni  Prim… lc                  10.9       1.1      NA      13.1
##  4 Gala… Gala… omni  Prim… &lt;NA&gt;                 9.8       1.1       0.55   14.2
##  5 Human Homo  omni  Prim… &lt;NA&gt;                 8         1.9       1.5    16  
##  6 Mong… Lemur herbi Prim… vu                   9.5       0.9      NA      14.5
##  7 Maca… Maca… omni  Prim… &lt;NA&gt;                10.1       1.2       0.75   13.9
##  8 Slow… Nyct… carni Prim… &lt;NA&gt;                11        NA        NA      13  
##  9 Chim… Pan   omni  Prim… &lt;NA&gt;                 9.7       1.4       1.42   14.3
## 10 Babo… Papio omni  Prim… &lt;NA&gt;                 9.4       1         0.667  14.6
## 11 Potto Pero… omni  Prim… lc                  11        NA        NA      13  
## 12 Squi… Saim… omni  Prim… &lt;NA&gt;                 9.6       1.4      NA      14.4
## # … with 2 more variables: brainwt &lt;dbl&gt;, bodywt &lt;dbl&gt;</code></pre>
<p>Note that we are using the equality <code>==</code> comparison operator that you learned about in the previous course. Also note that we have used the pipe operator to feed the <code>msleep</code> data frame into the <code>filter()</code> function.</p>
<p>The above is shorthand for:</p>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="wrangle-data.html#cb179-1"></a><span class="kw">filter</span>(msleep, order <span class="op">==</span><span class="st"> &quot;Primates&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 12 x 11
##    name  genus vore  order conservation sleep_total sleep_rem sleep_cycle awake
##    &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;              &lt;dbl&gt;     &lt;dbl&gt;       &lt;dbl&gt; &lt;dbl&gt;
##  1 Owl … Aotus omni  Prim… &lt;NA&gt;                17         1.8      NA       7  
##  2 Griv… Cerc… omni  Prim… lc                  10         0.7      NA      14  
##  3 Pata… Eryt… omni  Prim… lc                  10.9       1.1      NA      13.1
##  4 Gala… Gala… omni  Prim… &lt;NA&gt;                 9.8       1.1       0.55   14.2
##  5 Human Homo  omni  Prim… &lt;NA&gt;                 8         1.9       1.5    16  
##  6 Mong… Lemur herbi Prim… vu                   9.5       0.9      NA      14.5
##  7 Maca… Maca… omni  Prim… &lt;NA&gt;                10.1       1.2       0.75   13.9
##  8 Slow… Nyct… carni Prim… &lt;NA&gt;                11        NA        NA      13  
##  9 Chim… Pan   omni  Prim… &lt;NA&gt;                 9.7       1.4       1.42   14.3
## 10 Babo… Papio omni  Prim… &lt;NA&gt;                 9.4       1         0.667  14.6
## 11 Potto Pero… omni  Prim… lc                  11        NA        NA      13  
## 12 Squi… Saim… omni  Prim… &lt;NA&gt;                 9.6       1.4      NA      14.4
## # … with 2 more variables: brainwt &lt;dbl&gt;, bodywt &lt;dbl&gt;</code></pre>
<p>The output is the same as above here, but the code is slightly less readable. This is why we use the pipe (<code>%&gt;%</code>)!</p>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1Z1pukaF-HrZHEwSfr3SV8N2Slo2rMEJxpgl1qJv-QL4/export/png?id=1Z1pukaF-HrZHEwSfr3SV8N2Slo2rMEJxpgl1qJv-QL4&amp;pageid=g38bb68a535_0_164" alt="" />
<p class="caption">Filtered to only include Primates</p>
</div>
<p>Now, we have a smaller dataset of only 12 mammals (as opposed to the original 83) and we can see that the <code>order</code> variable column only includes “Primates.”</p>
<p>But, what if we were only interested in Primates who sleep more than 10 hours total per night? This information is in the <code>sleep_total</code> column. Fortunately, <code>filter()</code> also works on numeric variables. To accomplish this, you would use the following syntax, separating the multiple filters you want to apply with a comma:</p>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb181-1"><a href="wrangle-data.html#cb181-1"></a>msleep <span class="op">%&gt;%</span></span>
<span id="cb181-2"><a href="wrangle-data.html#cb181-2"></a><span class="st">  </span><span class="kw">filter</span>(order <span class="op">==</span><span class="st"> &quot;Primates&quot;</span>, sleep_total <span class="op">&gt;</span><span class="st"> </span><span class="dv">10</span>)</span></code></pre></div>
<pre><code>## # A tibble: 5 x 11
##   name  genus vore  order conservation sleep_total sleep_rem sleep_cycle awake
##   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;              &lt;dbl&gt;     &lt;dbl&gt;       &lt;dbl&gt; &lt;dbl&gt;
## 1 Owl … Aotus omni  Prim… &lt;NA&gt;                17         1.8       NA      7  
## 2 Pata… Eryt… omni  Prim… lc                  10.9       1.1       NA     13.1
## 3 Maca… Maca… omni  Prim… &lt;NA&gt;                10.1       1.2        0.75  13.9
## 4 Slow… Nyct… carni Prim… &lt;NA&gt;                11        NA         NA     13  
## 5 Potto Pero… omni  Prim… lc                  11        NA         NA     13  
## # … with 2 more variables: brainwt &lt;dbl&gt;, bodywt &lt;dbl&gt;</code></pre>
<p>Note that we have used the “greater than” comparison operator with <code>sleep_total</code>.</p>
<p>Now, we have a dataset focused in on only 5 mammals, all of which are primates who sleep for more than 10 hours a night total.</p>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1Z1pukaF-HrZHEwSfr3SV8N2Slo2rMEJxpgl1qJv-QL4/export/png?id=1Z1pukaF-HrZHEwSfr3SV8N2Slo2rMEJxpgl1qJv-QL4&amp;pageid=g38bb68a535_0_179" alt="" />
<p class="caption">Numerically filtered dataset</p>
</div>
<p>We can obtain the same result with the AND <code>&amp;</code> logical operator instead of separating filtering conditions with a comma:</p>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb183-1"><a href="wrangle-data.html#cb183-1"></a>msleep <span class="op">%&gt;%</span></span>
<span id="cb183-2"><a href="wrangle-data.html#cb183-2"></a><span class="st">  </span><span class="kw">filter</span>(order <span class="op">==</span><span class="st"> &quot;Primates&quot;</span> <span class="op">&amp;</span><span class="st"> </span>sleep_total <span class="op">&gt;</span><span class="st"> </span><span class="dv">10</span>)</span></code></pre></div>
<pre><code>## # A tibble: 5 x 11
##   name  genus vore  order conservation sleep_total sleep_rem sleep_cycle awake
##   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;              &lt;dbl&gt;     &lt;dbl&gt;       &lt;dbl&gt; &lt;dbl&gt;
## 1 Owl … Aotus omni  Prim… &lt;NA&gt;                17         1.8       NA      7  
## 2 Pata… Eryt… omni  Prim… lc                  10.9       1.1       NA     13.1
## 3 Maca… Maca… omni  Prim… &lt;NA&gt;                10.1       1.2        0.75  13.9
## 4 Slow… Nyct… carni Prim… &lt;NA&gt;                11        NA         NA     13  
## 5 Potto Pero… omni  Prim… lc                  11        NA         NA     13  
## # … with 2 more variables: brainwt &lt;dbl&gt;, bodywt &lt;dbl&gt;</code></pre>
<p>Note that the number of columns hasn’t changed. All 11 variables are still shown in columns because the function <code>filter()</code> filters on rows, not columns.</p>
</div>
<div id="selecting-columns" class="section level4" number="3.4.3.2">
<h4><span class="header-section-number">3.4.3.2</span> Selecting Columns</h4>
<p>While <code>filter()</code> operates on rows, it <em>is</em> possible to filter your dataset to only include the columns you’re interested in. To select columns so that your dataset only includes variables you’re interested in, you will use <code>select()</code>.</p>
<p>Let’s start with the code we just wrote to only include primates who sleep a lot. What if we only want to include the first column (the name of the mammal) and the sleep information (included in the columns <code>sleep_total</code>, <code>sleep_rem</code>, and <code>sleep_cycle</code>)? We would do this by starting with the code we just used, adding another pipe, and using the function <code>select()</code>. Within <code>select</code>, we specify which columns we want in our output.</p>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb185-1"><a href="wrangle-data.html#cb185-1"></a>msleep <span class="op">%&gt;%</span></span>
<span id="cb185-2"><a href="wrangle-data.html#cb185-2"></a><span class="st">  </span><span class="kw">filter</span>(order <span class="op">==</span><span class="st"> &quot;Primates&quot;</span>, sleep_total <span class="op">&gt;</span><span class="st"> </span><span class="dv">10</span>) <span class="op">%&gt;%</span></span>
<span id="cb185-3"><a href="wrangle-data.html#cb185-3"></a><span class="st">  </span><span class="kw">select</span>(name, sleep_total, sleep_rem, sleep_cycle)</span></code></pre></div>
<pre><code>## # A tibble: 5 x 4
##   name         sleep_total sleep_rem sleep_cycle
##   &lt;chr&gt;              &lt;dbl&gt;     &lt;dbl&gt;       &lt;dbl&gt;
## 1 Owl monkey          17         1.8       NA   
## 2 Patas monkey        10.9       1.1       NA   
## 3 Macaque             10.1       1.2        0.75
## 4 Slow loris          11        NA         NA   
## 5 Potto               11        NA         NA</code></pre>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1Z1pukaF-HrZHEwSfr3SV8N2Slo2rMEJxpgl1qJv-QL4/export/png?id=1Z1pukaF-HrZHEwSfr3SV8N2Slo2rMEJxpgl1qJv-QL4&amp;pageid=g38bb68a535_0_187" alt="" />
<p class="caption">Data with selected columns</p>
</div>
<p>Now, using <code>select()</code> we see that we still have the five rows we filtered to before, but we only have the four columns specified using <code>select()</code>. Here you can hopefully see the power of the pipe operator to chain together several commands in a row. Without the pipe operator, the full command would look like this:</p>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb187-1"><a href="wrangle-data.html#cb187-1"></a><span class="kw">select</span>(<span class="kw">filter</span>(msleep, order <span class="op">==</span><span class="st"> &quot;Primates&quot;</span>, sleep_total <span class="op">&gt;</span><span class="st"> </span><span class="dv">10</span>), name, sleep_total, sleep_rem, sleep_cycle)</span></code></pre></div>
<p>Yuck. Definitely harder to read. We’ll stick with the above approach!</p>
</div>
<div id="renaming-columns" class="section level4" number="3.4.3.3">
<h4><span class="header-section-number">3.4.3.3</span> Renaming Columns</h4>
<p><code>select()</code> can also be used to rename columns. To do so, you use the syntax: <code>new_column_name = old_column_name</code> within <code>select</code>. For example, to select the same columns and rename them <code>total</code>, <code>rem</code> and <code>cycle</code>, you would use the following syntax:</p>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="wrangle-data.html#cb188-1"></a>msleep <span class="op">%&gt;%</span></span>
<span id="cb188-2"><a href="wrangle-data.html#cb188-2"></a><span class="st">  </span><span class="kw">filter</span>(order <span class="op">==</span><span class="st"> &quot;Primates&quot;</span>, sleep_total <span class="op">&gt;</span><span class="st"> </span><span class="dv">10</span>) <span class="op">%&gt;%</span></span>
<span id="cb188-3"><a href="wrangle-data.html#cb188-3"></a><span class="st">  </span><span class="kw">select</span>(name, <span class="dt">total =</span> sleep_total, <span class="dt">rem =</span> sleep_rem, <span class="dt">cycle =</span> sleep_cycle)</span></code></pre></div>
<pre><code>## # A tibble: 5 x 4
##   name         total   rem cycle
##   &lt;chr&gt;        &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 Owl monkey    17     1.8 NA   
## 2 Patas monkey  10.9   1.1 NA   
## 3 Macaque       10.1   1.2  0.75
## 4 Slow loris    11    NA   NA   
## 5 Potto         11    NA   NA</code></pre>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1Z1pukaF-HrZHEwSfr3SV8N2Slo2rMEJxpgl1qJv-QL4/export/png?id=1Z1pukaF-HrZHEwSfr3SV8N2Slo2rMEJxpgl1qJv-QL4&amp;pageid=g38bb68a535_0_194" alt="" />
<p class="caption">Data with renamed columns names with <code>select()</code></p>
</div>
<p>It’s important to keep in mind that when using <code>select()</code> to rename columns, only the specified columns will be included and renamed in the output. If you, instead, want to change the names of a few columns but return <em>all</em> columns in your output, you’ll want to use <code>rename()</code>. For example, the following, returns a data frame with all 11 columns, where the column names for three columns specified within <code>rename()</code> function have been renamed.</p>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb190-1"><a href="wrangle-data.html#cb190-1"></a>msleep <span class="op">%&gt;%</span></span>
<span id="cb190-2"><a href="wrangle-data.html#cb190-2"></a><span class="st">  </span><span class="kw">filter</span>(order <span class="op">==</span><span class="st"> &quot;Primates&quot;</span>, sleep_total <span class="op">&gt;</span><span class="st"> </span><span class="dv">10</span>) <span class="op">%&gt;%</span></span>
<span id="cb190-3"><a href="wrangle-data.html#cb190-3"></a><span class="st">  </span><span class="kw">rename</span>(<span class="dt">total =</span> sleep_total, <span class="dt">rem =</span> sleep_rem, <span class="dt">cycle =</span> sleep_cycle)</span></code></pre></div>
<pre><code>## # A tibble: 5 x 11
##   name    genus  vore  order conservation total   rem cycle awake brainwt bodywt
##   &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;        &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;
## 1 Owl mo… Aotus  omni  Prim… &lt;NA&gt;          17     1.8 NA      7    0.0155   0.48
## 2 Patas … Eryth… omni  Prim… lc            10.9   1.1 NA     13.1  0.115   10   
## 3 Macaque Macaca omni  Prim… &lt;NA&gt;          10.1   1.2  0.75  13.9  0.179    6.8 
## 4 Slow l… Nycti… carni Prim… &lt;NA&gt;          11    NA   NA     13    0.0125   1.4 
## 5 Potto   Perod… omni  Prim… lc            11    NA   NA     13   NA        1.1</code></pre>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1Z1pukaF-HrZHEwSfr3SV8N2Slo2rMEJxpgl1qJv-QL4/export/png?id=1Z1pukaF-HrZHEwSfr3SV8N2Slo2rMEJxpgl1qJv-QL4&amp;pageid=g4518ccec72_0_0" alt="" />
<p class="caption">Data with renamed columns names using <code>rename()</code></p>
</div>
</div>
</div>
<div id="reordering" class="section level3" number="3.4.4">
<h3><span class="header-section-number">3.4.4</span> Reordering</h3>
<p>In addition to filtering rows and columns, often, you’ll want the data arranged in a particular order. It may order the columns in a logical way, or it could be to sort the data so that the data are sorted by value, with those having the smallest value in the first row and the largest value in the last row. All of this can be achieved with a few simple functions.</p>
<div id="reordering-columns" class="section level4" number="3.4.4.1">
<h4><span class="header-section-number">3.4.4.1</span> Reordering Columns</h4>
<p>The <code>select()</code> function is powerful. Not only will it filter and rename columns, but it can also be used to reorder your columns. Using our example from above, if you wanted <code>sleep_rem</code> to be the first sleep column and <code>sleep_total</code> to be the last column, all you have to do is reorder them within <code>select()</code>. The output from <code>select()</code> would then be reordered to match the order specified within <code>select()</code>.</p>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb192-1"><a href="wrangle-data.html#cb192-1"></a>msleep <span class="op">%&gt;%</span></span>
<span id="cb192-2"><a href="wrangle-data.html#cb192-2"></a><span class="st">  </span><span class="kw">filter</span>(order <span class="op">==</span><span class="st"> &quot;Primates&quot;</span>, sleep_total <span class="op">&gt;</span><span class="st"> </span><span class="dv">10</span>) <span class="op">%&gt;%</span></span>
<span id="cb192-3"><a href="wrangle-data.html#cb192-3"></a><span class="st">  </span><span class="kw">select</span>(name, sleep_rem, sleep_cycle, sleep_total)</span></code></pre></div>
<pre><code>## # A tibble: 5 x 4
##   name         sleep_rem sleep_cycle sleep_total
##   &lt;chr&gt;            &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;
## 1 Owl monkey         1.8       NA           17  
## 2 Patas monkey       1.1       NA           10.9
## 3 Macaque            1.2        0.75        10.1
## 4 Slow loris        NA         NA           11  
## 5 Potto             NA         NA           11</code></pre>
<p>Here we see that sleep_rem <code>name</code> is displayed first followed by <code>sleep_rem</code>, <code>sleep_cycle</code>, and <code>sleep_total</code>, just as it was specified within <code>select()</code>.</p>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1Z1pukaF-HrZHEwSfr3SV8N2Slo2rMEJxpgl1qJv-QL4/export/png?id=1Z1pukaF-HrZHEwSfr3SV8N2Slo2rMEJxpgl1qJv-QL4&amp;pageid=g38bb68a535_0_204" alt="" />
<p class="caption">Data with reordered columns names</p>
</div>
</div>
<div id="reordering-rows" class="section level4" number="3.4.4.2">
<h4><span class="header-section-number">3.4.4.2</span> Reordering Rows</h4>
<p>Rows can also be reordered. To reorder a variable in ascending order (from smallest to largest), you’ll want to use <code>arrange()</code>. Continuing on from our example above, to now sort our rows by the amount of total sleep each mammal gets, we would use the following syntax:</p>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="wrangle-data.html#cb194-1"></a>msleep <span class="op">%&gt;%</span></span>
<span id="cb194-2"><a href="wrangle-data.html#cb194-2"></a><span class="st">  </span><span class="kw">filter</span>(order <span class="op">==</span><span class="st"> &quot;Primates&quot;</span>, sleep_total <span class="op">&gt;</span><span class="st"> </span><span class="dv">10</span>) <span class="op">%&gt;%</span></span>
<span id="cb194-3"><a href="wrangle-data.html#cb194-3"></a><span class="st">  </span><span class="kw">select</span>(name, sleep_rem, sleep_cycle, sleep_total) <span class="op">%&gt;%</span></span>
<span id="cb194-4"><a href="wrangle-data.html#cb194-4"></a><span class="st">  </span><span class="kw">arrange</span>(sleep_total)</span></code></pre></div>
<pre><code>## # A tibble: 5 x 4
##   name         sleep_rem sleep_cycle sleep_total
##   &lt;chr&gt;            &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;
## 1 Macaque            1.2        0.75        10.1
## 2 Patas monkey       1.1       NA           10.9
## 3 Slow loris        NA         NA           11  
## 4 Potto             NA         NA           11  
## 5 Owl monkey         1.8       NA           17</code></pre>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1Z1pukaF-HrZHEwSfr3SV8N2Slo2rMEJxpgl1qJv-QL4/export/png?id=1Z1pukaF-HrZHEwSfr3SV8N2Slo2rMEJxpgl1qJv-QL4&amp;pageid=g38bb68a535_0_215" alt="" />
<p class="caption">Data arranged by total sleep in ascending order</p>
</div>
<p>While <code>arrange</code> sorts variables in ascending order, it’s also possible to sort in descending (largest to smallest) order. To do this you just use <code>desc()</code> with the following syntax:</p>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="wrangle-data.html#cb196-1"></a>msleep <span class="op">%&gt;%</span></span>
<span id="cb196-2"><a href="wrangle-data.html#cb196-2"></a><span class="st">  </span><span class="kw">filter</span>(order <span class="op">==</span><span class="st"> &quot;Primates&quot;</span>, sleep_total <span class="op">&gt;</span><span class="st"> </span><span class="dv">10</span>) <span class="op">%&gt;%</span></span>
<span id="cb196-3"><a href="wrangle-data.html#cb196-3"></a><span class="st">  </span><span class="kw">select</span>(name, sleep_rem, sleep_cycle, sleep_total) <span class="op">%&gt;%</span></span>
<span id="cb196-4"><a href="wrangle-data.html#cb196-4"></a><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(sleep_total))</span></code></pre></div>
<pre><code>## # A tibble: 5 x 4
##   name         sleep_rem sleep_cycle sleep_total
##   &lt;chr&gt;            &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;
## 1 Owl monkey         1.8       NA           17  
## 2 Slow loris        NA         NA           11  
## 3 Potto             NA         NA           11  
## 4 Patas monkey       1.1       NA           10.9
## 5 Macaque            1.2        0.75        10.1</code></pre>
<p>By putting <code>sleep_total</code> within <code>desc()</code>, <code>arrange()</code> will now sort your data from the primates with the longest total sleep to the shortest.</p>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1Z1pukaF-HrZHEwSfr3SV8N2Slo2rMEJxpgl1qJv-QL4/export/png?id=1Z1pukaF-HrZHEwSfr3SV8N2Slo2rMEJxpgl1qJv-QL4&amp;pageid=g38bb68a535_0_215" alt="" />
<p class="caption">Data arranged by total sleep in descending order</p>
</div>
<p><code>arrange()</code> can also be used to order non-numeric variables. For example, <code>arrange()</code> will sort character vectors alphabetically.</p>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="wrangle-data.html#cb198-1"></a>msleep <span class="op">%&gt;%</span></span>
<span id="cb198-2"><a href="wrangle-data.html#cb198-2"></a><span class="st">  </span><span class="kw">filter</span>(order <span class="op">==</span><span class="st"> &quot;Primates&quot;</span>, sleep_total <span class="op">&gt;</span><span class="st"> </span><span class="dv">10</span>) <span class="op">%&gt;%</span></span>
<span id="cb198-3"><a href="wrangle-data.html#cb198-3"></a><span class="st">  </span><span class="kw">select</span>(name, sleep_rem, sleep_cycle, sleep_total) <span class="op">%&gt;%</span></span>
<span id="cb198-4"><a href="wrangle-data.html#cb198-4"></a><span class="st">  </span><span class="kw">arrange</span>(name)</span></code></pre></div>
<pre><code>## # A tibble: 5 x 4
##   name         sleep_rem sleep_cycle sleep_total
##   &lt;chr&gt;            &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;
## 1 Macaque            1.2        0.75        10.1
## 2 Owl monkey         1.8       NA           17  
## 3 Patas monkey       1.1       NA           10.9
## 4 Potto             NA         NA           11  
## 5 Slow loris        NA         NA           11</code></pre>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1Z1pukaF-HrZHEwSfr3SV8N2Slo2rMEJxpgl1qJv-QL4/export/png?id=1Z1pukaF-HrZHEwSfr3SV8N2Slo2rMEJxpgl1qJv-QL4&amp;pageid=g38bb68a535_0_234" alt="" />
<p class="caption">Data arranged alphabetically by name</p>
</div>
<p>If you would like to reorder rows based on information in multiple columns, you can specify them separated by commas. This is useful if you have repeated labels in one column and want to sort within a category based on information in another column. In the example here, if there were repeated primates, this would sort the repeats based on their total sleep.</p>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb200-1"><a href="wrangle-data.html#cb200-1"></a>msleep <span class="op">%&gt;%</span></span>
<span id="cb200-2"><a href="wrangle-data.html#cb200-2"></a><span class="st">  </span><span class="kw">filter</span>(order <span class="op">==</span><span class="st"> &quot;Primates&quot;</span>, sleep_total <span class="op">&gt;</span><span class="st"> </span><span class="dv">10</span>) <span class="op">%&gt;%</span></span>
<span id="cb200-3"><a href="wrangle-data.html#cb200-3"></a><span class="st">  </span><span class="kw">select</span>(name, sleep_rem, sleep_cycle, sleep_total) <span class="op">%&gt;%</span></span>
<span id="cb200-4"><a href="wrangle-data.html#cb200-4"></a><span class="st">  </span><span class="kw">arrange</span>(name, sleep_total)</span></code></pre></div>
<pre><code>## # A tibble: 5 x 4
##   name         sleep_rem sleep_cycle sleep_total
##   &lt;chr&gt;            &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;
## 1 Macaque            1.2        0.75        10.1
## 2 Owl monkey         1.8       NA           17  
## 3 Patas monkey       1.1       NA           10.9
## 4 Potto             NA         NA           11  
## 5 Slow loris        NA         NA           11</code></pre>
</div>
</div>
<div id="creating-new-columns" class="section level3" number="3.4.5">
<h3><span class="header-section-number">3.4.5</span> Creating New Columns</h3>
<p>You will often find when working with data that you need an additional column. For example, if you had two datasets you wanted to combine, you may want to make a new column in each dataset called <code>dataset</code>. In one dataset you may put <code>datasetA</code> in each row. In the second dataset, you could put <code>datasetB</code>. This way, once you combined the data, you would be able to keep track of which dataset each row came from originally. More often, however, you’ll likely want to create a new column that calculates a new variable based on information in a column you already have. For example, in our mammal sleep dataset, <code>sleep_total</code> is in hours. What if you wanted to have that information in minutes? You could create a new column with this very information! The function <code>mutate()</code> was <em>made</em> for <strong>all</strong> of these new-column-creating situations. This function has a lot of capabilities. We’ll cover the basics here.</p>
<p>Returning to our <code>msleep</code> dataset, after filtering and re-ordering, we can create a new column with <code>mutate()</code>. Within <code>mutate()</code>, we will calculate the number of minutes each mammal sleeps by multiplying the number of hours each animal sleeps by 60 minutes.</p>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="wrangle-data.html#cb202-1"></a>msleep <span class="op">%&gt;%</span></span>
<span id="cb202-2"><a href="wrangle-data.html#cb202-2"></a><span class="st">  </span><span class="kw">filter</span>(order <span class="op">==</span><span class="st"> &quot;Primates&quot;</span>, sleep_total <span class="op">&gt;</span><span class="st"> </span><span class="dv">10</span>) <span class="op">%&gt;%</span></span>
<span id="cb202-3"><a href="wrangle-data.html#cb202-3"></a><span class="st">  </span><span class="kw">select</span>(name, sleep_rem, sleep_cycle, sleep_total) <span class="op">%&gt;%</span></span>
<span id="cb202-4"><a href="wrangle-data.html#cb202-4"></a><span class="st">  </span><span class="kw">arrange</span>(name) <span class="op">%&gt;%</span></span>
<span id="cb202-5"><a href="wrangle-data.html#cb202-5"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">sleep_total_min =</span> sleep_total <span class="op">*</span><span class="st"> </span><span class="dv">60</span>)</span></code></pre></div>
<pre><code>## # A tibble: 5 x 5
##   name         sleep_rem sleep_cycle sleep_total sleep_total_min
##   &lt;chr&gt;            &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;           &lt;dbl&gt;
## 1 Macaque            1.2        0.75        10.1             606
## 2 Owl monkey         1.8       NA           17              1020
## 3 Patas monkey       1.1       NA           10.9             654
## 4 Potto             NA         NA           11               660
## 5 Slow loris        NA         NA           11               660</code></pre>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1Z1pukaF-HrZHEwSfr3SV8N2Slo2rMEJxpgl1qJv-QL4/export/png?id=1Z1pukaF-HrZHEwSfr3SV8N2Slo2rMEJxpgl1qJv-QL4&amp;pageid=g38bb68a535_0_242" alt="" />
<p class="caption">Mutate to add new column to data</p>
</div>
</div>
<div id="separating-columns" class="section level3" number="3.4.6">
<h3><span class="header-section-number">3.4.6</span> Separating Columns</h3>
<p>Sometimes multiple pieces of information are merged within a single column even though it would be more useful during analysis to have those pieces of information in separate columns. To demonstrate, we’ll now move from the <code>msleep</code> dataset to talking about another <a href="https://raw.githubusercontent.com/suzanbaert/RTutorials/master/Rmd_originals/conservation_explanation.csv">dataset</a> that includes information about conservation abbreviations in a single column.</p>
<p>To read this file into R, we’ll use the <code>readr</code> package.</p>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="wrangle-data.html#cb204-1"></a><span class="co">## download file </span></span>
<span id="cb204-2"><a href="wrangle-data.html#cb204-2"></a>conservation &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;https://raw.githubusercontent.com/suzanbaert/Dplyr_Tutorials/master/conservation_explanation.csv&quot;</span>)</span>
<span id="cb204-3"><a href="wrangle-data.html#cb204-3"></a></span>
<span id="cb204-4"><a href="wrangle-data.html#cb204-4"></a><span class="co">## take a look at this file</span></span>
<span id="cb204-5"><a href="wrangle-data.html#cb204-5"></a>conservation</span></code></pre></div>
<pre><code>## # A tibble: 11 x 1
##    `conservation abbreviation`                  
##    &lt;chr&gt;                                        
##  1 EX = Extinct                                 
##  2 EW = Extinct in the wild                     
##  3 CR = Critically Endangered                   
##  4 EN = Endangered                              
##  5 VU = Vulnerable                              
##  6 NT = Near Threatened                         
##  7 LC = Least Concern                           
##  8 DD = Data deficient                          
##  9 NE = Not evaluated                           
## 10 PE = Probably extinct (informal)             
## 11 PEW = Probably extinct in the wild (informal)</code></pre>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1Z1pukaF-HrZHEwSfr3SV8N2Slo2rMEJxpgl1qJv-QL4/export/png?id=1Z1pukaF-HrZHEwSfr3SV8N2Slo2rMEJxpgl1qJv-QL4&amp;pageid=g38bb68a535_0_250" alt="" />
<p class="caption">Conservation dataset</p>
</div>
<p>In this dataset, we see that there is a single column that includes <em>both</em> the abbreviation for the conservation term as well as what that abbreviation means. Recall that this violates one of the tidy data principles covered in the first lesson: Put just one thing in a cell. To work with these data, you could imagine that you may want these two pieces of information (the abbreviation and the description) in two different columns. To accomplish this in R, you’ll want to use <code>separate()</code> from <code>tidyr</code>.</p>
<p>The <code>separate()</code> function requires the name of the existing column that you want to separate (<code>conservation abbreviation</code>), the desired column names of the resulting separated columns (<code>into = c("abbreviation", "description")</code>), and the characters that currently separate the pieces of information (<code>sep = " = "</code>). We have to put <code>conservation abbreviation</code> in back ticks in the code below because the column name contains a space. Without the back ticks, R would think that <code>conservation</code> and <code>abbreviation</code> were two separate things. This is another violation of tidy data! Variable names should have underscores, not spaces!</p>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="wrangle-data.html#cb206-1"></a>conservation <span class="op">%&gt;%</span></span>
<span id="cb206-2"><a href="wrangle-data.html#cb206-2"></a><span class="st">  </span><span class="kw">separate</span>(<span class="st">`</span><span class="dt">conservation abbreviation</span><span class="st">`</span>, </span>
<span id="cb206-3"><a href="wrangle-data.html#cb206-3"></a>           <span class="dt">into =</span> <span class="kw">c</span>(<span class="st">&quot;abbreviation&quot;</span>, <span class="st">&quot;description&quot;</span>), <span class="dt">sep =</span> <span class="st">&quot; = &quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 11 x 2
##    abbreviation description                            
##    &lt;chr&gt;        &lt;chr&gt;                                  
##  1 EX           Extinct                                
##  2 EW           Extinct in the wild                    
##  3 CR           Critically Endangered                  
##  4 EN           Endangered                             
##  5 VU           Vulnerable                             
##  6 NT           Near Threatened                        
##  7 LC           Least Concern                          
##  8 DD           Data deficient                         
##  9 NE           Not evaluated                          
## 10 PE           Probably extinct (informal)            
## 11 PEW          Probably extinct in the wild (informal)</code></pre>
<p>The output of this code shows that we now have two separate columns with the information in the original column separated out into <code>abbreviation</code> and <code>description</code>.</p>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1Z1pukaF-HrZHEwSfr3SV8N2Slo2rMEJxpgl1qJv-QL4/export/png?id=1Z1pukaF-HrZHEwSfr3SV8N2Slo2rMEJxpgl1qJv-QL4&amp;pageid=g38bb68a535_0_261" alt="" />
<p class="caption">Output of separate()</p>
</div>
</div>
<div id="merging-columns" class="section level3" number="3.4.7">
<h3><span class="header-section-number">3.4.7</span> Merging Columns</h3>
<p>The opposite of <code>separate()</code> is <code>unite()</code>. So, if you have information in two or more different columns but wish it were in one single column, you’ll want to use <code>unite()</code>. Using the code forming the two separate columns above, we can then add on an extra line of <code>unite()</code> code to re-join these separate columns, returning what we started with.</p>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="wrangle-data.html#cb208-1"></a>conservation <span class="op">%&gt;%</span></span>
<span id="cb208-2"><a href="wrangle-data.html#cb208-2"></a><span class="st">  </span><span class="kw">separate</span>(<span class="st">`</span><span class="dt">conservation abbreviation</span><span class="st">`</span>, </span>
<span id="cb208-3"><a href="wrangle-data.html#cb208-3"></a>           <span class="dt">into =</span> <span class="kw">c</span>(<span class="st">&quot;abbreviation&quot;</span>, <span class="st">&quot;description&quot;</span>), <span class="dt">sep =</span> <span class="st">&quot; = &quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb208-4"><a href="wrangle-data.html#cb208-4"></a><span class="st">  </span><span class="kw">unite</span>(united_col, abbreviation, description, <span class="dt">sep =</span> <span class="st">&quot; = &quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 11 x 1
##    united_col                                   
##    &lt;chr&gt;                                        
##  1 EX = Extinct                                 
##  2 EW = Extinct in the wild                     
##  3 CR = Critically Endangered                   
##  4 EN = Endangered                              
##  5 VU = Vulnerable                              
##  6 NT = Near Threatened                         
##  7 LC = Least Concern                           
##  8 DD = Data deficient                          
##  9 NE = Not evaluated                           
## 10 PE = Probably extinct (informal)             
## 11 PEW = Probably extinct in the wild (informal)</code></pre>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1Z1pukaF-HrZHEwSfr3SV8N2Slo2rMEJxpgl1qJv-QL4/export/png?id=1Z1pukaF-HrZHEwSfr3SV8N2Slo2rMEJxpgl1qJv-QL4&amp;pageid=g38bb68a535_0_408" alt="" />
<p class="caption">Output of unite()</p>
</div>
</div>
<div id="cleaning-column-names" class="section level3" number="3.4.8">
<h3><span class="header-section-number">3.4.8</span> Cleaning Column Names</h3>
<p>While maybe not quite as important as some of the other functions mentioned in this lesson, a function that will likely prove very helpful as you start analyzing lots of different datasets is <code>clean_names()</code> from the <code>janitor</code> package. This function takes the existing column names of your dataset, converts them all to lowercase letters and numbers, and separates all words using the underscore character. For example, there is a space in the column name for conservation. The <code>clean_names()</code>function will convert <code>conservation abbreviation</code> to <code>conservation_abbreviation</code>. These cleaned up column names are a lot easier to work with when you have large datasets.</p>
<p>So remember this is what the data first looked like:</p>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1Z1pukaF-HrZHEwSfr3SV8N2Slo2rMEJxpgl1qJv-QL4/export/png?id=1Z1pukaF-HrZHEwSfr3SV8N2Slo2rMEJxpgl1qJv-QL4&amp;pageid=g38bb68a535_0_250" alt="" />
<p class="caption">Conservation dataset</p>
</div>
<p>And now with “clean names” it looks like this:</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="wrangle-data.html#cb210-1"></a>conservation <span class="op">%&gt;%</span></span>
<span id="cb210-2"><a href="wrangle-data.html#cb210-2"></a><span class="st">  </span><span class="kw">clean_names</span>()</span></code></pre></div>
<pre><code>## # A tibble: 11 x 1
##    conservation_abbreviation                    
##    &lt;chr&gt;                                        
##  1 EX = Extinct                                 
##  2 EW = Extinct in the wild                     
##  3 CR = Critically Endangered                   
##  4 EN = Endangered                              
##  5 VU = Vulnerable                              
##  6 NT = Near Threatened                         
##  7 LC = Least Concern                           
##  8 DD = Data deficient                          
##  9 NE = Not evaluated                           
## 10 PE = Probably extinct (informal)             
## 11 PEW = Probably extinct in the wild (informal)</code></pre>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1Z1pukaF-HrZHEwSfr3SV8N2Slo2rMEJxpgl1qJv-QL4/export/png?id=1Z1pukaF-HrZHEwSfr3SV8N2Slo2rMEJxpgl1qJv-QL4&amp;pageid=g38bb68a535_0_329" alt="" />
<p class="caption">clean_names() output</p>
</div>
</div>
<div id="combining-data-across-data-frames" class="section level3" number="3.4.9">
<h3><span class="header-section-number">3.4.9</span> Combining Data Across Data Frames</h3>
<p>There is often information stored in two separate data frames that you’ll want in a single data frame. There are <em>many</em> different ways to join separate data frames. They are discussed in more detail in <a href="http://stat545.com/bit001_dplyr-cheatsheet.html">this tutorial</a> from <a href="https://www.stat.ubc.ca/~jenny/">Jenny Bryan</a>. Here, we’ll demonstrate how the <code>left_join()</code> function works, as this is used frequently.</p>
<p>Let’s try to combine the information from the two different datasets we’ve used in this lesson. We have <code>msleep</code> and <code>conservation</code>. The <code>msleep</code>dataset contains a column called <code>conservation</code>. This column includes lowercase abbreviations that overlap with the uppercase abbreviations in the <code>abbreviation</code> column in the <code>conservation</code> dataset.</p>
<p>To handle the fact that in one dataset the abbreviations are lowercase and the other they are uppercase, we’ll use <code>mutate()</code> to take all the lowercase abbreviations to uppercase abbreviations using the function <code>toupper()</code>.</p>
<p>We’ll then use <code>left_join()</code> which takes all of the rows in the first dataset mentioned (<code>msleep</code>, below) and incorporates information from the second dataset mentioned (<code>conserve</code>, below), when information in the second dataset is available. The <code>by =</code> argument states what columns to join by in the first (“conservation”) and second (“abbreviation”) datasets. This join adds the <code>description</code> column from the <code>conserve</code> dataset onto the original dataset (<code>msleep</code>). Note that if there is no information in the second dataset that matches with the information in the first dataset, <code>left_join()</code> will add NA. Specifically, for rows where conservation is “DOMESTICATED” below, the <code>description</code> column will have NA because “DOMESTICATED”" is not an abbreviation in the <code>conserve</code> dataset.</p>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="wrangle-data.html#cb212-1"></a><span class="co">## take conservation dataset and separate information</span></span>
<span id="cb212-2"><a href="wrangle-data.html#cb212-2"></a><span class="co">## into two columns</span></span>
<span id="cb212-3"><a href="wrangle-data.html#cb212-3"></a><span class="co">## call that new object `conserve`</span></span>
<span id="cb212-4"><a href="wrangle-data.html#cb212-4"></a>conserve &lt;-<span class="st"> </span>conservation <span class="op">%&gt;%</span></span>
<span id="cb212-5"><a href="wrangle-data.html#cb212-5"></a><span class="st">  </span><span class="kw">separate</span>(<span class="st">`</span><span class="dt">conservation abbreviation</span><span class="st">`</span>, </span>
<span id="cb212-6"><a href="wrangle-data.html#cb212-6"></a>           <span class="dt">into =</span> <span class="kw">c</span>(<span class="st">&quot;abbreviation&quot;</span>, <span class="st">&quot;description&quot;</span>), <span class="dt">sep =</span> <span class="st">&quot; = &quot;</span>)</span>
<span id="cb212-7"><a href="wrangle-data.html#cb212-7"></a></span>
<span id="cb212-8"><a href="wrangle-data.html#cb212-8"></a></span>
<span id="cb212-9"><a href="wrangle-data.html#cb212-9"></a><span class="co">## now lets join the two datasets together</span></span>
<span id="cb212-10"><a href="wrangle-data.html#cb212-10"></a>msleep <span class="op">%&gt;%</span></span>
<span id="cb212-11"><a href="wrangle-data.html#cb212-11"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">conservation =</span> <span class="kw">toupper</span>(conservation)) <span class="op">%&gt;%</span></span>
<span id="cb212-12"><a href="wrangle-data.html#cb212-12"></a><span class="st">  </span><span class="kw">left_join</span>(conserve, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;conservation&quot;</span> =<span class="st"> &quot;abbreviation&quot;</span>))</span></code></pre></div>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1Z1pukaF-HrZHEwSfr3SV8N2Slo2rMEJxpgl1qJv-QL4/export/png?id=1Z1pukaF-HrZHEwSfr3SV8N2Slo2rMEJxpgl1qJv-QL4&amp;pageid=g38bb68a535_0_265" alt="" />
<p class="caption">Data resulting from left_join</p>
</div>
<p>It’s important to note that there are many other ways to join data, which are covered in more detail on this <a href="http://stat545.com/bit001_dplyr-cheatsheet.html">dplyr join cheatsheet</a> from Jenny Bryan. For now, it’s important to know that joining datasets is done easily in R using tools in <code>dplyr</code>. As you join data frames in your own work, it’s a good idea to refer back to this cheatsheet for assistance.</p>
</div>
<div id="grouping-data" class="section level3" number="3.4.10">
<h3><span class="header-section-number">3.4.10</span> Grouping Data</h3>
<p>Often, data scientists will want to summarize information in their dataset. You may want to know how many people are in a dataset. However, more often, you’ll want to know how many people there are within a group in your dataset. For example, you may want to know how many males and how many females there are. To do this, grouping your data is necessary. Rather than looking at the total number of individuals, to accomplish this, you first have to <strong>group the data</strong> by the gender of the individuals. Then, you count within those groups. Grouping by variables within <code>dplyr</code> is straightforward.</p>
<div id="group_by" class="section level4" number="3.4.10.1">
<h4><span class="header-section-number">3.4.10.1</span> <code>group_by()</code></h4>
<p>There is an incredibly helpful function within <code>dplyr</code> called <code>group_by()</code>. The <code>group_by()</code> function groups a dataset by one or more variables. On its own, it does not appear to change the dataset very much. The difference between the two outputs below is subtle:</p>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb213-1"><a href="wrangle-data.html#cb213-1"></a>msleep</span>
<span id="cb213-2"><a href="wrangle-data.html#cb213-2"></a></span>
<span id="cb213-3"><a href="wrangle-data.html#cb213-3"></a>msleep <span class="op">%&gt;%</span></span>
<span id="cb213-4"><a href="wrangle-data.html#cb213-4"></a><span class="st">  </span><span class="kw">group_by</span>(order)</span></code></pre></div>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1Z1pukaF-HrZHEwSfr3SV8N2Slo2rMEJxpgl1qJv-QL4/export/png?id=1Z1pukaF-HrZHEwSfr3SV8N2Slo2rMEJxpgl1qJv-QL4&amp;pageid=g38bb68a535_0_278" alt="" />
<p class="caption">group_by() output</p>
</div>
<p>In fact, the only aspect of the output that is different is that the number of different orders is now printed on your screen. However, in the next section, you’ll see that the output from any further functions you carry out at this point will differ between the two datasets.</p>
</div>
</div>
<div id="summarizing-data" class="section level3" number="3.4.11">
<h3><span class="header-section-number">3.4.11</span> Summarizing Data</h3>
<p>Throughout data cleaning and analysis it will be important to summarize information in your dataset. This may be for a formal report or for checking the results of a data tidying operation.</p>
<div id="summarize" class="section level4" number="3.4.11.1">
<h4><span class="header-section-number">3.4.11.1</span> <code>summarize()</code></h4>
<p>Continuing on from the previous examples, if you wanted to figure out how many samples are present in your dataset, you could use the <code>summarize()</code> function.</p>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="wrangle-data.html#cb214-1"></a>msleep <span class="op">%&gt;%</span></span>
<span id="cb214-2"><a href="wrangle-data.html#cb214-2"></a><span class="co"># here we select the column called genus, any column would work</span></span>
<span id="cb214-3"><a href="wrangle-data.html#cb214-3"></a><span class="st">  </span><span class="kw">select</span>(genus) <span class="op">%&gt;%</span></span>
<span id="cb214-4"><a href="wrangle-data.html#cb214-4"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">N=</span><span class="kw">n</span>())</span></code></pre></div>
<pre><code>## # A tibble: 1 x 1
##       N
##   &lt;int&gt;
## 1    83</code></pre>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="wrangle-data.html#cb216-1"></a>msleep <span class="op">%&gt;%</span></span>
<span id="cb216-2"><a href="wrangle-data.html#cb216-2"></a><span class="co"># here we select the column called vore, any column would work</span></span>
<span id="cb216-3"><a href="wrangle-data.html#cb216-3"></a><span class="st">  </span><span class="kw">select</span>(vore) <span class="op">%&gt;%</span></span>
<span id="cb216-4"><a href="wrangle-data.html#cb216-4"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">N=</span><span class="kw">n</span>())</span></code></pre></div>
<pre><code>## # A tibble: 1 x 1
##       N
##   &lt;int&gt;
## 1    83</code></pre>
<p>This provides a summary of the data with the new column name we specified above (<code>N</code>) and the number of samples in the dataset. Note that we could also obtain the same information by directly obtaining the number of rows in the data frame with <code>nrow(msleep)</code>.</p>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1Z1pukaF-HrZHEwSfr3SV8N2Slo2rMEJxpgl1qJv-QL4/export/png?id=1Z1pukaF-HrZHEwSfr3SV8N2Slo2rMEJxpgl1qJv-QL4&amp;pageid=g38bb68a535_0_285" alt="" />
<p class="caption">Summarize with n()</p>
</div>
<p>However, if you wanted to count how many of each different <code>order</code> of mammal you had. You would first <code>group_by(order)</code> and then use <code>summarize()</code>. This will summarize within group.</p>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="wrangle-data.html#cb218-1"></a>msleep <span class="op">%&gt;%</span></span>
<span id="cb218-2"><a href="wrangle-data.html#cb218-2"></a><span class="st">  </span><span class="kw">group_by</span>(order) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb218-3"><a href="wrangle-data.html#cb218-3"></a><span class="st">  </span><span class="kw">select</span>(order) <span class="op">%&gt;%</span></span>
<span id="cb218-4"><a href="wrangle-data.html#cb218-4"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">N=</span><span class="kw">n</span>())</span></code></pre></div>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<pre><code>## # A tibble: 19 x 2
##    order               N
##    &lt;chr&gt;           &lt;int&gt;
##  1 Afrosoricida        1
##  2 Artiodactyla        6
##  3 Carnivora          12
##  4 Cetacea             3
##  5 Chiroptera          2
##  6 Cingulata           2
##  7 Didelphimorphia     2
##  8 Diprotodontia       2
##  9 Erinaceomorpha      2
## 10 Hyracoidea          3
## 11 Lagomorpha          1
## 12 Monotremata         1
## 13 Perissodactyla      3
## 14 Pilosa              1
## 15 Primates           12
## 16 Proboscidea         2
## 17 Rodentia           22
## 18 Scandentia          1
## 19 Soricomorpha        5</code></pre>
<p>The output from this, like above, includes the column name we specified in summarize (<code>N</code>). However, it includes the number of samples in the group_by variable we specified (<code>order</code>).</p>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1Z1pukaF-HrZHEwSfr3SV8N2Slo2rMEJxpgl1qJv-QL4/export/png?id=1Z1pukaF-HrZHEwSfr3SV8N2Slo2rMEJxpgl1qJv-QL4&amp;pageid=g38bb68a535_0_293" alt="" />
<p class="caption">group_by() and summarize with n()</p>
</div>
<p>There are other ways in which the data can be summarized using <code>summarize()</code>. In addition to using n() to count the number of samples within a group, you can also summarize using other helpful functions within R, such as <code>mean()</code>, <code>median()</code>, <code>min()</code>, and <code>max()</code>.</p>
<p>For example, if we wanted to calculate the average (mean) total sleep each order of mammal got, we could use the following syntax:</p>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb221-1"><a href="wrangle-data.html#cb221-1"></a>msleep <span class="op">%&gt;%</span></span>
<span id="cb221-2"><a href="wrangle-data.html#cb221-2"></a><span class="st">  </span><span class="kw">group_by</span>(order) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb221-3"><a href="wrangle-data.html#cb221-3"></a><span class="st">  </span><span class="kw">select</span>(order, sleep_total) <span class="op">%&gt;%</span></span>
<span id="cb221-4"><a href="wrangle-data.html#cb221-4"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">N=</span><span class="kw">n</span>(), <span class="dt">mean_sleep=</span><span class="kw">mean</span>(sleep_total))</span></code></pre></div>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<pre><code>## # A tibble: 19 x 3
##    order               N mean_sleep
##    &lt;chr&gt;           &lt;int&gt;      &lt;dbl&gt;
##  1 Afrosoricida        1      15.6 
##  2 Artiodactyla        6       4.52
##  3 Carnivora          12      10.1 
##  4 Cetacea             3       4.5 
##  5 Chiroptera          2      19.8 
##  6 Cingulata           2      17.8 
##  7 Didelphimorphia     2      18.7 
##  8 Diprotodontia       2      12.4 
##  9 Erinaceomorpha      2      10.2 
## 10 Hyracoidea          3       5.67
## 11 Lagomorpha          1       8.4 
## 12 Monotremata         1       8.6 
## 13 Perissodactyla      3       3.47
## 14 Pilosa              1      14.4 
## 15 Primates           12      10.5 
## 16 Proboscidea         2       3.6 
## 17 Rodentia           22      12.5 
## 18 Scandentia          1       8.9 
## 19 Soricomorpha        5      11.1</code></pre>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1Z1pukaF-HrZHEwSfr3SV8N2Slo2rMEJxpgl1qJv-QL4/export/png?id=1Z1pukaF-HrZHEwSfr3SV8N2Slo2rMEJxpgl1qJv-QL4&amp;pageid=g38bb68a535_0_300" alt="" />
<p class="caption">summarize using mean()</p>
</div>
</div>
<div id="tabyl" class="section level4" number="3.4.11.2">
<h4><span class="header-section-number">3.4.11.2</span> <code>tabyl()</code></h4>
<p>In addition to using <code>summarize()</code> from <code>dplyr</code>, the <code>tabyl()</code> function from the <code>janitor</code> package can be incredibly helpful for summarizing categorical variables quickly and discerning the output at a glance. It is similar to the <code>table()</code> function from base R, but is explicit about missing data, rather than ignoring missing values by default.</p>
<p>Again returning to our <code>msleep</code> dataset, if we wanted to get a summary of how many samples are in each order category and what percent of the data fall into each category we could call tabyl on that variable. For example, if we use the following syntax, we easily get a quick snapshot of this variable.</p>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="wrangle-data.html#cb224-1"></a>msleep <span class="op">%&gt;%</span></span>
<span id="cb224-2"><a href="wrangle-data.html#cb224-2"></a><span class="st">  </span><span class="kw">tabyl</span>(order)</span></code></pre></div>
<pre><code>##            order  n    percent
##     Afrosoricida  1 0.01204819
##     Artiodactyla  6 0.07228916
##        Carnivora 12 0.14457831
##          Cetacea  3 0.03614458
##       Chiroptera  2 0.02409639
##        Cingulata  2 0.02409639
##  Didelphimorphia  2 0.02409639
##    Diprotodontia  2 0.02409639
##   Erinaceomorpha  2 0.02409639
##       Hyracoidea  3 0.03614458
##       Lagomorpha  1 0.01204819
##      Monotremata  1 0.01204819
##   Perissodactyla  3 0.03614458
##           Pilosa  1 0.01204819
##         Primates 12 0.14457831
##      Proboscidea  2 0.02409639
##         Rodentia 22 0.26506024
##       Scandentia  1 0.01204819
##     Soricomorpha  5 0.06024096</code></pre>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1Z1pukaF-HrZHEwSfr3SV8N2Slo2rMEJxpgl1qJv-QL4/export/png?id=1Z1pukaF-HrZHEwSfr3SV8N2Slo2rMEJxpgl1qJv-QL4&amp;pageid=g38bb68a535_0_304" alt="" />
<p class="caption">summarize using tabyl() from janitor</p>
</div>
<p>Note, that <code>tabyl</code> assumes categorical variables. If you want to summarize numeric variables <code>summary()</code> works well. For example, this code will summarize the values in <code>msleep$awake</code> for you.</p>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb226-1"><a href="wrangle-data.html#cb226-1"></a><span class="kw">summary</span>(msleep<span class="op">$</span>awake)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##    4.10   10.25   13.90   13.57   16.15   22.10</code></pre>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1Z1pukaF-HrZHEwSfr3SV8N2Slo2rMEJxpgl1qJv-QL4/export/png?id=1Z1pukaF-HrZHEwSfr3SV8N2Slo2rMEJxpgl1qJv-QL4&amp;pageid=g38bb68a535_0_320" alt="" />
<p class="caption">summarize numeric variables</p>
</div>
</div>
<div id="tally" class="section level4" number="3.4.11.3">
<h4><span class="header-section-number">3.4.11.3</span> <code>tally()</code></h4>
<p>We can use the tally function to get the total number of samples in a tibble or the total number of rows very simply.</p>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb228-1"><a href="wrangle-data.html#cb228-1"></a>msleep <span class="op">%&gt;%</span></span>
<span id="cb228-2"><a href="wrangle-data.html#cb228-2"></a><span class="st">  </span><span class="kw">tally</span>()</span></code></pre></div>
<pre><code>## # A tibble: 1 x 1
##       n
##   &lt;int&gt;
## 1    83</code></pre>
<p>We can see that this is very similar to our previous use of summarize.</p>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb230-1"><a href="wrangle-data.html#cb230-1"></a>msleep <span class="op">%&gt;%</span></span>
<span id="cb230-2"><a href="wrangle-data.html#cb230-2"></a><span class="st">  </span><span class="co"># here we select the column called genus, any column would work</span></span>
<span id="cb230-3"><a href="wrangle-data.html#cb230-3"></a><span class="st">  </span><span class="kw">select</span>(genus) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb230-4"><a href="wrangle-data.html#cb230-4"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">N=</span><span class="kw">n</span>())</span></code></pre></div>
<pre><code>## # A tibble: 1 x 1
##       N
##   &lt;int&gt;
## 1    83</code></pre>
<p>We can also use this function to get a sum of the values of a column (if the values are numeric).</p>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb232-1"><a href="wrangle-data.html#cb232-1"></a>msleep <span class="op">%&gt;%</span></span>
<span id="cb232-2"><a href="wrangle-data.html#cb232-2"></a><span class="kw">tally</span>(sleep_total)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 1
##       n
##   &lt;dbl&gt;
## 1   866</code></pre>
<p>Thus overall, all the animals in the dataset sleep 866 hours in total.</p>
<p>This is the equivalent to using the sum <code>function()</code> with the <code>summarize()</code> function or the <code>pull</code> function.</p>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb234-1"><a href="wrangle-data.html#cb234-1"></a>msleep <span class="op">%&gt;%</span></span>
<span id="cb234-2"><a href="wrangle-data.html#cb234-2"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">sum_sleep_total =</span> <span class="kw">sum</span>(sleep_total))</span></code></pre></div>
<pre><code>## # A tibble: 1 x 1
##   sum_sleep_total
##             &lt;dbl&gt;
## 1             866</code></pre>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb236-1"><a href="wrangle-data.html#cb236-1"></a>msleep <span class="op">%&gt;%</span></span>
<span id="cb236-2"><a href="wrangle-data.html#cb236-2"></a><span class="kw">pull</span>(sleep_total)<span class="op">%&gt;%</span></span>
<span id="cb236-3"><a href="wrangle-data.html#cb236-3"></a><span class="st">  </span><span class="kw">sum</span>()</span></code></pre></div>
<pre><code>## [1] 866</code></pre>
</div>
<div id="add_tally" class="section level4" number="3.4.11.4">
<h4><span class="header-section-number">3.4.11.4</span> <code>add_tally()</code></h4>
<p>We can quickly add our tally values to our tibble using <code>add_tally()</code>.</p>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb238-1"><a href="wrangle-data.html#cb238-1"></a>msleep <span class="op">%&gt;%</span></span>
<span id="cb238-2"><a href="wrangle-data.html#cb238-2"></a><span class="st">  </span><span class="kw">add_tally</span>() <span class="op">%&gt;%</span></span>
<span id="cb238-3"><a href="wrangle-data.html#cb238-3"></a><span class="st">  </span><span class="kw">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 83
## Columns: 12
## $ name         &lt;chr&gt; &quot;Cheetah&quot;, &quot;Owl monkey&quot;, &quot;Mountain beaver&quot;, &quot;Greater sho…
## $ genus        &lt;chr&gt; &quot;Acinonyx&quot;, &quot;Aotus&quot;, &quot;Aplodontia&quot;, &quot;Blarina&quot;, &quot;Bos&quot;, &quot;Br…
## $ vore         &lt;chr&gt; &quot;carni&quot;, &quot;omni&quot;, &quot;herbi&quot;, &quot;omni&quot;, &quot;herbi&quot;, &quot;herbi&quot;, &quot;car…
## $ order        &lt;chr&gt; &quot;Carnivora&quot;, &quot;Primates&quot;, &quot;Rodentia&quot;, &quot;Soricomorpha&quot;, &quot;Ar…
## $ conservation &lt;chr&gt; &quot;lc&quot;, NA, &quot;nt&quot;, &quot;lc&quot;, &quot;domesticated&quot;, NA, &quot;vu&quot;, NA, &quot;dom…
## $ sleep_total  &lt;dbl&gt; 12.1, 17.0, 14.4, 14.9, 4.0, 14.4, 8.7, 7.0, 10.1, 3.0, …
## $ sleep_rem    &lt;dbl&gt; NA, 1.8, 2.4, 2.3, 0.7, 2.2, 1.4, NA, 2.9, NA, 0.6, 0.8,…
## $ sleep_cycle  &lt;dbl&gt; NA, NA, NA, 0.1333333, 0.6666667, 0.7666667, 0.3833333, …
## $ awake        &lt;dbl&gt; 11.9, 7.0, 9.6, 9.1, 20.0, 9.6, 15.3, 17.0, 13.9, 21.0, …
## $ brainwt      &lt;dbl&gt; NA, 0.01550, NA, 0.00029, 0.42300, NA, NA, NA, 0.07000, …
## $ bodywt       &lt;dbl&gt; 50.000, 0.480, 1.350, 0.019, 600.000, 3.850, 20.490, 0.0…
## $ n            &lt;int&gt; 83, 83, 83, 83, 83, 83, 83, 83, 83, 83, 83, 83, 83, 83, …</code></pre>
<p>Notice the new column called “n” that repeats the total number of samples for each row.</p>
<p>Or we can add a column that repeats the total hours of sleep of all the animals.</p>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb240-1"><a href="wrangle-data.html#cb240-1"></a>msleep <span class="op">%&gt;%</span></span>
<span id="cb240-2"><a href="wrangle-data.html#cb240-2"></a><span class="st">  </span><span class="kw">add_tally</span>(sleep_total) <span class="op">%&gt;%</span></span>
<span id="cb240-3"><a href="wrangle-data.html#cb240-3"></a><span class="st">  </span><span class="kw">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 83
## Columns: 12
## $ name         &lt;chr&gt; &quot;Cheetah&quot;, &quot;Owl monkey&quot;, &quot;Mountain beaver&quot;, &quot;Greater sho…
## $ genus        &lt;chr&gt; &quot;Acinonyx&quot;, &quot;Aotus&quot;, &quot;Aplodontia&quot;, &quot;Blarina&quot;, &quot;Bos&quot;, &quot;Br…
## $ vore         &lt;chr&gt; &quot;carni&quot;, &quot;omni&quot;, &quot;herbi&quot;, &quot;omni&quot;, &quot;herbi&quot;, &quot;herbi&quot;, &quot;car…
## $ order        &lt;chr&gt; &quot;Carnivora&quot;, &quot;Primates&quot;, &quot;Rodentia&quot;, &quot;Soricomorpha&quot;, &quot;Ar…
## $ conservation &lt;chr&gt; &quot;lc&quot;, NA, &quot;nt&quot;, &quot;lc&quot;, &quot;domesticated&quot;, NA, &quot;vu&quot;, NA, &quot;dom…
## $ sleep_total  &lt;dbl&gt; 12.1, 17.0, 14.4, 14.9, 4.0, 14.4, 8.7, 7.0, 10.1, 3.0, …
## $ sleep_rem    &lt;dbl&gt; NA, 1.8, 2.4, 2.3, 0.7, 2.2, 1.4, NA, 2.9, NA, 0.6, 0.8,…
## $ sleep_cycle  &lt;dbl&gt; NA, NA, NA, 0.1333333, 0.6666667, 0.7666667, 0.3833333, …
## $ awake        &lt;dbl&gt; 11.9, 7.0, 9.6, 9.1, 20.0, 9.6, 15.3, 17.0, 13.9, 21.0, …
## $ brainwt      &lt;dbl&gt; NA, 0.01550, NA, 0.00029, 0.42300, NA, NA, NA, 0.07000, …
## $ bodywt       &lt;dbl&gt; 50.000, 0.480, 1.350, 0.019, 600.000, 3.850, 20.490, 0.0…
## $ n            &lt;dbl&gt; 866, 866, 866, 866, 866, 866, 866, 866, 866, 866, 866, 8…</code></pre>
</div>
<div id="count" class="section level4" number="3.4.11.5">
<h4><span class="header-section-number">3.4.11.5</span> <code>count()</code></h4>
<p>The <code>count()</code> function takes the <code>tally()</code> function a step further to determine the count of unique values for specified variable(s)/column(s).</p>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb242-1"><a href="wrangle-data.html#cb242-1"></a>msleep <span class="op">%&gt;%</span></span>
<span id="cb242-2"><a href="wrangle-data.html#cb242-2"></a><span class="st">  </span><span class="kw">count</span>(vore)</span></code></pre></div>
<pre><code>## # A tibble: 5 x 2
##   vore        n
##   &lt;chr&gt;   &lt;int&gt;
## 1 carni      19
## 2 herbi      32
## 3 insecti     5
## 4 omni       20
## 5 &lt;NA&gt;        7</code></pre>
<p>This is the same as using group_by() with tally()</p>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb244-1"><a href="wrangle-data.html#cb244-1"></a>msleep <span class="op">%&gt;%</span></span>
<span id="cb244-2"><a href="wrangle-data.html#cb244-2"></a><span class="st">  </span><span class="kw">group_by</span>(vore) <span class="op">%&gt;%</span></span>
<span id="cb244-3"><a href="wrangle-data.html#cb244-3"></a><span class="st">  </span><span class="kw">tally</span>()</span></code></pre></div>
<pre><code>## # A tibble: 5 x 2
##   vore        n
##   &lt;chr&gt;   &lt;int&gt;
## 1 carni      19
## 2 herbi      32
## 3 insecti     5
## 4 omni       20
## 5 &lt;NA&gt;        7</code></pre>
<p>Multiple variables can be specified with <code>count()</code>.</p>
<p>This can be really useful when getting to know your data.</p>
<div class="sourceCode" id="cb246"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb246-1"><a href="wrangle-data.html#cb246-1"></a>msleep <span class="op">%&gt;%</span></span>
<span id="cb246-2"><a href="wrangle-data.html#cb246-2"></a><span class="st">  </span><span class="kw">count</span>(vore, order)</span></code></pre></div>
<pre><code>## # A tibble: 32 x 3
##    vore  order               n
##    &lt;chr&gt; &lt;chr&gt;           &lt;int&gt;
##  1 carni Carnivora          12
##  2 carni Cetacea             3
##  3 carni Cingulata           1
##  4 carni Didelphimorphia     1
##  5 carni Primates            1
##  6 carni Rodentia            1
##  7 herbi Artiodactyla        5
##  8 herbi Diprotodontia       1
##  9 herbi Hyracoidea          2
## 10 herbi Lagomorpha          1
## # … with 22 more rows</code></pre>
</div>
<div id="add_count" class="section level4" number="3.4.11.6">
<h4><span class="header-section-number">3.4.11.6</span> <code>add_count()</code></h4>
<p>the <code>add_count()</code> function is similar to the <code>add_tally()</code> function</p>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb248-1"><a href="wrangle-data.html#cb248-1"></a>msleep <span class="op">%&gt;%</span></span>
<span id="cb248-2"><a href="wrangle-data.html#cb248-2"></a><span class="st">  </span><span class="kw">add_count</span>(vore, order) <span class="op">%&gt;%</span></span>
<span id="cb248-3"><a href="wrangle-data.html#cb248-3"></a><span class="st">  </span><span class="kw">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 83
## Columns: 12
## $ name         &lt;chr&gt; &quot;Cheetah&quot;, &quot;Owl monkey&quot;, &quot;Mountain beaver&quot;, &quot;Greater sho…
## $ genus        &lt;chr&gt; &quot;Acinonyx&quot;, &quot;Aotus&quot;, &quot;Aplodontia&quot;, &quot;Blarina&quot;, &quot;Bos&quot;, &quot;Br…
## $ vore         &lt;chr&gt; &quot;carni&quot;, &quot;omni&quot;, &quot;herbi&quot;, &quot;omni&quot;, &quot;herbi&quot;, &quot;herbi&quot;, &quot;car…
## $ order        &lt;chr&gt; &quot;Carnivora&quot;, &quot;Primates&quot;, &quot;Rodentia&quot;, &quot;Soricomorpha&quot;, &quot;Ar…
## $ conservation &lt;chr&gt; &quot;lc&quot;, NA, &quot;nt&quot;, &quot;lc&quot;, &quot;domesticated&quot;, NA, &quot;vu&quot;, NA, &quot;dom…
## $ sleep_total  &lt;dbl&gt; 12.1, 17.0, 14.4, 14.9, 4.0, 14.4, 8.7, 7.0, 10.1, 3.0, …
## $ sleep_rem    &lt;dbl&gt; NA, 1.8, 2.4, 2.3, 0.7, 2.2, 1.4, NA, 2.9, NA, 0.6, 0.8,…
## $ sleep_cycle  &lt;dbl&gt; NA, NA, NA, 0.1333333, 0.6666667, 0.7666667, 0.3833333, …
## $ awake        &lt;dbl&gt; 11.9, 7.0, 9.6, 9.1, 20.0, 9.6, 15.3, 17.0, 13.9, 21.0, …
## $ brainwt      &lt;dbl&gt; NA, 0.01550, NA, 0.00029, 0.42300, NA, NA, NA, 0.07000, …
## $ bodywt       &lt;dbl&gt; 50.000, 0.480, 1.350, 0.019, 600.000, 3.850, 20.490, 0.0…
## $ n            &lt;int&gt; 12, 10, 16, 3, 5, 1, 12, 3, 12, 5, 5, 16, 10, 16, 3, 2, …</code></pre>
</div>
<div id="get_dupes" class="section level4" number="3.4.11.7">
<h4><span class="header-section-number">3.4.11.7</span> <code>get_dupes()</code></h4>
<p>Another common issue in data wrangling is the presence of duplicate entries. Sometimes you <em>expect</em> multiple observations from the same individual in your dataset. Other times, the information has accidentally been added more than once. The <code>get_dupes()</code> function becomes very helpful in this situation. If you want to identify duplicate entries during data wrangling, you’ll use this function and specify which columns you’re looking for duplicates in.</p>
<p>For example, in the <code>msleep</code> dataset, if you expected to only have one mammal representing each <code>genus</code> and <code>vore</code> you could double check this hung using <code>get_dupes()</code></p>
<div class="sourceCode" id="cb250"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb250-1"><a href="wrangle-data.html#cb250-1"></a><span class="co"># identify observations that match in both genus and vore</span></span>
<span id="cb250-2"><a href="wrangle-data.html#cb250-2"></a>msleep <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb250-3"><a href="wrangle-data.html#cb250-3"></a><span class="st">  </span><span class="kw">get_dupes</span>(genus, vore)</span></code></pre></div>
<pre><code>## # A tibble: 10 x 12
##    genus vore  dupe_count name  order conservation sleep_total sleep_rem
##    &lt;chr&gt; &lt;chr&gt;      &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;              &lt;dbl&gt;     &lt;dbl&gt;
##  1 Equus herbi          2 Horse Peri… domesticated         2.9       0.6
##  2 Equus herbi          2 Donk… Peri… domesticated         3.1       0.4
##  3 Pant… carni          3 Tiger Carn… en                  15.8      NA  
##  4 Pant… carni          3 Jagu… Carn… nt                  10.4      NA  
##  5 Pant… carni          3 Lion  Carn… vu                  13.5      NA  
##  6 Sper… herbi          3 Arct… Rode… lc                  16.6      NA  
##  7 Sper… herbi          3 Thir… Rode… lc                  13.8       3.4
##  8 Sper… herbi          3 Gold… Rode… lc                  15.9       3  
##  9 Vulp… carni          2 Arct… Carn… &lt;NA&gt;                12.5      NA  
## 10 Vulp… carni          2 Red … Carn… &lt;NA&gt;                 9.8       2.4
## # … with 4 more variables: sleep_cycle &lt;dbl&gt;, awake &lt;dbl&gt;, brainwt &lt;dbl&gt;,
## #   bodywt &lt;dbl&gt;</code></pre>
<p>The output demonstrates there are 10 mammals that overlap in their genus and vore. Note that the third column of the output counts <em>how many</em> duplicate observations there are. This can be very helpful when you’re checking your data!</p>
</div>
<div id="skim" class="section level4" number="3.4.11.8">
<h4><span class="header-section-number">3.4.11.8</span> <code>skim()</code></h4>
<p>When you would rather get a snapshot of the entire dataset, rather than just one variable, the <code>skim()</code> function from the <code>skimr</code> package can be very helpful. The output from <code>skim()</code> breaks the data up by variable type. For example, the <code>msleep</code> dataset is broken up into <code>character</code> and <code>numeric</code> variable types. The data are then summarized in a meaningful way for each. This function provides a lot of information about the entire dataset. So, when you want a summarize a dataset and quickly get a sense of your data, <code>skim()</code> is a great option!</p>
<div class="sourceCode" id="cb252"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb252-1"><a href="wrangle-data.html#cb252-1"></a><span class="co"># summarize dataset</span></span>
<span id="cb252-2"><a href="wrangle-data.html#cb252-2"></a><span class="kw">skim</span>(msleep)</span></code></pre></div>
<table>
<caption><span id="tab:unnamed-chunk-46">Table 3.1: </span>Data summary</caption>
<tbody>
<tr class="odd">
<td align="left">Name</td>
<td align="left">msleep</td>
</tr>
<tr class="even">
<td align="left">Number of rows</td>
<td align="left">83</td>
</tr>
<tr class="odd">
<td align="left">Number of columns</td>
<td align="left">11</td>
</tr>
<tr class="even">
<td align="left">_______________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Column type frequency:</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">character</td>
<td align="left">5</td>
</tr>
<tr class="odd">
<td align="left">numeric</td>
<td align="left">6</td>
</tr>
<tr class="even">
<td align="left">________________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Group variables</td>
<td align="left">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: character</strong></p>
<table>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">min</th>
<th align="right">max</th>
<th align="right">empty</th>
<th align="right">n_unique</th>
<th align="right">whitespace</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">name</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">3</td>
<td align="right">30</td>
<td align="right">0</td>
<td align="right">83</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">genus</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">3</td>
<td align="right">13</td>
<td align="right">0</td>
<td align="right">77</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">vore</td>
<td align="right">7</td>
<td align="right">0.92</td>
<td align="right">4</td>
<td align="right">7</td>
<td align="right">0</td>
<td align="right">4</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">order</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">6</td>
<td align="right">15</td>
<td align="right">0</td>
<td align="right">19</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">conservation</td>
<td align="right">29</td>
<td align="right">0.65</td>
<td align="right">2</td>
<td align="right">12</td>
<td align="right">0</td>
<td align="right">6</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">p0</th>
<th align="right">p25</th>
<th align="right">p50</th>
<th align="right">p75</th>
<th align="right">p100</th>
<th align="left">hist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">sleep_total</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">10.43</td>
<td align="right">4.45</td>
<td align="right">1.90</td>
<td align="right">7.85</td>
<td align="right">10.10</td>
<td align="right">13.75</td>
<td align="right">19.90</td>
<td align="left">▅▅▇▆▂</td>
</tr>
<tr class="even">
<td align="left">sleep_rem</td>
<td align="right">22</td>
<td align="right">0.73</td>
<td align="right">1.88</td>
<td align="right">1.30</td>
<td align="right">0.10</td>
<td align="right">0.90</td>
<td align="right">1.50</td>
<td align="right">2.40</td>
<td align="right">6.60</td>
<td align="left">▇▆▂▁▁</td>
</tr>
<tr class="odd">
<td align="left">sleep_cycle</td>
<td align="right">51</td>
<td align="right">0.39</td>
<td align="right">0.44</td>
<td align="right">0.36</td>
<td align="right">0.12</td>
<td align="right">0.18</td>
<td align="right">0.33</td>
<td align="right">0.58</td>
<td align="right">1.50</td>
<td align="left">▇▂▁▁▁</td>
</tr>
<tr class="even">
<td align="left">awake</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">13.57</td>
<td align="right">4.45</td>
<td align="right">4.10</td>
<td align="right">10.25</td>
<td align="right">13.90</td>
<td align="right">16.15</td>
<td align="right">22.10</td>
<td align="left">▂▅▇▃▅</td>
</tr>
<tr class="odd">
<td align="left">brainwt</td>
<td align="right">27</td>
<td align="right">0.67</td>
<td align="right">0.28</td>
<td align="right">0.98</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
<td align="right">0.01</td>
<td align="right">0.13</td>
<td align="right">5.71</td>
<td align="left">▇▁▁▁▁</td>
</tr>
<tr class="even">
<td align="left">bodywt</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">166.14</td>
<td align="right">786.84</td>
<td align="right">0.00</td>
<td align="right">0.17</td>
<td align="right">1.67</td>
<td align="right">41.75</td>
<td align="right">6654.00</td>
<td align="left">▇▁▁▁▁</td>
</tr>
</tbody>
</table>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1Z1pukaF-HrZHEwSfr3SV8N2Slo2rMEJxpgl1qJv-QL4/export/png?id=1Z1pukaF-HrZHEwSfr3SV8N2Slo2rMEJxpgl1qJv-QL4&amp;pageid=g38bb68a535_0_313" alt="" />
<p class="caption">summarize entire dataset using skim() from skimr</p>
</div>
<p>Note that this function allows for you to specify which columns you’d like to summarize, if you’re not interested in seeing a summary of the entire dataset:</p>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb253-1"><a href="wrangle-data.html#cb253-1"></a><span class="co"># see summary for specified columns</span></span>
<span id="cb253-2"><a href="wrangle-data.html#cb253-2"></a><span class="kw">skim</span>(msleep, genus, vore, sleep_total)</span></code></pre></div>
<table>
<caption><span id="tab:unnamed-chunk-47">Table 3.2: </span>Data summary</caption>
<tbody>
<tr class="odd">
<td align="left">Name</td>
<td align="left">msleep</td>
</tr>
<tr class="even">
<td align="left">Number of rows</td>
<td align="left">83</td>
</tr>
<tr class="odd">
<td align="left">Number of columns</td>
<td align="left">11</td>
</tr>
<tr class="even">
<td align="left">_______________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Column type frequency:</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">character</td>
<td align="left">2</td>
</tr>
<tr class="odd">
<td align="left">numeric</td>
<td align="left">1</td>
</tr>
<tr class="even">
<td align="left">________________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Group variables</td>
<td align="left">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: character</strong></p>
<table>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">min</th>
<th align="right">max</th>
<th align="right">empty</th>
<th align="right">n_unique</th>
<th align="right">whitespace</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">genus</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">3</td>
<td align="right">13</td>
<td align="right">0</td>
<td align="right">77</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">vore</td>
<td align="right">7</td>
<td align="right">0.92</td>
<td align="right">4</td>
<td align="right">7</td>
<td align="right">0</td>
<td align="right">4</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">p0</th>
<th align="right">p25</th>
<th align="right">p50</th>
<th align="right">p75</th>
<th align="right">p100</th>
<th align="left">hist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">sleep_total</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">10.43</td>
<td align="right">4.45</td>
<td align="right">1.9</td>
<td align="right">7.85</td>
<td align="right">10.1</td>
<td align="right">13.75</td>
<td align="right">19.9</td>
<td align="left">▅▅▇▆▂</td>
</tr>
</tbody>
</table>
<p>It is also possible to group data (using <code>dplyr</code>’s <code>group_by()</code> before summarizing. Notice in the summary output that each variable specified (<code>genus</code> and <code>sleep_total</code>) are now broken down within each of the <code>vore</code> categories.</p>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb254-1"><a href="wrangle-data.html#cb254-1"></a>msleep <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb254-2"><a href="wrangle-data.html#cb254-2"></a><span class="st">  </span><span class="kw">group_by</span>(vore) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb254-3"><a href="wrangle-data.html#cb254-3"></a><span class="st">  </span><span class="kw">skim</span>(genus, sleep_total)</span></code></pre></div>
<table>
<caption><span id="tab:unnamed-chunk-48">Table 3.3: </span>Data summary</caption>
<tbody>
<tr class="odd">
<td align="left">Name</td>
<td align="left">Piped data</td>
</tr>
<tr class="even">
<td align="left">Number of rows</td>
<td align="left">83</td>
</tr>
<tr class="odd">
<td align="left">Number of columns</td>
<td align="left">11</td>
</tr>
<tr class="even">
<td align="left">_______________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Column type frequency:</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">character</td>
<td align="left">1</td>
</tr>
<tr class="odd">
<td align="left">numeric</td>
<td align="left">1</td>
</tr>
<tr class="even">
<td align="left">________________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Group variables</td>
<td align="left">vore</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: character</strong></p>
<table>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="left">vore</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">min</th>
<th align="right">max</th>
<th align="right">empty</th>
<th align="right">n_unique</th>
<th align="right">whitespace</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">genus</td>
<td align="left">carni</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">5</td>
<td align="right">13</td>
<td align="right">0</td>
<td align="right">16</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">genus</td>
<td align="left">herbi</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">3</td>
<td align="right">12</td>
<td align="right">0</td>
<td align="right">29</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">genus</td>
<td align="left">insecti</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">6</td>
<td align="right">12</td>
<td align="right">0</td>
<td align="right">5</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">genus</td>
<td align="left">omni</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">3</td>
<td align="right">13</td>
<td align="right">0</td>
<td align="right">20</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">genus</td>
<td align="left">NA</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">6</td>
<td align="right">11</td>
<td align="right">0</td>
<td align="right">7</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="left">vore</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">p0</th>
<th align="right">p25</th>
<th align="right">p50</th>
<th align="right">p75</th>
<th align="right">p100</th>
<th align="left">hist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">sleep_total</td>
<td align="left">carni</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">10.38</td>
<td align="right">4.67</td>
<td align="right">2.7</td>
<td align="right">6.25</td>
<td align="right">10.4</td>
<td align="right">13.00</td>
<td align="right">19.4</td>
<td align="left">▅▃▇▃▂</td>
</tr>
<tr class="even">
<td align="left">sleep_total</td>
<td align="left">herbi</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">9.51</td>
<td align="right">4.88</td>
<td align="right">1.9</td>
<td align="right">4.30</td>
<td align="right">10.3</td>
<td align="right">14.22</td>
<td align="right">16.6</td>
<td align="left">▇▃▂▅▇</td>
</tr>
<tr class="odd">
<td align="left">sleep_total</td>
<td align="left">insecti</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">14.94</td>
<td align="right">5.92</td>
<td align="right">8.4</td>
<td align="right">8.60</td>
<td align="right">18.1</td>
<td align="right">19.70</td>
<td align="right">19.9</td>
<td align="left">▅▁▁▁▇</td>
</tr>
<tr class="even">
<td align="left">sleep_total</td>
<td align="left">omni</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">10.93</td>
<td align="right">2.95</td>
<td align="right">8.0</td>
<td align="right">9.10</td>
<td align="right">9.9</td>
<td align="right">10.93</td>
<td align="right">18.0</td>
<td align="left">▇▃▁▂▂</td>
</tr>
<tr class="odd">
<td align="left">sleep_total</td>
<td align="left">NA</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">10.19</td>
<td align="right">3.00</td>
<td align="right">5.4</td>
<td align="right">8.65</td>
<td align="right">10.6</td>
<td align="right">12.15</td>
<td align="right">13.7</td>
<td align="left">▇▁▃▇▇</td>
</tr>
</tbody>
</table>
</div>
<div id="summary-1" class="section level4" number="3.4.11.9">
<h4><span class="header-section-number">3.4.11.9</span> <code>summary()</code></h4>
<p>While base R has a summary function, the <code>skimr</code> package also has a helpful <code>summary()</code> function that provides you with a quick summary of the dataset at large.</p>
<div class="sourceCode" id="cb255"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb255-1"><a href="wrangle-data.html#cb255-1"></a><span class="kw">skim</span>(msleep) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb255-2"><a href="wrangle-data.html#cb255-2"></a><span class="st">  </span><span class="kw">summary</span>()</span></code></pre></div>
<table>
<caption><span id="tab:unnamed-chunk-49">Table 3.4: </span>Data summary</caption>
<tbody>
<tr class="odd">
<td align="left">Name</td>
<td align="left">msleep</td>
</tr>
<tr class="even">
<td align="left">Number of rows</td>
<td align="left">83</td>
</tr>
<tr class="odd">
<td align="left">Number of columns</td>
<td align="left">11</td>
</tr>
<tr class="even">
<td align="left">_______________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Column type frequency:</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">character</td>
<td align="left">5</td>
</tr>
<tr class="odd">
<td align="left">numeric</td>
<td align="left">6</td>
</tr>
<tr class="even">
<td align="left">________________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Group variables</td>
<td align="left">None</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="operations-across-columns" class="section level3" number="3.4.12">
<h3><span class="header-section-number">3.4.12</span> Operations Across Columns</h3>
<p>Sometimes it is valuable to apply a certain operation across the columns of a data frame. For example, it be necessary to compute the mean or some other summary statistics for each column in the data frame. In some cases, these operations can be done by a combination of <code>pivot_longer()</code> along with <code>group_by()</code> and <code>summarize()</code>. However, in other cases it is more straightforward to simply compute the statistic on each column.</p>
<p>The <code>across()</code> function is need to operate across the columns of a data frame. For example, in our <code>airquality</code> dataset, if we wanted to compute the mean of <code>Ozone</code>, <code>Solar.R</code>, <code>Wind</code>, and <code>Temp</code>, we could do</p>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb256-1"><a href="wrangle-data.html#cb256-1"></a>airquality <span class="op">%&gt;%</span></span>
<span id="cb256-2"><a href="wrangle-data.html#cb256-2"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="kw">across</span>(Ozone<span class="op">:</span>Temp, mean, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</span></code></pre></div>
<pre><code>## # A tibble: 1 x 4
##   Ozone Solar.R  Wind  Temp
##   &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1  42.1    186.  9.96  77.9</code></pre>
<p>The <code>across()</code> function can be used in conjunction with the <code>mutate()</code> and <code>filter()</code> functions to construct joint operations across different columns of a data frame. For example, suppose we wanted to filter the rows of the <code>airquality</code> data frame so that we only retain rows that do not have missing values for <code>Ozone</code> and <code>Solar.R</code>. Generally, we might use the <code>filter()</code> function for this, as follows.</p>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb258-1"><a href="wrangle-data.html#cb258-1"></a>airquality <span class="op">%&gt;%</span></span>
<span id="cb258-2"><a href="wrangle-data.html#cb258-2"></a><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(Ozone),</span>
<span id="cb258-3"><a href="wrangle-data.html#cb258-3"></a>         <span class="op">!</span><span class="kw">is.na</span>(Solar.R))</span></code></pre></div>
<p>Because we are only filtering on two columns here, it’s not too difficult to write out the expression. However, if we were filtering on many columns, it would become a challenge to write out every column. This is where the <code>across()</code> function comes in handy. With the <code>across()</code> function, we can specify columns in the same way that we use the <code>select()</code> function. This allows us to use short-hand notation to select a large set of columns.</p>
<p>We can use the <code>across()</code> function in conjunction with <code>filter()</code> to achieve the same result as above..</p>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb259-1"><a href="wrangle-data.html#cb259-1"></a>airquality <span class="op">%&gt;%</span></span>
<span id="cb259-2"><a href="wrangle-data.html#cb259-2"></a><span class="st">  </span><span class="kw">filter</span>(<span class="kw">across</span>(Ozone<span class="op">:</span>Solar.R, <span class="op">~</span><span class="st"> </span><span class="op">!</span><span class="kw">is.na</span>(.)))</span></code></pre></div>
<pre><code>## # A tibble: 111 x 6
##    Ozone Solar.R  Wind  Temp Month   Day
##    &lt;int&gt;   &lt;int&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
##  1    41     190   7.4    67     5     1
##  2    36     118   8      72     5     2
##  3    12     149  12.6    74     5     3
##  4    18     313  11.5    62     5     4
##  5    23     299   8.6    65     5     7
##  6    19      99  13.8    59     5     8
##  7     8      19  20.1    61     5     9
##  8    16     256   9.7    69     5    12
##  9    11     290   9.2    66     5    13
## 10    14     274  10.9    68     5    14
## # … with 101 more rows</code></pre>
<p>Here, the <code>~</code> in the call to <code>across()</code> indicates that we are passing an anonymous function (see the chapter on Functional Programming for more details) and the <code>.</code> is a stand-in for the name of the column.</p>
<p>If we wanted to filter the data frame to remove rows with missing values in <code>Ozone</code>, <code>Solar.R</code>, <code>Wind</code>, and <code>Temp</code>, we only need to make a small change.</p>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb261-1"><a href="wrangle-data.html#cb261-1"></a>airquality <span class="op">%&gt;%</span></span>
<span id="cb261-2"><a href="wrangle-data.html#cb261-2"></a><span class="st">  </span><span class="kw">filter</span>(<span class="kw">across</span>(Ozone<span class="op">:</span>Temp, <span class="op">~</span><span class="st"> </span><span class="op">!</span><span class="kw">is.na</span>(.)))</span></code></pre></div>
<pre><code>## # A tibble: 111 x 6
##    Ozone Solar.R  Wind  Temp Month   Day
##    &lt;int&gt;   &lt;int&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
##  1    41     190   7.4    67     5     1
##  2    36     118   8      72     5     2
##  3    12     149  12.6    74     5     3
##  4    18     313  11.5    62     5     4
##  5    23     299   8.6    65     5     7
##  6    19      99  13.8    59     5     8
##  7     8      19  20.1    61     5     9
##  8    16     256   9.7    69     5    12
##  9    11     290   9.2    66     5    13
## 10    14     274  10.9    68     5    14
## # … with 101 more rows</code></pre>
<p>The <code>across()</code> function can also be used with <code>mutate()</code> if we want to apply the same transformation to multiple columns. For example, suppose we want to cycle through each column and replace all missing values (<code>NA</code>s) with zeros. We could use <code>across()</code> to accomplish this.</p>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb263-1"><a href="wrangle-data.html#cb263-1"></a>airquality <span class="op">%&gt;%</span></span>
<span id="cb263-2"><a href="wrangle-data.html#cb263-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="kw">across</span>(Ozone<span class="op">:</span>Temp, <span class="op">~</span><span class="st"> </span><span class="kw">replace_na</span>(., <span class="dv">0</span>)))</span></code></pre></div>
<pre><code>## # A tibble: 153 x 6
##    Ozone Solar.R  Wind  Temp Month   Day
##    &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt;
##  1    41     190   7.4    67     5     1
##  2    36     118   8      72     5     2
##  3    12     149  12.6    74     5     3
##  4    18     313  11.5    62     5     4
##  5     0       0  14.3    56     5     5
##  6    28       0  14.9    66     5     6
##  7    23     299   8.6    65     5     7
##  8    19      99  13.8    59     5     8
##  9     8      19  20.1    61     5     9
## 10     0     194   8.6    69     5    10
## # … with 143 more rows</code></pre>
<p>Again, the <code>.</code> is used as a stand-in for the name of the column. This expression essentially applies the <code>replace_na()</code> function to each of the columns between <code>Ozone</code> and <code>Temp</code> in the data frame.</p>
</div>
</div>
<div id="working-with-factors" class="section level2" number="3.5">
<h2><span class="header-section-number">3.5</span> Working With Factors</h2>
<p>In R, categorical data are handled as factors. By definition, categorical data are limited in that they have a set number of possible values they can take. For example, there are 12 months in a calendar year. In a month variable, each observation is limited to taking one of these twelve values. Thus, with a limited number of possible values, month is a categorical variable. Categorical data, which will be referred to as factors for the rest of this lesson, are regularly found in data. Learning how to work with this type of variable effectively will be incredibly helpful.</p>
<p>To make working with factors simpler, we’ll utilize the <code>forcats</code> package, a core tidyverse package. All functions within <code>forcats</code> begin with <code>fct_</code>, making them easier to look up and remember. As before, to see available functions you can type <code>?fct_</code> in your RStudio console. A drop-down menu will appear with all the possible forcats functions.</p>
<div class="figure">
<img src="https://docs.google.com/presentation/d/16Y8swNgNfpmZPqDfw-lO36MXRc2T66zWoFB5Y35rmJU/export/png?id=16Y8swNgNfpmZPqDfw-lO36MXRc2T66zWoFB5Y35rmJU&amp;pageid=g391e563ea4_0_0" alt="" />
<p class="caption">fct_ output from RStudio</p>
</div>
<div id="factor-review" class="section level3" number="3.5.1">
<h3><span class="header-section-number">3.5.1</span> Factor Review</h3>
<p>In R, factors are comprised of two components: the actual <strong>values</strong> of the data and the possible <strong>levels</strong> within the factor. Thus, to create a factor, you need to supply both these pieces of information.</p>
<p>For example, if we were to create a character vector of the twelve months, we could certainly do that:</p>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb265-1"><a href="wrangle-data.html#cb265-1"></a><span class="co">## all 12 months</span></span>
<span id="cb265-2"><a href="wrangle-data.html#cb265-2"></a>all_months &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Jan&quot;</span>, <span class="st">&quot;Feb&quot;</span>, <span class="st">&quot;Mar&quot;</span>, <span class="st">&quot;Apr&quot;</span>, <span class="st">&quot;May&quot;</span>, <span class="st">&quot;Jun&quot;</span>, <span class="st">&quot;Jul&quot;</span>, <span class="st">&quot;Aug&quot;</span>, <span class="st">&quot;Sep&quot;</span>, <span class="st">&quot;Oct&quot;</span>, <span class="st">&quot;Nov&quot;</span>, <span class="st">&quot;Dec&quot;</span>)</span>
<span id="cb265-3"><a href="wrangle-data.html#cb265-3"></a></span>
<span id="cb265-4"><a href="wrangle-data.html#cb265-4"></a><span class="co">## our data</span></span>
<span id="cb265-5"><a href="wrangle-data.html#cb265-5"></a>some_months &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Mar&quot;</span>, <span class="st">&quot;Dec&quot;</span>, <span class="st">&quot;Jan&quot;</span>,  <span class="st">&quot;Apr&quot;</span>, <span class="st">&quot;Jul&quot;</span>)</span></code></pre></div>
<p>However, if we were to sort this vector, R would sort this vector alphabetically.</p>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb266-1"><a href="wrangle-data.html#cb266-1"></a><span class="co"># alphabetical sort</span></span>
<span id="cb266-2"><a href="wrangle-data.html#cb266-2"></a><span class="kw">sort</span>(some_months)</span></code></pre></div>
<pre><code>## [1] &quot;Apr&quot; &quot;Dec&quot; &quot;Jan&quot; &quot;Jul&quot; &quot;Mar&quot;</code></pre>
<div class="figure">
<img src="https://docs.google.com/presentation/d/16Y8swNgNfpmZPqDfw-lO36MXRc2T66zWoFB5Y35rmJU/export/png?id=16Y8swNgNfpmZPqDfw-lO36MXRc2T66zWoFB5Y35rmJU&amp;pageid=g391e563ea4_0_12" alt="" />
<p class="caption">sort sorts variable alphabetically</p>
</div>
<p>While you and I know that this is not how months should be ordered, we haven’t yet told R that. To do so, we need to let R know that it’s a factor variable and what the levels of that factor variable should be.</p>
<div class="sourceCode" id="cb268"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb268-1"><a href="wrangle-data.html#cb268-1"></a><span class="co"># create factor</span></span>
<span id="cb268-2"><a href="wrangle-data.html#cb268-2"></a>mon &lt;-<span class="st"> </span><span class="kw">factor</span>(some_months, <span class="dt">levels =</span> all_months)</span>
<span id="cb268-3"><a href="wrangle-data.html#cb268-3"></a></span>
<span id="cb268-4"><a href="wrangle-data.html#cb268-4"></a><span class="co"># look at factor</span></span>
<span id="cb268-5"><a href="wrangle-data.html#cb268-5"></a>mon</span></code></pre></div>
<pre><code>## [1] Mar Dec Jan Apr Jul
## Levels: Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec</code></pre>
<div class="sourceCode" id="cb270"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb270-1"><a href="wrangle-data.html#cb270-1"></a><span class="co"># look at sorted factor</span></span>
<span id="cb270-2"><a href="wrangle-data.html#cb270-2"></a><span class="kw">sort</span>(mon)</span></code></pre></div>
<pre><code>## [1] Jan Mar Apr Jul Dec
## Levels: Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec</code></pre>
<div class="figure">
<img src="https://docs.google.com/presentation/d/16Y8swNgNfpmZPqDfw-lO36MXRc2T66zWoFB5Y35rmJU/export/png?id=16Y8swNgNfpmZPqDfw-lO36MXRc2T66zWoFB5Y35rmJU&amp;pageid=g391e563ea4_0_16" alt="" />
<p class="caption">defining the factor levels sorts this variable sensibly</p>
</div>
<p>Here, we specify all the possible values that the factor could take in the <code>levels = all_months</code> argument. So, even though not all twelve months are included in the some_months object, we’ve stated that all of the months are possible values. Further, when you sort this variable, it now sorts in the sensical way!</p>
</div>
<div id="manually-changing-the-labels-of-factor-levels-fct_relevel" class="section level3" number="3.5.2">
<h3><span class="header-section-number">3.5.2</span> Manually Changing the Labels of Factor Levels: <code>fct_relevel()</code></h3>
<p>What if you wanted your months to start with July first? That can be accomplished using <code>fct_relevel()</code>. To use this function, you simply need to state what you’d like to relevel (<code>mon</code>) followed by the levels you want to relevel. If you want these to be placed in the beginning, the after argument should be <code>after = 0</code>. You can play around with this setting to see how changing <code>after</code> affects the levels in your output.</p>
<div class="sourceCode" id="cb272"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb272-1"><a href="wrangle-data.html#cb272-1"></a>mon_relevel &lt;-<span class="st"> </span><span class="kw">fct_relevel</span>(mon, <span class="st">&quot;Jul&quot;</span>, <span class="st">&quot;Aug&quot;</span>, <span class="st">&quot;Sep&quot;</span>, <span class="st">&quot;Oct&quot;</span>, <span class="st">&quot;Nov&quot;</span>, <span class="st">&quot;Dec&quot;</span>, <span class="dt">after =</span> <span class="dv">0</span>)</span>
<span id="cb272-2"><a href="wrangle-data.html#cb272-2"></a></span>
<span id="cb272-3"><a href="wrangle-data.html#cb272-3"></a><span class="co"># releveled</span></span>
<span id="cb272-4"><a href="wrangle-data.html#cb272-4"></a>mon_relevel</span></code></pre></div>
<pre><code>## [1] Mar Dec Jan Apr Jul
## Levels: Jul Aug Sep Oct Nov Dec Jan Feb Mar Apr May Jun</code></pre>
<div class="sourceCode" id="cb274"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb274-1"><a href="wrangle-data.html#cb274-1"></a><span class="co"># releleveld and sorted</span></span>
<span id="cb274-2"><a href="wrangle-data.html#cb274-2"></a><span class="kw">sort</span>(mon_relevel)</span></code></pre></div>
<pre><code>## [1] Jul Dec Jan Mar Apr
## Levels: Jul Aug Sep Oct Nov Dec Jan Feb Mar Apr May Jun</code></pre>
<div class="figure">
<img src="https://docs.google.com/presentation/d/16Y8swNgNfpmZPqDfw-lO36MXRc2T66zWoFB5Y35rmJU/export/png?id=16Y8swNgNfpmZPqDfw-lO36MXRc2T66zWoFB5Y35rmJU&amp;pageid=g391e563ea4_0_47" alt="" />
<p class="caption">fct_relevel enables you to change the order of your factor levels</p>
</div>
<p>After re-leveling, when we sort this factor, we see that Jul is placed first, as specified by the level re-ordering.</p>
</div>
<div id="keeping-the-order-of-the-factor-levels-fct_inorder" class="section level3" number="3.5.3">
<h3><span class="header-section-number">3.5.3</span> Keeping the Order of the Factor Levels: <code>fct_inorder()</code></h3>
<p>Now, if you’re not interested in the months being in calendar year order, you can always state that you want the levels to stay in the same order as the data you started with, you simply specify with <code>fct_inorder()</code>.</p>
<div class="sourceCode" id="cb276"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb276-1"><a href="wrangle-data.html#cb276-1"></a><span class="co"># keep order of appearance</span></span>
<span id="cb276-2"><a href="wrangle-data.html#cb276-2"></a>mon_inorder &lt;-<span class="st"> </span><span class="kw">fct_inorder</span>(some_months)</span>
<span id="cb276-3"><a href="wrangle-data.html#cb276-3"></a></span>
<span id="cb276-4"><a href="wrangle-data.html#cb276-4"></a><span class="co"># output</span></span>
<span id="cb276-5"><a href="wrangle-data.html#cb276-5"></a>mon_inorder</span></code></pre></div>
<pre><code>## [1] Mar Dec Jan Apr Jul
## Levels: Mar Dec Jan Apr Jul</code></pre>
<div class="sourceCode" id="cb278"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb278-1"><a href="wrangle-data.html#cb278-1"></a><span class="co"># sorted </span></span>
<span id="cb278-2"><a href="wrangle-data.html#cb278-2"></a><span class="kw">sort</span>(mon_inorder)</span></code></pre></div>
<pre><code>## [1] Mar Dec Jan Apr Jul
## Levels: Mar Dec Jan Apr Jul</code></pre>
<div class="figure">
<img src="https://docs.google.com/presentation/d/16Y8swNgNfpmZPqDfw-lO36MXRc2T66zWoFB5Y35rmJU/export/png?id=16Y8swNgNfpmZPqDfw-lO36MXRc2T66zWoFB5Y35rmJU&amp;pageid=g391e563ea4_0_52" alt="" />
<p class="caption">fct_inorder() assigns levels in the same order the level is seen in the data</p>
</div>
<p>We see now with <code>fct_inorder()</code> that even when we sort the output, it does not sort the factor alphabetically, nor does it put it in calendar order. In fact, it stays in the same order as the input, just as we specified.</p>
</div>
<div id="advanced-factoring" class="section level3" number="3.5.4">
<h3><span class="header-section-number">3.5.4</span> Advanced Factoring</h3>
<p>For the remainder of this lesson, we’re going to return to using a dataset that’s in R by default. We’ll use the <code>chickwts</code> dataset for exploring the remaining advanced functions. This dataset includes data from an experiment that was looking to compare the “effectiveness of various feed supplements on the growth rate of chickens.”</p>
<div class="figure">
<img src="https://docs.google.com/presentation/d/16Y8swNgNfpmZPqDfw-lO36MXRc2T66zWoFB5Y35rmJU/export/png?id=16Y8swNgNfpmZPqDfw-lO36MXRc2T66zWoFB5Y35rmJU&amp;pageid=g391e563ea4_0_24" alt="" />
<p class="caption">chickwts dataset</p>
</div>
</div>
<div id="re-ordering-factor-levels-by-frequency-fct_infreq" class="section level3" number="3.5.5">
<h3><span class="header-section-number">3.5.5</span> Re-ordering Factor Levels by Frequency: <code>fct_infreq()</code></h3>
<p>To re-order factor levels by frequency of the value in the dataset, you’ll want to use <code>fct_infreq()</code>. Below, we see from the output from <code>tabyl()</code> that ‘soybean’ is the most frequent feed in the dataset while ‘horsebean’ is the least frequent. Thus, when we order by frequency, we can expect these two feeds to be at opposite ends for our levels.</p>
<div class="sourceCode" id="cb280"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb280-1"><a href="wrangle-data.html#cb280-1"></a><span class="co">## take a look at frequency of each level </span></span>
<span id="cb280-2"><a href="wrangle-data.html#cb280-2"></a><span class="co">## using tabyl() from `janitor` package</span></span>
<span id="cb280-3"><a href="wrangle-data.html#cb280-3"></a><span class="kw">tabyl</span>(chickwts<span class="op">$</span>feed)</span></code></pre></div>
<pre><code>##  chickwts$feed  n   percent
##         casein 12 0.1690141
##      horsebean 10 0.1408451
##        linseed 12 0.1690141
##       meatmeal 11 0.1549296
##        soybean 14 0.1971831
##      sunflower 12 0.1690141</code></pre>
<div class="sourceCode" id="cb282"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb282-1"><a href="wrangle-data.html#cb282-1"></a><span class="co">## order levels by frequency </span></span>
<span id="cb282-2"><a href="wrangle-data.html#cb282-2"></a><span class="kw">fct_infreq</span>(chickwts<span class="op">$</span>feed) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>()</span></code></pre></div>
<pre><code>## [1] horsebean horsebean horsebean horsebean horsebean horsebean
## Levels: soybean casein linseed sunflower meatmeal horsebean</code></pre>
<div class="figure">
<img src="https://docs.google.com/presentation/d/16Y8swNgNfpmZPqDfw-lO36MXRc2T66zWoFB5Y35rmJU/export/png?id=16Y8swNgNfpmZPqDfw-lO36MXRc2T66zWoFB5Y35rmJU&amp;pageid=g391e563ea4_0_56" alt="" />
<p class="caption">fct_infreq orders levels based on frequency in dataset</p>
</div>
<p>As expected, <code>soybean</code>, the most frequent level, appears as the first level and <code>horsebean</code>, the least frequent level, appears last. The rest of the levels are sorted by frequency.</p>
</div>
<div id="reversing-order-levels-fct_rev" class="section level3" number="3.5.6">
<h3><span class="header-section-number">3.5.6</span> Reversing Order Levels: <code>fct_rev()</code></h3>
<p>If we wanted to sort the levels from least frequent to most frequent, we could just put <code>fct_rev()</code> around the code we just used to reverse the factor level order.</p>
<div class="sourceCode" id="cb284"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb284-1"><a href="wrangle-data.html#cb284-1"></a><span class="co">## reverse factor level order</span></span>
<span id="cb284-2"><a href="wrangle-data.html#cb284-2"></a><span class="kw">fct_rev</span>(<span class="kw">fct_infreq</span>(chickwts<span class="op">$</span>feed)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>()</span></code></pre></div>
<pre><code>## [1] horsebean horsebean horsebean horsebean horsebean horsebean
## Levels: horsebean meatmeal sunflower linseed casein soybean</code></pre>
<div class="figure">
<img src="https://docs.google.com/presentation/d/16Y8swNgNfpmZPqDfw-lO36MXRc2T66zWoFB5Y35rmJU/export/png?id=16Y8swNgNfpmZPqDfw-lO36MXRc2T66zWoFB5Y35rmJU&amp;pageid=g391e563ea4_0_20" alt="" />
<p class="caption">fct_rev() reverses the factor level order</p>
</div>
</div>
<div id="re-ordering-factor-levels-by-another-variable-fct_reorder" class="section level3" number="3.5.7">
<h3><span class="header-section-number">3.5.7</span> Re-ordering Factor Levels by Another Variable: <code>fct_reorder()</code></h3>
<p>At times you may want to reorder levels of a factor by another variable in your dataset. This is often helpful when generating plots (which we’ll get to in a future lesson!). To do this you specify the variable you want to reorder, followed by the numeric variable by which you’d like the factor to be re-leveled. Here, we see that we’re re-leveling feed by the weight of the chickens. While we haven’t discussed plotting yet, the best way to demonstrate how this works is by plotting the feed against the weights. We can see that the order of the factor is such that those chickens with the lowest median weight (horsebean) are to the left, while those with the highest median weight (casein) are to the right.</p>
<div class="sourceCode" id="cb286"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb286-1"><a href="wrangle-data.html#cb286-1"></a><span class="co">## order levels by a second numeric variable </span></span>
<span id="cb286-2"><a href="wrangle-data.html#cb286-2"></a>chickwts <span class="op">%&gt;%</span></span>
<span id="cb286-3"><a href="wrangle-data.html#cb286-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">newfeed =</span> <span class="kw">fct_reorder</span>(feed, weight)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb286-4"><a href="wrangle-data.html#cb286-4"></a><span class="st">  </span><span class="kw">ggplot</span>(., <span class="kw">aes</span>(newfeed,weight)) <span class="op">+</span></span>
<span id="cb286-5"><a href="wrangle-data.html#cb286-5"></a><span class="st">  </span><span class="kw">geom_point</span>()</span></code></pre></div>
<p><img src="03-tidying_files/figure-html/unnamed-chunk-62-1.png" width="672" /></p>
<div class="figure">
<img src="https://docs.google.com/presentation/d/16Y8swNgNfpmZPqDfw-lO36MXRc2T66zWoFB5Y35rmJU/export/png?id=16Y8swNgNfpmZPqDfw-lO36MXRc2T66zWoFB5Y35rmJU&amp;pageid=g391e563ea4_0_69" alt="" />
<p class="caption">fct_reorder allows you to re-level a factor based on a secondary numeric variable</p>
</div>
</div>
<div id="combining-several-levels-into-one-fct_recode" class="section level3" number="3.5.8">
<h3><span class="header-section-number">3.5.8</span> Combining Several Levels into One: <code>fct_recode()</code></h3>
<p>To demonstrate how to combine several factor levels into a single level, we’ll continue to use our ‘chickwts’ dataset. Now, I don’t know much about chicken feed, and there’s a good chance you know a lot more. However, let’s <em>assume</em> (even if it doesn’t make good sense with regards to chicken feed) you wanted to combine all the feeds with the name “bean” in it to a single category and you wanted to combine “linseed” and “sunflower”" into the category “seed”. This can be simply accomplished with <code>fct_recode</code>. In fact, below, you see we can rename all the levels to a simpler term (the values on the left side of the equals sign) by re-naming the original level names (the right side of the equals sign). This code will create a new column, called <code>feed_recode</code> (accomplished with <code>mutate()</code>). This new column will combine “horsebean” and “soybean feeds”, grouping them both into the larger level “bean”. It will similarly group “sunflower” and “linseed” into the larger level “seed.” All other feed types will also be renamed. When we look at the summary of this new column by using <code>tabyl()</code>, we see that all of the feeds have been recoded, just as we specified! We now have four different feed types, rather than the original six.</p>
<div class="sourceCode" id="cb287"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb287-1"><a href="wrangle-data.html#cb287-1"></a><span class="co">## we can use mutate to create a new column</span></span>
<span id="cb287-2"><a href="wrangle-data.html#cb287-2"></a><span class="co">## and fct_recode() to:</span></span>
<span id="cb287-3"><a href="wrangle-data.html#cb287-3"></a><span class="co">## 1. group horsebean and soybean into a single level</span></span>
<span id="cb287-4"><a href="wrangle-data.html#cb287-4"></a><span class="co">## 2. rename all the other levels.</span></span>
<span id="cb287-5"><a href="wrangle-data.html#cb287-5"></a>chickwts <span class="op">%&gt;%</span></span>
<span id="cb287-6"><a href="wrangle-data.html#cb287-6"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">feed_recode =</span> <span class="kw">fct_recode</span>(feed,</span>
<span id="cb287-7"><a href="wrangle-data.html#cb287-7"></a>    <span class="st">&quot;seed&quot;</span>    =<span class="st">   &quot;linseed&quot;</span>,</span>
<span id="cb287-8"><a href="wrangle-data.html#cb287-8"></a>    <span class="st">&quot;bean&quot;</span>    =<span class="st">   &quot;horsebean&quot;</span>,</span>
<span id="cb287-9"><a href="wrangle-data.html#cb287-9"></a>    <span class="st">&quot;bean&quot;</span>    =<span class="st">   &quot;soybean&quot;</span>,</span>
<span id="cb287-10"><a href="wrangle-data.html#cb287-10"></a>    <span class="st">&quot;meal&quot;</span>    =<span class="st">   &quot;meatmeal&quot;</span>,</span>
<span id="cb287-11"><a href="wrangle-data.html#cb287-11"></a>    <span class="st">&quot;seed&quot;</span>    =<span class="st">   &quot;sunflower&quot;</span>,</span>
<span id="cb287-12"><a href="wrangle-data.html#cb287-12"></a>    <span class="st">&quot;casein&quot;</span>  =<span class="st">   &quot;casein&quot;</span></span>
<span id="cb287-13"><a href="wrangle-data.html#cb287-13"></a>  )) <span class="op">%&gt;%</span></span>
<span id="cb287-14"><a href="wrangle-data.html#cb287-14"></a><span class="st">  </span><span class="kw">tabyl</span>(feed_recode)</span></code></pre></div>
<pre><code>##  feed_recode  n   percent
##       casein 12 0.1690141
##         bean 24 0.3380282
##         seed 24 0.3380282
##         meal 11 0.1549296</code></pre>
<div class="figure">
<img src="https://docs.google.com/presentation/d/16Y8swNgNfpmZPqDfw-lO36MXRc2T66zWoFB5Y35rmJU/export/png?id=16Y8swNgNfpmZPqDfw-lO36MXRc2T66zWoFB5Y35rmJU&amp;pageid=g391e563ea4_0_79" alt="" />
<p class="caption">fct_recode() can be used to group multiple levels into a single level and/or to rename levels</p>
</div>
</div>
<div id="converting-numeric-levels-to-factors-ifelse-factor" class="section level3" number="3.5.9">
<h3><span class="header-section-number">3.5.9</span> Converting Numeric Levels to Factors: <code>ifelse()</code> + <code>factor()</code></h3>
<p>Finally, when working with factors, there are times when you want to convert a numeric variable into a factor. For example, if you were talking about a dataset with BMI for a number of individuals, you may want to categorize people based on whether or not they are underweight (BMI &lt; 18.5), of a healthy weight (BMI between 18.5 and 29.9), or obese (BMI &gt;= 30). When you want to take a numeric variable and turn it into a categorical factor variable, you can accomplish this easily by using <code>ifelse()</code> statements. We previously covered <code>if{}</code> statements and <code>else{}</code> statements. Here we combine those two ideas. Within a single statement we provide R with a condition: <code>weight &lt;= 200</code>. With this, we are stating that the condition is if a chicken’s weight is less than or equal to 200 grams. Then, if that condition is true, meaning if a chicken’s weight is less than or equal to 200 grams, let’s assign that chicken to the category <code>low</code>. Otherwise, and this is the <code>else{}</code> part of the <code>ifelse()</code> function, assign that chicken to the category <code>high</code>. Finally, we have to let R know that weight_recode is a factor variable, so we call factor() on this new column. This way we take a numeric variable (<code>weight</code>), and turn it into a factor variable (<code>weight_recode</code>).</p>
<div class="sourceCode" id="cb289"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb289-1"><a href="wrangle-data.html#cb289-1"></a><span class="co">## convert numeric variable to factor</span></span>
<span id="cb289-2"><a href="wrangle-data.html#cb289-2"></a>chickwts <span class="op">%&gt;%</span></span>
<span id="cb289-3"><a href="wrangle-data.html#cb289-3"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">weight_recode =</span> <span class="kw">ifelse</span>(weight <span class="op">&lt;=</span><span class="st"> </span><span class="dv">200</span>, <span class="st">&quot;low&quot;</span>, <span class="st">&quot;high&quot;</span>), </span>
<span id="cb289-4"><a href="wrangle-data.html#cb289-4"></a>           <span class="dt">weight_recode =</span> <span class="kw">factor</span>(weight_recode)) <span class="op">%&gt;%</span></span>
<span id="cb289-5"><a href="wrangle-data.html#cb289-5"></a><span class="st">    </span><span class="kw">tabyl</span>(weight_recode)</span></code></pre></div>
<pre><code>##  weight_recode  n   percent
##           high 54 0.7605634
##            low 17 0.2394366</code></pre>
<div class="figure">
<img src="https://docs.google.com/presentation/d/16Y8swNgNfpmZPqDfw-lO36MXRc2T66zWoFB5Y35rmJU/export/png?id=16Y8swNgNfpmZPqDfw-lO36MXRc2T66zWoFB5Y35rmJU&amp;pageid=g391e563ea4_0_84" alt="" />
<p class="caption">converting a numeric type variable to a factor</p>
</div>
</div>
</div>
<div id="working-with-dates-and-times" class="section level2" number="3.6">
<h2><span class="header-section-number">3.6</span> Working With Dates and Times</h2>
<p>In lessons an earlier course, you were introduced to different types of objects in R, such as characters, numeric, and logicals. Then, in earlier lessons in this course, we covered how to work with strings and factors in detail. The remaining type of variable we haven’t yet covered is how to work with dates and time in R.</p>
<p>As with strings and factors, there is a tidyverse package to help you work with dates more easily. The <code>lubridate</code> package is not part of the core tidyverse packages, so it will have to be loaded individually. This package will make working with dates and times easier. Before working through this lesson, you’ll want to be sure that <code>lubridate</code> has been installed and loaded in:</p>
<div class="sourceCode" id="cb291"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb291-1"><a href="wrangle-data.html#cb291-1"></a><span class="co">#install.packages(&#39;lubridate&#39;)</span></span>
<span id="cb291-2"><a href="wrangle-data.html#cb291-2"></a><span class="kw">library</span>(lubridate)</span></code></pre></div>
<div id="dates-and-times-basics" class="section level3" number="3.6.1">
<h3><span class="header-section-number">3.6.1</span> Dates and Times Basics</h3>
<p>When working with dates and times in R, you can consider either <strong>dates</strong>, <strong>times</strong>, or <strong>date-times</strong>. Date-times refer to dates plus times, specifying an exact moment in time. It’s always best to work with the simplest possible object for your needs. So, if you don’t need to refer to date-times specifically, it’s best to work with dates.</p>
</div>
<div id="creating-dates-and-date-time-objects" class="section level3" number="3.6.2">
<h3><span class="header-section-number">3.6.2</span> Creating Dates and Date-Time Objects</h3>
<p>To get objects into dates and date-times that can be more easily worked with in R, you’ll want to get comfortable with a number of functions from the <code>lubridate</code> package. Below we’ll discuss how to create date and date-time objects from (1) strings and (2) individual parts.</p>
<div id="from-strings" class="section level4" number="3.6.2.1">
<h4><span class="header-section-number">3.6.2.1</span> From strings</h4>
<p>Date information is often provided as a string. The functions within the <code>lubridate</code> package can effectively handle this information. To use them to generate date objects, you can call a function using <code>y</code>, <code>m</code>, and <code>d</code> in the order in which the year (<code>y</code>), month (<code>m</code>), and date (<code>d</code>) appear in your data. The code below produces identical output for the date September 29th, 1988, despite the three distinct input formats. This uniform output makes working with dates much easier in R.</p>
<div class="sourceCode" id="cb292"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb292-1"><a href="wrangle-data.html#cb292-1"></a><span class="co"># year-month-date</span></span>
<span id="cb292-2"><a href="wrangle-data.html#cb292-2"></a><span class="kw">ymd</span>(<span class="st">&quot;1988-09-29&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;1988-09-29&quot;</code></pre>
<div class="sourceCode" id="cb294"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb294-1"><a href="wrangle-data.html#cb294-1"></a><span class="co">#month-day-year</span></span>
<span id="cb294-2"><a href="wrangle-data.html#cb294-2"></a><span class="kw">mdy</span>(<span class="st">&quot;September 29th, 1988&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;1988-09-29&quot;</code></pre>
<div class="sourceCode" id="cb296"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb296-1"><a href="wrangle-data.html#cb296-1"></a><span class="co">#day-month-year</span></span>
<span id="cb296-2"><a href="wrangle-data.html#cb296-2"></a><span class="kw">dmy</span>(<span class="st">&quot;29-Sep-1988&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;1988-09-29&quot;</code></pre>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1iLU-H6-GZw7EhL2syFZnjn_tC_cI6s9PmKRxcSOjg1c/export/png?id=1iLU-H6-GZw7EhL2syFZnjn_tC_cI6s9PmKRxcSOjg1c&amp;pageid=g39252087a2_0_22" alt="" />
<p class="caption">creating date and date-time objects</p>
</div>
<p>However, this has only covered working with date objects. To work with date-time objects, you have to further include hour (<code>h</code>), minute(<code>m</code>), and second (<code>s</code>) into the function. For example, in the code below, you can see that the output contains time information in addition to the date information generated in the functions above:</p>
<div class="sourceCode" id="cb298"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb298-1"><a href="wrangle-data.html#cb298-1"></a><span class="kw">ymd_hms</span>(<span class="st">&quot;1988-09-29 20:11:59&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;1988-09-29 20:11:59 UTC&quot;</code></pre>
</div>
<div id="from-individual-parts" class="section level4" number="3.6.2.2">
<h4><span class="header-section-number">3.6.2.2</span> From individual parts</h4>
<p>If you have a dataset where month, date, year, and/or time information are included in separate columns, the functions within <code>lubridate</code> can take this separate information and create a date or date-time object. To work through examples using the functions <code>make_date()</code> and <code>make_timedate()</code>, we’ll use a dataset called <code>nycflights13</code>. As this dataset is <em>not</em> included with the R by default, you’ll have to install and load it in directly:</p>
<div class="sourceCode" id="cb300"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb300-1"><a href="wrangle-data.html#cb300-1"></a><span class="co">#install.packages(&#39;nycflights13&#39;)</span></span>
<span id="cb300-2"><a href="wrangle-data.html#cb300-2"></a><span class="kw">library</span>(nycflights13)</span></code></pre></div>
<p>Loading this package makes a data frame called <code>flights</code>, which includes “on-time data for all flights that departed NYC in 2013,” available. We will work with this dataset to demonstrate how to create a date and date-time object from a dataset where the information is spread across multiple columns.</p>
<p>First, to create a new column, as we’ve done throughout the lessons in this course, we will use <code>mutate()</code>. To create a <code>date</code> object, we’ll use the function <code>make_date()</code>. We just then need to supply the names of the columns containing the year, month, and day information to this function.</p>
<div class="sourceCode" id="cb301"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb301-1"><a href="wrangle-data.html#cb301-1"></a><span class="co">## make_date() creates a date object </span></span>
<span id="cb301-2"><a href="wrangle-data.html#cb301-2"></a><span class="co">## from information in separate columns</span></span>
<span id="cb301-3"><a href="wrangle-data.html#cb301-3"></a>flights <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb301-4"><a href="wrangle-data.html#cb301-4"></a><span class="st">  </span><span class="kw">select</span>(year, month, day) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb301-5"><a href="wrangle-data.html#cb301-5"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">departure =</span> <span class="kw">make_date</span>(year, month, day))</span></code></pre></div>
<pre><code>## # A tibble: 336,776 x 4
##     year month   day departure 
##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;date&gt;    
##  1  2013     1     1 2013-01-01
##  2  2013     1     1 2013-01-01
##  3  2013     1     1 2013-01-01
##  4  2013     1     1 2013-01-01
##  5  2013     1     1 2013-01-01
##  6  2013     1     1 2013-01-01
##  7  2013     1     1 2013-01-01
##  8  2013     1     1 2013-01-01
##  9  2013     1     1 2013-01-01
## 10  2013     1     1 2013-01-01
## # … with 336,766 more rows</code></pre>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1iLU-H6-GZw7EhL2syFZnjn_tC_cI6s9PmKRxcSOjg1c/export/png?id=1iLU-H6-GZw7EhL2syFZnjn_tC_cI6s9PmKRxcSOjg1c&amp;pageid=g39252087a2_0_0" alt="" />
<p class="caption">mutate() and make_date() create a new column – departure – with a date object</p>
</div>
<p>A similar procedure is used to create a date-time object; however, this requires the function <code>make_datetime()</code> and requires columns with information about time be specified. Below, <code>hour</code> and <code>minute</code> are included to the function’s input.</p>
<div class="sourceCode" id="cb303"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb303-1"><a href="wrangle-data.html#cb303-1"></a><span class="co">## make_datetime() creates a date-time object </span></span>
<span id="cb303-2"><a href="wrangle-data.html#cb303-2"></a><span class="co">## from information in separate columns</span></span>
<span id="cb303-3"><a href="wrangle-data.html#cb303-3"></a>flights <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb303-4"><a href="wrangle-data.html#cb303-4"></a><span class="st">  </span><span class="kw">select</span>(year, month, day, hour, minute) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb303-5"><a href="wrangle-data.html#cb303-5"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">departure =</span> <span class="kw">make_datetime</span>(year, month, day, hour, minute))</span></code></pre></div>
<pre><code>## # A tibble: 336,776 x 6
##     year month   day  hour minute departure          
##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dttm&gt;             
##  1  2013     1     1     5     15 2013-01-01 05:15:00
##  2  2013     1     1     5     29 2013-01-01 05:29:00
##  3  2013     1     1     5     40 2013-01-01 05:40:00
##  4  2013     1     1     5     45 2013-01-01 05:45:00
##  5  2013     1     1     6      0 2013-01-01 06:00:00
##  6  2013     1     1     5     58 2013-01-01 05:58:00
##  7  2013     1     1     6      0 2013-01-01 06:00:00
##  8  2013     1     1     6      0 2013-01-01 06:00:00
##  9  2013     1     1     6      0 2013-01-01 06:00:00
## 10  2013     1     1     6      0 2013-01-01 06:00:00
## # … with 336,766 more rows</code></pre>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1iLU-H6-GZw7EhL2syFZnjn_tC_cI6s9PmKRxcSOjg1c/export/png?id=1iLU-H6-GZw7EhL2syFZnjn_tC_cI6s9PmKRxcSOjg1c&amp;pageid=g39252087a2_0_4" alt="" />
<p class="caption">mutate() and make_datetime() create a new column – departure – with a date-time object</p>
</div>
</div>
</div>
<div id="working-with-dates" class="section level3" number="3.6.3">
<h3><span class="header-section-number">3.6.3</span> Working with Dates</h3>
<p>The reason we’ve dedicated an entire lesson to working with dates and have shown you how to create date and date-time objects in this lesson is because you often want to plot data over time or calculate how long something has taken. Being able to accomplish these tasks is an important job for a data scientist. So, now that you know how to create date and date-time objects, we’ll work through a few examples of how to work with these objects.</p>
<div id="getting-components-of-dates" class="section level4" number="3.6.3.1">
<h4><span class="header-section-number">3.6.3.1</span> Getting components of dates</h4>
<p>Often you’re most interested in grouping your data by year, or just looking at monthly or weekly trends. To accomplish this, you have to be able to extract just a component of your date object. You can do this with the functions: <code>year()</code>, <code>month()</code>, <code>mday()</code>,<code>wday()</code>, <code>hour()</code>, <code>minute()</code> and <code>second()</code>. Each will extract the specified piece of information from the date or date-time object.</p>
<div class="sourceCode" id="cb305"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb305-1"><a href="wrangle-data.html#cb305-1"></a>mydate &lt;-<span class="st"> </span><span class="kw">ymd</span>(<span class="st">&quot;1988-09-29&quot;</span>)</span>
<span id="cb305-2"><a href="wrangle-data.html#cb305-2"></a></span>
<span id="cb305-3"><a href="wrangle-data.html#cb305-3"></a><span class="co">## extract year information</span></span>
<span id="cb305-4"><a href="wrangle-data.html#cb305-4"></a><span class="kw">year</span>(mydate)</span>
<span id="cb305-5"><a href="wrangle-data.html#cb305-5"></a></span>
<span id="cb305-6"><a href="wrangle-data.html#cb305-6"></a><span class="co">## extract day of the month</span></span>
<span id="cb305-7"><a href="wrangle-data.html#cb305-7"></a><span class="kw">mday</span>(mydate)</span>
<span id="cb305-8"><a href="wrangle-data.html#cb305-8"></a></span>
<span id="cb305-9"><a href="wrangle-data.html#cb305-9"></a><span class="co">## extract weekday information</span></span>
<span id="cb305-10"><a href="wrangle-data.html#cb305-10"></a><span class="kw">wday</span>(mydate)</span>
<span id="cb305-11"><a href="wrangle-data.html#cb305-11"></a></span>
<span id="cb305-12"><a href="wrangle-data.html#cb305-12"></a><span class="co">## label with actual day of the week</span></span>
<span id="cb305-13"><a href="wrangle-data.html#cb305-13"></a><span class="kw">wday</span>(mydate, <span class="dt">label =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1iLU-H6-GZw7EhL2syFZnjn_tC_cI6s9PmKRxcSOjg1c/export/png?id=1iLU-H6-GZw7EhL2syFZnjn_tC_cI6s9PmKRxcSOjg1c&amp;pageid=g39252087a2_0_27" alt="" />
<p class="caption">lubridate has specific functions to extract components from date and date-time objects</p>
</div>
</div>
</div>
<div id="time-spans" class="section level3" number="3.6.4">
<h3><span class="header-section-number">3.6.4</span> Time Spans</h3>
<p>In addition to being able to look at trends by month or year, which requires being able to extract that component from a date or date-time object, it’s also important to be able to operate over dates. If I give you a date of birth and ask you how old that person is today, you’ll want to be able to calculate that. This is possible when working with date objects. By subtracting this birth date from today’s date, you’ll learn now many days old this person is. By specifying this object using <code>as.duration()</code>, you’ll be able to extract how old this person is in years.</p>
<div class="sourceCode" id="cb306"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb306-1"><a href="wrangle-data.html#cb306-1"></a><span class="co">## how old is someone born on Sept 29, 1988</span></span>
<span id="cb306-2"><a href="wrangle-data.html#cb306-2"></a>mydate &lt;-<span class="st"> </span><span class="kw">ymd</span>(<span class="st">&quot;1988-09-29&quot;</span>)</span>
<span id="cb306-3"><a href="wrangle-data.html#cb306-3"></a></span>
<span id="cb306-4"><a href="wrangle-data.html#cb306-4"></a><span class="co">## subtract birthday from todays date</span></span>
<span id="cb306-5"><a href="wrangle-data.html#cb306-5"></a>age &lt;-<span class="st"> </span><span class="kw">today</span>() <span class="op">-</span><span class="st"> </span>mydate</span>
<span id="cb306-6"><a href="wrangle-data.html#cb306-6"></a>age</span></code></pre></div>
<pre><code>## Time difference of 11759 days</code></pre>
<div class="sourceCode" id="cb308"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb308-1"><a href="wrangle-data.html#cb308-1"></a><span class="co">## a duration object can get this information in years</span></span>
<span id="cb308-2"><a href="wrangle-data.html#cb308-2"></a><span class="kw">as.duration</span>(age)</span></code></pre></div>
<pre><code>## [1] &quot;1015977600s (~32.19 years)&quot;</code></pre>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1iLU-H6-GZw7EhL2syFZnjn_tC_cI6s9PmKRxcSOjg1c/export/png?id=1iLU-H6-GZw7EhL2syFZnjn_tC_cI6s9PmKRxcSOjg1c&amp;pageid=g39252087a2_0_37" alt="" />
<p class="caption">dates and date-times can be operated upon</p>
</div>
<p>Using addition, subtraction, multiplication, and division is possible with date objects, and accurately takes into account things like leap years and different number of days each month. This capability and the additional functions that exist within <code>lubridate</code> can be enormously helpful when working with dates and date-time objects.</p>
</div>
</div>
<div id="working-with-strings" class="section level2" number="3.7">
<h2><span class="header-section-number">3.7</span> Working With Strings</h2>
<p>You’re likely familiar with strings generally; however, to review briefly here:</p>
<blockquote>
<p>A string is a sequence of characters, letters, numbers or symbols.</p>
</blockquote>
<p>So within R, you could create a string using this syntax. Note that the string begins and ends with quotation marks:</p>
<div class="sourceCode" id="cb310"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb310-1"><a href="wrangle-data.html#cb310-1"></a>stringA &lt;-<span class="st"> &quot;This sentence is a string.&quot;</span></span></code></pre></div>
<p>Multiple strings can be stored within vectors. So, if you have multiple vectors that you want to store in a single object, you could do so by using c() around the strings you want to store and commas to separate each individual string:</p>
<div class="sourceCode" id="cb311"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb311-1"><a href="wrangle-data.html#cb311-1"></a>objectA &lt;-<span class="st"> </span><span class="kw">c</span>( <span class="st">&quot;This sentence is a string.&quot;</span>, <span class="st">&quot;Short String&quot;</span>, <span class="st">&quot;Third string&quot;</span> )</span></code></pre></div>
<div id="stringr-1" class="section level3" number="3.7.1">
<h3><span class="header-section-number">3.7.1</span> <code>stringr</code></h3>
<p><a href="http://stringr.tidyverse.org/">stringr</a> is a core tidyverse package specifically designed to help make your life easier when working with strings. Similar to what we saw with <code>forcats</code> functions starting with <code>fct_</code>, all functions within this package start with <code>str_</code>, as you’ll see below. There are <em>many</em> helpful functions within the <code>stringr</code> package. We’ll only review the basics here, but if you’re looking to accomplish something with a string and aren’t sure how to approach it, the <code>stringr</code> package is a good first place to look.</p>
<p>The best way to work through this lesson is to copy and paste every line of code into your RStudio window and see if the output makes sense to you. Working with strings and regular expressions is best learned by practice.</p>
<div id="available-functions" class="section level4" number="3.7.1.1">
<h4><span class="header-section-number">3.7.1.1</span> Available functions</h4>
<p>As we’ll only cover a few of the functions within <code>stringr</code> in this lesson, it’s important to remember that if you start typing “str_” within RStudio, a list of the many options will show up.</p>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1-6k6usRR06dp-YK-M3HUOUgQZKXXqKnAD5RC4TISGhw/export/png?id=1-6k6usRR06dp-YK-M3HUOUgQZKXXqKnAD5RC4TISGhw&amp;pageid=g38bb68a539_0_12" alt="" />
<p class="caption">str_ image</p>
</div>
</div>
</div>
<div id="string-basics" class="section level3" number="3.7.2">
<h3><span class="header-section-number">3.7.2</span> String Basics</h3>
<p>When working with strings, some of the most frequent tasks you’ll need to complete are to:
* determine the length of a string
* combine strings together
* subset strings</p>
<div id="string-length" class="section level4" number="3.7.2.1">
<h4><span class="header-section-number">3.7.2.1</span> String length</h4>
<p>Returning to our object with three strings from earlier in the lesson, we can determine the length of each string in the vector.</p>
<div class="sourceCode" id="cb312"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb312-1"><a href="wrangle-data.html#cb312-1"></a>objectA &lt;-<span class="st"> </span><span class="kw">c</span>( <span class="st">&quot;This sentence is a string.&quot;</span>, <span class="st">&quot;Short String&quot;</span>, <span class="st">&quot;Third string&quot;</span> )</span>
<span id="cb312-2"><a href="wrangle-data.html#cb312-2"></a></span>
<span id="cb312-3"><a href="wrangle-data.html#cb312-3"></a><span class="kw">str_length</span>(objectA)</span></code></pre></div>
<pre><code>## [1] 26 12 12</code></pre>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1-6k6usRR06dp-YK-M3HUOUgQZKXXqKnAD5RC4TISGhw/export/png?id=1-6k6usRR06dp-YK-M3HUOUgQZKXXqKnAD5RC4TISGhw&amp;pageid=g38bb68a539_0_17" alt="" />
<p class="caption"><code>str_length()</code> output</p>
</div>
<p>Here we see that the first string has a length of 26. If you were to go back and count the characters in the first string, you would see that this 26 includes each letter, space, and period in that string. The length of a string does not just could the letters in its length. The length includes every character. The second and third strings each have length 12.</p>
</div>
<div id="combining-strings-str_c" class="section level4" number="3.7.2.2">
<h4><span class="header-section-number">3.7.2.2</span> Combining strings: <code>str_c()</code></h4>
<p>If you were interested in combining strings, you’d want to use <code>str_c</code>.</p>
<div class="sourceCode" id="cb314"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb314-1"><a href="wrangle-data.html#cb314-1"></a><span class="kw">str_c</span>( <span class="st">&quot;Good&quot;</span>, <span class="st">&quot;Morning&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;GoodMorning&quot;</code></pre>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1-6k6usRR06dp-YK-M3HUOUgQZKXXqKnAD5RC4TISGhw/export/png?id=1-6k6usRR06dp-YK-M3HUOUgQZKXXqKnAD5RC4TISGhw&amp;pageid=g38bb68a539_0_0" alt="" />
<p class="caption"><code>str_c()</code></p>
</div>
<p>However, the output from this doesn’t look quite right. You may want a space between these two words when you combine the two strings. That can be controlled with the <code>sep</code> argument.</p>
<div class="sourceCode" id="cb316"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb316-1"><a href="wrangle-data.html#cb316-1"></a><span class="kw">str_c</span>( <span class="st">&quot;Good&quot;</span>, <span class="st">&quot;Morning&quot;</span>, <span class="dt">sep=</span><span class="st">&quot; &quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Good Morning&quot;</code></pre>
</div>
<div id="subsetting-strings-str_sub" class="section level4" number="3.7.2.3">
<h4><span class="header-section-number">3.7.2.3</span> Subsetting strings: <code>str_sub()</code></h4>
<p>Often, it’s important to get part of a string out. To do this, you’ll want to subset the string using the <code>str_sub()</code> function. For example, if you wanted only the first three characters in the string below, you would specify that within <code>str_sub()</code>.</p>
<div class="sourceCode" id="cb318"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb318-1"><a href="wrangle-data.html#cb318-1"></a>object &lt;-<span class="st"> </span><span class="kw">c</span>( <span class="st">&quot;Good&quot;</span>, <span class="st">&quot;Morning&quot;</span>)</span>
<span id="cb318-2"><a href="wrangle-data.html#cb318-2"></a></span>
<span id="cb318-3"><a href="wrangle-data.html#cb318-3"></a><span class="kw">str_sub</span>(object, <span class="dv">1</span>, <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Goo&quot; &quot;Mor&quot;</code></pre>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1-6k6usRR06dp-YK-M3HUOUgQZKXXqKnAD5RC4TISGhw/export/png?id=1-6k6usRR06dp-YK-M3HUOUgQZKXXqKnAD5RC4TISGhw&amp;pageid=g398837bd56_0_29" alt="" />
<p class="caption"><code>str_sub()</code> output</p>
</div>
<p>You can also use negative numbers to count from the end of the string. For example, below we see code that returns the last three positions in the string.</p>
<div class="sourceCode" id="cb320"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb320-1"><a href="wrangle-data.html#cb320-1"></a>object &lt;-<span class="st"> </span><span class="kw">c</span>( <span class="st">&quot;Good&quot;</span>, <span class="st">&quot;Morning&quot;</span>)</span>
<span id="cb320-2"><a href="wrangle-data.html#cb320-2"></a></span>
<span id="cb320-3"><a href="wrangle-data.html#cb320-3"></a><span class="kw">str_sub</span>(object, <span class="dv">-3</span>, <span class="dv">-1</span>)</span></code></pre></div>
<pre><code>## [1] &quot;ood&quot; &quot;ing&quot;</code></pre>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1-6k6usRR06dp-YK-M3HUOUgQZKXXqKnAD5RC4TISGhw/export/png?id=1-6k6usRR06dp-YK-M3HUOUgQZKXXqKnAD5RC4TISGhw&amp;pageid=g398837bd56_0_36" alt="" />
<p class="caption"><code>str_sub()</code> output counting from end of string</p>
</div>
</div>
<div id="string-sorting-str_sort" class="section level4" number="3.7.2.4">
<h4><span class="header-section-number">3.7.2.4</span> String sorting: <code>str_sort()</code></h4>
<p>Finally, if you wanted to sort a string alphabetically, <code>str_sort()</code> can help you accomplish that.</p>
<div class="sourceCode" id="cb322"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb322-1"><a href="wrangle-data.html#cb322-1"></a>names &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Keisha&quot;</span>, <span class="st">&quot;Mohammed&quot;</span>, <span class="st">&quot;Jane&quot;</span>)</span>
<span id="cb322-2"><a href="wrangle-data.html#cb322-2"></a></span>
<span id="cb322-3"><a href="wrangle-data.html#cb322-3"></a><span class="kw">str_sort</span>(names)</span></code></pre></div>
<pre><code>## [1] &quot;Jane&quot;     &quot;Keisha&quot;   &quot;Mohammed&quot;</code></pre>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1-6k6usRR06dp-YK-M3HUOUgQZKXXqKnAD5RC4TISGhw/export/png?id=1-6k6usRR06dp-YK-M3HUOUgQZKXXqKnAD5RC4TISGhw&amp;pageid=g398837bd56_0_42" alt="" />
<p class="caption"><code>str_sort()</code> output sorts strings</p>
</div>
</div>
</div>
<div id="regular-expressions" class="section level3" number="3.7.3">
<h3><span class="header-section-number">3.7.3</span> Regular Expressions</h3>
<p>Above we discussed the basics of working with strings within <code>stringr</code>. However, working with strings becomes infinitely easier with an understanding of regular expressions. Regular expressions (regexps) are used to <strong>describe patterns within strings</strong>. They can take a little while to get the hang of but become very helpful once you do. With regexps, instead of specifying that you want to extract the first three letters of a string (as we did above), you could more generally specify that you wanted to extract all strings that start with a specific letter or that contain a specific word somewhere in the string using regexps. We’ll explore the basics of regexps here.</p>
<p>The use them in <code>stringr</code>, the general format is <code>function(string , pattern = regexp)</code>, which you’ll see used in practice below.</p>
<p>We’ll cover a number of helpful <code>stringr</code> functions:</p>
<ul>
<li><strong><code>str_view()</code></strong> - View the first occurrence in a string that matches the regex</li>
<li><strong><code>str_view_all()</code></strong> - View all occurrences in a string that match the regex</li>
<li><strong><code>str_count()</code></strong> - count the number of times a regex matches within a string</li>
<li><strong><code>str_detect()</code></strong> - determine if regex is found within string</li>
<li><strong><code>str_subset()</code></strong> - return subset of strings that match the regex</li>
<li><strong><code>str_extract()</code></strong> - return portion of each string that matches the regex</li>
<li><strong><code>str_replace()</code></strong> - replace portion of string that matches the regex with something else</li>
</ul>
<div id="anchors" class="section level4" number="3.7.3.1">
<h4><span class="header-section-number">3.7.3.1</span> Anchors</h4>
<p>If interested in finding a pattern at the beginning (<code>^</code>) or end (<code>$</code>) of a string, you can specify that using a regexp. For example, if you wanted to only look at names that started with the letter “M”, you would specify that using a regexp. The pattern you would include would be <code>"^M"</code> to identify all strings that start with the letter M. To specify those strings that end with a capital M, you would specify the pattern <code>"$M"</code>.</p>
</div>
<div id="show-matches-str_view" class="section level4" number="3.7.3.2">
<h4><span class="header-section-number">3.7.3.2</span> Show matches: <code>str_view()</code></h4>
<p>To get comfortable with using regexps with strings, <code>str_view()</code> can be very helpful. The output from <code>str_view()</code> highlights what portion of your string match the pattern specified in your regexp with a gray box. For example, to we’ll start using anchors and <code>str_view()</code> below:</p>
<div class="sourceCode" id="cb324"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb324-1"><a href="wrangle-data.html#cb324-1"></a>names &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Keisha&quot;</span>, <span class="st">&quot;Mohammed&quot;</span>, <span class="st">&quot;Jane&quot;</span>, <span class="st">&quot;Mathieu&quot;</span>)</span>
<span id="cb324-2"><a href="wrangle-data.html#cb324-2"></a></span>
<span id="cb324-3"><a href="wrangle-data.html#cb324-3"></a><span class="co">## identify strings that start with &quot;M&quot;</span></span>
<span id="cb324-4"><a href="wrangle-data.html#cb324-4"></a><span class="kw">str_view</span>(names, <span class="st">&quot;^M&quot;</span>)</span></code></pre></div>
<div id="htmlwidget-ea661fe926d76067a0e5" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-ea661fe926d76067a0e5">{"x":{"html":"<ul>\n  <li>Keisha<\/li>\n  <li><span class='match'>M<\/span>ohammed<\/li>\n  <li>Jane<\/li>\n  <li><span class='match'>M<\/span>athieu<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1-6k6usRR06dp-YK-M3HUOUgQZKXXqKnAD5RC4TISGhw/export/png?id=1-6k6usRR06dp-YK-M3HUOUgQZKXXqKnAD5RC4TISGhw&amp;pageid=g38bb68a539_0_30" alt="" />
<p class="caption"><code>str_view()</code> identifies names that start with M</p>
</div>
<p>In this first example we see in the Viewer Panel that <code>str_view()</code> has identified the names that start with the letter “M”.</p>
<p>However, if you try to match strings that end with the letter “M”, no match is found.</p>
<div class="sourceCode" id="cb325"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb325-1"><a href="wrangle-data.html#cb325-1"></a><span class="co">## identify strings that end with &quot;M&quot;</span></span>
<span id="cb325-2"><a href="wrangle-data.html#cb325-2"></a><span class="kw">str_view</span>(names, <span class="st">&quot;M$&quot;</span>)</span></code></pre></div>
<div id="htmlwidget-b8d75f9a52d856bdadeb" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-b8d75f9a52d856bdadeb">{"x":{"html":"<ul>\n  <li>Keisha<\/li>\n  <li>Mohammed<\/li>\n  <li>Jane<\/li>\n  <li>Mathieu<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1-6k6usRR06dp-YK-M3HUOUgQZKXXqKnAD5RC4TISGhw/export/png?id=1-6k6usRR06dp-YK-M3HUOUgQZKXXqKnAD5RC4TISGhw&amp;pageid=g38bb68a539_0_26" alt="" />
<p class="caption"><code>str_view()</code> does not identify any names that end with M</p>
</div>
<p>To identify names by that end with the letter “a”, you would use the following.</p>
<div class="sourceCode" id="cb326"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb326-1"><a href="wrangle-data.html#cb326-1"></a><span class="co">## identify strings that end with &quot;a&quot;</span></span>
<span id="cb326-2"><a href="wrangle-data.html#cb326-2"></a><span class="kw">str_view</span>(names, <span class="st">&quot;a$&quot;</span>)</span></code></pre></div>
<div id="htmlwidget-00d4e007dba64fe8de50" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-00d4e007dba64fe8de50">{"x":{"html":"<ul>\n  <li>Keish<span class='match'>a<\/span><\/li>\n  <li>Mohammed<\/li>\n  <li>Jane<\/li>\n  <li>Mathieu<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1-6k6usRR06dp-YK-M3HUOUgQZKXXqKnAD5RC4TISGhw/export/png?id=1-6k6usRR06dp-YK-M3HUOUgQZKXXqKnAD5RC4TISGhw&amp;pageid=g38bb68a539_0_34" alt="" />
<p class="caption"><code>str_view()</code> identifies names that end with a</p>
</div>
<p>Note, however, that regexps are case sensitive. To match patterns, you have to consider that “A” and “a” are different characters.</p>
<div class="sourceCode" id="cb327"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb327-1"><a href="wrangle-data.html#cb327-1"></a><span class="co">## identify strings that end with &quot;A&quot;</span></span>
<span id="cb327-2"><a href="wrangle-data.html#cb327-2"></a><span class="kw">str_view</span>(names, <span class="st">&quot;A$&quot;</span>)</span></code></pre></div>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1-6k6usRR06dp-YK-M3HUOUgQZKXXqKnAD5RC4TISGhw/export/png?id=1-6k6usRR06dp-YK-M3HUOUgQZKXXqKnAD5RC4TISGhw&amp;pageid=g38bb68a539_0_39" alt="" />
<p class="caption"><code>str_view()</code> does not identify any names that end with A</p>
</div>
</div>
<div id="count-matches-str_count" class="section level4" number="3.7.3.3">
<h4><span class="header-section-number">3.7.3.3</span> Count matches: <code>str_count()</code></h4>
<p>To count the number of matches within your strings, you would use <code>str_count()</code>. Below, using the names vector we’ve been using, we see that <code>str_count()</code> produces a 1 for those names that start with “M” and a 0 otherwise.</p>
<div class="sourceCode" id="cb328"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb328-1"><a href="wrangle-data.html#cb328-1"></a><span class="co">## identify strings that start with &quot;M&quot;</span></span>
<span id="cb328-2"><a href="wrangle-data.html#cb328-2"></a><span class="co">## return count of the number of times string matches pattern</span></span>
<span id="cb328-3"><a href="wrangle-data.html#cb328-3"></a><span class="kw">str_count</span>(names, <span class="st">&quot;^M&quot;</span>)</span></code></pre></div>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1-6k6usRR06dp-YK-M3HUOUgQZKXXqKnAD5RC4TISGhw/export/png?id=1-6k6usRR06dp-YK-M3HUOUgQZKXXqKnAD5RC4TISGhw&amp;pageid=g38bb68a539_0_90" alt="" />
<p class="caption"><code>str_count()</code> strings that start with “M”</p>
</div>
<p>However, if we instead wanted a count of the numbers of lowercase “m”s, we could still use <code>str_count()</code> to accomplish that. Notice below we’ve removed the specification to just look at the beginning of the string. Here, we’re looking for lowercase m’s anywhere in the string and counting them:</p>
<div class="sourceCode" id="cb329"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb329-1"><a href="wrangle-data.html#cb329-1"></a><span class="co">## identify strings that have a lowercase &quot;m&quot;</span></span>
<span id="cb329-2"><a href="wrangle-data.html#cb329-2"></a><span class="co">## return count of the number of times string matches pattern</span></span>
<span id="cb329-3"><a href="wrangle-data.html#cb329-3"></a><span class="kw">str_count</span>(names, <span class="st">&quot;m&quot;</span>)</span></code></pre></div>
<pre><code>## [1] 0 2 0 0</code></pre>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1-6k6usRR06dp-YK-M3HUOUgQZKXXqKnAD5RC4TISGhw/export/png?id=1-6k6usRR06dp-YK-M3HUOUgQZKXXqKnAD5RC4TISGhw&amp;pageid=g38bb68a539_0_108" alt="" />
<p class="caption"><code>str_count()</code> strings that have an m in them</p>
</div>
</div>
<div id="detect-matches-str_detect" class="section level4" number="3.7.3.4">
<h4><span class="header-section-number">3.7.3.4</span> Detect matches: <code>str_detect()</code></h4>
<p>Instead of returning a count, at times you’re just interested in knowing which strings match the pattern you’re searching for. In these cases you’ll want to use <code>str_detect()</code>. This function simply returns a TRUE if the string matches the pattern specified and FALSE otherwise.</p>
<div class="sourceCode" id="cb331"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb331-1"><a href="wrangle-data.html#cb331-1"></a><span class="co">## identify strings that start with &quot;M&quot;</span></span>
<span id="cb331-2"><a href="wrangle-data.html#cb331-2"></a><span class="co">## return TRUE if they do; FALSE otherwise</span></span>
<span id="cb331-3"><a href="wrangle-data.html#cb331-3"></a><span class="kw">str_detect</span>(names, <span class="st">&quot;^M&quot;</span>)</span></code></pre></div>
<pre><code>## [1] FALSE  TRUE FALSE  TRUE</code></pre>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1-6k6usRR06dp-YK-M3HUOUgQZKXXqKnAD5RC4TISGhw/export/png?id=1-6k6usRR06dp-YK-M3HUOUgQZKXXqKnAD5RC4TISGhw&amp;pageid=g38bb68a539_0_96" alt="" />
<p class="caption">str_detect() returns TRUE for strings that match the specified pattern; FALSE otherwise</p>
</div>
</div>
<div id="subset-matches-str_subset" class="section level4" number="3.7.3.5">
<h4><span class="header-section-number">3.7.3.5</span> Subset matches: <code>str_subset()</code></h4>
<p>To return the actual string that matches the specified pattern, rather than a TRUE/FALSE, you’ll look to <code>str_subset()</code>. This function pulls out those strings that match the specified pattern. For example, to obtain the subset of names whose values start with the capital letter “M”, you would use the following:</p>
<div class="sourceCode" id="cb333"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb333-1"><a href="wrangle-data.html#cb333-1"></a><span class="co">## identify strings that start with &quot;M&quot;</span></span>
<span id="cb333-2"><a href="wrangle-data.html#cb333-2"></a><span class="co">## return whole string</span></span>
<span id="cb333-3"><a href="wrangle-data.html#cb333-3"></a><span class="kw">str_subset</span>(names, <span class="st">&quot;^M&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Mohammed&quot; &quot;Mathieu&quot;</code></pre>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1-6k6usRR06dp-YK-M3HUOUgQZKXXqKnAD5RC4TISGhw/export/png?id=1-6k6usRR06dp-YK-M3HUOUgQZKXXqKnAD5RC4TISGhw&amp;pageid=g38bb68a539_0_102" alt="" />
<p class="caption"><code>str_subset()</code> returns the strings that match the pattern specified</p>
</div>
</div>
<div id="extract-matches-str_extract" class="section level4" number="3.7.3.6">
<h4><span class="header-section-number">3.7.3.6</span> Extract matches: <code>str_extract()</code></h4>
<p>To extract only the portions of the string that match the specified pattern, you would use <code>str_extract()</code>. This function returns the pattern specified for strings where it is found and NA otherwise. For example, by searching for names that start with M, below, we see that the second and fourth strings in our vector return the pattern specified (“M”) and that the first and third strings in the vector return NA, as they do not start with a capital “M”.</p>
<div class="sourceCode" id="cb335"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb335-1"><a href="wrangle-data.html#cb335-1"></a><span class="co">## return &quot;M&quot; from strings that start with &quot;M&quot;</span></span>
<span id="cb335-2"><a href="wrangle-data.html#cb335-2"></a><span class="co">## otherwise, return NA</span></span>
<span id="cb335-3"><a href="wrangle-data.html#cb335-3"></a><span class="kw">str_extract</span>(names, <span class="st">&quot;^M&quot;</span>)</span></code></pre></div>
<pre><code>## [1] NA  &quot;M&quot; NA  &quot;M&quot;</code></pre>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1-6k6usRR06dp-YK-M3HUOUgQZKXXqKnAD5RC4TISGhw/export/png?id=1-6k6usRR06dp-YK-M3HUOUgQZKXXqKnAD5RC4TISGhw&amp;pageid=g38bb68a539_0_122" alt="" />
<p class="caption"><code>str_extract()</code> returns the portions of the strings that match the pattern specified</p>
</div>
</div>
<div id="replace-matches-str_replace" class="section level4" number="3.7.3.7">
<h4><span class="header-section-number">3.7.3.7</span> Replace matches: <code>str_replace()</code></h4>
<p>The final basic function from <code>stringr</code> that we’ll discuss is <code>str_replace()</code>. This function identifies a regex and replaces each occurrence with whatever replacement the user specifies. For example, below we search for strings that start with the capital letter “M” and replace each of them with a question mark. All strings that do <em>not</em> match the regex are returned unchanged.</p>
<div class="sourceCode" id="cb337"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb337-1"><a href="wrangle-data.html#cb337-1"></a><span class="co">## replace capital M with a question mark</span></span>
<span id="cb337-2"><a href="wrangle-data.html#cb337-2"></a><span class="kw">str_replace</span>(names, <span class="st">&quot;^M&quot;</span>, <span class="st">&quot;?&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Keisha&quot;   &quot;?ohammed&quot; &quot;Jane&quot;     &quot;?athieu&quot;</code></pre>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1-6k6usRR06dp-YK-M3HUOUgQZKXXqKnAD5RC4TISGhw/export/png?id=1-6k6usRR06dp-YK-M3HUOUgQZKXXqKnAD5RC4TISGhw&amp;pageid=g38bb68a539_0_131" alt="" />
<p class="caption"><code>str_replace()</code> replaces regex with specified characters</p>
</div>
</div>
<div id="common-regular-expressions" class="section level4" number="3.7.3.8">
<h4><span class="header-section-number">3.7.3.8</span> Common regular expressions</h4>
<p>Above we discuss two common patterns searched for using regular expressions: starts with (<code>^</code>) and ends with (<code>$</code>). However, there are a number of additional common ways to match patterns. They are listed here, and we’ll discuss each one in slightly more detail below.</p>
<div id="searching-for-characters" class="section level5" number="3.7.3.8.1">
<h5><span class="header-section-number">3.7.3.8.1</span> Searching for characters</h5>
<p>To search for a set of characters, you place these characters within brackets. Below, this will identify anywhere in the strings where you have a lowercase vowel. Note, that we’re now using <code>str_view_all()</code> to identify all occurrences of these characters, rather than <code>str_view()</code>, which only identifies the first occurrence in each string.</p>
<div class="sourceCode" id="cb339"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb339-1"><a href="wrangle-data.html#cb339-1"></a><span class="co">## identify all lowercase vowels</span></span>
<span id="cb339-2"><a href="wrangle-data.html#cb339-2"></a><span class="kw">str_view_all</span>(names, <span class="st">&quot;[aeiou]&quot;</span>)</span></code></pre></div>
<div id="htmlwidget-3bd78af66a38c316c353" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-3bd78af66a38c316c353">{"x":{"html":"<ul>\n  <li>K<span class='match'>e<\/span><span class='match'>i<\/span>sh<span class='match'>a<\/span><\/li>\n  <li>M<span class='match'>o<\/span>h<span class='match'>a<\/span>mm<span class='match'>e<\/span>d<\/li>\n  <li>J<span class='match'>a<\/span>n<span class='match'>e<\/span><\/li>\n  <li>M<span class='match'>a<\/span>th<span class='match'>i<\/span><span class='match'>e<\/span><span class='match'>u<\/span><\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1-6k6usRR06dp-YK-M3HUOUgQZKXXqKnAD5RC4TISGhw/export/png?id=1-6k6usRR06dp-YK-M3HUOUgQZKXXqKnAD5RC4TISGhw&amp;pageid=g38bb68a539_0_69" alt="" />
<p class="caption">brackets specify which characters to search for</p>
</div>
</div>
<div id="searching-for-anything-other-than-a-set-of-characters" class="section level5" number="3.7.3.8.2">
<h5><span class="header-section-number">3.7.3.8.2</span> Searching for anything <em>other</em> than a set of characters</h5>
<p>By adding a caret (<code>^</code>) before the vowels within the brackets, this regular expressions specifies that you are searching for any character that is not a lowercase vowel within your strings.</p>
<div class="sourceCode" id="cb340"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb340-1"><a href="wrangle-data.html#cb340-1"></a><span class="co">## identify anything that&#39;s NOT a lowercase vowel</span></span>
<span id="cb340-2"><a href="wrangle-data.html#cb340-2"></a><span class="kw">str_view_all</span>(names, <span class="st">&quot;[^aeiou]&quot;</span>)</span></code></pre></div>
<div id="htmlwidget-142aa8752421f02b5565" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-142aa8752421f02b5565">{"x":{"html":"<ul>\n  <li><span class='match'>K<\/span>ei<span class='match'>s<\/span><span class='match'>h<\/span>a<\/li>\n  <li><span class='match'>M<\/span>o<span class='match'>h<\/span>a<span class='match'>m<\/span><span class='match'>m<\/span>e<span class='match'>d<\/span><\/li>\n  <li><span class='match'>J<\/span>a<span class='match'>n<\/span>e<\/li>\n  <li><span class='match'>M<\/span>a<span class='match'>t<\/span><span class='match'>h<\/span>ieu<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1-6k6usRR06dp-YK-M3HUOUgQZKXXqKnAD5RC4TISGhw/export/png?id=1-6k6usRR06dp-YK-M3HUOUgQZKXXqKnAD5RC4TISGhw&amp;pageid=g38bb68a539_0_78" alt="" />
<p class="caption">brackets with a caret first specify which characters NOT to search for</p>
</div>
</div>
<div id="search-for-digits" class="section level5" number="3.7.3.8.3">
<h5><span class="header-section-number">3.7.3.8.3</span> Search for digits</h5>
<p>To search for digits (numeric variable between 0 and 9) in a string you use “; however, backslashes are protected characters in R. This means that you have to escape this character first with an additional backslash (<code>\</code>), to let R know that you want to search for the regular expression”.</p>
<div class="sourceCode" id="cb341"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb341-1"><a href="wrangle-data.html#cb341-1"></a>addresses &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;1234 Main Street&quot;</span>, <span class="st">&quot;1600 Pennsylvania Ave&quot;</span>, <span class="st">&quot;Brick Building&quot;</span>)</span>
<span id="cb341-2"><a href="wrangle-data.html#cb341-2"></a></span>
<span id="cb341-3"><a href="wrangle-data.html#cb341-3"></a><span class="co">## identify anything that&#39;s a digit</span></span>
<span id="cb341-4"><a href="wrangle-data.html#cb341-4"></a><span class="kw">str_view_all</span>(addresses, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">d&quot;</span>)</span></code></pre></div>
<div id="htmlwidget-9bb3602adfb97be7b596" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-9bb3602adfb97be7b596">{"x":{"html":"<ul>\n  <li><span class='match'>1<\/span><span class='match'>2<\/span><span class='match'>3<\/span><span class='match'>4<\/span> Main Street<\/li>\n  <li><span class='match'>1<\/span><span class='match'>6<\/span><span class='match'>0<\/span><span class='match'>0<\/span> Pennsylvania Ave<\/li>\n  <li>Brick Building<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1-6k6usRR06dp-YK-M3HUOUgQZKXXqKnAD5RC4TISGhw/export/png?id=1-6k6usRR06dp-YK-M3HUOUgQZKXXqKnAD5RC4TISGhw&amp;pageid=g38bb68a539_0_140" alt="" />
<p class="caption"><code>\d</code> searches for digits</p>
</div>
</div>
<div id="search-for-whitespace" class="section level5" number="3.7.3.8.4">
<h5><span class="header-section-number">3.7.3.8.4</span> Search for whitespace</h5>
<p>Identifying whitespace in R identifies any spaces, tabs or newlines. Note that again we have to escape the “” with a backslash for R to recognize the regular expression.</p>
<div class="sourceCode" id="cb342"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb342-1"><a href="wrangle-data.html#cb342-1"></a><span class="co">## identify any whitespace</span></span>
<span id="cb342-2"><a href="wrangle-data.html#cb342-2"></a><span class="kw">str_view_all</span>(addresses, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">s&quot;</span>)</span></code></pre></div>
<div id="htmlwidget-9d96a83b788b4cda0377" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-9d96a83b788b4cda0377">{"x":{"html":"<ul>\n  <li>1234<span class='match'> <\/span>Main<span class='match'> <\/span>Street<\/li>\n  <li>1600<span class='match'> <\/span>Pennsylvania<span class='match'> <\/span>Ave<\/li>\n  <li>Brick<span class='match'> <\/span>Building<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1-6k6usRR06dp-YK-M3HUOUgQZKXXqKnAD5RC4TISGhw/export/png?id=1-6k6usRR06dp-YK-M3HUOUgQZKXXqKnAD5RC4TISGhw&amp;pageid=g38bb68a539_0_153" alt="" />
<p class="caption"><code>\s</code> searches for whitespace</p>
</div>
</div>
<div id="identify-any-character-except-newline" class="section level5" number="3.7.3.8.5">
<h5><span class="header-section-number">3.7.3.8.5</span> Identify any character (except newline)</h5>
<p>To identify any character except for a newline you’ll use <code>"."</code>. Notice in our addresses example that there are no newlines, so this pattern will match with the entire string.</p>
<div class="sourceCode" id="cb343"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb343-1"><a href="wrangle-data.html#cb343-1"></a><span class="co">## identify any character</span></span>
<span id="cb343-2"><a href="wrangle-data.html#cb343-2"></a><span class="kw">str_view_all</span>(addresses, <span class="st">&quot;.&quot;</span>)</span></code></pre></div>
<div id="htmlwidget-6b3e5773556c6223098b" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-6b3e5773556c6223098b">{"x":{"html":"<ul>\n  <li><span class='match'>1<\/span><span class='match'>2<\/span><span class='match'>3<\/span><span class='match'>4<\/span><span class='match'> <\/span><span class='match'>M<\/span><span class='match'>a<\/span><span class='match'>i<\/span><span class='match'>n<\/span><span class='match'> <\/span><span class='match'>S<\/span><span class='match'>t<\/span><span class='match'>r<\/span><span class='match'>e<\/span><span class='match'>e<\/span><span class='match'>t<\/span><\/li>\n  <li><span class='match'>1<\/span><span class='match'>6<\/span><span class='match'>0<\/span><span class='match'>0<\/span><span class='match'> <\/span><span class='match'>P<\/span><span class='match'>e<\/span><span class='match'>n<\/span><span class='match'>n<\/span><span class='match'>s<\/span><span class='match'>y<\/span><span class='match'>l<\/span><span class='match'>v<\/span><span class='match'>a<\/span><span class='match'>n<\/span><span class='match'>i<\/span><span class='match'>a<\/span><span class='match'> <\/span><span class='match'>A<\/span><span class='match'>v<\/span><span class='match'>e<\/span><\/li>\n  <li><span class='match'>B<\/span><span class='match'>r<\/span><span class='match'>i<\/span><span class='match'>c<\/span><span class='match'>k<\/span><span class='match'> <\/span><span class='match'>B<\/span><span class='match'>u<\/span><span class='match'>i<\/span><span class='match'>l<\/span><span class='match'>d<\/span><span class='match'>i<\/span><span class='match'>n<\/span><span class='match'>g<\/span><\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1-6k6usRR06dp-YK-M3HUOUgQZKXXqKnAD5RC4TISGhw/export/png?id=1-6k6usRR06dp-YK-M3HUOUgQZKXXqKnAD5RC4TISGhw&amp;pageid=g38bb68a539_0_164" alt="" />
<p class="caption">. searches for any character</p>
</div>
</div>
</div>
<div id="repetition-within-regular-expressions" class="section level4" number="3.7.3.9">
<h4><span class="header-section-number">3.7.3.9</span> Repetition within regular expressions</h4>
<p>Searches for regular expressions allow you to specify how many times a pattern should be found within the string. To do so, you use the following:</p>
<ul>
<li><p><code>?</code> : 0 or 1</p></li>
<li><p><code>+</code> : 1 or more</p></li>
<li><p><code>\\*</code> : 0 or more</p></li>
<li><p><code>{n}</code> : exactly n times</p></li>
<li><p><code>{n,}</code> : n or more times</p></li>
<li><p><code>{n,m}</code> : between n and m times</p></li>
</ul>
<div id="examples-of-repetition-within-regular-expressions" class="section level5" number="3.7.3.9.1">
<h5><span class="header-section-number">3.7.3.9.1</span> Examples of repetition within regular expressions</h5>
<p>Using the definitions above, we can see that the following code will identify patterns within the addresses vector where n shows up one more more times in a string.</p>
<div class="sourceCode" id="cb344"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb344-1"><a href="wrangle-data.html#cb344-1"></a><span class="co">## identify any time n shows up one or more times</span></span>
<span id="cb344-2"><a href="wrangle-data.html#cb344-2"></a><span class="kw">str_view_all</span>(addresses, <span class="st">&quot;n+&quot;</span>)</span></code></pre></div>
<div id="htmlwidget-3a17526ef70bf9d022ee" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-3a17526ef70bf9d022ee">{"x":{"html":"<ul>\n  <li>1234 Mai<span class='match'>n<\/span> Street<\/li>\n  <li>1600 Pe<span class='match'>nn<\/span>sylva<span class='match'>n<\/span>ia Ave<\/li>\n  <li>Brick Buildi<span class='match'>n<\/span>g<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1-6k6usRR06dp-YK-M3HUOUgQZKXXqKnAD5RC4TISGhw/export/png?id=1-6k6usRR06dp-YK-M3HUOUgQZKXXqKnAD5RC4TISGhw&amp;pageid=g38bb68a539_0_177" alt="" />
<p class="caption">+ specifies to match the pattern one or more times</p>
</div>
<p>While the difference is slight in the output here, we’re identifying portions of the string where n shows up exactly once. So, instead of the ‘nn’ in Pennsylvania matching together, the code here splits these up, due to the fact that we’re specifying the pattern match ‘n’ exactly one time:</p>
<div class="sourceCode" id="cb345"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb345-1"><a href="wrangle-data.html#cb345-1"></a><span class="co">## identify any time n shows up</span></span>
<span id="cb345-2"><a href="wrangle-data.html#cb345-2"></a><span class="kw">str_view_all</span>(addresses, <span class="st">&quot;n{1}&quot;</span>)</span></code></pre></div>
<div id="htmlwidget-91a72d15dec7270cad6c" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-91a72d15dec7270cad6c">{"x":{"html":"<ul>\n  <li>1234 Mai<span class='match'>n<\/span> Street<\/li>\n  <li>1600 Pe<span class='match'>n<\/span><span class='match'>n<\/span>sylva<span class='match'>n<\/span>ia Ave<\/li>\n  <li>Brick Buildi<span class='match'>n<\/span>g<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1-6k6usRR06dp-YK-M3HUOUgQZKXXqKnAD5RC4TISGhw/export/png?id=1-6k6usRR06dp-YK-M3HUOUgQZKXXqKnAD5RC4TISGhw&amp;pageid=g38bb68a539_0_183" alt="" />
<p class="caption">{#} looks to match the pattern exactly the number of times within the curly braces</p>
</div>
<p>If you only wanted to match strings where n showed up twice in a row, you could specify that in this way:</p>
<div class="sourceCode" id="cb346"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb346-1"><a href="wrangle-data.html#cb346-1"></a><span class="co">## identify any time n shows up exactly two times in a row</span></span>
<span id="cb346-2"><a href="wrangle-data.html#cb346-2"></a><span class="kw">str_view_all</span>(addresses, <span class="st">&quot;n{2}&quot;</span>)</span></code></pre></div>
<div id="htmlwidget-ecd1aea51155ae2a3083" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-ecd1aea51155ae2a3083">{"x":{"html":"<ul>\n  <li>1234 Main Street<\/li>\n  <li>1600 Pe<span class='match'>nn<\/span>sylvania Ave<\/li>\n  <li>Brick Building<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1-6k6usRR06dp-YK-M3HUOUgQZKXXqKnAD5RC4TISGhw/export/png?id=1-6k6usRR06dp-YK-M3HUOUgQZKXXqKnAD5RC4TISGhw&amp;pageid=g38bb68a539_0_188" alt="" />
<p class="caption">{2} specifies that the pattern must be found exactly twice</p>
</div>
<p>This could similarly be achieved by specifying to search for the pattern ‘nn’ one or more times (<code>+</code>):</p>
<div class="sourceCode" id="cb347"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb347-1"><a href="wrangle-data.html#cb347-1"></a><span class="co">## identify any time &#39;nn&#39; shows up one or more times </span></span>
<span id="cb347-2"><a href="wrangle-data.html#cb347-2"></a><span class="kw">str_view_all</span>(addresses, <span class="st">&quot;nn+&quot;</span>)</span></code></pre></div>
<div id="htmlwidget-973ce9be1f14ebb605ee" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-973ce9be1f14ebb605ee">{"x":{"html":"<ul>\n  <li>1234 Main Street<\/li>\n  <li>1600 Pe<span class='match'>nn<\/span>sylvania Ave<\/li>\n  <li>Brick Building<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1-6k6usRR06dp-YK-M3HUOUgQZKXXqKnAD5RC4TISGhw/export/png?id=1-6k6usRR06dp-YK-M3HUOUgQZKXXqKnAD5RC4TISGhw&amp;pageid=g38bb68a539_0_193" alt="" />
<p class="caption">nn+ searches for double n one or more times in a string</p>
</div>
<p>You can also specify a range of the number of times to search for a pattern within your string. Below, we see that if we specify n be searched for at least two and at most 3 times, the pattern matches within our string. However, if we increase that to between three and four times, no pattern matching occurs, as there are never three or four n’s in a row in our strings.</p>
<div class="sourceCode" id="cb348"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb348-1"><a href="wrangle-data.html#cb348-1"></a><span class="co">## identify any time n shows up two or three times </span></span>
<span id="cb348-2"><a href="wrangle-data.html#cb348-2"></a><span class="kw">str_view_all</span>(addresses, <span class="st">&quot;n{2,3}&quot;</span>)</span></code></pre></div>
<div id="htmlwidget-3075fc205d71ff6a804c" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-3075fc205d71ff6a804c">{"x":{"html":"<ul>\n  <li>1234 Main Street<\/li>\n  <li>1600 Pe<span class='match'>nn<\/span>sylvania Ave<\/li>\n  <li>Brick Building<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode" id="cb349"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb349-1"><a href="wrangle-data.html#cb349-1"></a><span class="co">## identify any time n shows up three or four times </span></span>
<span id="cb349-2"><a href="wrangle-data.html#cb349-2"></a><span class="kw">str_view_all</span>(addresses, <span class="st">&quot;n{3,4}&quot;</span>)</span></code></pre></div>
<div id="htmlwidget-cc4d63e707238d1d229e" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-cc4d63e707238d1d229e">{"x":{"html":"<ul>\n  <li>1234 Main Street<\/li>\n  <li>1600 Pennsylvania Ave<\/li>\n  <li>Brick Building<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1-6k6usRR06dp-YK-M3HUOUgQZKXXqKnAD5RC4TISGhw/export/png?id=1-6k6usRR06dp-YK-M3HUOUgQZKXXqKnAD5RC4TISGhw&amp;pageid=g38bb68a539_0_65" alt="" />
<p class="caption">{n,m} looks to pattern match between n and m times</p>
</div>
</div>
</div>
</div>
<div id="glue-1" class="section level3" number="3.7.4">
<h3><span class="header-section-number">3.7.4</span> <code>glue</code></h3>
<p>Beyond using <code>stringr</code> to work with strings, there’s an additional helpful package called <a href="https://glue.tidyverse.org/"><code>glue</code></a>. According to the <code>glue</code> website:</p>
<blockquote>
<p>Glue offers interpreted string literals that are small, fast, and dependency-free. Glue does this by embedding R expressions in curly braces which are then evaluated and inserted into the argument string.</p>
</blockquote>
<p>To get started with this package, it will have to be installed and loaded in, as it is not a core tidyverse package.</p>
<div class="sourceCode" id="cb350"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb350-1"><a href="wrangle-data.html#cb350-1"></a><span class="co"># install.packages(&quot;glue&quot;)</span></span>
<span id="cb350-2"><a href="wrangle-data.html#cb350-2"></a><span class="kw">library</span>(glue)</span></code></pre></div>
<p>So, if you want to pass an R variable directly into a string, that becomes simpler with <code>glue</code>.</p>
<p>For example:</p>
<div class="sourceCode" id="cb351"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb351-1"><a href="wrangle-data.html#cb351-1"></a><span class="co"># use glue to interpret string literal</span></span>
<span id="cb351-2"><a href="wrangle-data.html#cb351-2"></a>topic &lt;-<span class="st"> &#39;tidyverse&#39;</span></span>
<span id="cb351-3"><a href="wrangle-data.html#cb351-3"></a><span class="kw">glue</span>(<span class="st">&#39;My favorite thing to learn about is the {topic}!&#39;</span>)</span></code></pre></div>
<pre><code>## My favorite thing to learn about is the tidyverse!</code></pre>
<p>Note that the code above interprets the variable <code>topic</code> within the string specified in the <code>glue()</code> function. The variable is specified within curly braces: <code>{}</code>.</p>
<p>This becomes particularly helpful when combining information within a data frame.</p>
<p>For example, if we return to the <code>msleep</code> dataset with information about mammalian sleep, we could use <code>mutate()</code> to add a column summarizing the name of the animal, how many minutes the animal spends asleep and how many awake. Note that these columns are currently in hours, so we’re going to convert that to minutes within the glue statement here:</p>
<div class="sourceCode" id="cb353"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb353-1"><a href="wrangle-data.html#cb353-1"></a><span class="co"># add a description column using glue</span></span>
<span id="cb353-2"><a href="wrangle-data.html#cb353-2"></a>msleep <span class="op">%&gt;%</span></span>
<span id="cb353-3"><a href="wrangle-data.html#cb353-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">description =</span> <span class="kw">glue</span>(<span class="st">&quot;The {name} typically sleeps for {sleep_total * 60} minutes and is awake for {awake * 60} minutes each day.&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb353-4"><a href="wrangle-data.html#cb353-4"></a><span class="st">  </span><span class="kw">select</span>(name, sleep_total, awake, description)</span></code></pre></div>
<pre><code>## # A tibble: 83 x 4
##    name             sleep_total awake description                               
##    &lt;chr&gt;                  &lt;dbl&gt; &lt;dbl&gt; &lt;glue&gt;                                    
##  1 Cheetah                 12.1  11.9 The Cheetah typically sleeps for 726 minu…
##  2 Owl monkey              17     7   The Owl monkey typically sleeps for 1020 …
##  3 Mountain beaver         14.4   9.6 The Mountain beaver typically sleeps for …
##  4 Greater short-t…        14.9   9.1 The Greater short-tailed shrew typically …
##  5 Cow                      4    20   The Cow typically sleeps for 240 minutes …
##  6 Three-toed sloth        14.4   9.6 The Three-toed sloth typically sleeps for…
##  7 Northern fur se…         8.7  15.3 The Northern fur seal typically sleeps fo…
##  8 Vesper mouse             7    17   The Vesper mouse typically sleeps for 420…
##  9 Dog                     10.1  13.9 The Dog typically sleeps for 606 minutes …
## 10 Roe deer                 3    21   The Roe deer typically sleeps for 180 min…
## # … with 73 more rows</code></pre>
<p>Note that we’ve selected the four columns used in this example with <code>select()</code> to focus on the output created using <code>glue()</code> in the <code>description</code> column. For each observation the information in description utilizes the appropriate information for that observation and the columns specified within the curly braces within the <code>glue()</code> function.</p>
</div>
</div>
<div id="working-with-text" class="section level2" number="3.8">
<h2><span class="header-section-number">3.8</span> Working With Text</h2>
<p>Beyond working with single strings and string literals, sometimes the information you’re analyzing is a whole body of text. This could be a speech, a novel, an article, or any other written document. In text analysis, the document(s) you’ve set out to analyze are referred to as a <strong>corpus</strong>. Linguists frequently analyze such types of data and doing so within R in a tidy data format has become simpler thanks to the <a href="https://juliasilge.github.io/tidytext/"><code>tidytext</code></a> package and the package-accompanying book <a href="https://www.tidytextmining.com/"><em>Text Mining with R</em></a>.</p>
<p>To get started, the package must be installed and loaded in:</p>
<div class="sourceCode" id="cb355"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb355-1"><a href="wrangle-data.html#cb355-1"></a><span class="co"># install.packages(&quot;tidytext&quot;)</span></span>
<span id="cb355-2"><a href="wrangle-data.html#cb355-2"></a><span class="kw">library</span>(tidytext)</span></code></pre></div>
<div id="tidy-text-format" class="section level3" number="3.8.1">
<h3><span class="header-section-number">3.8.1</span> Tidy Text Format</h3>
<p>If we’re thinking about all the text in a novel, it’s pretty clear that it is not in a format that is easy to analyze computationally. To analyze the text in the novel computationally and say, determine what words are used most frequently, or what topics are discussed, we need to convert the text in the novel into a format that a computer can interpret. And, as with all types of data discussed in these courses, we want this to be a tidy format where (1) each observation is a row (2) each variable is a column, and (3) each observational unit is a table. So, how do we take text from a novel and store the information in a tidy format?</p>
<p>The tidy text format requires that the data frame will store one <strong>token</strong> per row. This requires knowing that a <strong>token</strong> is a meaningful unit of text. How you define that unit is up to you, the analyst and is driven by the question you’re asking. If you’re looking to identify the words used most frequently in this analysis, the unit of your token would be individual words. You would then utilize your computer to generate a data frame with each row containing data about a single word. However, your token could be two words (a <strong>bigram</strong>, a sentence, or a paragraph. Whatever you decide is meaningful for your analysis will be the unit for your token. Each row will contain a separate token.</p>
<div id="tokenization" class="section level4" number="3.8.1.1">
<h4><span class="header-section-number">3.8.1.1</span> Tokenization</h4>
<p>After determining what level of information you’re most interested in, you need a way to go from a wall of text (say, all the text in a novel) to a data frame of tokens (say, individual words). To do this, the <code>unnest_tokens()</code> function is incredibly useful.</p>
<p>We’ll use a bear bones example to demonstrate how it works. Below is text from the Shel Silverstein poem “Carrots” stored as a character vector:</p>
<div class="sourceCode" id="cb356"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb356-1"><a href="wrangle-data.html#cb356-1"></a>carrots &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;They say that carrots are good for your eyes&quot;</span>,</span>
<span id="cb356-2"><a href="wrangle-data.html#cb356-2"></a>          <span class="st">&quot;They swear that they improve your sight&quot;</span>,</span>
<span id="cb356-3"><a href="wrangle-data.html#cb356-3"></a>          <span class="st">&quot;But I&#39;m seein&#39; worse than I did last night -&quot;</span>,</span>
<span id="cb356-4"><a href="wrangle-data.html#cb356-4"></a>          <span class="st">&quot;You think maybe I ain&#39;t usin&#39; em right?&quot;</span>)</span>
<span id="cb356-5"><a href="wrangle-data.html#cb356-5"></a></span>
<span id="cb356-6"><a href="wrangle-data.html#cb356-6"></a>carrots</span></code></pre></div>
<pre><code>## [1] &quot;They say that carrots are good for your eyes&quot;
## [2] &quot;They swear that they improve your sight&quot;     
## [3] &quot;But I&#39;m seein&#39; worse than I did last night -&quot;
## [4] &quot;You think maybe I ain&#39;t usin&#39; em right?&quot;</code></pre>
<p>For analysis, we’d need to get this into a tidy data format. So, first things first, let’s get it into a data frame:</p>
<div class="sourceCode" id="cb358"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb358-1"><a href="wrangle-data.html#cb358-1"></a><span class="kw">library</span>(tibble)</span>
<span id="cb358-2"><a href="wrangle-data.html#cb358-2"></a>text_df &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">line =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, <span class="dt">text =</span> carrots)</span>
<span id="cb358-3"><a href="wrangle-data.html#cb358-3"></a></span>
<span id="cb358-4"><a href="wrangle-data.html#cb358-4"></a>text_df</span></code></pre></div>
<pre><code>## # A tibble: 4 x 2
##    line text                                        
##   &lt;int&gt; &lt;chr&gt;                                       
## 1     1 They say that carrots are good for your eyes
## 2     2 They swear that they improve your sight     
## 3     3 But I&#39;m seein&#39; worse than I did last night -
## 4     4 You think maybe I ain&#39;t usin&#39; em right?</code></pre>
<p>At this point we have a tibble with each line of the poem in a separate row. Now, we want to convert this using <code>unnest_tokens()</code> so that each row contains a single token, where, for this example, our token will be an individual word. This process is known as <em>tokenization</em>.</p>
<div class="sourceCode" id="cb360"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb360-1"><a href="wrangle-data.html#cb360-1"></a>text_df <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb360-2"><a href="wrangle-data.html#cb360-2"></a><span class="st">  </span><span class="kw">unnest_tokens</span>(word, text)</span></code></pre></div>
<pre><code>## # A tibble: 33 x 2
##     line word   
##    &lt;int&gt; &lt;chr&gt;  
##  1     1 they   
##  2     1 say    
##  3     1 that   
##  4     1 carrots
##  5     1 are    
##  6     1 good   
##  7     1 for    
##  8     1 your   
##  9     1 eyes   
## 10     2 they   
## # … with 23 more rows</code></pre>
<p>Notice that the two arguments to the <code>unnest_tokens()</code> function. The first (<code>word</code> in our example) is the name of the token column in the output. The second (<code>text</code> in our example) is the name of the column in the input data frame (<code>text_df</code>) that should be used for tokenization.</p>
<p>In the output we see that there is a single word (token) in each row, so our data are now in a tidy format, which makes further analysis simpler.</p>
<p>Finally, note that, by default <code>unnest_tokens()</code> strips punctuation and converts the tokens to lowercase.</p>
</div>
</div>
<div id="sentiment-analysis" class="section level3" number="3.8.2">
<h3><span class="header-section-number">3.8.2</span> Sentiment Analysis</h3>
<p>Often, once you’ve tokenized your dataset, there is an analysis you want to do - a question you want to answer. Sometimes, this involves wanting to measure the sentiment of a piece by looking at the emotional content of the words in that piece.</p>
<p>To do this, the analyst must have access to or create a <em>lexicon</em>, a dictionary with the sentiment of common words. There are three single word-based lexicons available within the <code>tidytext</code> package: <a href="http://www2.imm.dtu.dk/pubdb/views/publication_details.php?id=6010"><code>afinn</code></a>, <a href="https://www.cs.uic.edu/~liub/FBS/sentiment-analysis.html"><code>bing</code></a>, <a href="https://sraf.nd.edu/"><code>loughran</code></a> and <a href="http://saifmohammad.com/WebPages/NRC-Emotion-Lexicon.htm"><code>nrc</code></a>. Each differs in how they categorize sentiment, and to get a sense of how words are categorized in any of these lexicon, you can use the <code>get_sentiments()</code> function.</p>
<p>However, this requires an additional package: <code>textdata</code>. Be sure this has been installed before using the <code>get_sentiments()</code> function.</p>
<div class="sourceCode" id="cb362"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb362-1"><a href="wrangle-data.html#cb362-1"></a><span class="kw">library</span>(textdata)</span>
<span id="cb362-2"><a href="wrangle-data.html#cb362-2"></a><span class="co"># be sure textdata is installed</span></span>
<span id="cb362-3"><a href="wrangle-data.html#cb362-3"></a><span class="co">#install.packages(&quot;textdata&quot;, repos = &#39;http://cran.us.r-project.org&#39;)</span></span>
<span id="cb362-4"><a href="wrangle-data.html#cb362-4"></a></span>
<span id="cb362-5"><a href="wrangle-data.html#cb362-5"></a><span class="co"># see information stored in NRC lexicon</span></span>
<span id="cb362-6"><a href="wrangle-data.html#cb362-6"></a><span class="kw">get_sentiments</span>(<span class="st">&#39;nrc&#39;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 13,901 x 2
##    word        sentiment
##    &lt;chr&gt;       &lt;chr&gt;    
##  1 abacus      trust    
##  2 abandon     fear     
##  3 abandon     negative 
##  4 abandon     sadness  
##  5 abandoned   anger    
##  6 abandoned   fear     
##  7 abandoned   negative 
##  8 abandoned   sadness  
##  9 abandonment anger    
## 10 abandonment fear     
## # … with 13,891 more rows</code></pre>
<p>Note: The first time you use this function R will prompt you to verify that you want to download the lexicon.</p>
<p>In the output you’ll see words in the first column and the sentiment attached to each word in the <code>sentiment</code> column. Notice that the same word can have multiple sentiments attached to it. All told, there are more than 13,000 word-sentiment pairs in this lexicon.</p>
<p>Let’s quantify the sentiment in the “Carrots” poem from above:</p>
<div class="sourceCode" id="cb364"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb364-1"><a href="wrangle-data.html#cb364-1"></a>text_df <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb364-2"><a href="wrangle-data.html#cb364-2"></a><span class="st">  </span><span class="kw">unnest_tokens</span>(word, text) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb364-3"><a href="wrangle-data.html#cb364-3"></a><span class="st">  </span><span class="kw">inner_join</span>(<span class="kw">get_sentiments</span>(<span class="st">&#39;nrc&#39;</span>))</span></code></pre></div>
<pre><code>## Joining, by = &quot;word&quot;</code></pre>
<pre><code>## # A tibble: 14 x 3
##     line word    sentiment   
##    &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;       
##  1     1 good    anticipation
##  2     1 good    joy         
##  3     1 good    positive    
##  4     1 good    surprise    
##  5     1 good    trust       
##  6     2 swear   positive    
##  7     2 swear   trust       
##  8     2 improve anticipation
##  9     2 improve joy         
## 10     2 improve positive    
## 11     2 improve trust       
## 12     3 worse   fear        
## 13     3 worse   negative    
## 14     3 worse   sadness</code></pre>
<p>Notice that the sentiments applied to each word are dependent upon the sentiments defined within the lexicon. Words that are missing or that are used differently than anticipated by those who generated the lexicon <em>could</em> be misclassified. Additionally, since we’re using single word tokens, qualifiers are removed from context. So in the carrots poem, the word good in “are good for your eyes” would be given the same sentiment as good if the phrase were “are <em>not</em> good for your eyes.” Thus, a lot context and nuance is lost in this approach. It’s always important to consider the limitations of your analytical approach!</p>
<p>Above we found the sentiments for each token, but let’s summarize that by counting the number of times each sentiment appears.</p>
<div class="sourceCode" id="cb367"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb367-1"><a href="wrangle-data.html#cb367-1"></a>text_df <span class="op">%&gt;%</span></span>
<span id="cb367-2"><a href="wrangle-data.html#cb367-2"></a><span class="st">  </span><span class="kw">unnest_tokens</span>(word, text) <span class="op">%&gt;%</span></span>
<span id="cb367-3"><a href="wrangle-data.html#cb367-3"></a><span class="st">  </span><span class="kw">inner_join</span>(<span class="kw">get_sentiments</span>(<span class="st">&#39;nrc&#39;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb367-4"><a href="wrangle-data.html#cb367-4"></a><span class="st">  </span><span class="kw">count</span>(sentiment, <span class="dt">sort =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## Joining, by = &quot;word&quot;</code></pre>
<pre><code>## # A tibble: 8 x 2
##   sentiment        n
##   &lt;chr&gt;        &lt;int&gt;
## 1 positive         3
## 2 trust            3
## 3 anticipation     2
## 4 joy              2
## 5 fear             1
## 6 negative         1
## 7 sadness          1
## 8 surprise         1</code></pre>
<p>As we’re analyzing a short poem, we see that only a few sentiments show up multiple times; however, using sentiment analysis on this poem suggests that the poem is generally positive, including words that convey trust, anticipation, and joy.</p>
<p>Analyzing a four line poem, however, is not typically what one would do. They would instead analyze the text across chapters in a book or across multiple books. Here, we’ve just demonstrated the concepts behind how you would go about carrying out sentiment analysis.</p>
</div>
<div id="word-and-document-frequency" class="section level3" number="3.8.3">
<h3><span class="header-section-number">3.8.3</span> Word and Document Frequency</h3>
<p>Beyond sentiment analysis, analysts of text are often interested in quantifying what a document is <em>about.</em> One could start by quantifying term frequency and looking at which terms occur most often; however, common words, such as the and and, are likely to appear most often. Those aren’t unique to the work and hardly explain the text’s topic. Often, these words, referred to as <strong>stop words</strong> are removed from analysis; however, these words are more important to some works relative to others. So, analysts tend to take a different approach: <strong><em>inverse document frequency</em></strong> (idf).</p>
<p>A document’s <strong><em>inverse document frequency</em></strong> (idf) weights each term by its frequency in a collection of documents. Those words that are quite common in a set of documents are down-weighted. The weights for words that are less common are increased. By combining idf with term frequency (tf) (through multiplication), words that are common <em>and</em> unique to that document (relative to the collection of documents) stand out.</p>
<p>To see an example of this, we’ll need a few more poems from Shel Silverstein for analysis. Here is <em>Invitation</em>:</p>
<div class="sourceCode" id="cb370"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb370-1"><a href="wrangle-data.html#cb370-1"></a><span class="kw">library</span>(tibble)</span>
<span id="cb370-2"><a href="wrangle-data.html#cb370-2"></a>invitation &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;If you are a dreamer, come in,&quot;</span>,</span>
<span id="cb370-3"><a href="wrangle-data.html#cb370-3"></a>  <span class="st">&quot;If you are a dreamer, a wisher, a liar&quot;</span>, </span>
<span id="cb370-4"><a href="wrangle-data.html#cb370-4"></a>  <span class="st">&quot;A hope-er, a pray-er, a magic bean buyer…&quot;</span>,</span>
<span id="cb370-5"><a href="wrangle-data.html#cb370-5"></a>  <span class="st">&quot;If you’re a pretender, come sit by my fire&quot;</span>,</span>
<span id="cb370-6"><a href="wrangle-data.html#cb370-6"></a>  <span class="st">&quot;For we have some flax-golden tales to spin.&quot;</span>,</span>
<span id="cb370-7"><a href="wrangle-data.html#cb370-7"></a>  <span class="st">&quot;Come in!&quot;</span>,</span>
<span id="cb370-8"><a href="wrangle-data.html#cb370-8"></a>  <span class="st">&quot;Come in!&quot;</span>)</span>
<span id="cb370-9"><a href="wrangle-data.html#cb370-9"></a></span>
<span id="cb370-10"><a href="wrangle-data.html#cb370-10"></a>invitation &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">line =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">7</span>, <span class="dt">text =</span> invitation, <span class="dt">title =</span> <span class="st">&quot;Invitation&quot;</span>)</span>
<span id="cb370-11"><a href="wrangle-data.html#cb370-11"></a></span>
<span id="cb370-12"><a href="wrangle-data.html#cb370-12"></a>invitation</span></code></pre></div>
<pre><code>## # A tibble: 7 x 3
##    line text                                        title     
##   &lt;int&gt; &lt;chr&gt;                                       &lt;chr&gt;     
## 1     1 If you are a dreamer, come in,              Invitation
## 2     2 If you are a dreamer, a wisher, a liar      Invitation
## 3     3 A hope-er, a pray-er, a magic bean buyer…   Invitation
## 4     4 If you’re a pretender, come sit by my fire  Invitation
## 5     5 For we have some flax-golden tales to spin. Invitation
## 6     6 Come in!                                    Invitation
## 7     7 Come in!                                    Invitation</code></pre>
<p>And, here is masks:</p>
<div class="sourceCode" id="cb372"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb372-1"><a href="wrangle-data.html#cb372-1"></a>masks &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;She had blue skin.&quot;</span>, </span>
<span id="cb372-2"><a href="wrangle-data.html#cb372-2"></a>           <span class="st">&quot;And so did he.&quot;</span>, </span>
<span id="cb372-3"><a href="wrangle-data.html#cb372-3"></a>           <span class="st">&quot;He kept it hid&quot;</span>, </span>
<span id="cb372-4"><a href="wrangle-data.html#cb372-4"></a>           <span class="st">&quot;And so did she.&quot;</span>, </span>
<span id="cb372-5"><a href="wrangle-data.html#cb372-5"></a>           <span class="st">&quot;They searched for blue&quot;</span>, </span>
<span id="cb372-6"><a href="wrangle-data.html#cb372-6"></a>           <span class="st">&quot;Their whole life through&quot;</span>,</span>
<span id="cb372-7"><a href="wrangle-data.html#cb372-7"></a>           <span class="st">&quot;Then passed right by—&quot;</span>, </span>
<span id="cb372-8"><a href="wrangle-data.html#cb372-8"></a>           <span class="st">&quot;And never knew&quot;</span>)</span>
<span id="cb372-9"><a href="wrangle-data.html#cb372-9"></a></span>
<span id="cb372-10"><a href="wrangle-data.html#cb372-10"></a>masks &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">line =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">8</span>, <span class="dt">text =</span> masks, <span class="dt">title =</span> <span class="st">&quot;Masks&quot;</span>)</span>
<span id="cb372-11"><a href="wrangle-data.html#cb372-11"></a></span>
<span id="cb372-12"><a href="wrangle-data.html#cb372-12"></a>masks</span></code></pre></div>
<pre><code>## # A tibble: 8 x 3
##    line text                     title
##   &lt;int&gt; &lt;chr&gt;                    &lt;chr&gt;
## 1     1 She had blue skin.       Masks
## 2     2 And so did he.           Masks
## 3     3 He kept it hid           Masks
## 4     4 And so did she.          Masks
## 5     5 They searched for blue   Masks
## 6     6 Their whole life through Masks
## 7     7 Then passed right by—    Masks
## 8     8 And never knew           Masks</code></pre>
<p>We’ll combine all three poems into a single data frame for TF-IDF analysis. To do so, we’ll first add a column to our carrots example from above so that it has a column for <code>title</code>:</p>
<div class="sourceCode" id="cb374"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb374-1"><a href="wrangle-data.html#cb374-1"></a><span class="co"># add title to carrots poem</span></span>
<span id="cb374-2"><a href="wrangle-data.html#cb374-2"></a>carrots &lt;-<span class="st"> </span>text_df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">title =</span> <span class="st">&quot;Carrots&quot;</span>)</span>
<span id="cb374-3"><a href="wrangle-data.html#cb374-3"></a></span>
<span id="cb374-4"><a href="wrangle-data.html#cb374-4"></a><span class="co"># combine all three poems into a tidy data frame</span></span>
<span id="cb374-5"><a href="wrangle-data.html#cb374-5"></a>poems &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(carrots, invitation, masks)</span></code></pre></div>
<p>Now that we have our three documents (poems) in a single data frame, we can tokenize the text by word and calculate each tokens frequency within the document (poem).</p>
<div class="sourceCode" id="cb375"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb375-1"><a href="wrangle-data.html#cb375-1"></a><span class="co"># count number of times word appwars within each text</span></span>
<span id="cb375-2"><a href="wrangle-data.html#cb375-2"></a>poem_words &lt;-<span class="st"> </span>poems <span class="op">%&gt;%</span></span>
<span id="cb375-3"><a href="wrangle-data.html#cb375-3"></a><span class="st">  </span><span class="kw">unnest_tokens</span>(word, text) <span class="op">%&gt;%</span></span>
<span id="cb375-4"><a href="wrangle-data.html#cb375-4"></a><span class="st">  </span><span class="kw">count</span>(title, word, <span class="dt">sort =</span> <span class="ot">TRUE</span>)</span>
<span id="cb375-5"><a href="wrangle-data.html#cb375-5"></a></span>
<span id="cb375-6"><a href="wrangle-data.html#cb375-6"></a><span class="co"># count total number of words in each poem</span></span>
<span id="cb375-7"><a href="wrangle-data.html#cb375-7"></a>total_words &lt;-<span class="st"> </span>poem_words <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb375-8"><a href="wrangle-data.html#cb375-8"></a><span class="st">  </span><span class="kw">group_by</span>(title) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb375-9"><a href="wrangle-data.html#cb375-9"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">total =</span> <span class="kw">sum</span>(n))</span></code></pre></div>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<div class="sourceCode" id="cb377"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb377-1"><a href="wrangle-data.html#cb377-1"></a><span class="co"># combine data frames</span></span>
<span id="cb377-2"><a href="wrangle-data.html#cb377-2"></a>poem_words &lt;-<span class="st"> </span><span class="kw">left_join</span>(poem_words, total_words)</span></code></pre></div>
<pre><code>## Joining, by = &quot;title&quot;</code></pre>
<div class="sourceCode" id="cb379"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb379-1"><a href="wrangle-data.html#cb379-1"></a>poem_words</span></code></pre></div>
<pre><code>## # A tibble: 82 x 4
##    title      word      n total
##    &lt;chr&gt;      &lt;chr&gt; &lt;int&gt; &lt;int&gt;
##  1 Invitation a         8    48
##  2 Invitation come      4    48
##  3 Carrots    they      3    33
##  4 Invitation if        3    48
##  5 Invitation in        3    48
##  6 Masks      and       3    31
##  7 Carrots    i         2    33
##  8 Carrots    that      2    33
##  9 Carrots    your      2    33
## 10 Invitation are       2    48
## # … with 72 more rows</code></pre>
<p>Note that there are a different number of total words in each document, which is important to consider when you’re comparing relative frequency between documents.</p>
<p>We could visualize the number of times a word appears relative to document length as follows:</p>
<div class="sourceCode" id="cb381"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb381-1"><a href="wrangle-data.html#cb381-1"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb381-2"><a href="wrangle-data.html#cb381-2"></a><span class="co"># visualize frequency / total words in poem</span></span>
<span id="cb381-3"><a href="wrangle-data.html#cb381-3"></a><span class="kw">ggplot</span>(poem_words, <span class="kw">aes</span>(n<span class="op">/</span>total, <span class="dt">fill =</span> title)) <span class="op">+</span></span>
<span id="cb381-4"><a href="wrangle-data.html#cb381-4"></a><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">show.legend =</span> <span class="ot">FALSE</span>, <span class="dt">bins =</span> <span class="dv">5</span>) <span class="op">+</span></span>
<span id="cb381-5"><a href="wrangle-data.html#cb381-5"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>title, <span class="dt">ncol =</span> <span class="dv">3</span>, <span class="dt">scales =</span> <span class="st">&quot;free_y&quot;</span>)</span></code></pre></div>
<p><img src="03-tidying_files/figure-html/unnamed-chunk-115-1.png" width="672" /></p>
<p>With most documents there are only a few words that show up infrequently in the tail off to the right (rare words), while most words show up a whole bunch of times.</p>
<p>What we’ve just visualized is term frequency. We can add this quantity to our data frame:</p>
<div class="sourceCode" id="cb382"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb382-1"><a href="wrangle-data.html#cb382-1"></a>freq_by_rank &lt;-<span class="st"> </span>poem_words <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb382-2"><a href="wrangle-data.html#cb382-2"></a><span class="st">  </span><span class="kw">group_by</span>(title) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb382-3"><a href="wrangle-data.html#cb382-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">rank =</span> <span class="kw">row_number</span>(), </span>
<span id="cb382-4"><a href="wrangle-data.html#cb382-4"></a>         <span class="st">`</span><span class="dt">term frequency</span><span class="st">`</span> =<span class="st"> </span>n<span class="op">/</span>total)</span></code></pre></div>
<p>Notice that words that appear most frequently will have the largest term frequency. However, we’re not just interested in word frequency, as stop words (such as “a”) have the highest term frequency. Rather, we’re interested in tf-idf - those words in a document that are unique relative to the other documents being analyzed.</p>
<p>To calculate tf-idf, we can use <code>bind_tf_idf()</code>, specifying three arguments: the column including the token (<code>word</code>), the column specifying the document from which the token originated (<code>title</code>), and the column including the number of times the word appears (<code>n</code>):</p>
<div class="sourceCode" id="cb383"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb383-1"><a href="wrangle-data.html#cb383-1"></a>poem_words &lt;-<span class="st"> </span>poem_words <span class="op">%&gt;%</span></span>
<span id="cb383-2"><a href="wrangle-data.html#cb383-2"></a><span class="st">  </span><span class="kw">bind_tf_idf</span>(word, title, n)</span>
<span id="cb383-3"><a href="wrangle-data.html#cb383-3"></a></span>
<span id="cb383-4"><a href="wrangle-data.html#cb383-4"></a><span class="co"># sort ascending</span></span>
<span id="cb383-5"><a href="wrangle-data.html#cb383-5"></a>poem_words <span class="op">%&gt;%</span></span>
<span id="cb383-6"><a href="wrangle-data.html#cb383-6"></a><span class="st">  </span><span class="kw">arrange</span>(tf_idf)</span></code></pre></div>
<pre><code>## # A tibble: 82 x 7
##    title      word      n total     tf   idf  tf_idf
##    &lt;chr&gt;      &lt;chr&gt; &lt;int&gt; &lt;int&gt;  &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
##  1 Carrots    for       1    33 0.0303 0     0      
##  2 Invitation for       1    48 0.0208 0     0      
##  3 Masks      for       1    31 0.0323 0     0      
##  4 Invitation by        1    48 0.0208 0.405 0.00845
##  5 Carrots    are       1    33 0.0303 0.405 0.0123 
##  6 Carrots    did       1    33 0.0303 0.405 0.0123 
##  7 Carrots    right     1    33 0.0303 0.405 0.0123 
##  8 Carrots    you       1    33 0.0303 0.405 0.0123 
##  9 Masks      by        1    31 0.0323 0.405 0.0131 
## 10 Masks      right     1    31 0.0323 0.405 0.0131 
## # … with 72 more rows</code></pre>
<p>If we sort this output in ascending order by <code>tf_idf</code>, you’ll notice that the word “for” has a <code>tf_idf</code> of 0. The data indicates that this word shows up with equal frequency across all three poems. It is <em>not</em> a word unique to any one poem.</p>
<div class="sourceCode" id="cb385"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb385-1"><a href="wrangle-data.html#cb385-1"></a><span class="co"># sort descending</span></span>
<span id="cb385-2"><a href="wrangle-data.html#cb385-2"></a>poem_words <span class="op">%&gt;%</span></span>
<span id="cb385-3"><a href="wrangle-data.html#cb385-3"></a><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(tf_idf))</span></code></pre></div>
<pre><code>## # A tibble: 82 x 7
##    title      word      n total     tf   idf tf_idf
##    &lt;chr&gt;      &lt;chr&gt; &lt;int&gt; &lt;int&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
##  1 Invitation a         8    48 0.167   1.10 0.183 
##  2 Masks      and       3    31 0.0968  1.10 0.106 
##  3 Invitation come      4    48 0.0833  1.10 0.0916
##  4 Masks      blue      2    31 0.0645  1.10 0.0709
##  5 Masks      he        2    31 0.0645  1.10 0.0709
##  6 Masks      she       2    31 0.0645  1.10 0.0709
##  7 Masks      so        2    31 0.0645  1.10 0.0709
##  8 Invitation if        3    48 0.0625  1.10 0.0687
##  9 Invitation in        3    48 0.0625  1.10 0.0687
## 10 Carrots    i         2    33 0.0606  1.10 0.0666
## # … with 72 more rows</code></pre>
<p>Alternatively, here we see the words most unique to the individual poems. “a” and “come” are most unique to <em>Invitation</em>, while “and” and “blue” are most unique to <em>Masks</em>. If we had removed stop words, we would have lost the fact that some common words are really unique in one of these poems relative to the others.</p>
<p>Again, we’re looking at a limited amount of text here, but this analysis can be applied to novels, works by different authors, or articles written in a newspaper.</p>
<p>We can summarize these tf-idf results by visualizing the words with the highest tf-idf in each of these poems:</p>
<div class="sourceCode" id="cb387"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb387-1"><a href="wrangle-data.html#cb387-1"></a>poem_words <span class="op">%&gt;%</span></span>
<span id="cb387-2"><a href="wrangle-data.html#cb387-2"></a><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(tf_idf)) <span class="op">%&gt;%</span></span>
<span id="cb387-3"><a href="wrangle-data.html#cb387-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">word =</span> <span class="kw">factor</span>(word, <span class="dt">levels =</span> <span class="kw">rev</span>(<span class="kw">unique</span>(word)))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb387-4"><a href="wrangle-data.html#cb387-4"></a><span class="st">  </span><span class="kw">group_by</span>(title) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb387-5"><a href="wrangle-data.html#cb387-5"></a><span class="st">  </span><span class="kw">top_n</span>(<span class="dv">3</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb387-6"><a href="wrangle-data.html#cb387-6"></a><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></span>
<span id="cb387-7"><a href="wrangle-data.html#cb387-7"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(word, tf_idf, <span class="dt">fill =</span> title)) <span class="op">+</span></span>
<span id="cb387-8"><a href="wrangle-data.html#cb387-8"></a><span class="st">  </span><span class="kw">geom_col</span>(<span class="dt">show.legend =</span> <span class="ot">FALSE</span>) <span class="op">+</span></span>
<span id="cb387-9"><a href="wrangle-data.html#cb387-9"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="ot">NULL</span>, <span class="dt">y =</span> <span class="st">&quot;tf-idf&quot;</span>) <span class="op">+</span></span>
<span id="cb387-10"><a href="wrangle-data.html#cb387-10"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>title, <span class="dt">ncol =</span> <span class="dv">3</span>, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="op">+</span></span>
<span id="cb387-11"><a href="wrangle-data.html#cb387-11"></a><span class="st">  </span><span class="kw">coord_flip</span>()</span></code></pre></div>
<pre><code>## Selecting by tf_idf</code></pre>
<p><img src="03-tidying_files/figure-html/unnamed-chunk-119-1.png" width="672" /></p>
</div>
</div>
<div id="functional-programming" class="section level2" number="3.9">
<h2><span class="header-section-number">3.9</span> Functional Programming</h2>
<p><strong>Functional programming</strong> is an approach to programming in which the code evaluated is treated as a mathematical function. It is <em>declarative</em>, so expressions (or declarations) are used instead of statements. Functional programming is often touted and used due to the fact that cleaner, shorter code can be written. In this shorter code, functional programming allows for code that is elegant but also understandable. Ultimately, the goal is to have simpler code that minimizes time required for debugging, testing, and maintaining.</p>
<p>R at its core is a functional programming language. If you’re familiar with the <code>apply()</code> family of functions in base R, you’ve carried out some functional programming! Here, we’ll discuss functional programming and utilize the <code>purrr</code> package, designed to enhance functional programming in R.</p>
<p>By utilizing functional programming, you’ll be able to minimize redundancy within your code. The way this happens in reality is by determining what small building blocks your code needs. These will each be a function. These small building block functions are then combined into more complex structures to be your final program.</p>
<div id="for-loops-vs.-functionals" class="section level3" number="3.9.1">
<h3><span class="header-section-number">3.9.1</span> For Loops vs. Functionals</h3>
<p>In base R, you likely found yourself writing for loops for iteration. For example, if you wanted to carry out an operation on every row of a data frame, you’ve likely written a for loop to do so that loops through each row of the data frame and carries out what you want to do. However, you also may have heard people bemoan this approach, arguing that it’s slow and unnecessary. This is because R is a functional programming language. You can wrap for loops into a function and call the function instead of using the for loop.</p>
<p>Let’s use an example to demonstrate what we mean by this. What if you had a data frame and wanted the median value for each column in the data frame? To see how you could approach this, we’ll use the <code>trees</code> dataset available by default from R:</p>
<div class="sourceCode" id="cb389"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb389-1"><a href="wrangle-data.html#cb389-1"></a><span class="co"># see dataset</span></span>
<span id="cb389-2"><a href="wrangle-data.html#cb389-2"></a>trees &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(trees)</span>
<span id="cb389-3"><a href="wrangle-data.html#cb389-3"></a>trees</span></code></pre></div>
<pre><code>## # A tibble: 31 x 3
##    Girth Height Volume
##    &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
##  1   8.3     70   10.3
##  2   8.6     65   10.3
##  3   8.8     63   10.2
##  4  10.5     72   16.4
##  5  10.7     81   18.8
##  6  10.8     83   19.7
##  7  11       66   15.6
##  8  11       75   18.2
##  9  11.1     80   22.6
## 10  11.2     75   19.9
## # … with 21 more rows</code></pre>
<p>The dataset contains the diameter, height, and volume of 31 Black Cherry trees.</p>
<div id="copy-paste-approach" class="section level4" number="3.9.1.1">
<h4><span class="header-section-number">3.9.1.1</span> Copy + Paste Approach</h4>
<p>To calculate the median for each column, you could do the following:</p>
<div class="sourceCode" id="cb391"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb391-1"><a href="wrangle-data.html#cb391-1"></a><span class="co"># calculate median of each column</span></span>
<span id="cb391-2"><a href="wrangle-data.html#cb391-2"></a><span class="kw">median</span>(trees<span class="op">$</span>Girth)</span></code></pre></div>
<pre><code>## [1] 12.9</code></pre>
<div class="sourceCode" id="cb393"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb393-1"><a href="wrangle-data.html#cb393-1"></a><span class="kw">median</span>(trees<span class="op">$</span>Height)</span></code></pre></div>
<pre><code>## [1] 76</code></pre>
<div class="sourceCode" id="cb395"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb395-1"><a href="wrangle-data.html#cb395-1"></a><span class="kw">median</span>(trees<span class="op">$</span>Volume)</span></code></pre></div>
<pre><code>## [1] 24.2</code></pre>
<p>This would get you your answer; however, this breaks the programming rule that you shouldn’t copy and paste more than once. And, you could imagine that if you had more than three columns, this would be a <em>huge</em> pain and involve a whole lot of copy and pasting and editing.</p>
</div>
<div id="for-loop-approach" class="section level4" number="3.9.1.2">
<h4><span class="header-section-number">3.9.1.2</span> For Loop Approach</h4>
<p>A second approach would be to use a for loop. You would loop through all the columns in the data frame, calculate the median, record that value and store that information in a variable.</p>
<div class="sourceCode" id="cb397"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb397-1"><a href="wrangle-data.html#cb397-1"></a><span class="co"># create output vector</span></span>
<span id="cb397-2"><a href="wrangle-data.html#cb397-2"></a>output &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;double&quot;</span>, <span class="kw">ncol</span>(trees)) </span>
<span id="cb397-3"><a href="wrangle-data.html#cb397-3"></a></span>
<span id="cb397-4"><a href="wrangle-data.html#cb397-4"></a><span class="co"># loop through columns</span></span>
<span id="cb397-5"><a href="wrangle-data.html#cb397-5"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_along</span>(trees)) {          </span>
<span id="cb397-6"><a href="wrangle-data.html#cb397-6"></a>  output[[i]] &lt;-<span class="st"> </span><span class="kw">median</span>(trees[[i]])      </span>
<span id="cb397-7"><a href="wrangle-data.html#cb397-7"></a>}</span>
<span id="cb397-8"><a href="wrangle-data.html#cb397-8"></a>output</span></code></pre></div>
<pre><code>## [1] 12.9 76.0 24.2</code></pre>
<p>This allows us to obtain the same information as the copy + paste method; however, it scales better if there are more than three columns in your data frame, making it a better option than the copy + paste method.</p>
<p>But, what if you frequently want to take the median of the columns in your data frame? What if you want to do this more than once? You would have to go in, copy + paste this code and change the name of the data frame each time. This would break the don’t copy + paste more than once rule.</p>
</div>
<div id="function-approach" class="section level4" number="3.9.1.3">
<h4><span class="header-section-number">3.9.1.3</span> Function Approach</h4>
<p>This brings us to the function approach. Here, we wrap the for loop into a function so that we can execute a function on our data. frame whenever we want to accomplish the task of calculating the median for each column:</p>
<div class="sourceCode" id="cb399"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb399-1"><a href="wrangle-data.html#cb399-1"></a><span class="co"># create function</span></span>
<span id="cb399-2"><a href="wrangle-data.html#cb399-2"></a>col_median &lt;-<span class="st"> </span><span class="cf">function</span>(df) {</span>
<span id="cb399-3"><a href="wrangle-data.html#cb399-3"></a>  output &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;double&quot;</span>, <span class="kw">length</span>(df))</span>
<span id="cb399-4"><a href="wrangle-data.html#cb399-4"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_along</span>(df)) {</span>
<span id="cb399-5"><a href="wrangle-data.html#cb399-5"></a>    output[i] &lt;-<span class="st"> </span><span class="kw">median</span>(df[[i]])</span>
<span id="cb399-6"><a href="wrangle-data.html#cb399-6"></a>  }</span>
<span id="cb399-7"><a href="wrangle-data.html#cb399-7"></a>  output</span>
<span id="cb399-8"><a href="wrangle-data.html#cb399-8"></a>}</span>
<span id="cb399-9"><a href="wrangle-data.html#cb399-9"></a></span>
<span id="cb399-10"><a href="wrangle-data.html#cb399-10"></a><span class="co"># execute function</span></span>
<span id="cb399-11"><a href="wrangle-data.html#cb399-11"></a><span class="kw">col_median</span>(trees)</span></code></pre></div>
<pre><code>## [1] 12.9 76.0 24.2</code></pre>
<p>Again, the output information from trees is the same for this specific example, but now we see that we could use the <code>col_median()</code> function any time we want to calculate the medians across columns within a data frame!</p>
<p>This is a much better approach as it allows you to generalize your code, <em>but</em> the above solution still requires you to loop through each column, making the code harder to read and understand at a glance. It fails to take advantage of R’s functional programming capabilities.</p>
</div>
<div id="purrr-approach" class="section level4" number="3.9.1.4">
<h4><span class="header-section-number">3.9.1.4</span> <code>purrr</code> Approach</h4>
<p>To really optimize this solution, we’ll turn to <code>purrr</code>. Using <code>purrr</code> requires you to determine how to carry out your operation of interest for a single occurrence (i.e. calculate the median for a single column in your data frame). Then <code>purrr</code> takes care of carrying out that operation across your data frame. Further, once you break your problem down into smaller building blocks, <code>purrr</code> also helps you combine those smaller pieces into a functional program.</p>
<p>Let’s use <code>purrr</code> (a core tidyverse package) to solve our calculate median for each column task. But, before we do that specifically, let’s first introduce the general <code>map()</code> function.</p>
<p><strong><code>map</code></strong></p>
<p>We’ll see usage of <code>map()</code> functions in just a second to accomplish our median for each column task, but before doing so, let’s take a second to look at the generic usage for the family of <code>map</code> functions:</p>
<pre><code>map(.x, .f, ...)
map(INPUT, FUNCTION_TO_APPLY, OPTIONAL_OTHER_STUFF)</code></pre>
<p>Note that the input to a <code>map</code> function requires you to first specify a vector input followed by the function you’d like to apply. Any other arguments to the function you want to pass follow at the end of the call.</p>
<p>When it comes to our specific task, this is implemented as follows using <code>map_dbl()</code>:</p>
<div class="sourceCode" id="cb402"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb402-1"><a href="wrangle-data.html#cb402-1"></a><span class="kw">library</span>(purrr)</span>
<span id="cb402-2"><a href="wrangle-data.html#cb402-2"></a><span class="co"># use purrr to calculate median</span></span>
<span id="cb402-3"><a href="wrangle-data.html#cb402-3"></a><span class="kw">map_dbl</span>(trees, median)</span></code></pre></div>
<pre><code>##  Girth Height Volume 
##   12.9   76.0   24.2</code></pre>
<p>Here, we use the <code>map_dbl()</code> function from <code>purrr</code> to iterate over the columns of trees and calculate the median. And, it even displays the variable name in the output for us - all in a single function call.</p>
<p>Note the flexibility! We’ve just passed the <code>median()</code> function <em>into</em> another function: <code>map_dbl</code>. This means that if we changed our minds and wanted mean instead, we could accomplish that with ease:</p>
<div class="sourceCode" id="cb404"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb404-1"><a href="wrangle-data.html#cb404-1"></a><span class="co"># use purrr to calculate mean</span></span>
<span id="cb404-2"><a href="wrangle-data.html#cb404-2"></a><span class="kw">map_dbl</span>(trees, mean)</span></code></pre></div>
<pre><code>##    Girth   Height   Volume 
## 13.24839 76.00000 30.17097</code></pre>
<p>This function exists because looping to do something to each element and saving the results is such a common task, that there is family of functions (one of which is <code>map_dbl</code>) to do it for you to accomplish such tasks in <code>purrr</code>.</p>
<p>We’ll note here that <code>purrr</code>’s functions are all implemented in the C programming language, making them faster than the function we generated previously.</p>
<p>In the example above <code>mean</code> could have been any function, denoted in the <code>purrr</code> documentation as <code>.f</code>. This specifies the function you’d like to apply to the vector you’ve specified.</p>
<p>After <code>.f</code> in <code>purrr</code> functions, you can pass additional arguments. These go <em>after</em> the specified function. For example, below, we specify that we’d like to remove NAs, by specifying an argument to be passed to the <code>mean()</code> function after the function call (<code>mean</code>):</p>
<div class="sourceCode" id="cb406"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb406-1"><a href="wrangle-data.html#cb406-1"></a><span class="co"># use purrr to calculate mean</span></span>
<span id="cb406-2"><a href="wrangle-data.html#cb406-2"></a><span class="kw">map_dbl</span>(trees, mean, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>##    Girth   Height   Volume 
## 13.24839 76.00000 30.17097</code></pre>
</div>
</div>
<div id="map-functions" class="section level3" number="3.9.2">
<h3><span class="header-section-number">3.9.2</span> <code>map</code> Functions</h3>
<p>The <code>map</code> family of functions from the <code>purrr</code> package are analogous to the <code>apply()</code> family of functions from base R. If you’re familiar with <code>lapply()</code>, <code>vapply()</code>, <code>tapply</code>, and <code>sappy()</code>, the thinking will similar; however, <code>purrr</code> provides a much more consistent syntax and are much easier to learn and implement consistently.</p>
<p>As you saw in the median example above, <code>map</code> functions carry out an operation repeatedly and store the output of that operation for you. There are a number of different <code>map</code> functions. To determine which to use, consider the output you want to obtain from your operation. Above, we wanted a double vector, so we used <code>map_dbl</code>. However, you can return a number of different outputs from the map functions. A few are listed here and we’ll introduce even more shortly:</p>
<ul>
<li><code>map()</code> - returns a list</li>
<li><code>map_lgl()</code> - returns a logical vector</li>
<li><code>map_int()</code> - returns an integer vector</li>
<li><code>map_dbl()</code> - returns a double vector</li>
<li><code>map_chr()</code> - returns a character vector</li>
</ul>
<p>These all take vector and a function as an input. The function is applied to the vector and a new vector (of the same length &amp; with the same names) is returned of the type specified in the map function call.</p>
<p>There are also the variations <code>map_df</code>, <code>map_dfr</code> and <code>map_dfc</code>, which will create a dataframe (the tidyverse version called a tibble) from the output by either combining the data by rows with <code>map_df()</code> and <code>map_dfr()</code> or by column with <code>map_dfc()</code>.</p>
<div class="sourceCode" id="cb408"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb408-1"><a href="wrangle-data.html#cb408-1"></a><span class="co"># use map_dfr to calculate mean and create a dataframe</span></span>
<span id="cb408-2"><a href="wrangle-data.html#cb408-2"></a><span class="kw">map_dfr</span>(trees, mean, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 3
##   Girth Height Volume
##   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
## 1  13.2     76   30.2</code></pre>
</div>
<div id="multiple-vectors" class="section level3" number="3.9.3">
<h3><span class="header-section-number">3.9.3</span> Multiple Vectors</h3>
<p>So far, we’ve only looked at iterating over a single vector at a time; however in analysis, you’ll often find that you need to iterate over more than one vector at a time. The <code>purrr</code> package has two functions that simplify this process for you: <code>map2</code> and <code>pmap</code>.</p>
<div id="map2" class="section level4" number="3.9.3.1">
<h4><span class="header-section-number">3.9.3.1</span> <code>map2</code></h4>
<p><strong><code>map2()</code></strong> allows you to iterate over two vectors at the same time. The two vectors you want to iterate over are first specified within the <code>map2()</code> function call, followed by the function to execute. Any arguments after the function you’d like <code>map2()</code> to apply are specified at the end of the <code>map2()</code> call.</p>
<p>The generic usage for <code>map2()</code> is:</p>
<pre><code>map2(.x, .y, .f, ...)
map(INPUT_ONE, INPUT_TWO, FUNCTION_TO_APPLY, OPTIONAL_OTHER_STUFF)</code></pre>
<p>What if we wanted to calculate the volume of each tree? There is a column for volume, but let’s see if we can’t use a little geometry to calculate it on our own.</p>
<p>If we assume that each tree is a cylinder, the volume of a cylinder is <span class="math inline">\(V = \pi r^2 h\)</span>, where <span class="math inline">\(r\)</span> is half the diameter. In the trees dataset, the diameter is stored in the <code>Girth</code> column, in <em>inches</em>. <span class="math inline">\(h\)</span> is the height of the cylinder, which is stored in the <code>Height</code> column, in <em>feet</em>.</p>
<p>Thus, we have two vectors we want to operate over, <code>Girth</code> and <code>Height</code>, so we’ll use <code>map2()</code>.</p>
<p>Let’s first generate a function that will calculate volume for us from the information in our <code>trees</code> dataset:</p>
<div class="sourceCode" id="cb411"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb411-1"><a href="wrangle-data.html#cb411-1"></a><span class="co"># generate volume function</span></span>
<span id="cb411-2"><a href="wrangle-data.html#cb411-2"></a>volume &lt;-<span class="st"> </span><span class="cf">function</span>(diameter, height){</span>
<span id="cb411-3"><a href="wrangle-data.html#cb411-3"></a>  <span class="co"># convert diameter in inches to raidus in feet</span></span>
<span id="cb411-4"><a href="wrangle-data.html#cb411-4"></a>  radius_ft &lt;-<span class="st"> </span>(diameter<span class="op">/</span><span class="dv">2</span>)<span class="op">/</span><span class="dv">12</span></span>
<span id="cb411-5"><a href="wrangle-data.html#cb411-5"></a>  <span class="co"># calculate volume</span></span>
<span id="cb411-6"><a href="wrangle-data.html#cb411-6"></a>  output &lt;-<span class="st"> </span>pi <span class="op">*</span><span class="st"> </span>radius_ft<span class="op">^</span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>height</span>
<span id="cb411-7"><a href="wrangle-data.html#cb411-7"></a>  <span class="kw">return</span>(output)</span>
<span id="cb411-8"><a href="wrangle-data.html#cb411-8"></a>}</span></code></pre></div>
<p>Now, we can utilize <code>map2</code> then to calculate the volume from these two input vectors:</p>
<div class="sourceCode" id="cb412"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb412-1"><a href="wrangle-data.html#cb412-1"></a><span class="co"># calculate volume</span></span>
<span id="cb412-2"><a href="wrangle-data.html#cb412-2"></a><span class="kw">map2_dbl</span>(trees<span class="op">$</span>Girth, trees<span class="op">$</span>Height, volume)</span></code></pre></div>
<pre><code>##  [1]  26.30157  26.22030  26.60929  43.29507  50.58013  52.80232  43.55687
##  [8]  49.49645  53.76050  51.31268  55.01883  53.87046  53.87046  51.51672
## [15]  58.90486  67.16431  77.14819  82.97153  72.68200  66.47610  83.38311
## [22]  87.98205  84.85845 100.53096 111.58179 132.22227 136.96744 139.80524
## [29] 141.37167 141.37167 201.36365</code></pre>
<p>Here the output is on the same order as the <code>Volume</code> column from the dataset, but the numbers are off, suggesting that the dataset calculated volume of the tree differently than we did in our approach.</p>
<div class="sourceCode" id="cb414"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb414-1"><a href="wrangle-data.html#cb414-1"></a>trees<span class="op">$</span>Volume</span></code></pre></div>
<pre><code>##  [1] 10.3 10.3 10.2 16.4 18.8 19.7 15.6 18.2 22.6 19.9 24.2 21.0 21.4 21.3 19.1
## [16] 22.2 33.8 27.4 25.7 24.9 34.5 31.7 36.3 38.3 42.6 55.4 55.7 58.3 51.5 51.0
## [31] 77.0</code></pre>
<p>Note that there are all the same variations that exist for <code>map_</code> exist for <code>map2()</code>, so you’re able to use <code>map2_chr()</code> and <code>map2_dbl()</code>, etc.</p>
<p>Additionally, the <code>map</code> functions work well within our <code>dplyr</code> approach to working with data. Here, we add the output for our volume calculation to the trees dataset as well as a column (<code>volume_diff</code>) that displays the difference between our volume calculation and that reported in the dataset:</p>
<div class="sourceCode" id="cb416"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb416-1"><a href="wrangle-data.html#cb416-1"></a><span class="co"># calculate volume</span></span>
<span id="cb416-2"><a href="wrangle-data.html#cb416-2"></a>trees <span class="op">%&gt;%</span></span>
<span id="cb416-3"><a href="wrangle-data.html#cb416-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">volume_cylinder =</span> <span class="kw">map2_dbl</span>(trees<span class="op">$</span>Girth, trees<span class="op">$</span>Height, volume),</span>
<span id="cb416-4"><a href="wrangle-data.html#cb416-4"></a>         <span class="dt">volume_diff =</span> Volume <span class="op">-</span><span class="st"> </span>volume_cylinder)</span></code></pre></div>
<pre><code>## # A tibble: 31 x 5
##    Girth Height Volume volume_cylinder volume_diff
##    &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;           &lt;dbl&gt;       &lt;dbl&gt;
##  1   8.3     70   10.3            26.3       -16.0
##  2   8.6     65   10.3            26.2       -15.9
##  3   8.8     63   10.2            26.6       -16.4
##  4  10.5     72   16.4            43.3       -26.9
##  5  10.7     81   18.8            50.6       -31.8
##  6  10.8     83   19.7            52.8       -33.1
##  7  11       66   15.6            43.6       -28.0
##  8  11       75   18.2            49.5       -31.3
##  9  11.1     80   22.6            53.8       -31.2
## 10  11.2     75   19.9            51.3       -31.4
## # … with 21 more rows</code></pre>
</div>
<div id="pmap" class="section level4" number="3.9.3.2">
<h4><span class="header-section-number">3.9.3.2</span> <code>pmap</code></h4>
<p>While <code>map()</code> allows for iteration over a single vector, and <code>map2()</code> allows for iteration over <em>two</em> vectors, there is no <code>map3()</code>, <code>map4()</code>, or <code>map5()</code> because that would get too unwieldy. Instead, there is a single and more general <code>pmap()</code> - which stands for parallel map - function. The <code>pmap()</code> function takes a list of arguments over which you’d like to iterate:</p>
<p>The generic usage for this function is:</p>
<pre><code>pmap(.l, .f, ...)
pmap(LIST_OF_INPUT_LISTS, FUNCTION_TO_APPLY, OPTIONAL_OTHER_STUFF)</code></pre>
<p>Note that <code>.l</code> is a list of all the input vectors, so you are no longer specifying <code>.x</code> or <code>.y</code> individually. The rest of the syntax remains the same.</p>
</div>
</div>
<div id="anonymous-functions" class="section level3" number="3.9.4">
<h3><span class="header-section-number">3.9.4</span> Anonymous Functions</h3>
<p>In our <code>map2()</code> example we created a separate function to calculate volume; however, as this is a specific scenario for volume calculation, we likely won’t need that function again later. In such scenarios, it can be helpful to utilize an <strong>anonymous function</strong>. This is a function that is not given a name but that is utilized within our <code>map</code> call. We are <em>not</em> able to refer back to this function later, but we <em>are</em> able to use it within our <code>map</code> call:</p>
<div class="sourceCode" id="cb419"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb419-1"><a href="wrangle-data.html#cb419-1"></a><span class="kw">map2_dbl</span>(trees<span class="op">$</span>Girth, trees<span class="op">$</span>Height, <span class="cf">function</span>(x,y){ pi <span class="op">*</span><span class="st"> </span>((x<span class="op">/</span><span class="dv">2</span>)<span class="op">/</span><span class="dv">12</span>)<span class="op">^</span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>y})</span></code></pre></div>
<pre><code>##  [1]  26.30157  26.22030  26.60929  43.29507  50.58013  52.80232  43.55687
##  [8]  49.49645  53.76050  51.31268  55.01883  53.87046  53.87046  51.51672
## [15]  58.90486  67.16431  77.14819  82.97153  72.68200  66.47610  83.38311
## [22]  87.98205  84.85845 100.53096 111.58179 132.22227 136.96744 139.80524
## [29] 141.37167 141.37167 201.36365</code></pre>
<p>In this example, we create the anonymous function within the <code>map2_dbl()</code> call. This allows volume to be calculated as before, but does so without having to define a function.</p>
<p>This becomes particularly helpful within <code>purrr</code> if you want to refer to the individual elements of your <code>map</code> call directly. This is done by specifying <code>.x</code> and <code>.y</code> to refer to the first and second input vectors, respectively:</p>
<div class="sourceCode" id="cb421"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb421-1"><a href="wrangle-data.html#cb421-1"></a><span class="kw">map2_dbl</span>(trees<span class="op">$</span>Girth, trees<span class="op">$</span>Height, <span class="op">~</span><span class="st"> </span>pi <span class="op">*</span><span class="st"> </span>((.x<span class="op">/</span><span class="dv">2</span>)<span class="op">/</span><span class="dv">12</span>)<span class="op">^</span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>.y)</span></code></pre></div>
<pre><code>##  [1]  26.30157  26.22030  26.60929  43.29507  50.58013  52.80232  43.55687
##  [8]  49.49645  53.76050  51.31268  55.01883  53.87046  53.87046  51.51672
## [15]  58.90486  67.16431  77.14819  82.97153  72.68200  66.47610  83.38311
## [22]  87.98205  84.85845 100.53096 111.58179 132.22227 136.96744 139.80524
## [29] 141.37167 141.37167 201.36365</code></pre>
<p>Here, we see the same output; however, the syntax defines an anonymous function using the formula syntax.</p>
</div>
</div>
<div id="exploratory-data-analysis" class="section level2" number="3.10">
<h2><span class="header-section-number">3.10</span> Exploratory Data Analysis</h2>
<p>The goal of an exploratory analysis is to examine, or <strong>explore</strong> the data and find <strong>relationships</strong> that weren’t previously known. Exploratory analyses explore how different measures might be related to each other but do not confirm that relationship as causal, i.e., one variable causing another. You’ve probably heard the phrase “Correlation does not imply causation,” and exploratory analyses lie at the root of this saying. Just because you observe a relationship between two variables during exploratory analysis, it does not mean that one necessarily causes the other.</p>
<p>Because of this, exploratory analyses, while useful for discovering new connections, should not be the final say in answering a question! It can allow you to formulate hypotheses and drive the design of future studies and data collection, but exploratory analysis alone should never be used as the final say on why or how data might be related to each other. In short, exploratory analysis helps us ask better questions, but it does not answer questions. More specifically, we explore data in order to:</p>
<ul>
<li>Understand data properties such as nonlinear relationships, the existence of missing values, the existence of outliers, etc.</li>
<li>Find patterns in data such as associations, group differences, confounders, etc.</li>
<li>Suggest modeling strategies such as linear vs. nonlinear models, transformation</li>
<li>“Debug” analyses</li>
<li>Communicate results</li>
</ul>
<div id="general-principles-of-eda" class="section level3" number="3.10.1">
<h3><span class="header-section-number">3.10.1</span> General Principles of EDA</h3>
<p>We can summarize the general principles of exploratory analysis as follows:</p>
<ul>
<li>Look for missing values</li>
<li>Look for outlier values</li>
<li>Use plots to explore relationships</li>
<li>Use tables to explore relationships</li>
<li>If necessary, transform variables</li>
</ul>
<p>These principles may be more clear in an example. We will use a dataset from <a href="www.kaggle.com">Kaggle.com</a> that contains 120 years of Olympics history on athletes and results. If you don’t have an account on Kaggle, create one and go to the link <a href="https://www.kaggle.com/heesoo37/120-years-of-olympic-history-athletes-and-results" class="uri">https://www.kaggle.com/heesoo37/120-years-of-olympic-history-athletes-and-results</a> and under “Data Sources” download the <code>athlete_events.csv</code> to your computer.</p>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1fVhtSr4JTBQW4oSxtJ4u3T6EijVvXIa8DnSgz7_L9r0/export/png?id=1fVhtSr4JTBQW4oSxtJ4u3T6EijVvXIa8DnSgz7_L9r0&amp;pageid=g3a82126a9f_0_24" alt="" />
<p class="caption">Dataset on 120 years of Olympics history on athletes and results</p>
</div>
<p>Upload the data in R and import the CSV file using the commands you have learned. Unfortunately, you cannot download the CSV file directly from the web address since downloading datasets on Kaggle requires logging in.</p>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1fVhtSr4JTBQW4oSxtJ4u3T6EijVvXIa8DnSgz7_L9r0/export/png?id=1fVhtSr4JTBQW4oSxtJ4u3T6EijVvXIa8DnSgz7_L9r0&amp;pageid=g3a82126a9f_0_30" alt="" />
<p class="caption">Importing data using <code>read_csv()</code></p>
</div>
<p>As we learned before, we can use the package <code>skimr</code> to take a look at the data.</p>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1fVhtSr4JTBQW4oSxtJ4u3T6EijVvXIa8DnSgz7_L9r0/export/png?id=1fVhtSr4JTBQW4oSxtJ4u3T6EijVvXIa8DnSgz7_L9r0&amp;pageid=g3a82126a9f_0_35" alt="" />
<p class="caption">Using the skimr package to have a summary of the data</p>
</div>
<p>We see that the dataset contains 15 variables and 271,116 observations. Some of the variables are of factor type and others are of integer or numeric type. The dataset includes variables on athletes such as name, sex, the sport played, whether they received a medal, age, and height. We first need to understand the data properties. So let’s start with missing values.</p>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1fVhtSr4JTBQW4oSxtJ4u3T6EijVvXIa8DnSgz7_L9r0/export/png?id=1fVhtSr4JTBQW4oSxtJ4u3T6EijVvXIa8DnSgz7_L9r0&amp;pageid=g3a82126a9f_0_44" alt="" />
<p class="caption">We have different types of variables in our data</p>
</div>
<p>First, the results of the <code>skim()</code> function indicate that some of our variables have lots of missing values. For instance, the variable <code>Medal</code> has 231,333 missing values. Generally, this is a place for concern since most statistical analyses ignore observations with missing values. However, it is obvious that the missing values for the variable <code>Medal</code> are mainly because the athlete didn’t receive any medals. So this kind of missing value should not be a problem. However, we have missing values in the variables <code>Height</code> and <code>Age</code>. Since we are going to use these variables in our analysis in this lesson, observations with missing values for these two variables will be dropped from our analysis. Remember that <code>NA</code> is the most common character for missing values, but sometimes they are coded as spaces, 999, -1 or “missing”. Check for missing values in a variety of ways.</p>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1fVhtSr4JTBQW4oSxtJ4u3T6EijVvXIa8DnSgz7_L9r0/export/png?id=1fVhtSr4JTBQW4oSxtJ4u3T6EijVvXIa8DnSgz7_L9r0&amp;pageid=g3a82126a9f_0_49" alt="" />
<p class="caption">There are some missing values in the data</p>
</div>
<p>Second, we can see that there are some outliers in some of the numerical variables. For example, look at the summary of the variable <code>Age</code>. Although the average age among all the athletes is around 25, there is an individual who is 97 years old (fun fact: use the command <code>subset(df, df$Age == 97)</code> to check out the information about this athlete. You will see that the name of the athlete is John Quincy Adams Ward and he competed in the sport(!) Art Competitions Mixed Sculpturing in 1928. This artist is known for his George Washington statue in front of Federal Hall in Wall Street in New York City.) It is always good to know about the existence of outliers in your sample. Outliers can significantly skew the results of your analysis. You can find outliers by looking at the distribution of your variable too.</p>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1fVhtSr4JTBQW4oSxtJ4u3T6EijVvXIa8DnSgz7_L9r0/export/png?id=1fVhtSr4JTBQW4oSxtJ4u3T6EijVvXIa8DnSgz7_L9r0&amp;pageid=g3a82126a9f_0_63" alt="" />
<p class="caption">There is an outlier in the Age variable</p>
</div>
<p>Histograms, in general, are one of the best ways to look at a variable and find abnormalities. You can see that the age of most individuals in the sample are between 18-35.</p>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1fVhtSr4JTBQW4oSxtJ4u3T6EijVvXIa8DnSgz7_L9r0/export/png?id=1fVhtSr4JTBQW4oSxtJ4u3T6EijVvXIa8DnSgz7_L9r0&amp;pageid=g3a82126a9f_0_40" alt="" />
<p class="caption">Histogram of the variable Age</p>
</div>
<p>Now, rather than just summarizing the data points within a single variable, we can look at how two or more variables might be related to each other. For instance, we like to know if there is an association between age of athletes and their gender. One of the ways to do this is to look at a boxplot of age grouped by gender, i.e., the distribution of age separated for male and female athletes. Boxplot shows the distribution of the variable age for the gender groups. You can see that the average age is slightly higher for men than for women.</p>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1fVhtSr4JTBQW4oSxtJ4u3T6EijVvXIa8DnSgz7_L9r0/export/png?id=1fVhtSr4JTBQW4oSxtJ4u3T6EijVvXIa8DnSgz7_L9r0&amp;pageid=g3a82126a9f_0_5" alt="" />
<p class="caption">Boxplot of the variable Age for male and female individuals</p>
</div>
<p>If we are interested in looking at the distribution of male and female athletes over time, we can use frequency tables. Let us first create a frequency table of the share of women in each Olympic event. Tables are good for looking at factor or character variables.</p>
<div class="sourceCode" id="cb423"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb423-1"><a href="wrangle-data.html#cb423-1"></a>share &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span></span>
<span id="cb423-2"><a href="wrangle-data.html#cb423-2"></a><span class="st">  </span><span class="kw">group_by</span>(Year, Sex) <span class="op">%&gt;%</span></span>
<span id="cb423-3"><a href="wrangle-data.html#cb423-3"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">n =</span><span class="kw">n</span>()) <span class="op">%&gt;%</span></span>
<span id="cb423-4"><a href="wrangle-data.html#cb423-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">freq =</span> n <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(n)) <span class="op">%&gt;%</span></span>
<span id="cb423-5"><a href="wrangle-data.html#cb423-5"></a><span class="st">  </span><span class="kw">filter</span>(Sex <span class="op">==</span><span class="st"> &quot;F&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb424"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb424-1"><a href="wrangle-data.html#cb424-1"></a>share</span></code></pre></div>
<pre><code>## # A tibble: 34 x 4
## # Groups:   Year [34]
##     Year Sex       n    freq
##    &lt;dbl&gt; &lt;chr&gt; &lt;int&gt;   &lt;dbl&gt;
##  1  1900 F        33 0.0170 
##  2  1904 F        16 0.0123 
##  3  1906 F        11 0.00635
##  4  1908 F        47 0.0152 
##  5  1912 F        87 0.0215 
##  6  1920 F       134 0.0312 
##  7  1924 F       261 0.0458 
##  8  1928 F       437 0.0784 
##  9  1932 F       369 0.111  
## 10  1936 F       549 0.0742 
## # … with 24 more rows</code></pre>
<p>Now, if we want to plot this trend, we can use <code>geom_line()</code> from <code>ggplot</code>. It’s interesting that the share of women among all athletes that was once at a very low level in the early 1900s has gone up to almost 50% in modern times.</p>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1fVhtSr4JTBQW4oSxtJ4u3T6EijVvXIa8DnSgz7_L9r0/export/png?id=1fVhtSr4JTBQW4oSxtJ4u3T6EijVvXIa8DnSgz7_L9r0&amp;pageid=g3a82126a9f_0_79" alt="" />
<p class="caption">Plot of the share of female athletes over time</p>
</div>
<p>In general, the most important plots in exploratory data analysis are:</p>
<ul>
<li>Scatterplots (<code>geom_point()</code>)</li>
<li>Histograms (<code>geom_histogram()</code>)</li>
<li>Density plots (<code>geom_density()</code>)</li>
<li>Boxplots (<code>geom_boxplot()</code>)</li>
<li>Barplots (<code>geom_bar()</code>)</li>
</ul>
<p>To end our lesson on exploratory analysis, let’s consider a question: are taller athletes more likely to win a medal? To answer this question we can use different methods. We can look at the distribution of height for those who received a medal and those who didn’t. We can use boxplots or barplots. The choice is yours but because boxplots are more informative, we will use them. We can first create a variable that indicates whether the athlete has any medal (the variable <code>Medal</code> indicates the type of medals). Note that the variable <code>has.medal</code> is a transformation of the variable <code>Medal</code>.</p>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1fVhtSr4JTBQW4oSxtJ4u3T6EijVvXIa8DnSgz7_L9r0/export/png?id=1fVhtSr4JTBQW4oSxtJ4u3T6EijVvXIa8DnSgz7_L9r0&amp;pageid=g3a82126a9f_0_91" alt="" />
<p class="caption">Creating a variable that shows whether the athlete has a medal or not</p>
</div>
<p>And now, we use the following code to create the boxplot.</p>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1fVhtSr4JTBQW4oSxtJ4u3T6EijVvXIa8DnSgz7_L9r0/export/png?id=1fVhtSr4JTBQW4oSxtJ4u3T6EijVvXIa8DnSgz7_L9r0&amp;pageid=g3a82126a9f_0_96" alt="" />
<p class="caption">Boxplot for the relationship between height and having won a medal</p>
</div>
<p>What is obvious is that those who have a medal are taller. Can we say that being tall increases the probability of winning a medal in the Olympics? The answer to this question is that we don’t know. There are some possible scenarios. For instance, it could be true that being tall increase the chances of winning medals. But it could also be that there are more medals awarded in sports such as volleyball or basketball that require taller athletes. In these sports, every member of the winning team gets a medal (even if country counts only one medal is counted for the country). As a result, we may end up having so many tall athletes with a medal in each Olympics. It could also be that there are other confounding factors involved that explain why an athlete wins a medal. We will learn about confounding variables in future lessons. For now, it’s important to know, as we said in the beginning of this lesson, that association or correlation does not mean causation.</p>
<p>In the next module we will cover more methods for visualizing data.</p>
</div>
<div id="analyzing-json-in-r" class="section level3" number="3.10.2">
<h3><span class="header-section-number">3.10.2</span> Analyzing JSON in R</h3>
<p>AVOCADO - this section stinks</p>
<p>Above we discussed how to analyze pure text (meaning, text written by humans in their native written and spoken language). Here, we’ll discuss how to briefly how others have wrangled text-based data from the Internet in the JSON format within R. This is possible because of the R package <code>jsonlite</code>, which was used in the following example:</p>
<p><a href="https://blog.exploratory.io/@kanaugust">Kan Nishida</a>, a data scientist, was interested in <a href="https://blog.exploratory.io/working-with-json-data-in-very-simple-way-ad7ebcc0bb89">understanding what restaurant types found most frequently in each state or province</a>. To do this, he used JSON data originally released from Yelp. He wrangled the data from JSON format into a tabular format using <code>jsonlite</code> and other data wrangling packages, such as <code>dplyr</code>, to ultimately determine the types of restaurants found most frequently in a number of different states and provinces.</p>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1r5T8BgmyVkHQMxXuZ8o575D1515v3RSCeciG8uyBghU/export/png?id=1r5T8BgmyVkHQMxXuZ8o575D1515v3RSCeciG8uyBghU&amp;pageid=g3d555e2b2e_0_17" alt="" />
<p class="caption">Wrangling Yelp data from JSON into tidy tabular data</p>
</div>
</div>
<div id="analyzing-xml-in-r" class="section level3" number="3.10.3">
<h3><span class="header-section-number">3.10.3</span> Analyzing XML in R</h3>
<p>AVOCADO - this section stinks</p>
<p>To see an example of not only using <code>xml2</code> to parse XML data, but also another example of using <code>rvest</code> to obtain the XML data, check out this post from <a href="https://towardsdatascience.com/@jroberayalas">José Roberto Ayala Solares</a> where he took the text from a New York Times article called <a href="https://www.nytimes.com/interactive/2017/06/23/opinion/trumps-lies.html">“Trump’s Lies”</a>, scraped the data from the web (obtaining it in XML), and then <a href="https://towardsdatascience.com/web-scraping-tutorial-in-r-5e71fd107f32">wrangled it into a tidy format</a> using <code>xml2</code>.</p>
<div class="figure">
<img src="https://docs.google.com/presentation/d/1r5T8BgmyVkHQMxXuZ8o575D1515v3RSCeciG8uyBghU/export/png?id=1r5T8BgmyVkHQMxXuZ8o575D1515v3RSCeciG8uyBghU&amp;pageid=g3d555e2b2e_0_148" alt="" />
<p class="caption"><code>rvest</code> and <code>xml2</code> are helpful for web scraping and working with XML data</p>
</div>
<p>In this lesson, our goal is to make you aware that data from the Internet (and APIs in particular) will often come in either JSON or XML format. Thus, the JSON and XML examples provided here only give you a bit of an idea of what JSON and XML data are and how to work with them. Nevertheless, the more frequently you retrieve data from APIs and the Internet, the more comfortable you’ll have to become with both JSON and XML. And, <code>jsonlite</code> and <code>xml2</code> will help you as you work with these data in R!</p>
</div>
</div>
<div id="case-studies-2" class="section level2" number="3.11">
<h2><span class="header-section-number">3.11</span> Case Studies</h2>
<p>So far, we’ve introduced the case studies and read the raw data into R.</p>
<p>Let’s load the raw data that we previously saved using the <code>here</code> package.</p>
<div class="sourceCode" id="cb426"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb426-1"><a href="wrangle-data.html#cb426-1"></a><span class="kw">library</span>(here)</span></code></pre></div>
<pre><code>## here() starts at /Users/rdpeng/books/tidyversecourse</code></pre>
<div class="sourceCode" id="cb428"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb428-1"><a href="wrangle-data.html#cb428-1"></a><span class="kw">load</span>(here<span class="op">::</span><span class="kw">here</span>(<span class="st">&quot;data&quot;</span>,<span class="st">&quot;raw_data&quot;</span>, <span class="st">&quot;case_study_1.rda&quot;</span>))</span>
<span id="cb428-2"><a href="wrangle-data.html#cb428-2"></a><span class="kw">load</span>(here<span class="op">::</span><span class="kw">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;raw_data&quot;</span>, <span class="st">&quot;case_study_2.rda&quot;</span>))</span>
<span id="cb428-3"><a href="wrangle-data.html#cb428-3"></a><span class="co">#This loads all the data objects that we previously saved in our raw_data directory. Recall that this directory is located within a directory called data that is located within the directory where our project is located. </span></span></code></pre></div>
<p>Now, we will work to get the data into two tidy formatted datasets that will include the information needed to answer our questions of interest.</p>
<div id="case-study-1-health-expenditures-2" class="section level3" number="3.11.1">
<h3><span class="header-section-number">3.11.1</span> Case Study #1: Health Expenditures</h3>
<p>We’ve already read in the datasets we’ll use for this health expenditures case study, but they’re not yet cleaned and wrangled. So, we’ll do that here!</p>
<p>As a reminder, we’re ultimately interested in answering the following questions with these data:</p>
<ol style="list-style-type: decimal">
<li>Is there a relationship between healthcare coverage and healthcare spending in the United States?</li>
<li>How does the spending distribution change across geographic regions in the United States?</li>
<li>Does the relationship between healthcare coverage and healthcare spending in the United States change from 2013 to 2014?</li>
</ol>
<p>This means that we’ll need all the data from the variables necessary to answer this question in our tidy dataset.</p>
<div id="healthcare-coverage-data-1" class="section level4" number="3.11.1.1">
<h4><span class="header-section-number">3.11.1.1</span> Healthcare Coverage Data</h4>
<p>Let’s remind ourselves before we get to wrangling what data we have when it comes to healthcare coverage.</p>
<div class="sourceCode" id="cb429"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb429-1"><a href="wrangle-data.html#cb429-1"></a>coverage</span></code></pre></div>
<pre><code>## # A tibble: 52 x 29
##    Location `2013__Employer` `2013__Non-Grou… `2013__Medicaid` `2013__Medicare`
##    &lt;chr&gt;               &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;
##  1 United …        155696900         13816000         54919100         40876300
##  2 Alabama           2126500           174200           869700           783000
##  3 Alaska             364900            24000            95000            55200
##  4 Arizona           2883800           170800          1346100           842000
##  5 Arkansas          1128800           155600           600800           515200
##  6 Califor…         17747300          1986400          8344800          3828500
##  7 Colorado          2852500           426300           697300           549700
##  8 Connect…          2030500           126800           532000           475300
##  9 Delaware           473700            25100           192700           141300
## 10 Distric…           324300            30400           174900            59900
## # … with 42 more rows, and 24 more variables: `2013__Other Public` &lt;chr&gt;,
## #   `2013__Uninsured` &lt;dbl&gt;, `2013__Total` &lt;dbl&gt;, `2014__Employer` &lt;dbl&gt;,
## #   `2014__Non-Group` &lt;dbl&gt;, `2014__Medicaid` &lt;dbl&gt;, `2014__Medicare` &lt;dbl&gt;,
## #   `2014__Other Public` &lt;chr&gt;, `2014__Uninsured` &lt;dbl&gt;, `2014__Total` &lt;dbl&gt;,
## #   `2015__Employer` &lt;dbl&gt;, `2015__Non-Group` &lt;dbl&gt;, `2015__Medicaid` &lt;dbl&gt;,
## #   `2015__Medicare` &lt;dbl&gt;, `2015__Other Public` &lt;chr&gt;,
## #   `2015__Uninsured` &lt;dbl&gt;, `2015__Total` &lt;dbl&gt;, `2016__Employer` &lt;dbl&gt;,
## #   `2016__Non-Group` &lt;dbl&gt;, `2016__Medicaid` &lt;dbl&gt;, `2016__Medicare` &lt;dbl&gt;,
## #   `2016__Other Public` &lt;chr&gt;, `2016__Uninsured` &lt;dbl&gt;, `2016__Total` &lt;dbl&gt;</code></pre>
<p>At a glance, we see that state-level information is stored in rows (with the exception of the first row, which stores country-level information) with columns corresponding to the amount of money spent on each type of healthcare, by year.</p>
<div id="states-data" class="section level5" number="3.11.1.1.1">
<h5><span class="header-section-number">3.11.1.1.1</span> States Data</h5>
<p>To work with these data, we’ll also want to be able to switch between full state names and two letter abbreviations. There’s data in R available to you for just this purpose!</p>
<div class="sourceCode" id="cb431"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb431-1"><a href="wrangle-data.html#cb431-1"></a><span class="kw">library</span>(datasets)</span>
<span id="cb431-2"><a href="wrangle-data.html#cb431-2"></a><span class="kw">data</span>(state)</span>
<span id="cb431-3"><a href="wrangle-data.html#cb431-3"></a>state.name</span></code></pre></div>
<pre><code>##  [1] &quot;Alabama&quot;        &quot;Alaska&quot;         &quot;Arizona&quot;        &quot;Arkansas&quot;      
##  [5] &quot;California&quot;     &quot;Colorado&quot;       &quot;Connecticut&quot;    &quot;Delaware&quot;      
##  [9] &quot;Florida&quot;        &quot;Georgia&quot;        &quot;Hawaii&quot;         &quot;Idaho&quot;         
## [13] &quot;Illinois&quot;       &quot;Indiana&quot;        &quot;Iowa&quot;           &quot;Kansas&quot;        
## [17] &quot;Kentucky&quot;       &quot;Louisiana&quot;      &quot;Maine&quot;          &quot;Maryland&quot;      
## [21] &quot;Massachusetts&quot;  &quot;Michigan&quot;       &quot;Minnesota&quot;      &quot;Mississippi&quot;   
## [25] &quot;Missouri&quot;       &quot;Montana&quot;        &quot;Nebraska&quot;       &quot;Nevada&quot;        
## [29] &quot;New Hampshire&quot;  &quot;New Jersey&quot;     &quot;New Mexico&quot;     &quot;New York&quot;      
## [33] &quot;North Carolina&quot; &quot;North Dakota&quot;   &quot;Ohio&quot;           &quot;Oklahoma&quot;      
## [37] &quot;Oregon&quot;         &quot;Pennsylvania&quot;   &quot;Rhode Island&quot;   &quot;South Carolina&quot;
## [41] &quot;South Dakota&quot;   &quot;Tennessee&quot;      &quot;Texas&quot;          &quot;Utah&quot;          
## [45] &quot;Vermont&quot;        &quot;Virginia&quot;       &quot;Washington&quot;     &quot;West Virginia&quot; 
## [49] &quot;Wisconsin&quot;      &quot;Wyoming&quot;</code></pre>
<p>Before going any further, let’s add some information about Washington, D.C, the nation’s capital, which is not a state, but a territory.</p>
<div class="sourceCode" id="cb433"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb433-1"><a href="wrangle-data.html#cb433-1"></a>state.abb &lt;-<span class="st"> </span><span class="kw">c</span>(state.abb, <span class="st">&quot;DC&quot;</span>)</span>
<span id="cb433-2"><a href="wrangle-data.html#cb433-2"></a>state.region &lt;-<span class="st"> </span><span class="kw">as.factor</span>(<span class="kw">c</span>(<span class="kw">as.character</span>(state.region), <span class="st">&quot;South&quot;</span>))</span>
<span id="cb433-3"><a href="wrangle-data.html#cb433-3"></a>state.name &lt;-<span class="st"> </span><span class="kw">c</span>(state.name, <span class="st">&quot;District of Columbia&quot;</span>)</span>
<span id="cb433-4"><a href="wrangle-data.html#cb433-4"></a>state_data &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">Location =</span> state.name,</span>
<span id="cb433-5"><a href="wrangle-data.html#cb433-5"></a>                     <span class="dt">abb =</span> state.abb,</span>
<span id="cb433-6"><a href="wrangle-data.html#cb433-6"></a>                     <span class="dt">region =</span> state.region)</span>
<span id="cb433-7"><a href="wrangle-data.html#cb433-7"></a>state_data</span></code></pre></div>
<pre><code>## # A tibble: 51 x 3
##    Location    abb   region   
##    &lt;chr&gt;       &lt;chr&gt; &lt;fct&gt;    
##  1 Alabama     AL    South    
##  2 Alaska      AK    West     
##  3 Arizona     AZ    West     
##  4 Arkansas    AR    South    
##  5 California  CA    West     
##  6 Colorado    CO    West     
##  7 Connecticut CT    Northeast
##  8 Delaware    DE    South    
##  9 Florida     FL    South    
## 10 Georgia     GA    South    
## # … with 41 more rows</code></pre>
<p>If we focus in on the columns within this dataframe, we see that we have a number of different types of health care (i.e. employer, medicare, medicaid, etc.) for each year between 2013 and 2016:</p>
<div class="sourceCode" id="cb435"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb435-1"><a href="wrangle-data.html#cb435-1"></a><span class="kw">names</span>(coverage)</span></code></pre></div>
<pre><code>##  [1] &quot;Location&quot;           &quot;2013__Employer&quot;     &quot;2013__Non-Group&quot;   
##  [4] &quot;2013__Medicaid&quot;     &quot;2013__Medicare&quot;     &quot;2013__Other Public&quot;
##  [7] &quot;2013__Uninsured&quot;    &quot;2013__Total&quot;        &quot;2014__Employer&quot;    
## [10] &quot;2014__Non-Group&quot;    &quot;2014__Medicaid&quot;     &quot;2014__Medicare&quot;    
## [13] &quot;2014__Other Public&quot; &quot;2014__Uninsured&quot;    &quot;2014__Total&quot;       
## [16] &quot;2015__Employer&quot;     &quot;2015__Non-Group&quot;    &quot;2015__Medicaid&quot;    
## [19] &quot;2015__Medicare&quot;     &quot;2015__Other Public&quot; &quot;2015__Uninsured&quot;   
## [22] &quot;2015__Total&quot;        &quot;2016__Employer&quot;     &quot;2016__Non-Group&quot;   
## [25] &quot;2016__Medicaid&quot;     &quot;2016__Medicare&quot;     &quot;2016__Other Public&quot;
## [28] &quot;2016__Uninsured&quot;    &quot;2016__Total&quot;</code></pre>
<p>While a lot of information in here will be helpful, it’s not in a tidy format. This is because, each variable is not in a separate column. For example, each column includes year, the type of coverage <em>and</em> the amount spent by state. We’ll want to use each piece of information separately downstream as we start to visualize and analyze these data. So, let’s work to get these pieces of information separated out now.</p>
<p>To accomplish this, the first thing we’ll have to do is reshape the data, using the <code>pivot_longer()</code> function from the <code>tidyr</code> package. As a reminder, this function gathers multiple columns and collapses them into new name-value pairs. This transform data from wide format into a long format, where:</p>
<ul>
<li>The first argument defines the columns to gather</li>
<li>The <strong><code>names_to</code></strong> argument is the name of the new column that you are creating which contains the values of the column headings that you are gathering</li>
<li>The <strong><code>values_to</code></strong> argument is the name of the new column that will contain the values themselves; you can indicate the name of this column with the <code>values_to</code> argument.</li>
</ul>
<p>Here, we create a column titled <code>year_type</code> and <code>tot_coverage</code>, storing this newly formatted dataframe back into the variable name <code>coverage</code>. We also want to keep the Location column as it is because it also contains observational level data.</p>
<div class="sourceCode" id="cb437"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb437-1"><a href="wrangle-data.html#cb437-1"></a>coverage &lt;-<span class="st"> </span>coverage <span class="op">%&gt;%</span></span>
<span id="cb437-2"><a href="wrangle-data.html#cb437-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="kw">across</span>(<span class="kw">starts_with</span>(<span class="st">&quot;20&quot;</span>), </span>
<span id="cb437-3"><a href="wrangle-data.html#cb437-3"></a>                as.integer)) <span class="op">%&gt;%</span><span class="st">  </span><span class="co">## Convert all year-based columns to integer</span></span>
<span id="cb437-4"><a href="wrangle-data.html#cb437-4"></a><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="op">-</span>Location,         <span class="co">## Use all columns BUT &#39;Location&#39;</span></span>
<span id="cb437-5"><a href="wrangle-data.html#cb437-5"></a>               <span class="dt">names_to =</span> <span class="st">&quot;year_type&quot;</span>, </span>
<span id="cb437-6"><a href="wrangle-data.html#cb437-6"></a>               <span class="dt">values_to =</span> <span class="st">&quot;tot_coverage&quot;</span>)</span></code></pre></div>
<pre><code>## Warning: Problem with `mutate()` input `..1`.
## ℹ NAs introduced by coercion
## ℹ Input `..1` is `across(starts_with(&quot;20&quot;), as.integer)`.</code></pre>
<pre><code>## Warning in fn(col, ...): NAs introduced by coercion</code></pre>
<pre><code>## Warning: Problem with `mutate()` input `..1`.
## ℹ NAs introduced by coercion
## ℹ Input `..1` is `across(starts_with(&quot;20&quot;), as.integer)`.</code></pre>
<pre><code>## Warning in fn(col, ...): NAs introduced by coercion</code></pre>
<pre><code>## Warning: Problem with `mutate()` input `..1`.
## ℹ NAs introduced by coercion
## ℹ Input `..1` is `across(starts_with(&quot;20&quot;), as.integer)`.</code></pre>
<pre><code>## Warning in fn(col, ...): NAs introduced by coercion</code></pre>
<pre><code>## Warning: Problem with `mutate()` input `..1`.
## ℹ NAs introduced by coercion
## ℹ Input `..1` is `across(starts_with(&quot;20&quot;), as.integer)`.</code></pre>
<pre><code>## Warning in fn(col, ...): NAs introduced by coercion</code></pre>
<div class="sourceCode" id="cb446"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb446-1"><a href="wrangle-data.html#cb446-1"></a>coverage</span></code></pre></div>
<pre><code>## # A tibble: 1,456 x 3
##    Location      year_type          tot_coverage
##    &lt;chr&gt;         &lt;chr&gt;                     &lt;int&gt;
##  1 United States 2013__Employer        155696900
##  2 United States 2013__Non-Group        13816000
##  3 United States 2013__Medicaid         54919100
##  4 United States 2013__Medicare         40876300
##  5 United States 2013__Other Public      6295400
##  6 United States 2013__Uninsured        41795100
##  7 United States 2013__Total           313401200
##  8 United States 2014__Employer        154347500
##  9 United States 2014__Non-Group        19313000
## 10 United States 2014__Medicaid         61650400
## # … with 1,446 more rows</code></pre>
<p>Great! We still have <code>Location</code> stored in a single column, but we’ve separated out <code>year_type</code> and <code>tot_coverage</code> into their own columns, storing all of the information in a <strong>long</strong> data format.</p>
<p>Unfortunately, the <code>year_type</code> column still contains two pieces of information. We’ll want to separate these out to ensure that the data are in a properly tidy format. To do this, we’ll use the <code>separate()</code> function, which allows us to separate out the information stored in a single column into two columns. We’ll also use the <code>convert=TRUE</code> argument to convert the character to an integer.</p>
<div class="sourceCode" id="cb448"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb448-1"><a href="wrangle-data.html#cb448-1"></a>coverage &lt;-<span class="st"> </span>coverage <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb448-2"><a href="wrangle-data.html#cb448-2"></a><span class="st">  </span><span class="kw">separate</span>(year_type, <span class="dt">sep=</span><span class="st">&quot;__&quot;</span>, </span>
<span id="cb448-3"><a href="wrangle-data.html#cb448-3"></a>           <span class="dt">into =</span> <span class="kw">c</span>(<span class="st">&quot;year&quot;</span>, <span class="st">&quot;type&quot;</span>), </span>
<span id="cb448-4"><a href="wrangle-data.html#cb448-4"></a>           <span class="dt">convert =</span> <span class="ot">TRUE</span>)</span>
<span id="cb448-5"><a href="wrangle-data.html#cb448-5"></a></span>
<span id="cb448-6"><a href="wrangle-data.html#cb448-6"></a>coverage</span></code></pre></div>
<pre><code>## # A tibble: 1,456 x 4
##    Location       year type         tot_coverage
##    &lt;chr&gt;         &lt;int&gt; &lt;chr&gt;               &lt;int&gt;
##  1 United States  2013 Employer        155696900
##  2 United States  2013 Non-Group        13816000
##  3 United States  2013 Medicaid         54919100
##  4 United States  2013 Medicare         40876300
##  5 United States  2013 Other Public      6295400
##  6 United States  2013 Uninsured        41795100
##  7 United States  2013 Total           313401200
##  8 United States  2014 Employer        154347500
##  9 United States  2014 Non-Group        19313000
## 10 United States  2014 Medicaid         61650400
## # … with 1,446 more rows</code></pre>
<p>Perfect! We now have the four columns we wanted, each storing a separate piece of information, <em>and</em> the year column is an integer, as you would want it to be!</p>
<p>Let’s go one step further and add in the state-level abbreviations and region for each row. We’ll utilize our <code>state</code> datasets that we read in previously to accomplish this! Because we formatted the state data as a tibble, we can simply join it with our <code>coverage</code> dataset to get the state and region information.</p>
<div class="sourceCode" id="cb450"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb450-1"><a href="wrangle-data.html#cb450-1"></a>coverage &lt;-<span class="st"> </span>coverage <span class="op">%&gt;%</span></span>
<span id="cb450-2"><a href="wrangle-data.html#cb450-2"></a><span class="st">  </span><span class="kw">left_join</span>(state_data, <span class="dt">by =</span> <span class="st">&quot;Location&quot;</span>)</span>
<span id="cb450-3"><a href="wrangle-data.html#cb450-3"></a></span>
<span id="cb450-4"><a href="wrangle-data.html#cb450-4"></a>coverage</span></code></pre></div>
<pre><code>## # A tibble: 1,456 x 6
##    Location       year type         tot_coverage abb   region
##    &lt;chr&gt;         &lt;int&gt; &lt;chr&gt;               &lt;int&gt; &lt;chr&gt; &lt;fct&gt; 
##  1 United States  2013 Employer        155696900 &lt;NA&gt;  &lt;NA&gt;  
##  2 United States  2013 Non-Group        13816000 &lt;NA&gt;  &lt;NA&gt;  
##  3 United States  2013 Medicaid         54919100 &lt;NA&gt;  &lt;NA&gt;  
##  4 United States  2013 Medicare         40876300 &lt;NA&gt;  &lt;NA&gt;  
##  5 United States  2013 Other Public      6295400 &lt;NA&gt;  &lt;NA&gt;  
##  6 United States  2013 Uninsured        41795100 &lt;NA&gt;  &lt;NA&gt;  
##  7 United States  2013 Total           313401200 &lt;NA&gt;  &lt;NA&gt;  
##  8 United States  2014 Employer        154347500 &lt;NA&gt;  &lt;NA&gt;  
##  9 United States  2014 Non-Group        19313000 &lt;NA&gt;  &lt;NA&gt;  
## 10 United States  2014 Medicaid         61650400 &lt;NA&gt;  &lt;NA&gt;  
## # … with 1,446 more rows</code></pre>
<p>Perfect! At this point, each row is an observation and each column stores a single piece of information. This dataset is now in good shape!</p>
</div>
</div>
<div id="healthcare-spending-data-1" class="section level4" number="3.11.1.2">
<h4><span class="header-section-number">3.11.1.2</span> Healthcare Spending Data</h4>
<p>We’ll have to take a similar approach when it comes to tidying the spending data as it has a similar structure to how the coverage data were stored.</p>
<div class="sourceCode" id="cb452"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb452-1"><a href="wrangle-data.html#cb452-1"></a>spending</span></code></pre></div>
<pre><code>## # A tibble: 52 x 25
##    Location `1991__Total He… `1992__Total He… `1993__Total He… `1994__Total He…
##    &lt;chr&gt;               &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;
##  1 United …           675896           731455           778684           820172
##  2 Alabama             10393            11284            12028            12742
##  3 Alaska               1458             1558             1661             1728
##  4 Arizona              9269             9815            10655            11364
##  5 Arkansas             5632             6022             6397             6810
##  6 Califor…            81438            87949            91963            94245
##  7 Colorado             8460             9215             9803            10382
##  8 Connect…            10950            11635            12081            12772
##  9 Delaware             1938             2111             2285             2489
## 10 Distric…             2800             3098             3240             3255
## # … with 42 more rows, and 20 more variables: `1995__Total Health
## #   Spending` &lt;dbl&gt;, `1996__Total Health Spending` &lt;dbl&gt;, `1997__Total Health
## #   Spending` &lt;dbl&gt;, `1998__Total Health Spending` &lt;dbl&gt;, `1999__Total Health
## #   Spending` &lt;dbl&gt;, `2000__Total Health Spending` &lt;dbl&gt;, `2001__Total Health
## #   Spending` &lt;dbl&gt;, `2002__Total Health Spending` &lt;dbl&gt;, `2003__Total Health
## #   Spending` &lt;dbl&gt;, `2004__Total Health Spending` &lt;dbl&gt;, `2005__Total Health
## #   Spending` &lt;dbl&gt;, `2006__Total Health Spending` &lt;dbl&gt;, `2007__Total Health
## #   Spending` &lt;dbl&gt;, `2008__Total Health Spending` &lt;dbl&gt;, `2009__Total Health
## #   Spending` &lt;dbl&gt;, `2010__Total Health Spending` &lt;dbl&gt;, `2011__Total Health
## #   Spending` &lt;dbl&gt;, `2012__Total Health Spending` &lt;dbl&gt;, `2013__Total Health
## #   Spending` &lt;dbl&gt;, `2014__Total Health Spending` &lt;dbl&gt;</code></pre>
<p>Here, we reshape the data using <code>year</code> and <code>tot_spending</code> for the key and value. We also want to keep <code>Location</code> like before. Then, in the <code>separate()</code> function, we create two new columns called <code>year</code> and <code>name.</code> Then, we ask to return all the columns, <em>except</em> name. To select all the columns except a specific column, use the <code>-</code> (subtraction) operator. (This process is also referred to as negative indexing.)</p>
<div class="sourceCode" id="cb454"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb454-1"><a href="wrangle-data.html#cb454-1"></a><span class="co"># take spending data from wide to long</span></span>
<span id="cb454-2"><a href="wrangle-data.html#cb454-2"></a>spending &lt;-<span class="st"> </span>spending <span class="op">%&gt;%</span></span>
<span id="cb454-3"><a href="wrangle-data.html#cb454-3"></a><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="op">-</span>Location, </span>
<span id="cb454-4"><a href="wrangle-data.html#cb454-4"></a>               <span class="dt">names_to =</span> <span class="st">&quot;year&quot;</span>, </span>
<span id="cb454-5"><a href="wrangle-data.html#cb454-5"></a>               <span class="dt">values_to =</span> <span class="st">&quot;tot_spending&quot;</span>)</span>
<span id="cb454-6"><a href="wrangle-data.html#cb454-6"></a></span>
<span id="cb454-7"><a href="wrangle-data.html#cb454-7"></a><span class="co"># separate year and name columns</span></span>
<span id="cb454-8"><a href="wrangle-data.html#cb454-8"></a>spending &lt;-<span class="st"> </span>spending <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb454-9"><a href="wrangle-data.html#cb454-9"></a><span class="st">  </span><span class="kw">separate</span>(year, <span class="dt">sep=</span><span class="st">&quot;__&quot;</span>, </span>
<span id="cb454-10"><a href="wrangle-data.html#cb454-10"></a>           <span class="dt">into =</span> <span class="kw">c</span>(<span class="st">&quot;year&quot;</span>, <span class="st">&quot;name&quot;</span>), </span>
<span id="cb454-11"><a href="wrangle-data.html#cb454-11"></a>           <span class="dt">convert =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb454-12"><a href="wrangle-data.html#cb454-12"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>name)</span>
<span id="cb454-13"><a href="wrangle-data.html#cb454-13"></a></span>
<span id="cb454-14"><a href="wrangle-data.html#cb454-14"></a><span class="co"># look at the data</span></span>
<span id="cb454-15"><a href="wrangle-data.html#cb454-15"></a>spending</span></code></pre></div>
<pre><code>## # A tibble: 1,248 x 3
##    Location       year tot_spending
##    &lt;chr&gt;         &lt;int&gt;        &lt;dbl&gt;
##  1 United States  1991       675896
##  2 United States  1992       731455
##  3 United States  1993       778684
##  4 United States  1994       820172
##  5 United States  1995       869578
##  6 United States  1996       917540
##  7 United States  1997       969531
##  8 United States  1998      1026103
##  9 United States  1999      1086280
## 10 United States  2000      1162035
## # … with 1,238 more rows</code></pre>
<p>Perfect, we have a tidy dataset and the type of information stored in each column is appropriate for the information being stored in the column!</p>
</div>
<div id="join-the-data" class="section level4" number="3.11.1.3">
<h4><span class="header-section-number">3.11.1.3</span> Join the Data</h4>
<p>At this point, we have a <code>coverage</code> dataset and a <code>spending</code> dataset, but ultimately, we want all of this information in a single tidy data frame. To do this, we’ll have to join the datasets together.</p>
<p>We have to decide what type of join we want to do. For our questions, we only want information from years that are found in both the <code>coverage</code> and the <code>spending</code> datasets. This means that we’ll want to do an <code>inner_join()</code>. This will keep the data from the intersection of years from <code>coverage</code> and <code>spending</code> (meaning only 2013 and 2014). We’ll store this in a new variable: <code>hc</code>.</p>
<div class="sourceCode" id="cb456"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb456-1"><a href="wrangle-data.html#cb456-1"></a><span class="co"># inner join to combine data frames</span></span>
<span id="cb456-2"><a href="wrangle-data.html#cb456-2"></a>hc &lt;-<span class="st"> </span><span class="kw">inner_join</span>(coverage, spending, </span>
<span id="cb456-3"><a href="wrangle-data.html#cb456-3"></a>                 <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;Location&quot;</span>, <span class="st">&quot;year&quot;</span>))</span>
<span id="cb456-4"><a href="wrangle-data.html#cb456-4"></a></span>
<span id="cb456-5"><a href="wrangle-data.html#cb456-5"></a>hc</span></code></pre></div>
<pre><code>## # A tibble: 728 x 7
##    Location       year type         tot_coverage abb   region tot_spending
##    &lt;chr&gt;         &lt;int&gt; &lt;chr&gt;               &lt;int&gt; &lt;chr&gt; &lt;fct&gt;         &lt;dbl&gt;
##  1 United States  2013 Employer        155696900 &lt;NA&gt;  &lt;NA&gt;        2435624
##  2 United States  2013 Non-Group        13816000 &lt;NA&gt;  &lt;NA&gt;        2435624
##  3 United States  2013 Medicaid         54919100 &lt;NA&gt;  &lt;NA&gt;        2435624
##  4 United States  2013 Medicare         40876300 &lt;NA&gt;  &lt;NA&gt;        2435624
##  5 United States  2013 Other Public      6295400 &lt;NA&gt;  &lt;NA&gt;        2435624
##  6 United States  2013 Uninsured        41795100 &lt;NA&gt;  &lt;NA&gt;        2435624
##  7 United States  2013 Total           313401200 &lt;NA&gt;  &lt;NA&gt;        2435624
##  8 United States  2014 Employer        154347500 &lt;NA&gt;  &lt;NA&gt;        2562824
##  9 United States  2014 Non-Group        19313000 &lt;NA&gt;  &lt;NA&gt;        2562824
## 10 United States  2014 Medicaid         61650400 &lt;NA&gt;  &lt;NA&gt;        2562824
## # … with 718 more rows</code></pre>
<p>Great, we’ve combined the information in our datasets. But, we’ve got a bit of extraneous information remaining. For example, we want to look only at the state-level. So, let’s filter out the country-level summary row:</p>
<div class="sourceCode" id="cb458"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb458-1"><a href="wrangle-data.html#cb458-1"></a><span class="co"># filter to only include state level</span></span>
<span id="cb458-2"><a href="wrangle-data.html#cb458-2"></a>hc &lt;-<span class="st"> </span>hc <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb458-3"><a href="wrangle-data.html#cb458-3"></a><span class="st">  </span><span class="kw">filter</span>(Location <span class="op">!=</span><span class="st"> &quot;United States&quot;</span>)</span></code></pre></div>
<p>Another problem is that inside our <code>hc</code> dataset, there are multiple types of healthcare coverage.</p>
<div class="sourceCode" id="cb459"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb459-1"><a href="wrangle-data.html#cb459-1"></a><span class="kw">table</span>(hc<span class="op">$</span>type)</span></code></pre></div>
<pre><code>## 
##     Employer     Medicaid     Medicare    Non-Group Other Public        Total 
##          102          102          102          102          102          102 
##    Uninsured 
##          102</code></pre>
<p>The “Total” type is not really a formal type of healthcare coverage. It really represents just the total number of people in the state. This is useful information and we can include it as a column called <code>tot_pop</code>. To accomplish this, we’ll first store this information in a data frame called <code>pop</code>.</p>
<div class="sourceCode" id="cb461"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb461-1"><a href="wrangle-data.html#cb461-1"></a>pop &lt;-<span class="st"> </span>hc <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb461-2"><a href="wrangle-data.html#cb461-2"></a><span class="st">  </span><span class="kw">filter</span>(type <span class="op">==</span><span class="st"> &quot;Total&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb461-3"><a href="wrangle-data.html#cb461-3"></a><span class="st">  </span><span class="kw">select</span>(Location, year, tot_coverage)</span>
<span id="cb461-4"><a href="wrangle-data.html#cb461-4"></a></span>
<span id="cb461-5"><a href="wrangle-data.html#cb461-5"></a>pop</span></code></pre></div>
<pre><code>## # A tibble: 102 x 3
##    Location    year tot_coverage
##    &lt;chr&gt;      &lt;int&gt;        &lt;int&gt;
##  1 Alabama     2013      4763900
##  2 Alabama     2014      4768000
##  3 Alaska      2013       702000
##  4 Alaska      2014       695700
##  5 Arizona     2013      6603100
##  6 Arizona     2014      6657200
##  7 Arkansas    2013      2904800
##  8 Arkansas    2014      2896000
##  9 California  2013     38176400
## 10 California  2014     38701300
## # … with 92 more rows</code></pre>
<p>We can then, using a <code>left_join</code> to ensure we keep all of the rows in the <code>hc</code> data frame in tact, add this population level information while simultaneously removing the rows where <code>type</code> is “Total” from the dataset. Finally, we’ll rename the columns to be informative of the information stored within:</p>
<div class="sourceCode" id="cb463"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb463-1"><a href="wrangle-data.html#cb463-1"></a><span class="co"># ad population level information</span></span>
<span id="cb463-2"><a href="wrangle-data.html#cb463-2"></a>hc &lt;-<span class="st"> </span>hc <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb463-3"><a href="wrangle-data.html#cb463-3"></a><span class="st">  </span><span class="kw">filter</span>(type <span class="op">!=</span><span class="st"> &quot;Total&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb463-4"><a href="wrangle-data.html#cb463-4"></a><span class="st">  </span><span class="kw">left_join</span>(pop, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;Location&quot;</span>, <span class="st">&quot;year&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb463-5"><a href="wrangle-data.html#cb463-5"></a><span class="st">  </span><span class="kw">rename</span>(<span class="dt">tot_coverage =</span> tot_coverage.x, </span>
<span id="cb463-6"><a href="wrangle-data.html#cb463-6"></a>         <span class="dt">tot_pop =</span> tot_coverage.y)</span>
<span id="cb463-7"><a href="wrangle-data.html#cb463-7"></a></span>
<span id="cb463-8"><a href="wrangle-data.html#cb463-8"></a>hc</span></code></pre></div>
<pre><code>## # A tibble: 612 x 8
##    Location  year type         tot_coverage abb   region tot_spending tot_pop
##    &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;               &lt;int&gt; &lt;chr&gt; &lt;fct&gt;         &lt;dbl&gt;   &lt;int&gt;
##  1 Alabama   2013 Employer          2126500 AL    South         33788 4763900
##  2 Alabama   2013 Non-Group          174200 AL    South         33788 4763900
##  3 Alabama   2013 Medicaid           869700 AL    South         33788 4763900
##  4 Alabama   2013 Medicare           783000 AL    South         33788 4763900
##  5 Alabama   2013 Other Public        85600 AL    South         33788 4763900
##  6 Alabama   2013 Uninsured          724800 AL    South         33788 4763900
##  7 Alabama   2014 Employer          2202800 AL    South         35263 4768000
##  8 Alabama   2014 Non-Group          288900 AL    South         35263 4768000
##  9 Alabama   2014 Medicaid           891900 AL    South         35263 4768000
## 10 Alabama   2014 Medicare           718400 AL    South         35263 4768000
## # … with 602 more rows</code></pre>
<p>From here, instead of only storing the absolute number of people who are covered (<code>tot_coverage</code>), we will calculate the proportion of people who are coverage in each state, year and type, storing this information in <code>prop_coverage</code>.</p>
<div class="sourceCode" id="cb465"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb465-1"><a href="wrangle-data.html#cb465-1"></a><span class="co"># add proportion covered</span></span>
<span id="cb465-2"><a href="wrangle-data.html#cb465-2"></a>hc &lt;-<span class="st"> </span>hc <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb465-3"><a href="wrangle-data.html#cb465-3"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">prop_coverage =</span> tot_coverage<span class="op">/</span>tot_pop) </span>
<span id="cb465-4"><a href="wrangle-data.html#cb465-4"></a></span>
<span id="cb465-5"><a href="wrangle-data.html#cb465-5"></a>hc</span></code></pre></div>
<pre><code>## # A tibble: 612 x 9
##    Location  year type  tot_coverage abb   region tot_spending tot_pop
##    &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;        &lt;int&gt; &lt;chr&gt; &lt;fct&gt;         &lt;dbl&gt;   &lt;int&gt;
##  1 Alabama   2013 Empl…      2126500 AL    South         33788 4763900
##  2 Alabama   2013 Non-…       174200 AL    South         33788 4763900
##  3 Alabama   2013 Medi…       869700 AL    South         33788 4763900
##  4 Alabama   2013 Medi…       783000 AL    South         33788 4763900
##  5 Alabama   2013 Othe…        85600 AL    South         33788 4763900
##  6 Alabama   2013 Unin…       724800 AL    South         33788 4763900
##  7 Alabama   2014 Empl…      2202800 AL    South         35263 4768000
##  8 Alabama   2014 Non-…       288900 AL    South         35263 4768000
##  9 Alabama   2014 Medi…       891900 AL    South         35263 4768000
## 10 Alabama   2014 Medi…       718400 AL    South         35263 4768000
## # … with 602 more rows, and 1 more variable: prop_coverage &lt;dbl&gt;</code></pre>
<p>The <code>tot_spending</code> column is reported in millions (1e6). Therefore, to calculate <code>spending_capita</code> we will need to adjust for this scaling factor to report it on the original scale (just dollars) and then divide by <code>tot_pop.</code> We can again use <code>mutate()</code> to accomplish this:</p>
<div class="sourceCode" id="cb467"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb467-1"><a href="wrangle-data.html#cb467-1"></a><span class="co"># get spending capita in dollars</span></span>
<span id="cb467-2"><a href="wrangle-data.html#cb467-2"></a>hc &lt;-<span class="st"> </span>hc <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb467-3"><a href="wrangle-data.html#cb467-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">spending_capita =</span> (tot_spending<span class="op">*</span><span class="fl">1e6</span>) <span class="op">/</span><span class="st"> </span>tot_pop)</span>
<span id="cb467-4"><a href="wrangle-data.html#cb467-4"></a></span>
<span id="cb467-5"><a href="wrangle-data.html#cb467-5"></a>hc</span></code></pre></div>
<pre><code>## # A tibble: 612 x 10
##    Location  year type  tot_coverage abb   region tot_spending tot_pop
##    &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;        &lt;int&gt; &lt;chr&gt; &lt;fct&gt;         &lt;dbl&gt;   &lt;int&gt;
##  1 Alabama   2013 Empl…      2126500 AL    South         33788 4763900
##  2 Alabama   2013 Non-…       174200 AL    South         33788 4763900
##  3 Alabama   2013 Medi…       869700 AL    South         33788 4763900
##  4 Alabama   2013 Medi…       783000 AL    South         33788 4763900
##  5 Alabama   2013 Othe…        85600 AL    South         33788 4763900
##  6 Alabama   2013 Unin…       724800 AL    South         33788 4763900
##  7 Alabama   2014 Empl…      2202800 AL    South         35263 4768000
##  8 Alabama   2014 Non-…       288900 AL    South         35263 4768000
##  9 Alabama   2014 Medi…       891900 AL    South         35263 4768000
## 10 Alabama   2014 Medi…       718400 AL    South         35263 4768000
## # … with 602 more rows, and 2 more variables: prop_coverage &lt;dbl&gt;,
## #   spending_capita &lt;dbl&gt;</code></pre>
<p>Yes! At this point we have a single tidy data frame storing all the information we’ll need to answer our questions!</p>
<p>Let’s save our new tidy data for case study #1.</p>
<div class="sourceCode" id="cb469"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb469-1"><a href="wrangle-data.html#cb469-1"></a><span class="kw">save</span>(hc, <span class="dt">file =</span> here<span class="op">::</span><span class="kw">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;tidy_data&quot;</span>, <span class="st">&quot;case_study_1_tidy.rda&quot;</span>))</span></code></pre></div>
</div>
</div>
<div id="case-study-2-firearms-2" class="section level3" number="3.11.2">
<h3><span class="header-section-number">3.11.2</span> Case Study #2: Firearms</h3>
<p>For our second case study, we’re interested in the following question: At the state-level, what is the relationship between firearm legislation strength and annual rate of fatal police shootings? Time to wrangle <em>all</em> those many datasets we read in previously!</p>
<div id="census-data-1" class="section level4" number="3.11.2.1">
<h4><span class="header-section-number">3.11.2.1</span> Census Data</h4>
<p>Let’s take a look at the raw data to remind ourselves of what information we have:</p>
<div class="sourceCode" id="cb470"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb470-1"><a href="wrangle-data.html#cb470-1"></a>census</span></code></pre></div>
<pre><code>## # A tibble: 236,844 x 19
##    SUMLEV REGION DIVISION STATE NAME    SEX ORIGIN  RACE   AGE CENSUS2010POP
##    &lt;chr&gt;   &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;         &lt;dbl&gt;
##  1 040         3        6 01    Alab…     0      0     1     0         37991
##  2 040         3        6 01    Alab…     0      0     1     1         38150
##  3 040         3        6 01    Alab…     0      0     1     2         39738
##  4 040         3        6 01    Alab…     0      0     1     3         39827
##  5 040         3        6 01    Alab…     0      0     1     4         39353
##  6 040         3        6 01    Alab…     0      0     1     5         39520
##  7 040         3        6 01    Alab…     0      0     1     6         39813
##  8 040         3        6 01    Alab…     0      0     1     7         39695
##  9 040         3        6 01    Alab…     0      0     1     8         40012
## 10 040         3        6 01    Alab…     0      0     1     9         42073
## # … with 236,834 more rows, and 9 more variables: ESTIMATESBASE2010 &lt;dbl&gt;,
## #   POPESTIMATE2010 &lt;dbl&gt;, POPESTIMATE2011 &lt;dbl&gt;, POPESTIMATE2012 &lt;dbl&gt;,
## #   POPESTIMATE2013 &lt;dbl&gt;, POPESTIMATE2014 &lt;dbl&gt;, POPESTIMATE2015 &lt;dbl&gt;,
## #   POPESTIMATE2016 &lt;dbl&gt;, POPESTIMATE2017 &lt;dbl&gt;</code></pre>
<p>These data look reasonably tidy to start; however, the information stored in each column is not particularly clear at a glance. For example, what is a RACE of 1? What does that mean?</p>
<p>Well, if we look at the data dictionary in the document <a href="https://github.com/opencasestudies/ocs-police-shootings-firearm-legislation/blob/master/data/sc-est2017-alldata6.pdf">sc-est2017-alldata6.pdf</a>, we learn that:</p>
<p>The key for <code>SEX</code> is as follows:
- 0 = Total
- 1 = Male
- 2 = Female</p>
<p>The key for <code>ORIGIN</code> is as follows:
- 0 = Total
- 1 = Not Hispanic
- 2 = Hispanic</p>
<p>The key for <code>RACE</code> is as follows:
- 1 = White Alone
- 2 = Black or African American Alone
- 3 = American Indian and Alaska Native Alone
- 4 = Asian Alone
- 5 = Native Hawaiian and Other Pacific Islander Alone
- 6 = Two or more races</p>
<p>With that information in mind, we can then use the <code>dplyr</code> package to <code>filter</code>, <code>group_by</code>, and <code>summarize</code> the data in order to calculate the necessary statistics we’ll need to answer our question.</p>
<p>For each state, we add rows in the column <code>POPESTIMATE2015</code> since we are looking at the year <code>2015.</code> Setting the <code>ORIGIN</code> or <code>SEX</code> equal to 0 ensures we don’t add duplicate data, since 0 is the key for both Hispanic and non Hispanic residents and total male and female residents. We group by each state since all data in this study should be at the state level.</p>
<p>We store each of these pieces of information in its own column within the new dataframe we’ve created <code>census_stats</code></p>
<div class="sourceCode" id="cb472"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb472-1"><a href="wrangle-data.html#cb472-1"></a><span class="co"># summarize by ethnicity</span></span>
<span id="cb472-2"><a href="wrangle-data.html#cb472-2"></a>census_stats &lt;-<span class="st"> </span>census <span class="op">%&gt;%</span></span>
<span id="cb472-3"><a href="wrangle-data.html#cb472-3"></a><span class="st">  </span><span class="kw">filter</span>(ORIGIN <span class="op">==</span><span class="st"> </span><span class="dv">0</span>, SEX <span class="op">==</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span></span>
<span id="cb472-4"><a href="wrangle-data.html#cb472-4"></a><span class="st">  </span><span class="kw">group_by</span>(NAME) <span class="op">%&gt;%</span></span>
<span id="cb472-5"><a href="wrangle-data.html#cb472-5"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">white =</span> <span class="kw">sum</span>(POPESTIMATE2015[RACE <span class="op">==</span><span class="st"> </span><span class="dv">1</span>])<span class="op">/</span><span class="kw">sum</span>(POPESTIMATE2015)<span class="op">*</span><span class="dv">100</span>,</span>
<span id="cb472-6"><a href="wrangle-data.html#cb472-6"></a>            <span class="dt">black =</span> <span class="kw">sum</span>(POPESTIMATE2015[RACE <span class="op">==</span><span class="st"> </span><span class="dv">2</span>])<span class="op">/</span><span class="kw">sum</span>(POPESTIMATE2015)<span class="op">*</span><span class="dv">100</span>)</span></code></pre></div>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<div class="sourceCode" id="cb474"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb474-1"><a href="wrangle-data.html#cb474-1"></a><span class="co"># add hispanic information</span></span>
<span id="cb474-2"><a href="wrangle-data.html#cb474-2"></a>census_stats<span class="op">$</span>hispanic &lt;-<span class="st"> </span>census <span class="op">%&gt;%</span></span>
<span id="cb474-3"><a href="wrangle-data.html#cb474-3"></a><span class="st">  </span><span class="kw">filter</span>(SEX <span class="op">==</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb474-4"><a href="wrangle-data.html#cb474-4"></a><span class="st">  </span><span class="kw">group_by</span>(NAME) <span class="op">%&gt;%</span></span>
<span id="cb474-5"><a href="wrangle-data.html#cb474-5"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">x =</span> <span class="kw">sum</span>(POPESTIMATE2015[ORIGIN <span class="op">==</span><span class="st"> </span><span class="dv">2</span>])<span class="op">/</span><span class="kw">sum</span>(POPESTIMATE2015[ORIGIN <span class="op">==</span><span class="st"> </span><span class="dv">0</span>])<span class="op">*</span><span class="dv">100</span>) <span class="op">%&gt;%</span></span>
<span id="cb474-6"><a href="wrangle-data.html#cb474-6"></a><span class="st">  </span><span class="kw">pull</span>(x)</span></code></pre></div>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<div class="sourceCode" id="cb476"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb476-1"><a href="wrangle-data.html#cb476-1"></a><span class="co"># add male information</span></span>
<span id="cb476-2"><a href="wrangle-data.html#cb476-2"></a>census_stats<span class="op">$</span>male &lt;-<span class="st"> </span>census <span class="op">%&gt;%</span></span>
<span id="cb476-3"><a href="wrangle-data.html#cb476-3"></a><span class="st">  </span><span class="kw">filter</span>(ORIGIN <span class="op">==</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span></span>
<span id="cb476-4"><a href="wrangle-data.html#cb476-4"></a><span class="st">  </span><span class="kw">group_by</span>(NAME) <span class="op">%&gt;%</span></span>
<span id="cb476-5"><a href="wrangle-data.html#cb476-5"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">x =</span> <span class="kw">sum</span>(POPESTIMATE2015[SEX <span class="op">==</span><span class="st"> </span><span class="dv">1</span>])<span class="op">/</span><span class="kw">sum</span>(POPESTIMATE2015[SEX <span class="op">==</span><span class="st"> </span><span class="dv">0</span>])<span class="op">*</span><span class="dv">100</span>) <span class="op">%&gt;%</span></span>
<span id="cb476-6"><a href="wrangle-data.html#cb476-6"></a><span class="st">  </span><span class="kw">pull</span>(x)</span></code></pre></div>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<div class="sourceCode" id="cb478"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb478-1"><a href="wrangle-data.html#cb478-1"></a><span class="co"># add total population information</span></span>
<span id="cb478-2"><a href="wrangle-data.html#cb478-2"></a>census_stats<span class="op">$</span>total_pop &lt;-<span class="st"> </span>census <span class="op">%&gt;%</span></span>
<span id="cb478-3"><a href="wrangle-data.html#cb478-3"></a><span class="st">  </span><span class="kw">filter</span>(ORIGIN <span class="op">==</span><span class="st"> </span><span class="dv">0</span>, SEX <span class="op">==</span><span class="st"> </span><span class="dv">0</span> ) <span class="op">%&gt;%</span></span>
<span id="cb478-4"><a href="wrangle-data.html#cb478-4"></a><span class="st">  </span><span class="kw">group_by</span>(NAME) <span class="op">%&gt;%</span></span>
<span id="cb478-5"><a href="wrangle-data.html#cb478-5"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">total =</span> <span class="kw">sum</span>(POPESTIMATE2015)) <span class="op">%&gt;%</span></span>
<span id="cb478-6"><a href="wrangle-data.html#cb478-6"></a><span class="st">  </span><span class="kw">pull</span>(total)</span></code></pre></div>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<div class="sourceCode" id="cb480"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb480-1"><a href="wrangle-data.html#cb480-1"></a><span class="co"># lowercase state name for consistency</span></span>
<span id="cb480-2"><a href="wrangle-data.html#cb480-2"></a>census_stats<span class="op">$</span>NAME &lt;-<span class="st"> </span><span class="kw">tolower</span>(census_stats<span class="op">$</span>NAME)</span>
<span id="cb480-3"><a href="wrangle-data.html#cb480-3"></a></span>
<span id="cb480-4"><a href="wrangle-data.html#cb480-4"></a>census_stats</span></code></pre></div>
<pre><code>## # A tibble: 51 x 6
##    NAME                 white black hispanic  male total_pop
##    &lt;chr&gt;                &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;
##  1 alabama               69.5 26.7      4.13  48.5   4850858
##  2 alaska                66.5  3.67     6.82  52.4    737979
##  3 arizona               83.5  4.80    30.9   49.7   6802262
##  4 arkansas              79.6 15.7      7.18  49.1   2975626
##  5 california            73.0  6.49    38.7   49.7  39032444
##  6 colorado              87.6  4.47    21.3   50.3   5440445
##  7 connecticut           80.9 11.6     15.3   48.8   3593862
##  8 delaware              70.3 22.5      8.96  48.4    944107
##  9 district of columbia  44.1 48.5     10.7   47.4    672736
## 10 florida               77.7 16.9     24.7   48.9  20268567
## # … with 41 more rows</code></pre>
<p>We can approach the age data similarly, where we get the number of people within each state at each age:</p>
<div class="sourceCode" id="cb482"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb482-1"><a href="wrangle-data.html#cb482-1"></a><span class="co"># get state-level age information</span></span>
<span id="cb482-2"><a href="wrangle-data.html#cb482-2"></a>age_stats &lt;-<span class="st"> </span>census <span class="op">%&gt;%</span></span>
<span id="cb482-3"><a href="wrangle-data.html#cb482-3"></a><span class="st">  </span><span class="kw">filter</span>(ORIGIN <span class="op">==</span><span class="st"> </span><span class="dv">0</span>, SEX <span class="op">==</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span></span>
<span id="cb482-4"><a href="wrangle-data.html#cb482-4"></a><span class="st">  </span><span class="kw">group_by</span>(NAME, AGE) <span class="op">%&gt;%</span></span>
<span id="cb482-5"><a href="wrangle-data.html#cb482-5"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">sum_ages =</span> <span class="kw">sum</span>(POPESTIMATE2015))</span></code></pre></div>
<pre><code>## `summarise()` regrouping output by &#39;NAME&#39; (override with `.groups` argument)</code></pre>
<div class="sourceCode" id="cb484"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb484-1"><a href="wrangle-data.html#cb484-1"></a>age_stats</span></code></pre></div>
<pre><code>## # A tibble: 4,386 x 3
## # Groups:   NAME [51]
##    NAME      AGE sum_ages
##    &lt;chr&gt;   &lt;dbl&gt;    &lt;dbl&gt;
##  1 Alabama     0    59080
##  2 Alabama     1    58738
##  3 Alabama     2    57957
##  4 Alabama     3    58800
##  5 Alabama     4    59329
##  6 Alabama     5    59610
##  7 Alabama     6    59977
##  8 Alabama     7    62282
##  9 Alabama     8    62175
## 10 Alabama     9    61249
## # … with 4,376 more rows</code></pre>
<p>This information is in a long format, but it likely makes more sense to store this information in a wide format, where each column is a different state and each row is an age. To do this:</p>
<div class="sourceCode" id="cb486"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb486-1"><a href="wrangle-data.html#cb486-1"></a>age_stats &lt;-<span class="st"> </span>age_stats <span class="op">%&gt;%</span></span>
<span id="cb486-2"><a href="wrangle-data.html#cb486-2"></a><span class="st">  </span><span class="kw">pivot_wider</span>(<span class="dt">names_from =</span> <span class="st">&quot;NAME&quot;</span>,</span>
<span id="cb486-3"><a href="wrangle-data.html#cb486-3"></a>              <span class="dt">values_from =</span> <span class="st">&quot;sum_ages&quot;</span>)</span>
<span id="cb486-4"><a href="wrangle-data.html#cb486-4"></a>  </span>
<span id="cb486-5"><a href="wrangle-data.html#cb486-5"></a>age_stats</span></code></pre></div>
<pre><code>## # A tibble: 86 x 52
##      AGE Alabama Alaska Arizona Arkansas California Colorado Connecticut
##    &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt;       &lt;dbl&gt;
##  1     0   59080  11253   86653    38453     500834    66222       36414
##  2     1   58738  11109   86758    38005     499070    66528       36559
##  3     2   57957  11009   86713    37711     499614    66144       36887
##  4     3   58800  10756   86914    38381     498536    67065       37745
##  5     4   59329  10895   87624    38443     510026    68443       38962
##  6     5   59610  10537   87234    38582     498754    69823       39182
##  7     6   59977  10352   89215    38630     497444    69691       39871
##  8     7   62282  10431   93236    40141     516916    71415       41438
##  9     8   62175  10302   93866    40677     518117    72384       42359
## 10     9   61249  10055   92531    39836     511610    72086       43032
## # … with 76 more rows, and 44 more variables: Delaware &lt;dbl&gt;, `District of
## #   Columbia` &lt;dbl&gt;, Florida &lt;dbl&gt;, Georgia &lt;dbl&gt;, Hawaii &lt;dbl&gt;, Idaho &lt;dbl&gt;,
## #   Illinois &lt;dbl&gt;, Indiana &lt;dbl&gt;, Iowa &lt;dbl&gt;, Kansas &lt;dbl&gt;, Kentucky &lt;dbl&gt;,
## #   Louisiana &lt;dbl&gt;, Maine &lt;dbl&gt;, Maryland &lt;dbl&gt;, Massachusetts &lt;dbl&gt;,
## #   Michigan &lt;dbl&gt;, Minnesota &lt;dbl&gt;, Mississippi &lt;dbl&gt;, Missouri &lt;dbl&gt;,
## #   Montana &lt;dbl&gt;, Nebraska &lt;dbl&gt;, Nevada &lt;dbl&gt;, `New Hampshire` &lt;dbl&gt;, `New
## #   Jersey` &lt;dbl&gt;, `New Mexico` &lt;dbl&gt;, `New York` &lt;dbl&gt;, `North
## #   Carolina` &lt;dbl&gt;, `North Dakota` &lt;dbl&gt;, Ohio &lt;dbl&gt;, Oklahoma &lt;dbl&gt;,
## #   Oregon &lt;dbl&gt;, Pennsylvania &lt;dbl&gt;, `Rhode Island` &lt;dbl&gt;, `South
## #   Carolina` &lt;dbl&gt;, `South Dakota` &lt;dbl&gt;, Tennessee &lt;dbl&gt;, Texas &lt;dbl&gt;,
## #   Utah &lt;dbl&gt;, Vermont &lt;dbl&gt;, Virginia &lt;dbl&gt;, Washington &lt;dbl&gt;, `West
## #   Virginia` &lt;dbl&gt;, Wisconsin &lt;dbl&gt;, Wyoming &lt;dbl&gt;</code></pre>
<p>Now that we’ve made the data easier to work with, we need to find a way to get the median. One method is to take the cumulative sum of each column and then divide all the rows by the last row in each respective column, calculating a percentile/quantile for each age. To do this, we first remove the AGE column, as we don’t want to calculate the median for this column. We then apply the <code>cumsum()</code> function and an anonymous function using <code>purrr</code>’s <code>map_dfc</code> function. This is a special variation of the <code>map()</code> function that returns a dataframe instead of a list by combining the data by column. But, of course, we do still want the AGE information in there, so we add that column back in using <code>mutate()</code> and then reorder the columns so that AGE is at the front again using <code>select()</code>.</p>
<p>First let’s see what would happen if we used <code>map()</code> instead of <code>map_dfc()</code>:</p>
<div class="sourceCode" id="cb488"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb488-1"><a href="wrangle-data.html#cb488-1"></a> age_stats <span class="op">%&gt;%</span></span>
<span id="cb488-2"><a href="wrangle-data.html#cb488-2"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>AGE) <span class="op">%&gt;%</span></span>
<span id="cb488-3"><a href="wrangle-data.html#cb488-3"></a><span class="st">  </span><span class="kw">map</span>(cumsum) <span class="op">%&gt;%</span></span>
<span id="cb488-4"><a href="wrangle-data.html#cb488-4"></a><span class="st">  </span><span class="kw">map</span>(<span class="cf">function</span>(x) x<span class="op">/</span>x[<span class="kw">nrow</span>(age_stats)]) <span class="op">%&gt;%</span></span>
<span id="cb488-5"><a href="wrangle-data.html#cb488-5"></a><span class="st">  </span>glimpse</span></code></pre></div>
<pre><code>## List of 51
##  $ Alabama             : num [1:86] 0.0122 0.0243 0.0362 0.0484 0.0606 ...
##  $ Alaska              : num [1:86] 0.0152 0.0303 0.0452 0.0598 0.0746 ...
##  $ Arizona             : num [1:86] 0.0127 0.0255 0.0382 0.051 0.0639 ...
##  $ Arkansas            : num [1:86] 0.0129 0.0257 0.0384 0.0513 0.0642 ...
##  $ California          : num [1:86] 0.0128 0.0256 0.0384 0.0512 0.0643 ...
##  $ Colorado            : num [1:86] 0.0122 0.0244 0.0366 0.0489 0.0615 ...
##  $ Connecticut         : num [1:86] 0.0101 0.0203 0.0306 0.0411 0.0519 ...
##  $ Delaware            : num [1:86] 0.0116 0.0233 0.0348 0.0466 0.0587 ...
##  $ District of Columbia: num [1:86] 0.0146 0.0276 0.0407 0.0533 0.0657 ...
##  $ Florida             : num [1:86] 0.011 0.0219 0.0328 0.0437 0.0547 ...
##  $ Georgia             : num [1:86] 0.0128 0.0256 0.0384 0.0514 0.0647 ...
##  $ Hawaii              : num [1:86] 0.0128 0.0258 0.039 0.0519 0.065 ...
##  $ Idaho               : num [1:86] 0.0139 0.0274 0.0413 0.0549 0.069 ...
##  $ Illinois            : num [1:86] 0.0123 0.0245 0.0366 0.0488 0.0611 ...
##  $ Indiana             : num [1:86] 0.0126 0.0253 0.038 0.0507 0.0635 ...
##  $ Iowa                : num [1:86] 0.0127 0.0254 0.038 0.0506 0.063 ...
##  $ Kansas              : num [1:86] 0.0133 0.0268 0.0404 0.054 0.0677 ...
##  $ Kentucky            : num [1:86] 0.0126 0.0251 0.0376 0.05 0.0624 ...
##  $ Louisiana           : num [1:86] 0.0137 0.0272 0.0405 0.0536 0.0667 ...
##  $ Maine               : num [1:86] 0.00949 0.01906 0.02881 0.0386 0.04839 ...
##  $ Maryland            : num [1:86] 0.0123 0.0245 0.0367 0.049 0.0614 ...
##  $ Massachusetts       : num [1:86] 0.0106 0.0213 0.0319 0.0427 0.0536 ...
##  $ Michigan            : num [1:86] 0.0114 0.023 0.0345 0.046 0.0577 ...
##  $ Minnesota           : num [1:86] 0.0127 0.0256 0.0383 0.0511 0.0639 ...
##  $ Mississippi         : num [1:86] 0.0128 0.0255 0.0382 0.0512 0.0641 ...
##  $ Missouri            : num [1:86] 0.0123 0.0248 0.0371 0.0494 0.0618 ...
##  $ Montana             : num [1:86] 0.0123 0.0244 0.0364 0.0484 0.0604 ...
##  $ Nebraska            : num [1:86] 0.0141 0.0281 0.042 0.0557 0.0696 ...
##  $ Nevada              : num [1:86] 0.0125 0.0248 0.0374 0.0498 0.0626 ...
##  $ New Hampshire       : num [1:86] 0.00932 0.01866 0.02852 0.03814 0.04831 ...
##  $ New Jersey          : num [1:86] 0.0115 0.0232 0.0349 0.0468 0.0589 ...
##  $ New Mexico          : num [1:86] 0.0124 0.025 0.0376 0.0504 0.0634 ...
##  $ New York            : num [1:86] 0.0122 0.0241 0.036 0.0478 0.0598 ...
##  $ North Carolina      : num [1:86] 0.012 0.024 0.0359 0.0479 0.06 ...
##  $ North Dakota        : num [1:86] 0.015 0.0296 0.0438 0.0576 0.0709 ...
##  $ Ohio                : num [1:86] 0.012 0.024 0.036 0.048 0.0601 ...
##  $ Oklahoma            : num [1:86] 0.0136 0.0272 0.0409 0.0546 0.0683 ...
##  $ Oregon              : num [1:86] 0.0114 0.0229 0.0344 0.046 0.0577 ...
##  $ Pennsylvania        : num [1:86] 0.0111 0.0222 0.0333 0.0445 0.0558 ...
##  $ Rhode Island        : num [1:86] 0.0103 0.0205 0.0309 0.0413 0.0518 ...
##  $ South Carolina      : num [1:86] 0.0118 0.0236 0.0354 0.0474 0.0594 ...
##  $ South Dakota        : num [1:86] 0.0144 0.029 0.0433 0.0575 0.0714 ...
##  $ Tennessee           : num [1:86] 0.0123 0.0245 0.0367 0.049 0.0612 ...
##  $ Texas               : num [1:86] 0.0146 0.0292 0.0435 0.0578 0.0724 ...
##  $ Utah                : num [1:86] 0.0171 0.034 0.051 0.0676 0.0846 ...
##  $ Vermont             : num [1:86] 0.0096 0.0195 0.0292 0.039 0.0489 ...
##  $ Virginia            : num [1:86] 0.0123 0.0245 0.0367 0.0489 0.0612 ...
##  $ Washington          : num [1:86] 0.0124 0.0248 0.0373 0.0497 0.0623 ...
##  $ West Virginia       : num [1:86] 0.0108 0.0219 0.0331 0.0443 0.0554 ...
##  $ Wisconsin           : num [1:86] 0.0116 0.0232 0.0349 0.0467 0.0586 ...
##  $ Wyoming             : num [1:86] 0.0132 0.0262 0.0392 0.0523 0.0655 ...</code></pre>
<p>We can see that we create a list of vectors for each state.</p>
<p>Now let’s use <code>map_dfc()</code>:</p>
<div class="sourceCode" id="cb490"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb490-1"><a href="wrangle-data.html#cb490-1"></a><span class="co"># calculate median age for each state</span></span>
<span id="cb490-2"><a href="wrangle-data.html#cb490-2"></a>age_stats &lt;-<span class="st"> </span>age_stats <span class="op">%&gt;%</span></span>
<span id="cb490-3"><a href="wrangle-data.html#cb490-3"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>AGE) <span class="op">%&gt;%</span></span>
<span id="cb490-4"><a href="wrangle-data.html#cb490-4"></a><span class="st">  </span><span class="kw">map_dfc</span>(cumsum) <span class="op">%&gt;%</span></span>
<span id="cb490-5"><a href="wrangle-data.html#cb490-5"></a><span class="st">  </span><span class="kw">map_dfc</span>(<span class="cf">function</span>(x) x<span class="op">/</span>x[<span class="kw">nrow</span>(age_stats)]) <span class="op">%&gt;%</span></span>
<span id="cb490-6"><a href="wrangle-data.html#cb490-6"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">AGE =</span> age_stats<span class="op">$</span>AGE) <span class="op">%&gt;%</span></span>
<span id="cb490-7"><a href="wrangle-data.html#cb490-7"></a><span class="st">  </span><span class="kw">select</span>(AGE, <span class="kw">everything</span>())</span>
<span id="cb490-8"><a href="wrangle-data.html#cb490-8"></a></span>
<span id="cb490-9"><a href="wrangle-data.html#cb490-9"></a><span class="kw">glimpse</span>(age_stats)</span></code></pre></div>
<pre><code>## Rows: 86
## Columns: 52
## $ AGE                    &lt;dbl&gt; 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, …
## $ Alabama                &lt;dbl&gt; 0.01217929, 0.02428807, 0.03623586, 0.04835742…
## $ Alaska                 &lt;dbl&gt; 0.01524840, 0.03030168, 0.04521944, 0.05979438…
## $ Arizona                &lt;dbl&gt; 0.01273885, 0.02549314, 0.03824081, 0.05101803…
## $ Arkansas               &lt;dbl&gt; 0.01292266, 0.02569476, 0.03836806, 0.05126652…
## $ California             &lt;dbl&gt; 0.01283122, 0.02561725, 0.03841722, 0.05118957…
## $ Colorado               &lt;dbl&gt; 0.01217217, 0.02440058, 0.03655841, 0.04888552…
## $ Connecticut            &lt;dbl&gt; 0.01013228, 0.02030490, 0.03056879, 0.04107142…
## $ Delaware               &lt;dbl&gt; 0.01163322, 0.02326537, 0.03477678, 0.04661654…
## $ `District of Columbia` &lt;dbl&gt; 0.01457035, 0.02759032, 0.04071434, 0.05331661…
## $ Florida                &lt;dbl&gt; 0.01095628, 0.02192577, 0.03277035, 0.04371311…
## $ Georgia                &lt;dbl&gt; 0.01284902, 0.02562823, 0.03837038, 0.05144559…
## $ Hawaii                 &lt;dbl&gt; 0.01275029, 0.02580557, 0.03896040, 0.05191402…
## $ Idaho                  &lt;dbl&gt; 0.01390752, 0.02744397, 0.04125812, 0.05494312…
## $ Illinois               &lt;dbl&gt; 0.01233645, 0.02447549, 0.03656625, 0.04878623…
## $ Indiana                &lt;dbl&gt; 0.01264485, 0.02525899, 0.03798841, 0.05071888…
## $ Iowa                   &lt;dbl&gt; 0.01267030, 0.02538518, 0.03802630, 0.05063696…
## $ Kansas                 &lt;dbl&gt; 0.01334268, 0.02681406, 0.04039729, 0.05398568…
## $ Kentucky               &lt;dbl&gt; 0.01257763, 0.02509149, 0.03759246, 0.05002287…
## $ Louisiana              &lt;dbl&gt; 0.01366990, 0.02722998, 0.04047237, 0.05358525…
## $ Maine                  &lt;dbl&gt; 0.00949098, 0.01906255, 0.02881486, 0.03860408…
## $ Maryland               &lt;dbl&gt; 0.01233418, 0.02449538, 0.03670807, 0.04897542…
## $ Massachusetts          &lt;dbl&gt; 0.01064012, 0.02127391, 0.03194332, 0.04267411…
## $ Michigan               &lt;dbl&gt; 0.01142560, 0.02298902, 0.03448267, 0.04603339…
## $ Minnesota              &lt;dbl&gt; 0.01271147, 0.02555680, 0.03831076, 0.05107128…
## $ Mississippi            &lt;dbl&gt; 0.01277126, 0.02554419, 0.03822836, 0.05115873…
## $ Missouri               &lt;dbl&gt; 0.01232034, 0.02475678, 0.03708173, 0.04938873…
## $ Montana                &lt;dbl&gt; 0.01225303, 0.02440298, 0.03639442, 0.04838391…
## $ Nebraska               &lt;dbl&gt; 0.01411096, 0.02814111, 0.04197798, 0.05572191…
## $ Nevada                 &lt;dbl&gt; 0.01250131, 0.02483232, 0.03739746, 0.04979506…
## $ `New Hampshire`        &lt;dbl&gt; 0.009324624, 0.018656767, 0.028516676, 0.03813…
## $ `New Jersey`           &lt;dbl&gt; 0.01153672, 0.02318527, 0.03489888, 0.04677209…
## $ `New Mexico`           &lt;dbl&gt; 0.01241485, 0.02496946, 0.03762395, 0.05035577…
## $ `New York`             &lt;dbl&gt; 0.01217189, 0.02407385, 0.03599014, 0.04784986…
## $ `North Carolina`       &lt;dbl&gt; 0.01200077, 0.02400872, 0.03589836, 0.04789096…
## $ `North Dakota`         &lt;dbl&gt; 0.01498293, 0.02957241, 0.04375387, 0.05755379…
## $ Ohio                   &lt;dbl&gt; 0.01195482, 0.02398530, 0.03604946, 0.04804797…
## $ Oklahoma               &lt;dbl&gt; 0.01360302, 0.02720220, 0.04094481, 0.05455859…
## $ Oregon                 &lt;dbl&gt; 0.01137846, 0.02290605, 0.03443489, 0.04598165…
## $ Pennsylvania           &lt;dbl&gt; 0.01105806, 0.02218984, 0.03332365, 0.04452838…
## $ `Rhode Island`         &lt;dbl&gt; 0.01029817, 0.02052152, 0.03085757, 0.04130916…
## $ `South Carolina`       &lt;dbl&gt; 0.01182747, 0.02361386, 0.03537920, 0.04736508…
## $ `South Dakota`         &lt;dbl&gt; 0.01441743, 0.02898356, 0.04325579, 0.05748470…
## $ Tennessee              &lt;dbl&gt; 0.01234189, 0.02454161, 0.03672630, 0.04900204…
## $ Texas                  &lt;dbl&gt; 0.01460720, 0.02916560, 0.04354217, 0.05781300…
## $ Utah                   &lt;dbl&gt; 0.01705642, 0.03397314, 0.05104564, 0.06758513…
## $ Vermont                &lt;dbl&gt; 0.009603574, 0.019524225, 0.029198261, 0.03901…
## $ Virginia               &lt;dbl&gt; 0.01229627, 0.02446226, 0.03665131, 0.04888352…
## $ Washington             &lt;dbl&gt; 0.01241119, 0.02476856, 0.03725623, 0.04972054…
## $ `West Virginia`        &lt;dbl&gt; 0.01083507, 0.02189516, 0.03312702, 0.04427952…
## $ Wisconsin              &lt;dbl&gt; 0.01158854, 0.02323645, 0.03492551, 0.04674149…
## $ Wyoming                &lt;dbl&gt; 0.01320760, 0.02620022, 0.03920990, 0.05229295…</code></pre>
<p>Great, we have a tidy dataframe with a column for each state storing important census information for both ethnicity and age. Now onto the other datasets!</p>
</div>
<div id="violent-crime" class="section level4" number="3.11.2.2">
<h4><span class="header-section-number">3.11.2.2</span> Violent Crime</h4>
<p>For crime, we have the following data:</p>
<div class="sourceCode" id="cb492"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb492-1"><a href="wrangle-data.html#cb492-1"></a>crime</span></code></pre></div>
<pre><code>## # A tibble: 510 x 14
##    State Area  ...3  Population `Violent\ncrime… `Murder and \nn…
##    &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;                 &lt;dbl&gt;            &lt;dbl&gt;
##  1 ALAB… Metr… &lt;NA&gt;  3708033                  NA               NA
##  2 &lt;NA&gt;  &lt;NA&gt;  Area… 0.9709999…            18122              283
##  3 &lt;NA&gt;  &lt;NA&gt;  Esti… 1                     18500              287
##  4 &lt;NA&gt;  Citi… &lt;NA&gt;  522241                   NA               NA
##  5 &lt;NA&gt;  &lt;NA&gt;  Area… 0.9739999…             3178               32
##  6 &lt;NA&gt;  &lt;NA&gt;  Esti… 1                      3240               33
##  7 &lt;NA&gt;  Nonm… &lt;NA&gt;  628705                   NA               NA
##  8 &lt;NA&gt;  &lt;NA&gt;  Area… 0.9939999…             1205               28
##  9 &lt;NA&gt;  &lt;NA&gt;  Esti… 1                      1212               28
## 10 &lt;NA&gt;  Stat… &lt;NA&gt;  4858979               22952              348
## # … with 500 more rows, and 8 more variables:
## #   `Rape\n(revised\ndefinition)2` &lt;dbl&gt;, `Rape\n(legacy\ndefinition)3` &lt;dbl&gt;,
## #   Robbery &lt;dbl&gt;, `Aggravated \nassault` &lt;dbl&gt;, `Property \ncrime` &lt;dbl&gt;,
## #   Burglary &lt;dbl&gt;, `Larceny-\ntheft` &lt;dbl&gt;, `Motor \nvehicle \ntheft` &lt;dbl&gt;</code></pre>
<p>IF we take a look at what information is stored in each column…</p>
<div class="sourceCode" id="cb494"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb494-1"><a href="wrangle-data.html#cb494-1"></a><span class="kw">colnames</span>(crime)</span></code></pre></div>
<pre><code>##  [1] &quot;State&quot;                                   
##  [2] &quot;Area&quot;                                    
##  [3] &quot;...3&quot;                                    
##  [4] &quot;Population&quot;                              
##  [5] &quot;Violent\ncrime1&quot;                         
##  [6] &quot;Murder and \nnonnegligent \nmanslaughter&quot;
##  [7] &quot;Rape\n(revised\ndefinition)2&quot;            
##  [8] &quot;Rape\n(legacy\ndefinition)3&quot;             
##  [9] &quot;Robbery&quot;                                 
## [10] &quot;Aggravated \nassault&quot;                    
## [11] &quot;Property \ncrime&quot;                        
## [12] &quot;Burglary&quot;                                
## [13] &quot;Larceny-\ntheft&quot;                         
## [14] &quot;Motor \nvehicle \ntheft&quot;</code></pre>
<p>you see that it’s kind of a mess and there’s a whole bunch of information in there that we’re not necessarily interested in for this analysis.</p>
<p>Because of the messy names here (we’ll clean them up in a bit), we’ll see the column index to select columns instead of the complicated names. Also, we print a specified row of violent crime to observe the <code>X__1</code> group we are looking for – Rate per 100,000 inhabitants (per the study.)</p>
<div class="sourceCode" id="cb496"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb496-1"><a href="wrangle-data.html#cb496-1"></a>violentcrime &lt;-<span class="st"> </span>crime <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb496-2"><a href="wrangle-data.html#cb496-2"></a><span class="st">  </span><span class="kw">select</span>(<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">5</span>))</span>
<span id="cb496-3"><a href="wrangle-data.html#cb496-3"></a></span>
<span id="cb496-4"><a href="wrangle-data.html#cb496-4"></a>violentcrime</span></code></pre></div>
<pre><code>## # A tibble: 510 x 3
##    State   ...3                    `Violent\ncrime1`
##    &lt;chr&gt;   &lt;chr&gt;                               &lt;dbl&gt;
##  1 ALABAMA &lt;NA&gt;                                   NA
##  2 &lt;NA&gt;    Area actually reporting             18122
##  3 &lt;NA&gt;    Estimated total                     18500
##  4 &lt;NA&gt;    &lt;NA&gt;                                   NA
##  5 &lt;NA&gt;    Area actually reporting              3178
##  6 &lt;NA&gt;    Estimated total                      3240
##  7 &lt;NA&gt;    &lt;NA&gt;                                   NA
##  8 &lt;NA&gt;    Area actually reporting              1205
##  9 &lt;NA&gt;    Estimated total                      1212
## 10 &lt;NA&gt;    &lt;NA&gt;                                22952
## # … with 500 more rows</code></pre>
<p>Great, so we’re starting to home in on the data we’re interested in but we’re ultimately interested in Rate per 100,000 inhabitants, so we need get all rows where the second column is equal to <code>Rate per 100,000 inhabitants</code>.</p>
<p>However, as we can see above, the value for State in these rows is <code>NA</code>, so we need to <code>fill()</code> that value with the state name that is listed in a previous row. Then we can select the rows where the second column is <code>Rate per 100,000 inhabitants</code>. After that, we no longer need the second column, so we’ll remove it.</p>
<div class="sourceCode" id="cb498"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb498-1"><a href="wrangle-data.html#cb498-1"></a>violentcrime &lt;-<span class="st"> </span>violentcrime <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb498-2"><a href="wrangle-data.html#cb498-2"></a><span class="st">  </span><span class="kw">fill</span>(State) <span class="op">%&gt;%</span></span>
<span id="cb498-3"><a href="wrangle-data.html#cb498-3"></a><span class="st">  </span><span class="kw">filter</span>(.[[<span class="dv">2</span>]] <span class="op">==</span><span class="st"> &quot;Rate per 100,000 inhabitants&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb498-4"><a href="wrangle-data.html#cb498-4"></a><span class="st">  </span><span class="kw">rename</span>( <span class="dt">violent_crime =</span> <span class="st">`</span><span class="dt">Violent</span><span class="ch">\n</span><span class="dt">crime1</span><span class="st">`</span>) <span class="op">%&gt;%</span></span>
<span id="cb498-5"><a href="wrangle-data.html#cb498-5"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span><span class="st">`</span><span class="dt">...3</span><span class="st">`</span>)</span>
<span id="cb498-6"><a href="wrangle-data.html#cb498-6"></a>  </span>
<span id="cb498-7"><a href="wrangle-data.html#cb498-7"></a>violentcrime</span></code></pre></div>
<pre><code>## # A tibble: 52 x 2
##    State                 violent_crime
##    &lt;chr&gt;                         &lt;dbl&gt;
##  1 ALABAMA                        472.
##  2 ALASKA                         730.
##  3 ARIZONA                        410.
##  4 ARKANSAS                       521.
##  5 CALIFORNIA                     426.
##  6 COLORADO                       321 
##  7 CONNECTICUT                    218.
##  8 DELAWARE                       499 
##  9 DISTRICT OF COLUMBIA4         1269.
## 10 FLORIDA                        462.
## # … with 42 more rows</code></pre>
<p>If we look closely at our data, we’ll notice that some of our state names have 6s at the end of them. This will cause problems later on.</p>
<div class="sourceCode" id="cb500"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb500-1"><a href="wrangle-data.html#cb500-1"></a>violentcrime<span class="op">$</span>State[<span class="dv">20</span>]</span></code></pre></div>
<pre><code>## [1] &quot;MAINE6&quot;</code></pre>
<p>So, let’s clean that up now be removing those trailing numeric values <em>and</em> converting the names to lower case:</p>
<div class="sourceCode" id="cb502"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb502-1"><a href="wrangle-data.html#cb502-1"></a><span class="co"># lower case and remove numbers from State column</span></span>
<span id="cb502-2"><a href="wrangle-data.html#cb502-2"></a>violentcrime &lt;-<span class="st"> </span>violentcrime <span class="op">%&gt;%</span></span>
<span id="cb502-3"><a href="wrangle-data.html#cb502-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">State =</span> <span class="kw">tolower</span>(<span class="kw">gsub</span>(<span class="st">&#39;[0-9]+&#39;</span>, <span class="st">&#39;&#39;</span>, State)))</span>
<span id="cb502-4"><a href="wrangle-data.html#cb502-4"></a></span>
<span id="cb502-5"><a href="wrangle-data.html#cb502-5"></a>violentcrime</span></code></pre></div>
<pre><code>## # A tibble: 52 x 2
##    State                violent_crime
##    &lt;chr&gt;                        &lt;dbl&gt;
##  1 alabama                       472.
##  2 alaska                        730.
##  3 arizona                       410.
##  4 arkansas                      521.
##  5 california                    426.
##  6 colorado                      321 
##  7 connecticut                   218.
##  8 delaware                      499 
##  9 district of columbia         1269.
## 10 florida                       462.
## # … with 42 more rows</code></pre>
<p>We’ve now got ourselves a tidy dataset with violent crime information that’s ready to be joined with our census_stats data!</p>
<div class="sourceCode" id="cb504"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb504-1"><a href="wrangle-data.html#cb504-1"></a><span class="co"># join with census data</span></span>
<span id="cb504-2"><a href="wrangle-data.html#cb504-2"></a>firearms &lt;-<span class="st"> </span><span class="kw">left_join</span>(census_stats, violentcrime, </span>
<span id="cb504-3"><a href="wrangle-data.html#cb504-3"></a>                  <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;NAME&quot;</span> =<span class="st"> &quot;State&quot;</span>))</span>
<span id="cb504-4"><a href="wrangle-data.html#cb504-4"></a></span>
<span id="cb504-5"><a href="wrangle-data.html#cb504-5"></a>firearms</span></code></pre></div>
<pre><code>## # A tibble: 51 x 7
##    NAME                 white black hispanic  male total_pop violent_crime
##    &lt;chr&gt;                &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;         &lt;dbl&gt;
##  1 alabama               69.5 26.7      4.13  48.5   4850858          472.
##  2 alaska                66.5  3.67     6.82  52.4    737979          730.
##  3 arizona               83.5  4.80    30.9   49.7   6802262          410.
##  4 arkansas              79.6 15.7      7.18  49.1   2975626          521.
##  5 california            73.0  6.49    38.7   49.7  39032444          426.
##  6 colorado              87.6  4.47    21.3   50.3   5440445          321 
##  7 connecticut           80.9 11.6     15.3   48.8   3593862          218.
##  8 delaware              70.3 22.5      8.96  48.4    944107          499 
##  9 district of columbia  44.1 48.5     10.7   47.4    672736         1269.
## 10 florida               77.7 16.9     24.7   48.9  20268567          462.
## # … with 41 more rows</code></pre>
</div>
<div id="brady-scores" class="section level4" number="3.11.2.3">
<h4><span class="header-section-number">3.11.2.3</span> Brady Scores</h4>
<p>The study by AJPH groups the scores using 7 different categories. The study removed all weightings of the different laws in favor of a “1 law 1 point” system, since the weightings were “somewhat arbitrary.”</p>
<p>For the purpose of practice and simplification we will just keep the first line of “total state points” from the Brady Scorecard as they are given. This will be where our analysis differs from the study. We need to transform the data frame so that we have a column of state names and a column of the corresponding total scores.</p>
<div class="sourceCode" id="cb506"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb506-1"><a href="wrangle-data.html#cb506-1"></a>brady</span></code></pre></div>
<pre><code>## # A tibble: 116 x 54
##    `States can rec… `Category Point… `Sub Category P… Points AL    AK    AR   
##    &lt;chr&gt;                       &lt;dbl&gt;            &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;
##  1 TOTAL STATE POI…               NA               NA     NA -18   -30   -24  
##  2 CATEGORY 1:  KE…               50               NA     NA &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; 
##  3 BACKGROUND CHEC…               NA               25     NA AL    AK    AR   
##  4 Background Chec…               NA               NA     25 &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; 
##  5 Background Chec…               NA               NA     20 &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; 
##  6 Background Chec…               NA               NA      5 &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; 
##  7 Verifiy Legal P…               NA               NA     20 &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; 
##  8 TOTAL                          NA               NA     NA 0     0     0    
##  9 &lt;NA&gt;                           NA               NA     NA &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; 
## 10 OTHER LAWS TO S…               NA               12     NA AL    AK    AR   
## # … with 106 more rows, and 47 more variables: AZ &lt;chr&gt;, CA &lt;chr&gt;, CO &lt;chr&gt;,
## #   CT &lt;chr&gt;, DE &lt;chr&gt;, FL &lt;chr&gt;, GA &lt;chr&gt;, HI &lt;chr&gt;, ID &lt;chr&gt;, IL &lt;chr&gt;,
## #   IN &lt;chr&gt;, IA &lt;chr&gt;, KS &lt;chr&gt;, KY &lt;chr&gt;, LA &lt;chr&gt;, MA &lt;chr&gt;, MD &lt;chr&gt;,
## #   ME &lt;chr&gt;, MI &lt;chr&gt;, MN &lt;chr&gt;, MO &lt;chr&gt;, MT &lt;chr&gt;, MS &lt;chr&gt;, NC &lt;chr&gt;,
## #   ND &lt;chr&gt;, NE &lt;chr&gt;, NH &lt;chr&gt;, NJ &lt;chr&gt;, NM &lt;chr&gt;, NV &lt;chr&gt;, NY &lt;chr&gt;,
## #   OK &lt;chr&gt;, OH &lt;chr&gt;, OR &lt;chr&gt;, PA &lt;chr&gt;, RI &lt;chr&gt;, SC &lt;chr&gt;, SD &lt;chr&gt;,
## #   TN &lt;chr&gt;, TX &lt;chr&gt;, UT &lt;chr&gt;, VA &lt;chr&gt;, VT &lt;chr&gt;, WA &lt;chr&gt;, WI &lt;chr&gt;,
## #   WV &lt;chr&gt;, WY &lt;chr&gt;</code></pre>
<p>This dataset includes a lot of information, but we’re interested in the brady scores for each state. These are stored in the row where the first column is equal to “TOTAL STATE POINTS,” so we <code>filter()</code> to only include that row. We then want to only receive the scores for each state, and not the information in the first few columns, so we specify that using <code>select()</code>. With the information we’re interested in, we then take the data from wide to long using <code>pivot_longer()</code>, renaming the columns as we go. Finally, we specify that the information in the <code>brady_scores</code> column is numeric, not a character.</p>
<div class="sourceCode" id="cb508"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb508-1"><a href="wrangle-data.html#cb508-1"></a>brady &lt;-<span class="st"> </span>brady <span class="op">%&gt;%</span></span>
<span id="cb508-2"><a href="wrangle-data.html#cb508-2"></a><span class="st">  </span><span class="kw">rename</span>(<span class="dt">Law =</span> <span class="st">`</span><span class="dt">States can receive a maximum of 100 points</span><span class="st">`</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb508-3"><a href="wrangle-data.html#cb508-3"></a><span class="st">  </span><span class="kw">filter</span>(Law <span class="op">==</span><span class="st"> &quot;TOTAL STATE POINTS&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb508-4"><a href="wrangle-data.html#cb508-4"></a><span class="st">  </span><span class="kw">select</span>((<span class="kw">ncol</span>(brady) <span class="op">-</span><span class="st"> </span><span class="dv">49</span>)<span class="op">:</span><span class="kw">ncol</span>(brady)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb508-5"><a href="wrangle-data.html#cb508-5"></a><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="kw">everything</span>(), </span>
<span id="cb508-6"><a href="wrangle-data.html#cb508-6"></a>               <span class="dt">names_to =</span> <span class="st">&quot;state&quot;</span>,</span>
<span id="cb508-7"><a href="wrangle-data.html#cb508-7"></a>               <span class="dt">values_to =</span> <span class="st">&quot;brady_scores&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb508-8"><a href="wrangle-data.html#cb508-8"></a><span class="st">  </span><span class="kw">mutate_at</span>(<span class="st">&quot;brady_scores&quot;</span>, as.numeric)</span>
<span id="cb508-9"><a href="wrangle-data.html#cb508-9"></a></span>
<span id="cb508-10"><a href="wrangle-data.html#cb508-10"></a>brady</span></code></pre></div>
<pre><code>## # A tibble: 50 x 2
##    state brady_scores
##    &lt;chr&gt;        &lt;dbl&gt;
##  1 AL           -18  
##  2 AK           -30  
##  3 AR           -24  
##  4 AZ           -39  
##  5 CA            76  
##  6 CO            22  
##  7 CT            73  
##  8 DE            41  
##  9 FL           -20.5
## 10 GA           -18  
## # … with 40 more rows</code></pre>
<p>Only problem now is that we have the two letter state code, rather than the full state name we’ve been joining on so far here. We can, however, use the <code>state</code> datasets we used in the first case study here!</p>
<div class="sourceCode" id="cb510"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb510-1"><a href="wrangle-data.html#cb510-1"></a>brady &lt;-<span class="st"> </span>brady <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb510-2"><a href="wrangle-data.html#cb510-2"></a><span class="st">  </span><span class="kw">left_join</span>(<span class="kw">rename</span>(state_data, <span class="dt">state =</span> abb), </span>
<span id="cb510-3"><a href="wrangle-data.html#cb510-3"></a>            <span class="dt">by =</span> <span class="st">&quot;state&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb510-4"><a href="wrangle-data.html#cb510-4"></a><span class="st">  </span><span class="kw">select</span>(Location, brady_scores) <span class="op">%&gt;%</span></span>
<span id="cb510-5"><a href="wrangle-data.html#cb510-5"></a><span class="st">  </span><span class="kw">rename</span>(<span class="dt">state =</span> Location) <span class="op">%&gt;%</span></span>
<span id="cb510-6"><a href="wrangle-data.html#cb510-6"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">state =</span> <span class="kw">tolower</span>(state))</span>
<span id="cb510-7"><a href="wrangle-data.html#cb510-7"></a></span>
<span id="cb510-8"><a href="wrangle-data.html#cb510-8"></a>brady</span></code></pre></div>
<pre><code>## # A tibble: 50 x 2
##    state       brady_scores
##    &lt;chr&gt;              &lt;dbl&gt;
##  1 alabama            -18  
##  2 alaska             -30  
##  3 arkansas           -24  
##  4 arizona            -39  
##  5 california          76  
##  6 colorado            22  
##  7 connecticut         73  
##  8 delaware            41  
##  9 florida            -20.5
## 10 georgia            -18  
## # … with 40 more rows</code></pre>
<p>Now, it’s time to join this information into our growing dataframe <code>firearms</code>:</p>
<div class="sourceCode" id="cb512"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb512-1"><a href="wrangle-data.html#cb512-1"></a>firearms &lt;-<span class="st"> </span><span class="kw">left_join</span>(firearms, brady, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;NAME&quot;</span> =<span class="st"> &quot;state&quot;</span>))</span>
<span id="cb512-2"><a href="wrangle-data.html#cb512-2"></a></span>
<span id="cb512-3"><a href="wrangle-data.html#cb512-3"></a>firearms</span></code></pre></div>
<pre><code>## # A tibble: 51 x 8
##    NAME          white black hispanic  male total_pop violent_crime brady_scores
##    &lt;chr&gt;         &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;         &lt;dbl&gt;        &lt;dbl&gt;
##  1 alabama        69.5 26.7      4.13  48.5   4850858          472.        -18  
##  2 alaska         66.5  3.67     6.82  52.4    737979          730.        -30  
##  3 arizona        83.5  4.80    30.9   49.7   6802262          410.        -39  
##  4 arkansas       79.6 15.7      7.18  49.1   2975626          521.        -24  
##  5 california     73.0  6.49    38.7   49.7  39032444          426.         76  
##  6 colorado       87.6  4.47    21.3   50.3   5440445          321          22  
##  7 connecticut    80.9 11.6     15.3   48.8   3593862          218.         73  
##  8 delaware       70.3 22.5      8.96  48.4    944107          499          41  
##  9 district of …  44.1 48.5     10.7   47.4    672736         1269.         NA  
## 10 florida        77.7 16.9     24.7   48.9  20268567          462.        -20.5
## # … with 41 more rows</code></pre>
</div>
<div id="the-counted-fatal-shootings" class="section level4" number="3.11.2.4">
<h4><span class="header-section-number">3.11.2.4</span> The Counted Fatal Shootings</h4>
<p>We’re making progress, but we have a ways to go still! Let’s get working on incorporating data from The Counted.</p>
<p>As a reminder, we have a datasets here with data from 2015:</p>
<div class="sourceCode" id="cb514"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb514-1"><a href="wrangle-data.html#cb514-1"></a>counted15</span></code></pre></div>
<pre><code>## # A tibble: 1,146 x 6
##    gender raceethnicity    state classification  lawenforcementagency   armed   
##    &lt;chr&gt;  &lt;chr&gt;            &lt;chr&gt; &lt;chr&gt;           &lt;chr&gt;                  &lt;chr&gt;   
##  1 Male   Black            GA    Death in custo… Chatham County Sherif… No      
##  2 Male   White            OR    Gunshot         Washington County She… Firearm 
##  3 Male   White            HI    Struck by vehi… Kauai Police Departme… No      
##  4 Male   Hispanic/Latino  KS    Gunshot         Wichita Police Depart… No      
##  5 Male   Asian/Pacific I… WA    Gunshot         Mason County Sheriff&#39;… Firearm 
##  6 Male   White            CA    Gunshot         San Francisco Police … Non-let…
##  7 Male   Hispanic/Latino  AZ    Gunshot         Chandler Police Depar… Firearm 
##  8 Male   Hispanic/Latino  CO    Gunshot         Evans Police Departme… Other   
##  9 Male   White            CA    Gunshot         Stockton Police Depar… Knife   
## 10 Male   Black            CA    Taser           Los Angeles County Sh… No      
## # … with 1,136 more rows</code></pre>
<p>The data from each year are in a similar format with each row representing a different individual and the columns being consistent between the two datasets.</p>
<p>Because of this consistent format, we can combine these two datasets using <code>bind_rows()</code>. By specifying <code>id = "dataset"</code>, a column called <code>dataset</code> will store which dataset each row came from originally. We can then use <code>mutate()</code> and <code>ifelse()</code> to conditionally specify the year – 2015 or 2016 – from which the data originated. We’ll also be sure to change the two letter state abbreviation to the lower case state name, to allow for each merging.</p>
<div class="sourceCode" id="cb516"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb516-1"><a href="wrangle-data.html#cb516-1"></a>counted15 &lt;-<span class="st"> </span>counted15 <span class="op">%&gt;%</span></span>
<span id="cb516-2"><a href="wrangle-data.html#cb516-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">state =</span> <span class="kw">tolower</span>(state.name[<span class="kw">match</span>(state, state.abb)]))</span></code></pre></div>
<p>At this point, we have a lot of information at the individual level, but we’d like to summarize this at the state level by ethnicity, gender, and armed status. The researchers “calculated descriptive statistics for the proportion of victims that were male, armed, and non-White,” so we’ll do the same. We can accomplish this using <code>dplyr</code>. The <code>tally()</code> function will be particularly helpful here to count the number of observations in each group. We’re calculating this for each state as well as calculating the annualized rate per 1,000,000 residents. This utilizes the <code>total_pop</code> column from the <code>census_stats</code> data frame we used earlier.</p>
<div class="sourceCode" id="cb517"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb517-1"><a href="wrangle-data.html#cb517-1"></a><span class="co"># get overall stats</span></span>
<span id="cb517-2"><a href="wrangle-data.html#cb517-2"></a>counted_stats &lt;-<span class="st"> </span>counted15 <span class="op">%&gt;%</span></span>
<span id="cb517-3"><a href="wrangle-data.html#cb517-3"></a><span class="st">  </span><span class="kw">group_by</span>(state) <span class="op">%&gt;%</span></span>
<span id="cb517-4"><a href="wrangle-data.html#cb517-4"></a><span class="st">  </span><span class="kw">filter</span>(classification <span class="op">==</span><span class="st"> &quot;Gunshot&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb517-5"><a href="wrangle-data.html#cb517-5"></a><span class="st">  </span><span class="kw">tally</span>() <span class="op">%&gt;%</span></span>
<span id="cb517-6"><a href="wrangle-data.html#cb517-6"></a><span class="st">  </span><span class="kw">rename</span>(<span class="st">&quot;gunshot_tally&quot;</span> =<span class="st"> &quot;n&quot;</span>)</span>
<span id="cb517-7"><a href="wrangle-data.html#cb517-7"></a></span>
<span id="cb517-8"><a href="wrangle-data.html#cb517-8"></a><span class="co"># get summary for subset of population</span></span>
<span id="cb517-9"><a href="wrangle-data.html#cb517-9"></a>gunshot_filtered &lt;-<span class="st"> </span>counted15 <span class="op">%&gt;%</span></span>
<span id="cb517-10"><a href="wrangle-data.html#cb517-10"></a><span class="st">  </span><span class="kw">group_by</span>(state) <span class="op">%&gt;%</span></span>
<span id="cb517-11"><a href="wrangle-data.html#cb517-11"></a><span class="st">  </span><span class="kw">filter</span>(classification <span class="op">==</span><span class="st"> &quot;Gunshot&quot;</span>,raceethnicity <span class="op">!=</span><span class="st"> &quot;white&quot;</span>, armed <span class="op">!=</span><span class="st"> &quot;No&quot;</span>, gender <span class="op">==</span><span class="st"> &quot;Male&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb517-12"><a href="wrangle-data.html#cb517-12"></a><span class="st">  </span><span class="kw">tally</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb517-13"><a href="wrangle-data.html#cb517-13"></a><span class="st">  </span><span class="kw">rename</span>(<span class="st">&quot;gunshot_filtered&quot;</span> =<span class="st"> &quot;n&quot;</span>)</span>
<span id="cb517-14"><a href="wrangle-data.html#cb517-14"></a></span>
<span id="cb517-15"><a href="wrangle-data.html#cb517-15"></a><span class="co"># join data together</span></span>
<span id="cb517-16"><a href="wrangle-data.html#cb517-16"></a>counted_stats &lt;-<span class="st"> </span><span class="kw">left_join</span>(counted_stats, gunshot_filtered, <span class="dt">by =</span> <span class="st">&quot;state&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb517-17"><a href="wrangle-data.html#cb517-17"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">total_pop =</span> census_stats<span class="op">$</span>total_pop[<span class="kw">match</span>(state, census_stats<span class="op">$</span>NAME)],</span>
<span id="cb517-18"><a href="wrangle-data.html#cb517-18"></a>         <span class="dt">gunshot_rate =</span> (gunshot_tally<span class="op">/</span>total_pop)<span class="op">*</span><span class="dv">1000000</span><span class="op">/</span><span class="dv">2</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb517-19"><a href="wrangle-data.html#cb517-19"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>total_pop)</span>
<span id="cb517-20"><a href="wrangle-data.html#cb517-20"></a></span>
<span id="cb517-21"><a href="wrangle-data.html#cb517-21"></a>counted_stats</span></code></pre></div>
<pre><code>## # A tibble: 50 x 4
##    state                gunshot_tally gunshot_filtered gunshot_rate
##    &lt;chr&gt;                        &lt;int&gt;            &lt;int&gt;        &lt;dbl&gt;
##  1 alabama                         18               15        1.86 
##  2 alaska                           4                4        2.71 
##  3 arizona                         43               37        3.16 
##  4 arkansas                         5                4        0.840
##  5 california                     196              150        2.51 
##  6 colorado                        29               27        2.67 
##  7 connecticut                      2                2        0.278
##  8 delaware                         3                2        1.59 
##  9 district of columbia             5                4        3.72 
## 10 florida                         64               54        1.58 
## # … with 40 more rows</code></pre>
<p>Time to merge this into the data frame we’ve been compiling:</p>
<div class="sourceCode" id="cb519"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb519-1"><a href="wrangle-data.html#cb519-1"></a>firearms &lt;-<span class="st"> </span><span class="kw">left_join</span>(firearms, counted_stats, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;NAME&quot;</span> =<span class="st"> &quot;state&quot;</span>))</span></code></pre></div>
</div>
<div id="unemployment-data-1" class="section level4" number="3.11.2.5">
<h4><span class="header-section-number">3.11.2.5</span> Unemployment Data</h4>
<p>Let’s recall the table we scraped from the web, which is currently storing our unemployment data:</p>
<div class="sourceCode" id="cb520"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb520-1"><a href="wrangle-data.html#cb520-1"></a>unemployment</span></code></pre></div>
<pre><code>## # A tibble: 54 x 3
##    State           `2015rate` Rank 
##    &lt;chr&gt;           &lt;chr&gt;      &lt;chr&gt;
##  1 &quot;United States&quot; &quot;5.3&quot;      &quot;&quot;   
##  2 &quot;&quot;              &quot;&quot;         &quot;&quot;   
##  3 &quot;North Dakota&quot;  &quot;2.8&quot;      &quot;1&quot;  
##  4 &quot;Nebraska&quot;      &quot;3.0&quot;      &quot;2&quot;  
##  5 &quot;South Dakota&quot;  &quot;3.1&quot;      &quot;3&quot;  
##  6 &quot;New Hampshire&quot; &quot;3.4&quot;      &quot;4&quot;  
##  7 &quot;Hawaii&quot;        &quot;3.6&quot;      &quot;5&quot;  
##  8 &quot;Utah&quot;          &quot;3.6&quot;      &quot;5&quot;  
##  9 &quot;Vermont&quot;       &quot;3.6&quot;      &quot;5&quot;  
## 10 &quot;Minnesota&quot;     &quot;3.7&quot;      &quot;8&quot;  
## # … with 44 more rows</code></pre>
<p>Let’s first rename the columns to clean things up. You’ll note that there are more rows in this data frame (due to an empty row, the United States, and a note being in this dataset); however, when we <code>left_merge()</code> in just a second these will disappear, so we can ignore them for now.</p>
<div class="sourceCode" id="cb522"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb522-1"><a href="wrangle-data.html#cb522-1"></a>unemployment &lt;-<span class="st"> </span>unemployment <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb522-2"><a href="wrangle-data.html#cb522-2"></a><span class="st">  </span><span class="kw">rename</span>(<span class="st">&quot;state&quot;</span> =<span class="st"> &quot;State&quot;</span>, </span>
<span id="cb522-3"><a href="wrangle-data.html#cb522-3"></a>         <span class="st">&quot;unemployment_rate&quot;</span> =<span class="st"> &quot;2015rate&quot;</span>, </span>
<span id="cb522-4"><a href="wrangle-data.html#cb522-4"></a>         <span class="st">&quot;unemployment_rank&quot;</span> =<span class="st"> &quot;Rank&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb522-5"><a href="wrangle-data.html#cb522-5"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">state =</span> <span class="kw">tolower</span>(state)) <span class="op">%&gt;%</span></span>
<span id="cb522-6"><a href="wrangle-data.html#cb522-6"></a><span class="st">  </span><span class="kw">arrange</span>(state)</span>
<span id="cb522-7"><a href="wrangle-data.html#cb522-7"></a></span>
<span id="cb522-8"><a href="wrangle-data.html#cb522-8"></a>unemployment</span></code></pre></div>
<pre><code>## # A tibble: 54 x 3
##    state                  unemployment_rate unemployment_rank
##    &lt;chr&gt;                  &lt;chr&gt;             &lt;chr&gt;            
##  1 &quot;&quot;                     &quot;&quot;                &quot;&quot;               
##  2 &quot;alabama&quot;              &quot;6.1&quot;             &quot;42&quot;             
##  3 &quot;alaska&quot;               &quot;6.5&quot;             &quot;47&quot;             
##  4 &quot;arizona&quot;              &quot;6.1&quot;             &quot;42&quot;             
##  5 &quot;arkansas&quot;             &quot;5.0&quot;             &quot;24&quot;             
##  6 &quot;california&quot;           &quot;6.2&quot;             &quot;44&quot;             
##  7 &quot;colorado&quot;             &quot;3.9&quot;             &quot;10&quot;             
##  8 &quot;connecticut&quot;          &quot;5.7&quot;             &quot;35&quot;             
##  9 &quot;delaware&quot;             &quot;4.9&quot;             &quot;22&quot;             
## 10 &quot;district of columbia&quot; &quot;6.9&quot;             &quot;51&quot;             
## # … with 44 more rows</code></pre>
<p>Let’s do that join now. Let’s add unemployment information to our growing data frame!</p>
<div class="sourceCode" id="cb524"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb524-1"><a href="wrangle-data.html#cb524-1"></a>firearms &lt;-<span class="st"> </span><span class="kw">left_join</span>(firearms, unemployment, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;NAME&quot;</span> =<span class="st"> &quot;state&quot;</span>))</span></code></pre></div>
<p>If we take a look at the data we now have in our growing data frame, using <code>glimpse()</code>, we see that type is correct for most of our variables <em>except</em> <code>unemployment_rate</code> and <code>unemployment_rank</code>. This is due to that “Note” and empty (<code>""</code>) row in the unemployment dataset. So, let’s be sure to get that variable to a numeric now as it should be:</p>
<div class="sourceCode" id="cb525"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb525-1"><a href="wrangle-data.html#cb525-1"></a><span class="kw">glimpse</span>(firearms)</span></code></pre></div>
<pre><code>## Rows: 51
## Columns: 13
## $ NAME              &lt;chr&gt; &quot;alabama&quot;, &quot;alaska&quot;, &quot;arizona&quot;, &quot;arkansas&quot;, &quot;califo…
## $ white             &lt;dbl&gt; 69.50197, 66.51368, 83.52295, 79.57623, 72.97555, 8…
## $ black             &lt;dbl&gt; 26.7459489, 3.6679906, 4.7978011, 15.6634268, 6.491…
## $ hispanic          &lt;dbl&gt; 4.129434, 6.821197, 30.873010, 7.180439, 38.727129,…
## $ male              &lt;dbl&gt; 48.46650, 52.36978, 49.71595, 49.12855, 49.67815, 5…
## $ total_pop         &lt;dbl&gt; 4850858, 737979, 6802262, 2975626, 39032444, 544044…
## $ violent_crime     &lt;dbl&gt; 472.4, 730.2, 410.2, 521.3, 426.3, 321.0, 218.5, 49…
## $ brady_scores      &lt;dbl&gt; -18.0, -30.0, -39.0, -24.0, 76.0, 22.0, 73.0, 41.0,…
## $ gunshot_tally     &lt;int&gt; 18, 4, 43, 5, 196, 29, 2, 3, 5, 64, 29, 2, 7, 22, 1…
## $ gunshot_filtered  &lt;int&gt; 15, 4, 37, 4, 150, 27, 2, 2, 4, 54, 25, 2, 7, 21, 1…
## $ gunshot_rate      &lt;dbl&gt; 1.8553419, 2.7101042, 3.1607133, 0.8401593, 2.51073…
## $ unemployment_rate &lt;chr&gt; &quot;6.1&quot;, &quot;6.5&quot;, &quot;6.1&quot;, &quot;5.0&quot;, &quot;6.2&quot;, &quot;3.9&quot;, &quot;5.7&quot;, &quot;4…
## $ unemployment_rank &lt;chr&gt; &quot;42&quot;, &quot;47&quot;, &quot;42&quot;, &quot;24&quot;, &quot;44&quot;, &quot;10&quot;, &quot;35&quot;, &quot;22&quot;, &quot;51…</code></pre>
<div class="sourceCode" id="cb527"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb527-1"><a href="wrangle-data.html#cb527-1"></a><span class="co"># convert type for unemployment columns</span></span>
<span id="cb527-2"><a href="wrangle-data.html#cb527-2"></a>firearms &lt;-<span class="st"> </span>firearms <span class="op">%&gt;%</span></span>
<span id="cb527-3"><a href="wrangle-data.html#cb527-3"></a><span class="st">  </span><span class="kw">mutate_at</span>(<span class="st">&quot;unemployment_rate&quot;</span>, as.numeric) <span class="op">%&gt;%</span></span>
<span id="cb527-4"><a href="wrangle-data.html#cb527-4"></a><span class="st">  </span><span class="kw">mutate_at</span>(<span class="st">&quot;unemployment_rank&quot;</span>, as.integer)</span></code></pre></div>
</div>
<div id="population-density-2015" class="section level4" number="3.11.2.6">
<h4><span class="header-section-number">3.11.2.6</span> Population Density: 2015</h4>
<p>Population density for 2015 can be calculated from the Census data in combination with the land area data we’ve read in. This is calculated (rather than simply imported) because accurate data for state population in 2015 was not available in a downloadable format nor was it easy to scrape.</p>
<p>From the census data, we can obtain total population counts:</p>
<div class="sourceCode" id="cb528"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb528-1"><a href="wrangle-data.html#cb528-1"></a>totalPop &lt;-<span class="st"> </span>census <span class="op">%&gt;%</span></span>
<span id="cb528-2"><a href="wrangle-data.html#cb528-2"></a><span class="st">  </span><span class="kw">filter</span>(ORIGIN <span class="op">==</span><span class="st"> </span><span class="dv">0</span>, SEX <span class="op">==</span><span class="st"> </span><span class="dv">0</span> ) <span class="op">%&gt;%</span></span>
<span id="cb528-3"><a href="wrangle-data.html#cb528-3"></a><span class="st">  </span><span class="kw">group_by</span>(NAME) <span class="op">%&gt;%</span></span>
<span id="cb528-4"><a href="wrangle-data.html#cb528-4"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">total =</span> <span class="kw">sum</span>(POPESTIMATE2015)) <span class="op">%&gt;%</span></span>
<span id="cb528-5"><a href="wrangle-data.html#cb528-5"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">NAME =</span> <span class="kw">tolower</span>(NAME))</span></code></pre></div>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<div class="sourceCode" id="cb530"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb530-1"><a href="wrangle-data.html#cb530-1"></a>totalPop</span></code></pre></div>
<pre><code>## # A tibble: 51 x 2
##    NAME                    total
##    &lt;chr&gt;                   &lt;dbl&gt;
##  1 alabama               4850858
##  2 alaska                 737979
##  3 arizona               6802262
##  4 arkansas              2975626
##  5 california           39032444
##  6 colorado              5440445
##  7 connecticut           3593862
##  8 delaware               944107
##  9 district of columbia   672736
## 10 florida              20268567
## # … with 41 more rows</code></pre>
<p>Then, we select <code>LND110210D</code> by looking at the <code>land</code> table and comparing values on other sites (such as the census or Wikipedia) to find the correct column. This column corresponds to land area in square miles. We’ll convert all state names to lower case for easy merging with our growing data frame in a few steps.</p>
<div class="sourceCode" id="cb532"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb532-1"><a href="wrangle-data.html#cb532-1"></a>landSqMi &lt;-<span class="st"> </span>land <span class="op">%&gt;%</span></span>
<span id="cb532-2"><a href="wrangle-data.html#cb532-2"></a><span class="st">  </span><span class="kw">select</span>(Areaname, <span class="dt">land_area =</span> LND110210D) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb532-3"><a href="wrangle-data.html#cb532-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Areaname =</span> <span class="kw">tolower</span>(Areaname))</span>
<span id="cb532-4"><a href="wrangle-data.html#cb532-4"></a></span>
<span id="cb532-5"><a href="wrangle-data.html#cb532-5"></a>landSqMi</span></code></pre></div>
<pre><code>## # A tibble: 3,198 x 2
##    Areaname      land_area
##    &lt;chr&gt;             &lt;dbl&gt;
##  1 united states  3531905.
##  2 alabama          50645.
##  3 autauga, al        594.
##  4 baldwin, al       1590.
##  5 barbour, al        885.
##  6 bibb, al           623.
##  7 blount, al         645.
##  8 bullock, al        623.
##  9 butler, al         777.
## 10 calhoun, al        606.
## # … with 3,188 more rows</code></pre>
<p>Since <code>landSqMi</code> gives us area for each town in addition to the states, we will want merge on the state names to obtain only the area for each state, removing the city- and nation-level data. Also, because “district of columbia” appears twice, we’ll use the <code>distinct()</code> function to only include on entry for “district of columbia”</p>
<p>We can then calculate density and remove the <code>total</code> and <code>land_area</code> columns to only keep state name and density for each state:</p>
<div class="sourceCode" id="cb534"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb534-1"><a href="wrangle-data.html#cb534-1"></a>popdensity &lt;-<span class="st"> </span><span class="kw">left_join</span>(totalPop, landSqMi, <span class="dt">by=</span><span class="kw">c</span>(<span class="st">&quot;NAME&quot;</span> =<span class="st"> &quot;Areaname&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb534-2"><a href="wrangle-data.html#cb534-2"></a><span class="st">  </span><span class="kw">distinct</span>() <span class="op">%&gt;%</span></span>
<span id="cb534-3"><a href="wrangle-data.html#cb534-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">density =</span> total<span class="op">/</span>land_area) <span class="op">%&gt;%</span></span>
<span id="cb534-4"><a href="wrangle-data.html#cb534-4"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span><span class="kw">c</span>(total, land_area))</span>
<span id="cb534-5"><a href="wrangle-data.html#cb534-5"></a></span>
<span id="cb534-6"><a href="wrangle-data.html#cb534-6"></a>popdensity</span></code></pre></div>
<pre><code>## # A tibble: 51 x 2
##    NAME                  density
##    &lt;chr&gt;                   &lt;dbl&gt;
##  1 alabama                 95.8 
##  2 alaska                   1.29
##  3 arizona                 59.9 
##  4 arkansas                57.2 
##  5 california             251.  
##  6 colorado                52.5 
##  7 connecticut            742.  
##  8 delaware               485.  
##  9 district of columbia 11019.  
## 10 florida                378.  
## # … with 41 more rows</code></pre>
<p>This can now be joined with our growing data frame:</p>
<div class="sourceCode" id="cb536"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb536-1"><a href="wrangle-data.html#cb536-1"></a>firearms &lt;-<span class="st"> </span><span class="kw">left_join</span>(firearms, popdensity, <span class="dt">by=</span><span class="st">&quot;NAME&quot;</span>)</span></code></pre></div>
</div>
<div id="firearm-ownership" class="section level4" number="3.11.2.7">
<h4><span class="header-section-number">3.11.2.7</span> Firearm Ownership</h4>
<p>Last but not least, we calculate firearm ownership as a percent of firearm suicides to all suicides.</p>
<div class="sourceCode" id="cb537"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb537-1"><a href="wrangle-data.html#cb537-1"></a>ownership_df &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(<span class="kw">list</span>(<span class="st">&quot;NAME&quot;</span> =<span class="st"> </span><span class="kw">tolower</span>(suicide_all<span class="op">$</span>State), </span>
<span id="cb537-2"><a href="wrangle-data.html#cb537-2"></a>                          <span class="st">&quot;ownership&quot;</span> =<span class="st"> </span>suicide_firearm<span class="op">$</span>Deaths<span class="op">/</span>suicide_all<span class="op">$</span>Deaths<span class="op">*</span><span class="dv">100</span>))</span>
<span id="cb537-3"><a href="wrangle-data.html#cb537-3"></a>ownership_df</span></code></pre></div>
<pre><code>## # A tibble: 51 x 2
##    NAME        ownership
##    &lt;chr&gt;           &lt;dbl&gt;
##  1 alabama          70.1
##  2 alaska           59.9
##  3 arizona          57.4
##  4 arkansas         59.5
##  5 california       37.3
##  6 colorado         51.0
##  7 connecticut      27.4
##  8 delaware         49.8
##  9 florida          52.0
## 10 georgia          62.1
## # … with 41 more rows</code></pre>
<p>This can now be joined onto our tidy data frame:</p>
<div class="sourceCode" id="cb539"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb539-1"><a href="wrangle-data.html#cb539-1"></a>firearms &lt;-<span class="st"> </span><span class="kw">left_join</span>(firearms, ownership_df, <span class="dt">by=</span><span class="st">&quot;NAME&quot;</span>)</span></code></pre></div>
<p>And, with that, we’ve wrangled and tidied all these datasets into a single data frame. This can now be used for visualization and analysis!</p>
<p>Let’s save our new tidy data for case study #2.</p>
<div class="sourceCode" id="cb540"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb540-1"><a href="wrangle-data.html#cb540-1"></a><span class="kw">save</span>(firearms, <span class="dt">file =</span> here<span class="op">::</span><span class="kw">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;tidy_data&quot;</span>, <span class="st">&quot;case_study_2_tidy.rda&quot;</span>))</span></code></pre></div>

</div>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="get-data.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="dataviz.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["applieddatascience.pdf", "applieddatascience.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
